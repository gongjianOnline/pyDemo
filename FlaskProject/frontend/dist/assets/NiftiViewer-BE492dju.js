import{ax as It,P as ln,r as Rt,ay as sn,aw as un,o as dn,az as St,c as bt,O as Bt,F as fn,n as cn,ab as Ut,e as Ct,t as Yt}from"./index-iZTeaJac.js";function yt(et,ze){for(var W=0;W<ze.length;W++){const n=ze[W];if(typeof n!="string"&&!Array.isArray(n)){for(const e in n)if(e!=="default"&&!(e in et)){const a=Object.getOwnPropertyDescriptor(n,e);a&&Object.defineProperty(et,e,a.get?a:{enumerable:!0,get:()=>n[e]})}}}return Object.freeze(Object.defineProperty(et,Symbol.toStringTag,{value:"Module"}))}var Wt={exports:{}};/*! cornerstone-core - 2.6.1 - 2021-11-19 | (c) 2016 Chris Hafey | https://github.com/cornerstonejs/cornerstone */var Xt;function vn(){return Xt||(Xt=1,function(et,ze){(function(n,e){et.exports=e()})(window,function(){return function(W){function n(p){delete installedChunks[p]}var e=window.webpackHotUpdate;window.webpackHotUpdate=function(A,j){y(A,j),e&&e(A,j)};function a(p){var A=document.getElementsByTagName("head")[0],j=document.createElement("script");j.charset="utf-8",j.src=B.p+""+p+"."+l+".hot-update.js",A.appendChild(j)}function f(p){return p=p||1e4,new Promise(function(A,j){if(typeof XMLHttpRequest>"u")return j(new Error("No browser support"));try{var x=new XMLHttpRequest,L=B.p+""+l+".hot-update.json";x.open("GET",L,!0),x.timeout=p,x.send(null)}catch(U){return j(U)}x.onreadystatechange=function(){if(x.readyState===4)if(x.status===0)j(new Error("Manifest request to "+L+" timed out."));else if(x.status===404)A();else if(x.status!==200&&x.status!==304)j(new Error("Manifest request to "+L+" failed."));else{try{var U=JSON.parse(x.responseText)}catch(S){j(S);return}A(U)}}})}var d=!0,l="4d8d88ba53621f59b9a9",o=1e4,t={},r,s=[],i=[];function u(p){var A=H[p];if(!A)return B;var j=function(U){return A.hot.active?(H[U]?H[U].parents.indexOf(p)===-1&&H[U].parents.push(p):(s=[p],r=U),A.children.indexOf(U)===-1&&A.children.push(U)):s=[],B(U)},x=function(S){return{configurable:!0,enumerable:!0,get:function(){return B[S]},set:function(w){B[S]=w}}};for(var L in B)Object.prototype.hasOwnProperty.call(B,L)&&L!=="e"&&L!=="t"&&Object.defineProperty(j,L,x(L));return j.e=function(U){return g==="ready"&&v("prepare"),E++,B.e(U).then(S,function(w){throw S(),w});function S(){E--,g==="prepare"&&(T[U]||R(U),E===0&&m===0&&b())}},j.t=function(U,S){return S&1&&(U=j(U)),B.t(U,S&-2)},j}function c(p){var A={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:r!==p,active:!0,accept:function(j,x){if(j===void 0)A._selfAccepted=!0;else if(typeof j=="function")A._selfAccepted=j;else if(typeof j=="object")for(var L=0;L<j.length;L++)A._acceptedDependencies[j[L]]=x||function(){};else A._acceptedDependencies[j]=x||function(){}},decline:function(j){if(j===void 0)A._selfDeclined=!0;else if(typeof j=="object")for(var x=0;x<j.length;x++)A._declinedDependencies[j[x]]=!0;else A._declinedDependencies[j]=!0},dispose:function(j){A._disposeHandlers.push(j)},addDisposeHandler:function(j){A._disposeHandlers.push(j)},removeDisposeHandler:function(j){var x=A._disposeHandlers.indexOf(j);x>=0&&A._disposeHandlers.splice(x,1)},check:I,apply:z,status:function(j){if(!j)return g;h.push(j)},addStatusHandler:function(j){h.push(j)},removeStatusHandler:function(j){var x=h.indexOf(j);x>=0&&h.splice(x,1)},data:t[p]};return r=void 0,A}var h=[],g="idle";function v(p){g=p;for(var A=0;A<h.length;A++)h[A].call(null,p)}var m=0,E=0,T={},O={},M={},P,C,_;function D(p){var A=+p+""===p;return A?+p:p}function I(p){if(g!=="idle")throw new Error("check() is only allowed in idle status");return d=p,v("check"),f(o).then(function(A){if(!A)return v("idle"),null;O={},T={},M=A.c,_=A.h,v("prepare");var j=new Promise(function(L,U){P={resolve:L,reject:U}});C={};var x="cornerstone";return R(x),g==="prepare"&&E===0&&m===0&&b(),j})}function y(p,A){if(!(!M[p]||!O[p])){O[p]=!1;for(var j in A)Object.prototype.hasOwnProperty.call(A,j)&&(C[j]=A[j]);--m===0&&E===0&&b()}}function R(p){M[p]?(O[p]=!0,m++,a(p)):T[p]=!0}function b(){v("ready");var p=P;if(P=null,!!p)if(d)Promise.resolve().then(function(){return z(d)}).then(function(x){p.resolve(x)},function(x){p.reject(x)});else{var A=[];for(var j in C)Object.prototype.hasOwnProperty.call(C,j)&&A.push(D(j));p.resolve(A)}}function z(p){if(g!=="ready")throw new Error("apply() is only allowed in ready status");p=p||{};var A,j,x,L,U;function S(ie){for(var he=[ie],pe={},ye=he.slice().map(function(Ie){return{chain:[Ie],id:Ie}});ye.length>0;){var Se=ye.pop(),Re=Se.id,Be=Se.chain;if(L=H[Re],!(!L||L.hot._selfAccepted)){if(L.hot._selfDeclined)return{type:"self-declined",chain:Be,moduleId:Re};if(L.hot._main)return{type:"unaccepted",chain:Be,moduleId:Re};for(var Le=0;Le<L.parents.length;Le++){var J=L.parents[Le],Pe=H[J];if(Pe){if(Pe.hot._declinedDependencies[Re])return{type:"declined",chain:Be.concat([J]),moduleId:Re,parentId:J};if(he.indexOf(J)===-1){if(Pe.hot._acceptedDependencies[Re]){pe[J]||(pe[J]=[]),w(pe[J],[Re]);continue}delete pe[J],he.push(J),ye.push({chain:Be.concat([J]),id:J})}}}}}return{type:"accepted",moduleId:ie,outdatedModules:he,outdatedDependencies:pe}}function w(ie,he){for(var pe=0;pe<he.length;pe++){var ye=he[pe];ie.indexOf(ye)===-1&&ie.push(ye)}}var G={},$=[],Q={},re=function(){};for(var le in C)if(Object.prototype.hasOwnProperty.call(C,le)){U=D(le);var de;C[le]?de=S(U):de={type:"disposed",moduleId:le};var me=!1,Y=!1,V=!1,te="";switch(de.chain&&(te=`
Update propagation: `+de.chain.join(" -> ")),de.type){case"self-declined":p.onDeclined&&p.onDeclined(de),p.ignoreDeclined||(me=new Error("Aborted because of self decline: "+de.moduleId+te));break;case"declined":p.onDeclined&&p.onDeclined(de),p.ignoreDeclined||(me=new Error("Aborted because of declined dependency: "+de.moduleId+" in "+de.parentId+te));break;case"unaccepted":p.onUnaccepted&&p.onUnaccepted(de),p.ignoreUnaccepted||(me=new Error("Aborted because "+U+" is not accepted"+te));break;case"accepted":p.onAccepted&&p.onAccepted(de),Y=!0;break;case"disposed":p.onDisposed&&p.onDisposed(de),V=!0;break;default:throw new Error("Unexception type "+de.type)}if(me)return v("abort"),Promise.reject(me);if(Y){Q[U]=C[U],w($,de.outdatedModules);for(U in de.outdatedDependencies)Object.prototype.hasOwnProperty.call(de.outdatedDependencies,U)&&(G[U]||(G[U]=[]),w(G[U],de.outdatedDependencies[U]))}V&&(w($,[de.moduleId]),Q[U]=re)}var ne=[];for(j=0;j<$.length;j++)U=$[j],H[U]&&H[U].hot._selfAccepted&&ne.push({module:U,errorHandler:H[U].hot._selfAccepted});v("dispose"),Object.keys(M).forEach(function(ie){M[ie]===!1&&n(ie)});for(var ue,ge=$.slice();ge.length>0;)if(U=ge.pop(),L=H[U],!!L){var ve={},Ee=L.hot._disposeHandlers;for(x=0;x<Ee.length;x++)A=Ee[x],A(ve);for(t[U]=ve,L.hot.active=!1,delete H[U],delete G[U],x=0;x<L.children.length;x++){var De=H[L.children[x]];De&&(ue=De.parents.indexOf(U),ue>=0&&De.parents.splice(ue,1))}}var X,N;for(U in G)if(Object.prototype.hasOwnProperty.call(G,U)&&(L=H[U],L))for(N=G[U],x=0;x<N.length;x++)X=N[x],ue=L.children.indexOf(X),ue>=0&&L.children.splice(ue,1);v("apply"),l=_;for(U in Q)Object.prototype.hasOwnProperty.call(Q,U)&&(W[U]=Q[U]);var F=null;for(U in G)if(Object.prototype.hasOwnProperty.call(G,U)&&(L=H[U],L)){N=G[U];var q=[];for(j=0;j<N.length;j++)if(X=N[j],A=L.hot._acceptedDependencies[X],A){if(q.indexOf(A)!==-1)continue;q.push(A)}for(j=0;j<q.length;j++){A=q[j];try{A(N)}catch(ie){p.onErrored&&p.onErrored({type:"accept-errored",moduleId:U,dependencyId:N[j],error:ie}),p.ignoreErrored||F||(F=ie)}}}for(j=0;j<ne.length;j++){var oe=ne[j];U=oe.module,s=[U];try{B(U)}catch(ie){if(typeof oe.errorHandler=="function")try{oe.errorHandler(ie)}catch(he){p.onErrored&&p.onErrored({type:"self-accept-error-handler-errored",moduleId:U,error:he,originalError:ie}),p.ignoreErrored||F||(F=he),F||(F=ie)}else p.onErrored&&p.onErrored({type:"self-accept-errored",moduleId:U,error:ie}),p.ignoreErrored||F||(F=ie)}}return F?(v("fail"),Promise.reject(F)):(v("idle"),new Promise(function(ie){ie($)}))}var H={};function B(p){if(H[p])return H[p].exports;var A=H[p]={i:p,l:!1,exports:{},hot:c(p),parents:(i=s,s=[],i),children:[]};return W[p].call(A.exports,A,A.exports,u(p)),A.l=!0,A.exports}return B.m=W,B.c=H,B.d=function(p,A,j){B.o(p,A)||Object.defineProperty(p,A,{enumerable:!0,get:j})},B.r=function(p){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})},B.t=function(p,A){if(A&1&&(p=B(p)),A&8||A&4&&typeof p=="object"&&p&&p.__esModule)return p;var j=Object.create(null);if(B.r(j),Object.defineProperty(j,"default",{enumerable:!0,value:p}),A&2&&typeof p!="string")for(var x in p)B.d(j,x,(function(L){return p[L]}).bind(null,x));return j},B.n=function(p){var A=p&&p.__esModule?function(){return p.default}:function(){return p};return B.d(A,"a",A),A},B.o=function(p,A){return Object.prototype.hasOwnProperty.call(p,A)},B.p="",B.h=function(){return l},u("./index.js")(B.s="./index.js")}({"./canvasToPixel.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./internal/getTransform.js");n.default=function(d,l){var o=Object(a.getEnabledElement)(d),t=Object(f.default)(o);return t.invert(),t.transformPoint(l.x,l.y)}},"./colors/colormap.js":function(W,n,e){e.r(n),e.d(n,"getColormapsList",function(){return i}),e.d(n,"getColormap",function(){return u});var a=e("./colors/lookupTable.js"),f=[0,0,0,0],d={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}};function l(c,h,g){g=g===null?100:g;for(var v=(h-c)/(g-1),m=[];g-- >0;)m.push(c),c+=v;return m[m.length-1]=h,m}function o(c,h){for(var g=0,v=c.length-1;g<=v;){var m=g+Math.floor((v-g)/2),E=c[m];if(E===h)return m;h<E?v=m-1:g=m+1}return g}function t(c,h){var g,v=[],m=h.length;for(c.sort(function(E,T){return E-T}),g=0;g<m;g++)v[g]=o(c,h[g]);return v}function r(c,h,g){var v,m=[],E=[],T=[],O=[];for(g=g===null?1:g,v=0;v<h.length;v++){var M=h[v];m.push((c-1)*M[0]),E.push(M[1]),T.push(M[1])}var P=l(0,1,c);for(v=0;v<c;v++)P[v]=(c-1)*Math.pow(P[v],g);var C=t(m,P);for(v=1;v<c-1;v++){var _=C[v],D=(P[v]-m[_-1])/(m[_]-m[_-1]),I=E[_]-T[_-1];O[v]=D*I+T[_-1]}return O[0]=T[0],O[c-1]=E[h.length-1],O}function s(c,h,g){var v,m=[];h=h===null?256:h,g=g===null?1:g;var E=r(h,c.red,g),T=r(h,c.green,g),O=r(h,c.blue,g);for(v=0;v<h;v++){var M=Math.round(E[v]*255),P=Math.round(T[v]*255),C=Math.round(O[v]*255),_=[M,P,C,255];m.push(_)}return m}function i(){var c=[],h=Object.keys(d);return h.forEach(function(g){if(d.hasOwnProperty(g)){var v=d[g];c.push({id:g,name:v.name})}}),c.sort(function(g,v){var m=g.name.toLowerCase(),E=v.name.toLowerCase();return m===E?0:m<E?-1:1}),c}function u(c,h){var g=d[c];return g||(g=d[c]=h||{name:"",colors:[]}),!g.colors&&g.segmentedData&&(g.colors=s(g.segmentedData,g.numColors,g.gamma)),{getId:function(){return c},getColorSchemeName:function(){return g.name},setColorSchemeName:function(m){g.name=m},getNumberOfColors:function(){return g.colors.length},setNumberOfColors:function(m){for(;g.colors.length<m;)g.colors.push(f);g.colors.length=m},getColor:function(m){return this.isValidIndex(m)?g.colors[m]:f},getColorRepeating:function(m){var E=g.colors.length;return m=E?m%E:0,this.getColor(m)},setColor:function(m,E){this.isValidIndex(m)&&(g.colors[m]=E)},addColor:function(m){g.colors.push(m)},insertColor:function(m,E){this.isValidIndex(m)&&g.colors.splice(m,1,E)},removeColor:function(m){this.isValidIndex(m)&&g.colors.splice(m,1)},clearColors:function(){g.colors=[]},buildLookupTable:function(m){if(m){var E=g.colors.length;m.setNumberOfTableValues(E);for(var T=0;T<E;T++)m.setTableValue(T,g.colors[T])}},createLookupTable:function(){var m=new a.default;return this.buildLookupTable(m),m},isValidIndex:function(m){return m>=0&&m<g.colors.length}}}},"./colors/index.js":function(W,n,e){e.r(n);var a=e("./colors/colormap.js"),f=e("./colors/lookupTable.js");n.default={getColormap:a.getColormap,getColormapsList:a.getColormapsList,LookupTable:f.default}},"./colors/lookupTable.js":function(W,n,e){e.r(n);function a(u,c){if(!(u instanceof c))throw new TypeError("Cannot call a class as a function")}function f(u,c){for(var h=0;h<c.length;h++){var g=c[h];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(u,g.key,g)}}function d(u,c,h){return c&&f(u.prototype,c),u}var l=0,o=1,t=2;function r(u,c,h){if(u>1)throw new Error("HSVToRGB expects hue < 1");var g=[];if(c===0)return g[0]=h,g[1]=h,g[2]=h,g;var v=Math.floor(u*6),m=6*u-v,E=h*(1-c),T=h*(1-c*m),O=h*(1-c*(1-m));switch(v){case 0:case 6:g[0]=h,g[1]=O,g[2]=E;break;case 1:g[0]=T,g[1]=h,g[2]=E;break;case 2:g[0]=E,g[1]=h,g[2]=O;break;case 3:g[0]=E,g[1]=T,g[2]=h;break;case 4:g[0]=O,g[1]=E,g[2]=h;break;case 5:g[0]=h,g[1]=E,g[2]=T;break}return g}function s(u,c){var h;return u<c.Range[0]?h=c.MaxIndex+l+1.5:u>c.Range[1]?h=c.MaxIndex+o+1.5:h=(u+c.Shift)*c.Scale,Math.floor(h)}var i=function(){function u(){a(this,u),this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}return d(u,[{key:"setNumberOfTableValues",value:function(h){this.NumberOfColors=h}},{key:"setRamp",value:function(h){this.Ramp=h}},{key:"setTableRange",value:function(h,g){this.TableRange[0]=h,this.TableRange[1]=g}},{key:"setHueRange",value:function(h,g){this.HueRange[0]=h,this.HueRange[1]=g}},{key:"setSaturationRange",value:function(h,g){this.SaturationRange[0]=h,this.SaturationRange[1]=g}},{key:"setValueRange",value:function(h,g){this.ValueRange[0]=h,this.ValueRange[1]=g}},{key:"setRange",value:function(h,g){this.InputRange[0]=h,this.InputRange[1]=g}},{key:"setAlphaRange",value:function(h,g){this.AlphaRange[0]=h,this.AlphaRange[1]=g}},{key:"getColor",value:function(h){return this.mapValue(h)}},{key:"build",value:function(h){if(!(this.Table.length>1&&!h)){this.Table=[];var g=this.NumberOfColors-1,v,m,E,T;g?(v=(this.HueRange[1]-this.HueRange[0])/g,m=(this.SaturationRange[1]-this.SaturationRange[0])/g,E=(this.ValueRange[1]-this.ValueRange[0])/g,T=(this.AlphaRange[1]-this.AlphaRange[0])/g):v=m=E=T=0;for(var O=0;O<=g;O++){var M=this.HueRange[0]+O*v,P=this.SaturationRange[0]+O*m,C=this.ValueRange[0]+O*E,_=this.AlphaRange[0]+O*T,D=r(M,P,C),I=[];switch(this.Ramp){case"scurve":I[0]=Math.floor(127.5*(1+Math.cos((1-D[0])*Math.PI))),I[1]=Math.floor(127.5*(1+Math.cos((1-D[1])*Math.PI))),I[2]=Math.floor(127.5*(1+Math.cos((1-D[2])*Math.PI))),I[3]=Math.floor(_*255);break;case"linear":I[0]=Math.floor(D[0]*255+.5),I[1]=Math.floor(D[1]*255+.5),I[2]=Math.floor(D[2]*255+.5),I[3]=Math.floor(_*255+.5);break;case"sqrt":I[0]=Math.floor(Math.sqrt(D[0])*255+.5),I[1]=Math.floor(Math.sqrt(D[1])*255+.5),I[2]=Math.floor(Math.sqrt(D[2])*255+.5),I[3]=Math.floor(Math.sqrt(_)*255+.5);break;default:throw new Error("Invalid Ramp value (".concat(this.Ramp,")"))}this.Table.push(I)}this.buildSpecialColors()}}},{key:"buildSpecialColors",value:function(){var h=this.NumberOfColors,g=h+l,v=h+o,m=h+t;this.UseBelowRangeColor||h===0?this.Table[g]=this.BelowRangeColor:this.Table[g]=this.Table[0],this.UseAboveRangeColor||h===0?this.Table[v]=this.AboveRangeColor:this.Table[v]=this.Table[h-1],this.Table[m]=this.NaNColor}},{key:"mapValue",value:function(h){var g=this.getIndex(h);if(g<0)return this.NaNColor;if(g===0){if(this.UseBelowRangeColor&&h<this.TableRange[0])return this.BelowRangeColor}else if(g===this.NumberOfColors-1&&this.UseAboveRangeColor&&h>this.TableRange[1])return this.AboveRangeColor;return this.Table[g]}},{key:"getIndex",value:function(h){var g={};if(g.Range=[],g.MaxIndex=this.NumberOfColors-1,g.Shift=-this.TableRange[0],this.TableRange[1]<=this.TableRange[0]?g.Scale=Number.MAX_VALUE:g.Scale=g.MaxIndex/(this.TableRange[1]-this.TableRange[0]),g.Range[0]=this.TableRange[0],g.Range[1]=this.TableRange[1],isNaN(h))return-1;var v=s(h,g);return v===this.NumberOfColors+l?v=0:v===this.NumberOfColors+o&&(v=this.NumberOfColors-1),v}},{key:"setTableValue",value:function(h,g){if(arguments.length===5&&(g=Array.prototype.slice.call(arguments,1)),h<0)throw new Error("Can't set the table value for negative index (".concat(h,")"));h>=this.NumberOfColors&&new Error("Index ".concat(h," is greater than the number of colors ").concat(this.NumberOfColors)),this.Table[h]=g,(h===0||h===this.NumberOfColors-1)&&this.buildSpecialColors()}}]),u}();n.default=i},"./disable.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./triggerEvent.js"),d=e("./events.js");n.default=function(l){if(l===void 0)throw new Error("disable: element must not be undefined");for(var o=Object(a.getEnabledElements)(),t=0;t<o.length;t++)if(o[t].element===l){var r={element:l};Object(f.default)(l,d.default.ELEMENT_DISABLED,r),Object(f.default)(d.events,d.default.ELEMENT_DISABLED,r),o[t].element.removeChild(o[t].canvas),o[t].canvas=void 0,o.splice(t,1);break}}},"./displayImage.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./internal/getDefaultViewport.js"),d=e("./updateImage.js"),l=e("./internal/now.js"),o=e("./layers.js"),t=e("./triggerEvent.js"),r=e("./events.js");n.default=function(s,i,u){if(s===void 0)throw new Error("displayImage: parameter element must not be undefined");if(i===void 0)throw new Error("displayImage: parameter image must not be undefined");var c=Object(a.getEnabledElement)(s),h=c.image;if(c.image=i,c.layers&&c.layers.length&&Object(o.setLayerImage)(s,i),c.viewport===void 0&&(c.viewport=Object(f.default)(c.canvas,i)),u)for(var g in u)u[g]!==null&&(c.viewport[g]=u[g]);var v;if(c.lastImageTimeStamp!==void 0){var m=Object(l.default)()-c.lastImageTimeStamp;v=(1e3/m).toFixed()}c.lastImageTimeStamp=Object(l.default)();var E={viewport:c.viewport,element:c.element,image:c.image,oldImage:h,enabledElement:c,frameRate:v};Object(t.default)(c.element,r.default.NEW_IMAGE,E),Object(d.default)(s)}},"./draw.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./internal/drawImage.js");n.default=function(d){var l=Object(a.getEnabledElement)(d);Object(f.default)(l)}},"./drawInvalidated.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./internal/drawImage.js");n.default=function(){for(var d=Object(a.getEnabledElements)(),l=0;l<d.length;l++){var o=d[l];o.invalid===!0&&Object(f.default)(o,!0)}}},"./enable.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./resize.js"),d=e("./internal/drawImageSync.js"),l=e("./internal/requestAnimationFrame.js"),o=e("./internal/tryEnableWebgl.js"),t=e("./triggerEvent.js"),r=e("./generateUUID.js"),s=e("./events.js"),i=e("./internal/getCanvas.js");function u(c){return c.image!==void 0||c.layers.length>0}n.default=function(c,h){if(c===void 0)throw new Error("enable: parameter element cannot be undefined");h&&h.renderer&&h.renderer.toLowerCase()==="webgl"&&Object(o.default)(h);var g=Object(i.default)(c),v={element:c,canvas:g,image:void 0,invalid:!1,needsRedraw:!0,options:Object.assign({},h),layers:[],data:{},renderingTools:{},uuid:Object(r.default)()};Object(a.addEnabledElement)(v),Object(t.default)(s.events,s.default.ELEMENT_ENABLED,v),Object(f.default)(c,!0);function m(E){if(v.canvas!==void 0){var T={enabledElement:v,timestamp:E};Object(t.default)(v.element,s.default.PRE_RENDER,T),v.needsRedraw&&u(v)&&Object(d.default)(v,v.invalid),Object(l.default)(m)}}m()}},"./enabledElementData.js":function(W,n,e){e.r(n),e.d(n,"getElementData",function(){return f}),e.d(n,"removeElementData",function(){return d});var a=e("./enabledElements.js");function f(l,o){var t=Object(a.getEnabledElement)(l);return t.data.hasOwnProperty(o)===!1&&(t.data[o]={}),t.data[o]}function d(l,o){var t=Object(a.getEnabledElement)(l);delete t.data[o]}},"./enabledElements.js":function(W,n,e){e.r(n),e.d(n,"getEnabledElement",function(){return f}),e.d(n,"addEnabledElement",function(){return d}),e.d(n,"getEnabledElementsByImageId",function(){return l}),e.d(n,"getEnabledElements",function(){return o});var a=[];function f(t){if(t===void 0)throw new Error("getEnabledElement: parameter element must not be undefined");for(var r=0;r<a.length;r++)if(a[r].element===t)return a[r];throw new Error("element not enabled")}function d(t){if(t===void 0)throw new Error("getEnabledElement: enabledElement element must not be undefined");a.push(t)}function l(t){var r=[];return a.forEach(function(s){s.image&&s.image.imageId===t&&r.push(s)}),r}function o(){return a}},"./events.js":function(W,n,e){e.r(n),e.d(n,"events",function(){return t});function a(r,s){if(!(r instanceof s))throw new TypeError("Cannot call a class as a function")}function f(r,s){for(var i=0;i<s.length;i++){var u=s[i];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(r,u.key,u)}}function d(r,s,i){return s&&f(r.prototype,s),r}var l={NEW_IMAGE:"cornerstonenewimage",INVALIDATED:"cornerstoneinvalidated",PRE_RENDER:"cornerstoneprerender",IMAGE_CACHE_MAXIMUM_SIZE_CHANGED:"cornerstoneimagecachemaximumsizechanged",IMAGE_CACHE_PROMISE_REMOVED:"cornerstoneimagecachepromiseremoved",IMAGE_CACHE_FULL:"cornerstoneimagecachefull",IMAGE_CACHE_CHANGED:"cornerstoneimagecachechanged",WEBGL_TEXTURE_REMOVED:"cornerstonewebgltextureremoved",WEBGL_TEXTURE_CACHE_FULL:"cornerstonewebgltexturecachefull",IMAGE_LOADED:"cornerstoneimageloaded",IMAGE_LOAD_PROGRESS:"cornerstoneimageloadprogress",IMAGE_LOAD_FAILED:"cornerstoneimageloadfailed",ELEMENT_RESIZED:"cornerstoneelementresized",IMAGE_RENDERED:"cornerstoneimagerendered",LAYER_ADDED:"cornerstonelayeradded",LAYER_REMOVED:"cornerstonelayerremoved",ACTIVE_LAYER_CHANGED:"cornerstoneactivelayerchanged",ELEMENT_DISABLED:"cornerstoneelementdisabled",ELEMENT_ENABLED:"cornerstoneelementenabled"};n.default=l;var o=function(){function r(){a(this,r),this.listeners={},this.namespaces={}}return d(r,[{key:"addEventNamespaceListener",value:function(i,u){i.indexOf(".")<=0||(this.namespaces[i]=u,this.addEventListener(i.split(".")[0],u))}},{key:"removeEventNamespaceListener",value:function(i){i.indexOf(".")<=0||!this.namespaces[i]||(this.removeEventListener(i.split(".")[0],this.namespaces[i]),delete this.namespaces[i])}},{key:"addEventListener",value:function(i,u){if(i.indexOf(".")>0){this.addEventNamespaceListener(i,u);return}i in this.listeners||(this.listeners[i]=[]),this.listeners[i].push(u)}},{key:"removeEventListener",value:function(i,u){if(i.indexOf(".")>0){this.removeEventNamespaceListener(i);return}if(i in this.listeners){for(var c=this.listeners[i],h=0,g=c.length;h<g;h++)if(c[h]===u){c.splice(h,1);return}}}},{key:"dispatchEvent",value:function(i){if(!(i.type in this.listeners))return!0;for(var u=this.listeners[i.type].slice(),c=0,h=u.length;c<h;c++)u[c].call(this,i);return!i.defaultPrevented}}]),r}(),t=new o},"./falseColorMapping.js":function(W,n,e){e.r(n),e.d(n,"convertImageToFalseColorImage",function(){return s}),e.d(n,"convertToFalseColorImage",function(){return i}),e.d(n,"restoreImage",function(){return r});var a=e("./enabledElements.js"),f=e("./pixelDataToFalseColorData.js"),d=e("./colors/colormap.js");function l(u){for(var c=Number.MAX_VALUE,h=Number.MIN_VALUE,g=u.length,v,m=0;m<g;m++)v=u[m],c=c<v?c:v,h=h>v?h:v;return{minPixelValue:c,maxPixelValue:h}}function o(u){if(u.restore)return u.restore;var c=u.color,h=u.rgba,g=u.cachedLut,v=u.slope,m=u.windowWidth,E=u.windowCenter,T=u.minPixelValue,O=u.maxPixelValue;return function(){if(u.color=c,u.rgba=h,u.cachedLut=g,u.slope=v,u.windowWidth=m,u.windowCenter=E,u.minPixelValue=T,u.maxPixelValue=O,u.origPixelData){var M=u.origPixelData;u.getPixelData=function(){return M}}u.origPixelData=void 0,u.colormapId=void 0,u.falseColor=void 0}}function t(u){return u&&typeof u=="string"&&(u=Object(d.getColormap)(u)),u}function r(u){return u.restore&&typeof u.restore=="function"?(u.restore(),!0):!1}function s(u,c){if(u.color&&!u.falseColor)throw new Error("Color transforms are not implemented yet");c=t(c);var h=c.getId();if(u.colormapId===h)return!1;if(r(u),h){var g=u.minPixelValue||0,v=u.maxPixelValue||255;u.restore=o(u);var m=c.createLookupTable();m.setTableRange(g,v),Object(f.default)(u,m);var E=l(u.getPixelData());u.minPixelValue=E.minPixelValue,u.maxPixelValue=E.maxPixelValue,u.windowWidth=255,u.windowCenter=128,u.colormapId=h}return!0}function i(u,c){var h=Object(a.getEnabledElement)(u);return s(h.image,c)}},"./fitToWindow.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./updateImage.js"),d=e("./internal/getImageFitScale.js");n.default=function(l){var o=Object(a.getEnabledElement)(l),t=o.image;o.viewport.scale=Object(d.default)(o.canvas,t,o.viewport.rotation).scaleFactor,o.viewport.translation.x=0,o.viewport.translation.y=0,Object(f.default)(l)}},"./generateUUID.js":function(W,n,e){e.r(n),n.default=function(){var a=new Date().getTime();return typeof performance<"u"&&typeof performance.now=="function"&&(a+=performance.now()),"x.x.x.x.x.x.xxxx.xxx.x.x.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,function(f){var d=(a+Math.random()*16)%16|0;return a=Math.floor(a/16),(f==="x"?d:d&3|8).toString(16)})}},"./getDefaultViewportForImage.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./internal/getDefaultViewport.js");n.default=function(d,l){var o=Object(a.getEnabledElement)(d);return Object(f.default)(o.canvas,l)}},"./getImage.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js");n.default=function(f){var d=Object(a.getEnabledElement)(f);return d.image}},"./getPixels.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./getStoredPixels.js"),d=e("./internal/getModalityLUT.js");n.default=function(l,o,t,r,s){var i=Object(f.default)(l,o,t,r,s),u=Object(a.getEnabledElement)(l),c=Object(d.default)(u.image.slope,u.image.intercept,u.viewport.modalityLUT);return i.map(c)}},"./getStoredPixels.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js");n.default=function(f,d,l,o,t){if(f===void 0)throw new Error("getStoredPixels: parameter element must not be undefined");d=Math.round(d),l=Math.round(l);for(var r=Object(a.getEnabledElement)(f),s=[],i=0,u=r.image.getPixelData(),c=0;c<t;c++)for(var h=0;h<o;h++){var g=(c+l)*r.image.columns+(h+d);s[i++]=u[g]}return s}},"./getViewport.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js");n.default=function(f){var d=Object(a.getEnabledElement)(f),l=d.viewport;if(l!==void 0)return Object.assign({},l)}},"./imageCache.js":function(W,n,e){e.r(n),e.d(n,"cachedImages",function(){return t}),e.d(n,"setMaximumSizeBytes",function(){return r}),e.d(n,"putImageLoadObject",function(){return i}),e.d(n,"getImageLoadObject",function(){return u}),e.d(n,"removeImageLoadObject",function(){return c}),e.d(n,"getCacheInfo",function(){return h}),e.d(n,"purgeCache",function(){return v}),e.d(n,"changeImageIdCacheSize",function(){return m});var a=e("./events.js"),f=e("./triggerEvent.js"),d=1024*1024*1024,l=0,o={},t=[];function r(E){if(E===void 0)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(E.toFixed===void 0)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");d=E,Object(f.default)(a.events,a.default.IMAGE_CACHE_MAXIMUM_SIZE_CHANGED),s()}function s(){if(l<=d)return;function E(P,C){return P.timeStamp>C.timeStamp?-1:P.timeStamp<C.timeStamp?1:0}for(t.sort(E);l>d;){var T=t[t.length-1],O=T.imageId;c(O),Object(f.default)(a.events,a.default.IMAGE_CACHE_PROMISE_REMOVED,{imageId:O})}var M=h();Object(f.default)(a.events,a.default.IMAGE_CACHE_FULL,M)}function i(E,T){if(E===void 0)throw new Error("putImageLoadObject: imageId must not be undefined");if(T.promise===void 0)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(o.hasOwnProperty(E)===!0)throw new Error("putImageLoadObject: imageId already in cache");if(T.cancelFn&&typeof T.cancelFn!="function")throw new Error("putImageLoadObject: imageLoadObject.cancelFn must be a function");var O={loaded:!1,imageId:E,sharedCacheKey:void 0,imageLoadObject:T,timeStamp:Date.now(),sizeInBytes:0};o[E]=O,t.push(O),T.promise.then(function(M){if(t.indexOf(O)!==-1){if(O.loaded=!0,O.image=M,M.sizeInBytes===void 0)throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(M.sizeInBytes.toFixed===void 0)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");O.sizeInBytes=M.sizeInBytes,l+=O.sizeInBytes;var P={action:"addImage",image:O};Object(f.default)(a.events,a.default.IMAGE_CACHE_CHANGED,P),O.sharedCacheKey=M.sharedCacheKey,s()}},function(){var M=o[E];t.splice(t.indexOf(M),1),delete o[E]})}function u(E){if(E===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");var T=o[E];if(T!==void 0)return T.timeStamp=Date.now(),T.imageLoadObject}function c(E){if(E===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");var T=o[E];if(T===void 0)throw new Error("removeImageLoadObject: imageId was not present in imageCache");t.splice(t.indexOf(T),1),l-=T.sizeInBytes;var O={action:"deleteImage",image:T};Object(f.default)(a.events,a.default.IMAGE_CACHE_CHANGED,O),g(T.imageLoadObject),delete o[E]}function h(){return{maximumSizeInBytes:d,cacheSizeInBytes:l,numberOfImagesCached:t.length}}function g(E){E.promise.then(function(){E.decache&&E.decache()},function(){E.decache&&E.decache()})}function v(){for(;t.length>0;){var E=t[0];c(E.imageId)}}function m(E,T){var O=o[E];O&&O.imageLoadObject.promise.then(function(M){var P=T-M.sizeInBytes;M.sizeInBytes=T,O.sizeInBytes=T,l+=P;var C={action:"changeImageSize",image:M};Object(f.default)(a.events,a.default.IMAGE_CACHE_CHANGED,C)})}n.default={imageCache:o,cachedImages:t,setMaximumSizeBytes:r,putImageLoadObject:i,getImageLoadObject:u,removeImageLoadObject:c,getCacheInfo:h,purgeCache:v,changeImageIdCacheSize:m}},"./imageLoader.js":function(W,n,e){e.r(n),e.d(n,"loadImage",function(){return r}),e.d(n,"loadAndCacheImage",function(){return s}),e.d(n,"registerImageLoader",function(){return i}),e.d(n,"registerUnknownImageLoader",function(){return u});var a=e("./imageCache.js"),f=e("./events.js"),d=e("./triggerEvent.js"),l={},o;function t(c,h){var g=c.indexOf(":"),v=c.substring(0,g),m=l[v];if(m==null){if(o!==void 0)return o(c);throw new Error("loadImageFromImageLoader: no image loader for imageId")}var E=m(c,h);return E.promise.then(function(T){Object(d.default)(f.events,f.default.IMAGE_LOADED,{image:T})},function(T){var O={imageId:c,error:T};Object(d.default)(f.events,f.default.IMAGE_LOAD_FAILED,O)}),E}function r(c,h){if(c===void 0)throw new Error("loadImage: parameter imageId must not be undefined");var g=Object(a.getImageLoadObject)(c);return g!==void 0?g.promise:t(c,h).promise}function s(c,h){if(c===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");var g=Object(a.getImageLoadObject)(c);return g!==void 0||(g=t(c,h),Object(a.putImageLoadObject)(c,g)),g.promise}function i(c,h){l[c]=h}function u(c){var h=o;return o=c,h}},"./index.js":function(W,n,e){e.r(n);var a=e("./events.js");e.d(n,"EVENTS",function(){return a.default}),e.d(n,"events",function(){return a.events});var f=e("./enabledElements.js");e.d(n,"getEnabledElement",function(){return f.getEnabledElement}),e.d(n,"addEnabledElement",function(){return f.addEnabledElement}),e.d(n,"getEnabledElementsByImageId",function(){return f.getEnabledElementsByImageId}),e.d(n,"getEnabledElements",function(){return f.getEnabledElements});var d=e("./layers.js");e.d(n,"addLayer",function(){return d.addLayer}),e.d(n,"removeLayer",function(){return d.removeLayer}),e.d(n,"getLayer",function(){return d.getLayer}),e.d(n,"getLayers",function(){return d.getLayers}),e.d(n,"getVisibleLayers",function(){return d.getVisibleLayers}),e.d(n,"setActiveLayer",function(){return d.setActiveLayer}),e.d(n,"getActiveLayer",function(){return d.getActiveLayer}),e.d(n,"purgeLayers",function(){return d.purgeLayers}),e.d(n,"setLayerImage",function(){return d.setLayerImage});var l=e("./falseColorMapping.js");e.d(n,"convertImageToFalseColorImage",function(){return l.convertImageToFalseColorImage}),e.d(n,"convertToFalseColorImage",function(){return l.convertToFalseColorImage}),e.d(n,"restoreImage",function(){return l.restoreImage});var o=e("./enabledElementData.js");e.d(n,"getElementData",function(){return o.getElementData}),e.d(n,"removeElementData",function(){return o.removeElementData});var t=e("./imageLoader.js");e.d(n,"loadImage",function(){return t.loadImage}),e.d(n,"loadAndCacheImage",function(){return t.loadAndCacheImage}),e.d(n,"registerImageLoader",function(){return t.registerImageLoader}),e.d(n,"registerUnknownImageLoader",function(){return t.registerUnknownImageLoader});var r=e("./requestPool/imageLoadPoolManager.ts");e.d(n,"imageLoadPoolManager",function(){return r.default});var s=e("./requestPool/imageRetrievalPoolManager.ts");e.d(n,"imageRetrievalPoolManager",function(){return s.default});var i=e("./requestPool/RequestPoolManager.ts");e.d(n,"RequestPoolManager",function(){return i.RequestPoolManager});var u=e("./canvasToPixel.js");e.d(n,"canvasToPixel",function(){return u.default});var c=e("./colors/index.js");e.d(n,"colors",function(){return c.default});var h=e("./disable.js");e.d(n,"disable",function(){return h.default});var g=e("./displayImage.js");e.d(n,"displayImage",function(){return g.default});var v=e("./draw.js");e.d(n,"draw",function(){return v.default});var m=e("./internal/drawImage.js");e.d(n,"drawImage",function(){return m.default});var E=e("./drawInvalidated.js");e.d(n,"drawInvalidated",function(){return E.default});var T=e("./enable.js");e.d(n,"enable",function(){return T.default});var O=e("./fitToWindow.js");e.d(n,"fitToWindow",function(){return O.default});var M=e("./internal/generateLut.js");e.d(n,"generateLut",function(){return M.default});var P=e("./internal/getDefaultViewport.js");e.d(n,"getDefaultViewport",function(){return P.default});var C=e("./getDefaultViewportForImage.js");e.d(n,"getDefaultViewportForImage",function(){return C.default});var _=e("./internal/getDisplayedArea.js");e.d(n,"getDisplayedArea",function(){return _.default});var D=e("./getImage.js");e.d(n,"getImage",function(){return D.default});var I=e("./getPixels.js");e.d(n,"getPixels",function(){return I.default});var y=e("./getStoredPixels.js");e.d(n,"getStoredPixels",function(){return y.default});var R=e("./getViewport.js");e.d(n,"getViewport",function(){return R.default});var b=e("./imageCache.js");e.d(n,"imageCache",function(){return b.default});var z=e("./internal/index.js");e.d(n,"internal",function(){return z.default});var H=e("./invalidate.js");e.d(n,"invalidate",function(){return H.default});var B=e("./invalidateImageId.js");e.d(n,"invalidateImageId",function(){return B.default});var p=e("./metaData.js");e.d(n,"metaData",function(){return p.default});var A=e("./pageToPixel.js");e.d(n,"pageToPixel",function(){return A.default});var j=e("./pixelDataToFalseColorData.js");e.d(n,"pixelDataToFalseColorData",function(){return j.default});var x=e("./pixelToCanvas.js");e.d(n,"pixelToCanvas",function(){return x.default});var L=e("./rendering/renderColorImage.js");e.d(n,"renderColorImage",function(){return L.renderColorImage});var U=e("./rendering/renderGrayscaleImage.js");e.d(n,"renderGrayscaleImage",function(){return U.renderGrayscaleImage});var S=e("./rendering/renderLabelMapImage.js");e.d(n,"renderLabelMapImage",function(){return S.renderLabelMapImage});var w=e("./rendering/renderPseudoColorImage.js");e.d(n,"renderPseudoColorImage",function(){return w.renderPseudoColorImage});var G=e("./rendering/renderToCanvas.js");e.d(n,"renderToCanvas",function(){return G.default});var $=e("./rendering/renderWebImage.js");e.d(n,"renderWebImage",function(){return $.renderWebImage});var Q=e("./rendering/index.js");e.d(n,"rendering",function(){return Q.default});var re=e("./internal/requestAnimationFrame.js");e.d(n,"requestAnimationFrame",function(){return re.default});var le=e("./reset.js");e.d(n,"reset",function(){return le.default});var de=e("./resize.js");e.d(n,"resize",function(){return de.default});var me=e("./internal/setDefaultViewport.js");e.d(n,"setDefaultViewport",function(){return me.default});var Y=e("./setToPixelCoordinateSystem.js");e.d(n,"setToPixelCoordinateSystem",function(){return Y.default});var V=e("./setViewport.js");e.d(n,"setViewport",function(){return V.default});var te=e("./internal/storedColorPixelDataToCanvasImageData.js");e.d(n,"storedColorPixelDataToCanvasImageData",function(){return te.default});var ne=e("./internal/storedPixelDataToCanvasImageData.js");e.d(n,"storedPixelDataToCanvasImageData",function(){return ne.default});var ue=e("./internal/storedPixelDataToCanvasImageDataColorLUT.js");e.d(n,"storedPixelDataToCanvasImageDataColorLUT",function(){return ue.default});var ge=e("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js");e.d(n,"storedPixelDataToCanvasImageDataPseudocolorLUT",function(){return ge.default});var ve=e("./triggerEvent.js");e.d(n,"triggerEvent",function(){return ve.default});var Ee=e("./updateImage.js");e.d(n,"updateImage",function(){return Ee.default});var De=e("./webgl/index.js");e.d(n,"webGL",function(){return De.default});var X={drawImage:m.default,generateLut:M.default,getDefaultViewport:P.default,requestAnimationFrame:re.default,storedPixelDataToCanvasImageData:ne.default,storedColorPixelDataToCanvasImageData:te.default,storedPixelDataToCanvasImageDataColorLUT:ue.default,storedPixelDataToCanvasImageDataPseudocolorLUT:ge.default,internal:z.default,renderLabelMapImage:S.renderLabelMapImage,renderPseudoColorImage:w.renderPseudoColorImage,renderColorImage:L.renderColorImage,renderGrayscaleImage:U.renderGrayscaleImage,renderWebImage:$.renderWebImage,renderToCanvas:G.default,canvasToPixel:u.default,disable:h.default,displayImage:g.default,draw:v.default,drawInvalidated:E.default,enable:T.default,getElementData:o.getElementData,removeElementData:o.removeElementData,getEnabledElement:f.getEnabledElement,addEnabledElement:f.addEnabledElement,getEnabledElementsByImageId:f.getEnabledElementsByImageId,getEnabledElements:f.getEnabledElements,addLayer:d.addLayer,removeLayer:d.removeLayer,getLayer:d.getLayer,getLayers:d.getLayers,getVisibleLayers:d.getVisibleLayers,setActiveLayer:d.setActiveLayer,getActiveLayer:d.getActiveLayer,purgeLayers:d.purgeLayers,setLayerImage:d.setLayerImage,fitToWindow:O.default,getDefaultViewportForImage:C.default,getDisplayedArea:_.default,setDefaultViewport:me.default,getImage:D.default,getPixels:I.default,getStoredPixels:y.default,getViewport:R.default,loadImage:t.loadImage,loadAndCacheImage:t.loadAndCacheImage,registerImageLoader:t.registerImageLoader,registerUnknownImageLoader:t.registerUnknownImageLoader,invalidate:H.default,invalidateImageId:B.default,pageToPixel:A.default,pixelToCanvas:x.default,reset:le.default,resize:de.default,setToPixelCoordinateSystem:Y.default,setViewport:V.default,updateImage:Ee.default,pixelDataToFalseColorData:j.default,rendering:Q.default,imageCache:b.default,metaData:p.default,webGL:De.default,colors:c.default,convertImageToFalseColorImage:l.convertImageToFalseColorImage,convertToFalseColorImage:l.convertToFalseColorImage,restoreImage:l.restoreImage,EVENTS:a.default,events:a.events,triggerEvent:ve.default,imageLoadPoolManager:r.default,imageRetrievalPoolManager:s.default,RequestPoolManager:i.RequestPoolManager};n.default=X},"./internal/calculateTransform.js":function(W,n,e){e.r(n);var a=e("./internal/transform.js"),f=e("./internal/getDisplayedArea.js");n.default=function(d,l){var o=new a.Transform;o.translate(d.canvas.width/2,d.canvas.height/2);var t=d.viewport.rotation;t!==0&&o.rotate(t*Math.PI/180);var r=d.viewport.scale,s=d.viewport.scale,i=Object(f.default)(d.image,d.viewport),u=i.tlhc.x-1,c=i.tlhc.y-1,h=i.brhc.x-u,g=i.brhc.y-c;if(i.presentationSizeMode==="NONE")d.image.rowPixelSpacing<d.image.columnPixelSpacing?r*=d.image.columnPixelSpacing/d.image.rowPixelSpacing:d.image.columnPixelSpacing<d.image.rowPixelSpacing&&(s*=d.image.rowPixelSpacing/d.image.columnPixelSpacing);else if(r=i.columnPixelSpacing,s=i.rowPixelSpacing,i.presentationSizeMode==="SCALE TO FIT"){var v=d.canvas.height/(g*s),m=d.canvas.width/(h*r);r=s=Math.min(m,v),i.rowPixelSpacing<i.columnPixelSpacing?r*=i.columnPixelSpacing/i.rowPixelSpacing:i.columnPixelSpacing<i.rowPixelSpacing&&(s*=i.rowPixelSpacing/i.columnPixelSpacing)}return o.scale(r,s),t!==0&&o.rotate(-t*Math.PI/180),o.translate(d.viewport.translation.x,d.viewport.translation.y),t!==0&&o.rotate(t*Math.PI/180),l!==void 0&&o.scale(l,l),d.viewport.hflip&&o.scale(-1,1),d.viewport.vflip&&o.scale(1,-1),o.translate(-h/2,-g/2),o.translate(-u,-c),o}},"./internal/computeAutoVoi.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(d,l){if(!f(d)){var o=l.maxPixelValue*l.slope+l.intercept,t=l.minPixelValue*l.slope+l.intercept,r=o-t,s=(o+t)/2;d.voi===void 0?d.voi={windowWidth:r,windowCenter:s}:(d.voi.windowWidth=r,d.voi.windowCenter=s)}}function f(d){var l=d.voiLUT&&d.voiLUT.lut&&d.voiLUT.lut.length>0;return l||d.voi.windowWidth!==void 0&&d.voi.windowCenter!==void 0}},"./internal/createViewport.js":function(W,n,e){e.r(n);var a=e("./internal/setDefaultViewport.js");n.default=function(){var f={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:void 0};return Object.assign({},f,a.state.viewport)}},"./internal/drawCompositeImage.js":function(W,n,e){e.r(n);var a=e("./layers.js"),f=e("./rendering/renderGrayscaleImage.js"),d=e("./rendering/renderColorImage.js"),l=e("./rendering/renderPseudoColorImage.js"),o=e("./rendering/renderLabelMapImage.js"),t=e("./setToPixelCoordinateSystem.js"),r=e("./internal/getDisplayedArea.js");function s(h,g){return h.syncProps||i(h),g.syncProps||i(g),g.syncProps.originalScale/h.syncProps.originalScale}function i(h){var g=h.syncProps||{};g.originalScale=h.viewport.scale,h.syncProps=g}function u(h,g){h.forEach(function(v){if(!(v===g||!v.viewport||!g.viewport)){v.syncProps||i(v);var m=s(g,v);v.viewport.scale=g.viewport.scale*m,v.viewport.rotation=g.viewport.rotation,v.viewport.translation={x:g.viewport.translation.x/m,y:g.viewport.translation.y/m},v.viewport.hflip=g.viewport.hflip,v.viewport.vflip=g.viewport.vflip}})}function c(h,g,v){g.forEach(function(m,E){if(m.image){h.save(),m.canvas=h.canvas,Object(t.default)(m,h);var T=m.viewport.colormap||m.options.colormap,O=m.viewport.labelmap,M=m.invalid||v;if(T&&T!==""&&O===!0)Object(o.addLabelMapLayer)(m,M);else if(T&&T!=="")Object(l.addPseudoColorLayer)(m,M);else if(m.image.color===!0)Object(d.addColorLayer)(m,M);else{var P=E===0;Object(f.addGrayscaleLayer)(m,M,P)}m.options&&m.options.opacity?h.globalAlpha=m.options.opacity:h.globalAlpha=1,m.options&&m.options.fillStyle&&(h.fillStyle=m.options.fillStyle),h.imageSmoothingEnabled=!m.viewport.pixelReplication,h.mozImageSmoothingEnabled=h.imageSmoothingEnabled;var C=Object(r.default)(m.image,m.viewport),_=C.tlhc.x-1,D=C.tlhc.y-1,I=C.brhc.x-_,y=C.brhc.y-D;h.drawImage(m.canvas,_,D,I,y,_,D,I,y),h.restore(),m.invalid=!1}})}n.default=function(h,g){var v=h.element,m=Object(a.getLayers)(v),E=Object(a.getActiveLayer)(v),T=Object(a.getVisibleLayers)(v),O=!h.lastSyncViewportsState&&h.syncViewports;h.lastSyncViewportsState=h.syncViewports,O&&m.forEach(function(P){P.viewport&&i(P)}),h.syncViewports===!0&&u(T,E);var M=h.canvas.getContext("2d",{desynchronized:!0});M.setTransform(1,0,0,1,0,0),M.fillStyle="black",M.fillRect(0,0,h.canvas.width,h.canvas.height),c(M,T,g)}},"./internal/drawImage.js":function(W,n,e){e.r(n),n.default=function(a){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;a.needsRedraw=!0,f&&(a.invalid=!0)}},"./internal/drawImageSync.js":function(W,n,e){e.r(n);var a=e("./internal/now.js"),f=e("./internal/drawCompositeImage.js"),d=e("./rendering/renderColorImage.js"),l=e("./rendering/renderGrayscaleImage.js"),o=e("./rendering/renderPseudoColorImage.js"),t=e("./rendering/renderLabelMapImage.js"),r=e("./triggerEvent.js"),s=e("./events.js");n.default=function(i,u){var c=i.image,h=i.element,g=i.layers||[];if(!(!i.canvas||!i.image)){var v=Object(a.default)();if(c.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},g&&g.length)Object(f.default)(i,u);else if(c){var m=c.render;m||(i.viewport.colormap&&i.viewport.colormap!==""&&i.image.labelmap===!0?m=t.renderLabelMapImage:i.viewport.colormap&&i.viewport.colormap!==""?m=o.renderPseudoColorImage:c.color?m=d.renderColorImage:m=l.renderGrayscaleImage),m(i,u)}var E=Object(a.default)()-v,T={viewport:i.viewport,element:h,image:c,enabledElement:i,canvasContext:i.canvas.getContext("2d",{desynchronized:!0}),renderTimeInMs:E};c.stats.lastRenderTime=E,i.invalid=!1,i.needsRedraw=!1,Object(r.default)(h,s.default.IMAGE_RENDERED,T)}}},"./internal/generateColorLut.js":function(W,n,e){e.r(n);var a=e("./internal/getVOILut.js");n.default=function(f,d,l,o,t){var r=f.maxPixelValue,s=f.minPixelValue,i=Math.min(s,0);if(f.cachedLut===void 0){var u=r-i+1;f.cachedLut={},f.cachedLut.lutArray=new Uint8ClampedArray(u)}var c=f.cachedLut.lutArray,h=Object(a.default)(d,l,t);if(o===!0)for(var g=s;g<=r;g++)c[g+-i]=255-h(g);else for(var v=s;v<=r;v++)c[v+-i]=h(v);return c}},"./internal/generateLut.js":function(W,n,e){e.r(n);var a=e("./internal/getModalityLUT.js"),f=e("./internal/getVOILut.js");n.default=function(d,l,o,t,r,s){var i=d.maxPixelValue,u=d.minPixelValue,c=Math.min(u,0);if(d.cachedLut===void 0){var h=i-c+1;d.cachedLut={},d.cachedLut.lutArray=new Uint8ClampedArray(h)}var g=d.cachedLut.lutArray,v=!!(d.slope%1)||!!(d.intercept%1),m=Object(a.default)(d.slope,d.intercept,r),E=Object(f.default)(l,o,s,v);if(t===!0)for(var T=u;T<=i;T++)g[T+-c]=255-E(m(T));else for(var O=u;O<=i;O++)g[O+-c]=E(m(O));return g}},"./internal/getCanvas.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return d});var a="cornerstone-canvas";function f(l){var o=document.createElement("canvas");return o.style.display="block",o.classList.add(a),l.appendChild(o),o}function d(l){var o="canvas.".concat(a);return l.querySelector(o)||f(l)}},"./internal/getDefaultViewport.js":function(W,n,e){e.r(n);var a=e("./internal/createViewport.js"),f=e("./internal/getImageFitScale.js");n.default=function(d,l){if(d===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(l===void 0)return Object(a.default)();var o=Object(f.default)(d,l,0).scaleFactor;return{scale:o,translation:{x:0,y:0},voi:{windowWidth:l.windowWidth,windowCenter:l.windowCenter},invert:l.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:l.modalityLUT,voiLUT:l.voiLUT,colormap:l.colormap,labelmap:!!l.labelmap,displayedArea:void 0}}},"./internal/getDisplayedArea.js":function(W,n,e){e.r(n),n.default=function(a){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(f&&f.displayedArea)return f.displayedArea;if(a===void 0)throw new Error("getDisplayedArea: parameter image must not be undefined");return{tlhc:{x:1,y:1},brhc:{x:a.columns,y:a.rows},rowPixelSpacing:a.rowPixelSpacing===void 0?1:a.rowPixelSpacing,columnPixelSpacing:a.columnPixelSpacing===void 0?1:a.columnPixelSpacing,presentationSizeMode:"NONE"}}},"./internal/getFillStyle.js":function(W,n,e){e.r(n),n.default=function(a){var f=a.viewport||{},d=f.invert,l=a.options||{},o=l.fillStyle;return["black","white"].indexOf(o)!==-1&&d?"white":"black"}},"./internal/getImageFitScale.js":function(W,n,e){e.r(n);var a=e("./internal/validator.js"),f=e("./internal/getImageSize.js");n.default=function(d,l){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;Object(a.validateParameterUndefinedOrNull)(d,"getImageScale: parameter windowSize must not be undefined"),Object(a.validateParameterUndefinedOrNull)(l,"getImageScale: parameter image must not be undefined");var t=Object(f.default)(l,o),r=l.rowPixelSpacing||1,s=l.columnPixelSpacing||1,i=1,u=1;r<s?u=s/r:i=r/s;var c=d.height/t.height/i,h=d.width/t.width/u;return{verticalScale:c,horizontalScale:h,scaleFactor:Math.min(h,c)}}},"./internal/getImageSize.js":function(W,n,e){e.r(n);var a=e("./internal/validator.js");function f(d){return!(d==null||d===0||d===180)}n.default=function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return Object(a.validateParameterUndefinedOrNull)(d,"getImageSize: parameter image must not be undefined"),Object(a.validateParameterUndefinedOrNull)(d.width,"getImageSize: parameter image must have width"),Object(a.validateParameterUndefinedOrNull)(d.height,"getImageSize: parameter image must have height"),f(l)?{height:d.width,width:d.height}:{width:d.width,height:d.height}}},"./internal/getModalityLUT.js":function(W,n,e){e.r(n);function a(d,l){return function(o){return o*d+l}}function f(d){var l=d.lut[0],o=d.lut[d.lut.length-1],t=d.firstValueMapped+d.lut.length;return function(r){return r<d.firstValueMapped?l:r>=t?o:d.lut[r]}}n.default=function(d,l,o){return o?f(o):a(d,l)}},"./internal/getTransform.js":function(W,n,e){e.r(n);var a=e("./internal/calculateTransform.js");n.default=function(f){return Object(a.default)(f)}},"./internal/getVOILut.js":function(W,n,e){e.r(n);function a(i){return o(i)||l(i)||d(i)||f()}function f(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d(i,u){if(i){if(typeof i=="string")return t(i,u);var c=Object.prototype.toString.call(i).slice(8,-1);if(c==="Object"&&i.constructor&&(c=i.constructor.name),c==="Map"||c==="Set")return Array.from(i);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return t(i,u)}}function l(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function o(i){if(Array.isArray(i))return t(i)}function t(i,u){(u==null||u>i.length)&&(u=i.length);for(var c=0,h=new Array(u);c<u;c++)h[c]=i[c];return h}function r(i,u){return function(c){return((c-u)/i+.5)*255}}function s(i,u){var c=Math.max.apply(Math,a(i.lut)).toString(2).length,h=c-8,g=i.lut[0]>>h,v=i.lut[i.lut.length-1]>>h,m=i.firstValueMapped+i.lut.length-1;return function(E){return E<i.firstValueMapped?g:E>=m?v:u?i.lut[Math.round(E)-i.firstValueMapped]>>h:i.lut[E-i.firstValueMapped]>>h}}n.default=function(i,u,c,h){return c?s(c,h):r(i,u)}},"./internal/guid.js":function(W,n,e){e.r(n);function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}n.default=function(){return"".concat(a()+a(),"-").concat(a(),"-").concat(a(),"-").concat(a(),"-").concat(a()).concat(a()).concat(a())}},"./internal/index.js":function(W,n,e){e.r(n);var a=e("./internal/transform.js"),f=e("./internal/calculateTransform.js"),d=e("./internal/drawImage.js"),l=e("./internal/generateLut.js"),o=e("./internal/getDefaultViewport.js"),t=e("./internal/getTransform.js"),r=e("./internal/requestAnimationFrame.js"),s=e("./internal/setDefaultViewport.js"),i=e("./internal/storedColorPixelDataToCanvasImageData.js"),u=e("./internal/storedPixelDataToCanvasImageData.js"),c=e("./internal/storedPixelDataToCanvasImageDataColorLUT.js"),h=e("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js"),g=e("./internal/storedPixelDataToCanvasImageDataRGBA.js");n.default={drawImage:d.default,generateLut:l.default,getDefaultViewport:o.default,requestAnimationFrame:r.default,setDefaultViewport:s.default,storedPixelDataToCanvasImageData:u.default,storedPixelDataToCanvasImageDataRGBA:g.default,storedPixelDataToCanvasImageDataColorLUT:c.default,storedPixelDataToCanvasImageDataPseudocolorLUT:h.default,storedColorPixelDataToCanvasImageData:i.default,getTransform:t.default,calculateTransform:f.default,Transform:a.Transform}},"./internal/now.js":function(W,n,e){e.r(n),n.default=function(){return window.performance?performance.now():Date.now()}},"./internal/requestAnimationFrame.js":function(W,n,e){e.r(n);function a(f){window.setTimeout(f,1e3/60)}n.default=function(f){return window.requestAnimationFrame(f)||window.webkitRequestAnimationFrame(f)||window.mozRequestAnimationFrame(f)||window.oRequestAnimationFrame(f)||window.msRequestAnimationFrame(f)||a(f)}},"./internal/setDefaultViewport.js":function(W,n,e){e.r(n),e.d(n,"state",function(){return a});var a={viewport:{}};n.default=function(f){a.viewport=f||{}}},"./internal/storedColorPixelDataToCanvasImageData.js":function(W,n,e){e.r(n);var a=e("./internal/now.js");n.default=function(f,d,l){var o=Object(a.default)(),t=f.getPixelData();f.stats.lastGetPixelDataTime=Object(a.default)()-o;var r=f.minPixelValue,s=0,i=0,u=t.length;if(o=Object(a.default)(),r<0)for(;i<u;)l[s++]=d[t[i++]+-r],l[s++]=d[t[i++]+-r],l[s]=d[t[i]+-r],i+=2,s+=2;else for(;i<u;)l[s++]=d[t[i++]],l[s++]=d[t[i++]],l[s]=d[t[i]],i+=2,s+=2;f.stats.lastStoredPixelDataToCanvasImageDataTime=Object(a.default)()-o}},"./internal/storedPixelDataToCanvasImageData.js":function(W,n,e){e.r(n);var a=e("./internal/now.js");n.default=function(f,d,l){var o=Object(a.default)(),t=f.getPixelData();f.stats.lastGetPixelDataTime=Object(a.default)()-o;var r=t.length,s=f.minPixelValue,i=3,u=0;if(o=Object(a.default)(),t instanceof Int16Array)if(s<0)for(;u<r;)l[i]=d[t[u++]+-s],i+=4;else for(;u<r;)l[i]=d[t[u++]],i+=4;else if(t instanceof Uint16Array)for(;u<r;)l[i]=d[t[u++]],i+=4;else if(s<0)for(;u<r;)l[i]=d[t[u++]+-s],i+=4;else for(;u<r;)l[i]=d[t[u++]],i+=4;f.stats.lastStoredPixelDataToCanvasImageDataTime=Object(a.default)()-o}},"./internal/storedPixelDataToCanvasImageDataColorLUT.js":function(W,n,e){e.r(n);var a=e("./colors/index.js"),f=e("./internal/now.js");function d(l,o,t){var r=Object(f.default)(),s=l.getPixelData();l.stats.lastGetPixelDataTime=Object(f.default)()-r;var i=s.length,u=l.minPixelValue,c=0,h=0,g,v;if(r=Object(f.default)(),o instanceof a.default.LookupTable?v=o.Table:v=o,u<0)for(;h<i;)g=v[s[h++]+-u],t[c++]=g[0],t[c++]=g[1],t[c++]=g[2],t[c++]=g[3];else for(;h<i;)g=v[s[h++]],t[c++]=g[0],t[c++]=g[1],t[c++]=g[2],t[c++]=g[3];l.stats.lastStoredPixelDataToCanvasImageDataTime=Object(f.default)()-r}n.default=d},"./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js":function(W,n,e){e.r(n);var a=e("./colors/index.js"),f=e("./internal/now.js");function d(l,o,t,r){var s=Object(f.default)(),i=l.getPixelData();l.stats.lastGetPixelDataTime=Object(f.default)()-s;var u=i.length,c=l.minPixelValue,h=0,g=0,v,m,E;if(s=Object(f.default)(),t instanceof a.default.LookupTable?E=t.Table:E=t,c<0)for(;g<u;)v=o[i[g++]+-c],m=E[v],r[h++]=m[0],r[h++]=m[1],r[h++]=m[2],r[h++]=m[3];else for(;g<u;)v=o[i[g++]],m=E[v],r[h++]=m[0],r[h++]=m[1],r[h++]=m[2],r[h++]=m[3];l.stats.lastStoredPixelDataToCanvasImageDataTime=Object(f.default)()-s}n.default=d},"./internal/storedPixelDataToCanvasImageDataRGBA.js":function(W,n,e){e.r(n);var a=e("./internal/now.js");n.default=function(f,d,l){var o=Object(a.default)(),t=f.getPixelData();f.stats.lastGetPixelDataTime=Object(a.default)()-o;var r=t.length,s=f.minPixelValue,i=0,u=0,c;if(o=Object(a.default)(),t instanceof Int16Array)if(s<0)for(;u<r;)c=d[t[u++]+-s],l[i++]=c,l[i++]=c,l[i++]=c,l[i++]=255;else for(;u<r;)c=d[t[u++]],l[i++]=c,l[i++]=c,l[i++]=c,l[i++]=255;else if(t instanceof Uint16Array)for(;u<r;)c=d[t[u++]],l[i++]=c,l[i++]=c,l[i++]=c,l[i++]=255;else if(s<0)for(;u<r;)c=d[t[u++]+-s],l[i++]=c,l[i++]=c,l[i++]=c,l[i++]=255;else for(;u<r;)c=d[t[u++]],l[i++]=c,l[i++]=c,l[i++]=c,l[i++]=255;f.stats.lastStoredPixelDataToCanvasImageDataTime=Object(a.default)()-o}},"./internal/storedRGBAPixelDataToCanvasImageData.js":function(W,n,e){e.r(n);var a=e("./internal/now.js");n.default=function(f,d,l){var o=Object(a.default)(),t=f.getPixelData();f.stats.lastGetPixelDataTime=Object(a.default)()-o;var r=f.minPixelValue,s=0,i=0,u=t.length;if(o=Object(a.default)(),r<0)for(;i<u;)l[s++]=d[t[i++]+-r],l[s++]=d[t[i++]+-r],l[s++]=d[t[i++]+-r],l[s++]=t[i++];else for(;i<u;)l[s++]=d[t[i++]],l[s++]=d[t[i++]],l[s++]=d[t[i++]],l[s++]=t[i++];f.stats.lastStoredPixelDataToCanvasImageDataTime=Object(a.default)()-o}},"./internal/transform.js":function(W,n,e){e.r(n),e.d(n,"Transform",function(){return l});function a(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}function f(o,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(o,s.key,s)}}function d(o,t,r){return t&&f(o.prototype,t),o}var l=function(){function o(){a(this,o),this.reset()}return d(o,[{key:"reset",value:function(){this.m=[1,0,0,1,0,0]}},{key:"clone",value:function(){var r=new o;return r.m[0]=this.m[0],r.m[1]=this.m[1],r.m[2]=this.m[2],r.m[3]=this.m[3],r.m[4]=this.m[4],r.m[5]=this.m[5],r}},{key:"multiply",value:function(r){var s=this.m[0]*r.m[0]+this.m[2]*r.m[1],i=this.m[1]*r.m[0]+this.m[3]*r.m[1],u=this.m[0]*r.m[2]+this.m[2]*r.m[3],c=this.m[1]*r.m[2]+this.m[3]*r.m[3],h=this.m[0]*r.m[4]+this.m[2]*r.m[5]+this.m[4],g=this.m[1]*r.m[4]+this.m[3]*r.m[5]+this.m[5];this.m[0]=s,this.m[1]=i,this.m[2]=u,this.m[3]=c,this.m[4]=h,this.m[5]=g}},{key:"invert",value:function(){var r=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),s=this.m[3]*r,i=-this.m[1]*r,u=-this.m[2]*r,c=this.m[0]*r,h=r*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=r*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=s,this.m[1]=i,this.m[2]=u,this.m[3]=c,this.m[4]=h,this.m[5]=g}},{key:"rotate",value:function(r){var s=Math.cos(r),i=Math.sin(r),u=this.m[0]*s+this.m[2]*i,c=this.m[1]*s+this.m[3]*i,h=this.m[0]*-i+this.m[2]*s,g=this.m[1]*-i+this.m[3]*s;this.m[0]=u,this.m[1]=c,this.m[2]=h,this.m[3]=g}},{key:"translate",value:function(r,s){this.m[4]+=this.m[0]*r+this.m[2]*s,this.m[5]+=this.m[1]*r+this.m[3]*s}},{key:"scale",value:function(r,s){this.m[0]*=r,this.m[1]*=r,this.m[2]*=s,this.m[3]*=s}},{key:"transformPoint",value:function(r,s){var i=r,u=s;return r=i*this.m[0]+u*this.m[2]+this.m[4],s=i*this.m[1]+u*this.m[3]+this.m[5],{x:r,y:s}}}]),o}()},"./internal/tryEnableWebgl.js":function(W,n,e){e.r(n);var a=e("./webgl/index.js");n.default=function(f){return a.default.renderer.isWebGLAvailable()?(a.default.renderer.initRenderer(),f.renderer="webgl",f.desynchronized=!0,f.preserveDrawingBuffer=!0,!0):(delete f.renderer,delete f.preserveDrawingBuffer,!1)}},"./internal/validator.js":function(W,n,e){e.r(n),e.d(n,"validateParameterUndefined",function(){return a}),e.d(n,"validateParameterUndefinedOrNull",function(){return f});function a(d,l){if(d===void 0)throw new Error(l)}function f(d,l){if(d==null)throw new Error(l)}},"./invalidate.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./triggerEvent.js"),d=e("./events.js");n.default=function(l){var o=Object(a.getEnabledElement)(l);o.invalid=!0,o.needsRedraw=!0;var t={element:l};Object(f.default)(l,d.default.INVALIDATED,t)}},"./invalidateImageId.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./internal/drawImage.js");n.default=function(d){var l=Object(a.getEnabledElementsByImageId)(d);l.forEach(function(o){Object(f.default)(o,!0)})}},"./layers.js":function(W,n,e){e.r(n),e.d(n,"rescaleImage",function(){return i}),e.d(n,"addLayer",function(){return u}),e.d(n,"removeLayer",function(){return c}),e.d(n,"getLayer",function(){return h}),e.d(n,"getLayers",function(){return g}),e.d(n,"getVisibleLayers",function(){return v}),e.d(n,"setActiveLayer",function(){return m}),e.d(n,"setLayerImage",function(){return E}),e.d(n,"getActiveLayer",function(){return T}),e.d(n,"purgeLayers",function(){return O});var a=e("./internal/guid.js"),f=e("./enabledElements.js"),d=e("./internal/getDefaultViewport.js"),l=e("./internal/getDisplayedArea.js"),o=e("./updateImage.js"),t=e("./triggerEvent.js"),r=e("./events.js");function s(M,P,C){var _=P.element,D={viewport:P.viewport,element:P.element,image:P.image,enabledElement:P,layerId:C};Object(t.default)(_,M,D)}function i(M,P){if(M.layerId===P.layerId)throw new Error("rescaleImage: both arguments represent the same layer");var C=M.image,_=P.image;if(!(!C.imageId||!_.imageId)){var D=Object(l.default)(_,P.viewport),I=Object(l.default)(C,M.viewport),y=D.columnPixelSpacing*_.width/(I.columnPixelSpacing*C.width),R=P.viewport.scale/M.viewport.scale*y;P.viewport.scale=M.viewport.scale*R}}function u(M,P,C){var _=Object(a.default)(),D=Object(f.getEnabledElement)(M),I=D.layers,y;P&&(y=Object(d.default)(D.canvas,P),C&&C.viewport&&(y=Object.assign(y,C.viewport))),D.syncViewports!==!1&&(D.syncViewports=!0);var R={image:P,layerId:_,viewport:y,options:C||{},renderingTools:{}};return I.length&&P&&i(I[0],R),I.push(R),s(r.default.LAYER_ADDED,D,_),I.length===1&&P&&m(M,_),_}function c(M,P){var C=Object(f.getEnabledElement)(M),_=C.layers,D=C.layers.findIndex(function(I){return I.layerId===P});D!==-1&&(_.splice(D,1),P===C.activeLayerId&&_.length&&m(M,_[0].layerId),s(r.default.LAYER_REMOVED,C,P))}function h(M,P){var C=Object(f.getEnabledElement)(M);return C.layers.find(function(_){return _.layerId===P})}function g(M){var P=Object(f.getEnabledElement)(M);return P.layers}function v(M){var P=Object(f.getEnabledElement)(M);return P.layers.filter(function(C){return C.options&&C.options.visible!==!1&&C.options.opacity!==0})}function m(M,P){var C=Object(f.getEnabledElement)(M);if(C.activeLayerId!==P){var _=C.layers.findIndex(function(I){return I.layerId===P});if(_===-1)throw new Error("setActiveLayer: layer not found in layers array");var D=C.layers[_];if(!D.image)throw new Error("setActiveLayer: layer with undefined image cannot be set as active.");C.activeLayerId=P,C.image=D.image,C.viewport=D.viewport,Object(o.default)(M),s(r.default.ACTIVE_LAYER_CHANGED,C,P)}}function E(M,P,C){var _=Object(f.getEnabledElement)(M),D=_.layers[0],I;if(C?I=h(M,C):I=T(M),!I)throw new Error("setLayerImage: Layer not found");if(I.image=P,!P){I.viewport=void 0;return}if(!I.viewport){var y=Object(d.default)(_.canvas,P);I.options&&I.options.viewport&&(I.viewport=Object.assign(y,I.options.viewport)),D.layerId!==C&&i(D,I)}}function T(M){var P=Object(f.getEnabledElement)(M);return P.layers.find(function(C){return C.layerId===P.activeLayerId})}function O(M){var P=Object(f.getEnabledElement)(M);P.layers=[],delete P.activeLayerId,delete P.lastSyncViewportsState}},"./metaData.js":function(W,n,e){e.r(n),e.d(n,"addProvider",function(){return f}),e.d(n,"removeProvider",function(){return d});var a=[];function f(o){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r;for(r=0;r<a.length&&!(a[r].priority<=t);r++);a.splice(r,0,{priority:t,provider:o})}function d(o){for(var t=0;t<a.length;t++)if(a[t].provider===o){a.splice(t,1);break}}function l(o,t){for(var r=0;r<a.length;r++){var s=a[r].provider(o,t);if(s!==void 0)return s}}n.default={addProvider:f,removeProvider:d,get:l}},"./pageToPixel.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./internal/getTransform.js");n.default=function(d,l,o){var t=Object(a.getEnabledElement)(d);if(t.image===void 0)throw new Error("image has not been loaded yet");var r=d.getBoundingClientRect(),s=l-r.left-window.pageXOffset,i=o-r.top-window.pageYOffset,u={x:s,y:i},c=Object(f.default)(t);return c.invert(),c.transformPoint(u.x,u.y)}},"./pixelDataToFalseColorData.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./colors/index.js");function f(d,l){if(d.color&&!d.falseColor)throw new Error("Color transforms are not implemented yet");var o=d.minPixelValue,t=0,r=0,s=d.width*d.height,i=d.origPixelData||d.getPixelData(),u=new Uint8Array(s*4),c,h;if(d.color=!0,d.falseColor=!0,d.origPixelData=i,l instanceof a.default.LookupTable)for(l.build();r<s;)c=i[r++],h=l.mapValue(c),u[t++]=h[0],u[t++]=h[1],u[t++]=h[2],u[t++]=h[3];else if(o<0)for(;r<s;)c=i[r++],u[t++]=l[c+-o][0],u[t++]=l[c+-o][1],u[t++]=l[c+-o][2],u[t++]=l[c+-o][3];else for(;r<s;)c=i[r++],u[t++]=l[c][0],u[t++]=l[c][1],u[t++]=l[c][2],u[t++]=l[c][3];d.rgba=!0,d.cachedLut=void 0,d.render=void 0,d.slope=1,d.intercept=0,d.minPixelValue=0,d.maxPixelValue=255,d.windowWidth=255,d.windowCenter=128,d.getPixelData=function(){return u}}},"./pixelToCanvas.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./internal/getTransform.js");n.default=function(d,l){var o=Object(a.getEnabledElement)(d),t=Object(f.default)(o);return t.transformPoint(l.x,l.y)}},"./rendering/doesImageNeedToBeRendered.js":function(W,n,e){e.r(n),n.default=function(a,f){var d=a.renderingTools.lastRenderedImageId,l=a.renderingTools.lastRenderedViewport;return f.imageId!==d||!l||l.windowCenter!==a.viewport.voi.windowCenter||l.windowWidth!==a.viewport.voi.windowWidth||l.invert!==a.viewport.invert||l.rotation!==a.viewport.rotation||l.hflip!==a.viewport.hflip||l.vflip!==a.viewport.vflip||l.modalityLUT!==a.viewport.modalityLUT||l.voiLUT!==a.viewport.voiLUT||l.colormap!==a.viewport.colormap}},"./rendering/getLut.js":function(W,n,e){e.r(n);var a=e("./internal/computeAutoVoi.js"),f=e("./rendering/lutMatches.js"),d=e("./internal/generateLut.js");n.default=function(l,o,t){return l.cachedLut!==void 0&&l.cachedLut.windowCenter===o.voi.windowCenter&&l.cachedLut.windowWidth===o.voi.windowWidth&&Object(f.default)(l.cachedLut.modalityLUT,o.modalityLUT)&&Object(f.default)(l.cachedLut.voiLUT,o.voiLUT)&&l.cachedLut.invert===o.invert&&t!==!0||(Object(a.default)(o,l),Object(d.default)(l,o.voi.windowWidth,o.voi.windowCenter,o.invert,o.modalityLUT,o.voiLUT),l.cachedLut.windowWidth=o.voi.windowWidth,l.cachedLut.windowCenter=o.voi.windowCenter,l.cachedLut.invert=o.invert,l.cachedLut.voiLUT=o.voiLUT,l.cachedLut.modalityLUT=o.modalityLUT),l.cachedLut.lutArray}},"./rendering/index.js":function(W,n,e){e.r(n);var a=e("./rendering/renderColorImage.js"),f=e("./rendering/renderGrayscaleImage.js"),d=e("./rendering/renderWebImage.js"),l=e("./rendering/renderPseudoColorImage.js"),o=e("./rendering/renderLabelMapImage.js"),t=e("./rendering/renderToCanvas.js");n.default={colorImage:a.renderColorImage,grayscaleImage:f.renderGrayscaleImage,webImage:d.renderWebImage,pseudoColorImage:l.renderPseudoColorImage,labelMapImage:o.renderLabelMapImage,toCanvas:t.default}},"./rendering/initializeRenderCanvas.js":function(W,n,e){e.r(n),n.default=function(a,f){var d=a.renderingTools.renderCanvas;d.width=f.width,d.height=f.height;var l=d.getContext("2d",{desynchronized:!0});l.fillStyle="white",l.fillRect(0,0,d.width,d.height);var o=l.getImageData(0,0,f.width,f.height);a.renderingTools.renderCanvasContext=l,a.renderingTools.renderCanvasData=o}},"./rendering/lutMatches.js":function(W,n,e){e.r(n),n.default=function(a,f){return!a&&!f?!0:!a||!f?!1:a.id===f.id}},"./rendering/renderColorImage.js":function(W,n,e){e.r(n),e.d(n,"renderColorImage",function(){return v}),e.d(n,"addColorLayer",function(){return m});var a=e("./internal/now.js"),f=e("./internal/getFillStyle.js"),d=e("./internal/generateColorLut.js"),l=e("./internal/storedColorPixelDataToCanvasImageData.js"),o=e("./internal/storedRGBAPixelDataToCanvasImageData.js"),t=e("./setToPixelCoordinateSystem.js"),r=e("./webgl/index.js"),s=e("./rendering/doesImageNeedToBeRendered.js"),i=e("./rendering/initializeRenderCanvas.js"),u=e("./rendering/saveLastRendered.js"),c=e("./internal/getDisplayedArea.js");function h(E,T){return E.cachedLut!==void 0&&E.cachedLut.windowCenter===T.voi.windowCenter&&E.cachedLut.windowWidth===T.voi.windowWidth&&E.cachedLut.invert===T.invert||(Object(d.default)(E,T.voi.windowWidth,T.voi.windowCenter,T.invert),E.cachedLut.windowWidth=T.voi.windowWidth,E.cachedLut.windowCenter=T.voi.windowCenter,E.cachedLut.invert=T.invert),E.cachedLut.lutArray}function g(E,T,O){var M=E.renderingTools.lastRenderedIsColor===!0;(!E.renderingTools.renderCanvas||!M)&&(E.renderingTools.renderCanvas=document.createElement("canvas"));var P=E.renderingTools.renderCanvas;if(E.viewport.voi.windowWidth===255&&E.viewport.voi.windowCenter===128&&E.viewport.invert===!1&&T.getCanvas&&T.getCanvas())return T.getCanvas();if(Object(s.default)(E,T)===!1&&O!==!0)return P;(P.width!==T.width||P.height!==T.height)&&Object(i.default)(E,T);var C=Object(a.default)(),_=h(T,E.viewport);T.stats=T.stats||{},T.stats.lastLutGenerateTime=Object(a.default)()-C;var D=E.renderingTools.renderCanvasData,I=E.renderingTools.renderCanvasContext;return T.rgba?Object(o.default)(T,_,D.data):Object(l.default)(T,_,D.data),C=Object(a.default)(),I.putImageData(D,0,0),T.stats.lastPutImageDataTime=Object(a.default)()-C,P}function v(E,T){if(E===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");var O=E.image;if(O===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");var M=E.canvas.getContext("2d",{desynchronized:!0});M.setTransform(1,0,0,1,0,0),M.fillStyle=Object(f.default)(E),M.fillRect(0,0,E.canvas.width,E.canvas.height),M.imageSmoothingEnabled=!E.viewport.pixelReplication,M.mozImageSmoothingEnabled=M.imageSmoothingEnabled,Object(t.default)(E,M);var P;E.options&&E.options.renderer&&E.options.renderer.toLowerCase()==="webgl"?P=r.default.renderer.render(E):P=g(E,O,T);var C=Object(c.default)(E.image,E.viewport),_=C.tlhc.x-1,D=C.tlhc.y-1,I=C.brhc.x-_,y=C.brhc.y-D;M.drawImage(P,_,D,I,y,_,D,I,y),E.renderingTools=Object(u.default)(E)}function m(E,T){if(E===void 0)throw new Error("addColorLayer: layer parameter must not be undefined");var O=E.image;if(O===void 0)throw new Error("addColorLayer: image must be loaded before it can be drawn");O.rgba=!0,E.canvas=g(E,O,T);var M=E.canvas.getContext("2d",{desynchronized:!0});M.imageSmoothingEnabled=!E.viewport.pixelReplication,M.mozImageSmoothingEnabled=M.imageSmoothingEnabled,E.renderingTools=Object(u.default)(E)}},"./rendering/renderGrayscaleImage.js":function(W,n,e){e.r(n),e.d(n,"renderGrayscaleImage",function(){return g}),e.d(n,"addGrayscaleLayer",function(){return v});var a=e("./internal/getFillStyle.js"),f=e("./internal/storedPixelDataToCanvasImageData.js"),d=e("./internal/storedPixelDataToCanvasImageDataRGBA.js"),l=e("./setToPixelCoordinateSystem.js"),o=e("./internal/now.js"),t=e("./webgl/index.js"),r=e("./rendering/getLut.js"),s=e("./rendering/doesImageNeedToBeRendered.js"),i=e("./rendering/initializeRenderCanvas.js"),u=e("./rendering/saveLastRendered.js"),c=e("./internal/getDisplayedArea.js");function h(m,E,T){var O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,M=m.renderingTools.lastRenderedIsColor===!0;(!m.renderingTools.renderCanvas||M)&&(m.renderingTools.renderCanvas=document.createElement("canvas"),Object(i.default)(m,E));var P=m.renderingTools.renderCanvas;if(Object(s.default)(m,E)===!1&&T!==!0)return P;(P.width!==E.width||P.height!==E.height)&&Object(i.default)(m,E);var C=Object(o.default)(),_=Object(r.default)(E,m.viewport,T);E.stats=E.stats||{},E.stats.lastLutGenerateTime=Object(o.default)()-C;var D=m.renderingTools.renderCanvasData,I=m.renderingTools.renderCanvasContext;return O?Object(f.default)(E,_,D.data):Object(d.default)(E,_,D.data),C=Object(o.default)(),I.putImageData(D,0,0),E.stats.lastPutImageDataTime=Object(o.default)()-C,P}function g(m,E){if(m===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");var T=m.image;if(T===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");var O=m.canvas.getContext("2d",{desynchronized:!0});O.setTransform(1,0,0,1,0,0),O.fillStyle=Object(a.default)(m),O.fillRect(0,0,m.canvas.width,m.canvas.height),O.imageSmoothingEnabled=!m.viewport.pixelReplication,O.mozImageSmoothingEnabled=O.imageSmoothingEnabled,Object(l.default)(m,O);var M;m.options&&m.options.renderer&&m.options.renderer.toLowerCase()==="webgl"?M=t.default.renderer.render(m):M=h(m,T,E);var P=Object(c.default)(m.image,m.viewport),C=P.tlhc.x-1,_=P.tlhc.y-1,D=P.brhc.x-C,I=P.brhc.y-_;O.drawImage(M,C,_,D,I,C,_,D,I),m.renderingTools=Object(u.default)(m)}function v(m,E){var T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(m===void 0)throw new Error("addGrayscaleLayer: layer parameter must not be undefined");var O=m.image;if(O===void 0)throw new Error("addGrayscaleLayer: image must be loaded before it can be drawn");m.canvas=h(m,O,E,T);var M=m.canvas.getContext("2d",{desynchronized:!0});M.imageSmoothingEnabled=!m.viewport.pixelReplication,M.mozImageSmoothingEnabled=M.imageSmoothingEnabled,m.renderingTools=Object(u.default)(m)}},"./rendering/renderLabelMapImage.js":function(W,n,e){e.r(n),e.d(n,"renderLabelMapImage",function(){return c}),e.d(n,"addLabelMapLayer",function(){return h});var a=e("./setToPixelCoordinateSystem.js"),f=e("./internal/now.js"),d=e("./internal/getFillStyle.js"),l=e("./rendering/initializeRenderCanvas.js"),o=e("./rendering/saveLastRendered.js"),t=e("./rendering/doesImageNeedToBeRendered.js"),r=e("./internal/storedPixelDataToCanvasImageDataColorLUT.js"),s=e("./colors/index.js"),i=e("./internal/getDisplayedArea.js");function u(g,v,m){g.renderingTools.renderCanvas||(g.renderingTools.renderCanvas=document.createElement("canvas"));var E=g.renderingTools.renderCanvas,T=g.viewport.colormap||g.options.colormap;if(g.options.colormap,T&&typeof T=="string"&&(T=s.default.getColormap(T)),!T)throw new Error("renderLabelMapImage: colormap not found.");var O=T.getId();if(Object(t.default)(g,v)===!1&&m!==!0&&g.renderingTools.colormapId===O)return E;(E.width!==v.width||E.height!==v.height)&&Object(l.default)(g,v);var M=Object(f.default)();(!g.renderingTools.colorLut||m||g.renderingTools.colormapId!==O)&&(g.renderingTools.colorLut=T.createLookupTable(),g.renderingTools.colormapId=O),v.stats=v.stats||{},v.stats.lastLutGenerateTime=Object(f.default)()-M;var P=g.renderingTools.colorLut,C=g.renderingTools.renderCanvasData,_=g.renderingTools.renderCanvasContext;return Object(r.default)(v,P,C.data),M=Object(f.default)(),_.putImageData(C,0,0),v.stats.lastPutImageDataTime=Object(f.default)()-M,E}function c(g,v){if(g===void 0)throw new Error("renderLabelMapImage: enabledElement parameter must not be undefined");var m=g.image;if(m===void 0)throw new Error("renderLabelMapImage: image must be loaded before it can be drawn");var E=g.canvas.getContext("2d",{desynchronized:!0});E.setTransform(1,0,0,1,0,0),E.fillStyle=Object(d.default)(g),E.fillRect(0,0,g.canvas.width,g.canvas.height),E.imageSmoothingEnabled=!g.viewport.pixelReplication,E.mozImageSmoothingEnabled=E.imageSmoothingEnabled,Object(a.default)(g,E);var T=u(g,m,v),O=Object(i.default)(g.image,g.viewport),M=O.tlhc.x-1,P=O.tlhc.y-1,C=O.brhc.x-M,_=O.brhc.y-P;E.drawImage(T,M,P,C,_,M,P,C,_),g.renderingTools=Object(o.default)(g)}function h(g,v){if(g===void 0)throw new Error("addLabelMapLayer: layer parameter must not be undefined");var m=g.image;if(m===void 0)throw new Error("addLabelMapLayer: image must be loaded before it can be drawn");g.canvas=u(g,m,v);var E=g.canvas.getContext("2d",{desynchronized:!0});E.imageSmoothingEnabled=!g.viewport.pixelReplication,E.mozImageSmoothingEnabled=E.imageSmoothingEnabled,g.renderingTools=Object(o.default)(g)}},"./rendering/renderPseudoColorImage.js":function(W,n,e){e.r(n),e.d(n,"renderPseudoColorImage",function(){return h}),e.d(n,"addPseudoColorLayer",function(){return g});var a=e("./setToPixelCoordinateSystem.js"),f=e("./internal/now.js"),d=e("./internal/getFillStyle.js"),l=e("./rendering/initializeRenderCanvas.js"),o=e("./rendering/getLut.js"),t=e("./rendering/saveLastRendered.js"),r=e("./rendering/doesImageNeedToBeRendered.js"),s=e("./internal/storedPixelDataToCanvasImageDataPseudocolorLUT.js"),i=e("./colors/index.js"),u=e("./internal/getDisplayedArea.js");function c(v,m,E){v.renderingTools.renderCanvas||(v.renderingTools.renderCanvas=document.createElement("canvas"));var T=v.renderingTools.renderCanvas,O=v.viewport.colormap||v.options.colormap;if(v.options&&v.options.colormap,O&&typeof O=="string"&&(O=i.default.getColormap(O)),!O)throw new Error("renderPseudoColorImage: colormap not found.");var M=O.getId();if(Object(r.default)(v,m)===!1&&E!==!0&&v.renderingTools.colormapId===M)return T;(T.width!==m.width||T.height!==m.height)&&Object(l.default)(v,m);var P=Object(f.default)();(!v.renderingTools.colorLut||E||v.renderingTools.colormapId!==M)&&(O.setNumberOfColors(256),v.renderingTools.colorLut=O.createLookupTable(),v.renderingTools.colormapId=M);var C=Object(o.default)(m,v.viewport,E);m.stats=m.stats||{},m.stats.lastLutGenerateTime=Object(f.default)()-P;var _=v.renderingTools.colorLut,D=v.renderingTools.renderCanvasData,I=v.renderingTools.renderCanvasContext;return Object(s.default)(m,C,_,D.data),P=Object(f.default)(),I.putImageData(D,0,0),m.stats.lastPutImageDataTime=Object(f.default)()-P,T}function h(v,m){if(v===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");var E=v.image;if(E===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");var T=v.canvas.getContext("2d",{desynchronized:!0});T.setTransform(1,0,0,1,0,0),T.fillStyle=Object(d.default)(v),T.fillRect(0,0,v.canvas.width,v.canvas.height),T.imageSmoothingEnabled=!v.viewport.pixelReplication,T.mozImageSmoothingEnabled=T.imageSmoothingEnabled,Object(a.default)(v,T);var O=c(v,E,m),M=Object(u.default)(v.image,v.viewport),P=M.tlhc.x-1,C=M.tlhc.y-1,_=M.brhc.x-P,D=M.brhc.y-C;T.drawImage(O,P,C,_,D,P,C,_,D),v.renderingTools=Object(t.default)(v)}function g(v,m){if(v===void 0)throw new Error("addPseudoColorLayer: layer parameter must not be undefined");var E=v.image;if(E===void 0)throw new Error("addPseudoColorLayer: image must be loaded before it can be drawn");v.canvas=c(v,E,m);var T=v.canvas.getContext("2d",{desynchronized:!0});T.imageSmoothingEnabled=!v.viewport.pixelReplication,T.mozImageSmoothingEnabled=T.imageSmoothingEnabled,v.renderingTools=Object(t.default)(v)}},"./rendering/renderToCanvas.js":function(W,n,e){e.r(n);var a=e("./triggerEvent.js"),f=e("./events.js"),d=e("./internal/drawImageSync.js"),l=e("./internal/getDefaultViewport.js"),o=e("./internal/tryEnableWebgl.js");function t(r,s,i,u){return{element:r,canvas:r,image:s,invalid:!0,needsRedraw:!0,options:i,layers:[],data:{},renderingTools:{},viewport:u}}n.default=function(r,s){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(r===void 0)throw new Error("renderToCanvas: parameter canvas cannot be undefined");u&&u.renderer&&u.renderer.toLowerCase()==="webgl"&&Object(o.default)(u);var c=Object(l.default)(r,s);i&&Object.assign(c,i);var h=t(r,s,u,c),g={enabledElement:h,timestamp:Date.now()};Object(a.default)(h.element,f.default.PRE_RENDER,g),Object(d.default)(h,h.invalid)}},"./rendering/renderWebImage.js":function(W,n,e){e.r(n),e.d(n,"renderWebImage",function(){return l});var a=e("./setToPixelCoordinateSystem.js"),f=e("./rendering/renderColorImage.js"),d=e("./internal/getDisplayedArea.js");function l(o,t){if(o===void 0)throw new Error("renderWebImage: enabledElement parameter must not be undefined");var r=o.image;if(r===void 0)throw new Error("renderWebImage: image must be loaded before it can be drawn");if(o.viewport.voi.windowWidth===o.image.windowWidth&&o.viewport.voi.windowCenter===o.image.windowCenter&&o.viewport.invert===!1){var s=o.canvas.getContext("2d",{desynchronized:!0});s.setTransform(1,0,0,1,0,0),s.fillStyle="black",s.fillRect(0,0,o.canvas.width,o.canvas.height),s.imageSmoothingEnabled=!o.viewport.pixelReplication,s.mozImageSmoothingEnabled=s.imageSmoothingEnabled,Object(a.default)(o,s);var i=Object(d.default)(o.image,o.viewport),u=i.tlhc.x-1,c=i.tlhc.y-1,h=i.brhc.x-u,g=i.brhc.y-c;s.drawImage(r.getImage(),u,c,h,g,u,c,h,g)}else Object(f.renderColorImage)(o,t)}},"./rendering/saveLastRendered.js":function(W,n,e){e.r(n),n.default=function(a){var f=a.image.imageId,d=a.viewport,l=a.image.color;return a.renderingTools.lastRenderedImageId=f,a.renderingTools.lastRenderedIsColor=l,a.renderingTools.lastRenderedViewport={windowCenter:d.voi.windowCenter,windowWidth:d.voi.windowWidth,invert:d.invert,rotation:d.rotation,hflip:d.hflip,vflip:d.vflip,modalityLUT:d.modalityLUT,voiLUT:d.voiLUT,colormap:d.colormap},a.renderingTools}},"./requestPool/RequestPoolManager.ts":function(W,n,e){e.r(n),e.d(n,"RequestPoolManager",function(){return s});function a(i,u){var c=typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(!c){if(Array.isArray(i)||(c=f(i))||u){c&&(i=c);var h=0,g=function(){};return{s:g,n:function(){return h>=i.length?{done:!0}:{done:!1,value:i[h++]}},e:function(O){throw O},f:g}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var v=!0,m=!1,E;return{s:function(){c=c.call(i)},n:function(){var O=c.next();return v=O.done,O},e:function(O){m=!0,E=O},f:function(){try{!v&&c.return!=null&&c.return()}finally{if(m)throw E}}}}function f(i,u){if(i){if(typeof i=="string")return d(i,u);var c=Object.prototype.toString.call(i).slice(8,-1);if(c==="Object"&&i.constructor&&(c=i.constructor.name),c==="Map"||c==="Set")return Array.from(i);if(c==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return d(i,u)}}function d(i,u){(u==null||u>i.length)&&(u=i.length);for(var c=0,h=new Array(u);c<u;c++)h[c]=i[c];return h}function l(i,u){if(!(i instanceof u))throw new TypeError("Cannot call a class as a function")}function o(i,u){for(var c=0;c<u.length;c++){var h=u[c];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(i,h.key,h)}}function t(i,u,c){return u&&o(i.prototype,u),i}function r(i,u,c){return u in i?Object.defineProperty(i,u,{value:c,enumerable:!0,configurable:!0,writable:!0}):i[u]=c,i}var s=function(){function i(){l(this,i),r(this,"requestPool",void 0),r(this,"awake",void 0),r(this,"numRequests",void 0),r(this,"maxNumRequests",void 0),r(this,"grabDelay",void 0),r(this,"timeoutHandle",void 0),this.requestPool={interaction:{0:[]},thumbnail:{0:[]},prefetch:{0:[]}},this.awake=!1,this.grabDelay=5,this.numRequests={interaction:0,thumbnail:0,prefetch:0},this.maxNumRequests={interaction:6,thumbnail:6,prefetch:5}}return t(i,[{key:"destroy",value:function(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"addRequest",value:function(c,h,g){var v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,E={requestFn:c,type:h,additionalDetails:g};this.requestPool[h][v]===void 0&&(this.requestPool[h][v]=[]),m?this.requestPool[h][v].unshift(E):this.requestPool[h][v].push(E),this.awake||(this.awake=!0,this.startGrabbing())}},{key:"filterRequests",value:function(c){var h=this;Object.keys(this.requestPool).forEach(function(g){var v=h.requestPool[g];Object.keys(v).forEach(function(m){v[m]=v[m].filter(function(E){return c(E)})})})}},{key:"clearRequestStack",value:function(c){if(!this.requestPool[c])throw new Error("No category for the type ".concat(c," found"));this.requestPool[c]={0:[]}}},{key:"sendRequest",value:function(c){var h=this,g=c.requestFn,v=c.type;this.numRequests[v]++,this.awake=!0,g().finally(function(){h.numRequests[v]--,h.startAgain()})}},{key:"startGrabbing",value:function(){for(var c=this.maxNumRequests.interaction+this.maxNumRequests.thumbnail+this.maxNumRequests.prefetch,h=this.numRequests.interaction+this.numRequests.thumbnail+this.numRequests.prefetch,g=c-h,v=0;v<g;v++){var m=this.getNextRequest();if(m===!1)break;m&&this.sendRequest(m)}}},{key:"startAgain",value:function(){var c=this;this.awake&&(this.grabDelay?this.timeoutHandle=window.setTimeout(function(){c.startGrabbing()},this.grabDelay):this.startGrabbing())}},{key:"getSortedPriorityGroups",value:function(c){var h=this,g=Object.keys(this.requestPool[c]).map(Number).filter(function(v){return h.requestPool[c][v].length}).sort();return g}},{key:"getNextRequest",value:function(){var c=this.getSortedPriorityGroups("interaction"),h=a(c),g;try{for(h.s();!(g=h.n()).done;){var v=g.value;if(this.requestPool.interaction[v].length&&this.numRequests.interaction<this.maxNumRequests.interaction)return this.requestPool.interaction[v].shift()}}catch(D){h.e(D)}finally{h.f()}var m=this.getSortedPriorityGroups("thumbnail"),E=a(m),T;try{for(E.s();!(T=E.n()).done;){var O=T.value;if(this.requestPool.thumbnail[O].length&&this.numRequests.thumbnail<this.maxNumRequests.thumbnail)return this.requestPool.thumbnail[O].shift()}}catch(D){E.e(D)}finally{E.f()}var M=this.getSortedPriorityGroups("prefetch"),P=a(M),C;try{for(P.s();!(C=P.n()).done;){var _=C.value;if(this.requestPool.prefetch[_].length&&this.numRequests.prefetch<this.maxNumRequests.prefetch)return this.requestPool.prefetch[_].shift()}}catch(D){P.e(D)}finally{P.f()}return!c.length&&!m.length&&!M.length&&(this.awake=!1),!1}},{key:"getRequestPool",value:function(){return this.requestPool}}]),i}()},"./requestPool/imageLoadPoolManager.ts":function(W,n,e){e.r(n);var a=e("./requestPool/RequestPoolManager.ts"),f=new a.RequestPoolManager;f.maxNumRequests={interaction:1e3,thumbnail:1e3,prefetch:1e3},f.grabDelay=0,n.default=f},"./requestPool/imageRetrievalPoolManager.ts":function(W,n,e){e.r(n);var a=e("./requestPool/RequestPoolManager.ts"),f=new a.RequestPoolManager;f.maxNumRequests={interaction:20,thumbnail:20,prefetch:20},f.grabDelay=0,n.default=f},"./reset.js":function(W,n,e){e.r(n);var a=e("./internal/getDefaultViewport.js"),f=e("./enabledElements.js"),d=e("./updateImage.js");n.default=function(l){var o=Object(f.getEnabledElement)(l);o.viewport=Object(a.default)(o.canvas,o.image),Object(d.default)(l)}},"./resize.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./fitToWindow.js"),d=e("./updateImage.js"),l=e("./triggerEvent.js"),o=e("./internal/getImageSize.js"),t=e("./events.js");function r(u,c){c.width!==u.clientWidth&&(c.width=u.clientWidth,c.style.width="".concat(u.clientWidth,"px")),c.height!==u.clientHeight&&(c.height=u.clientHeight,c.style.height="".concat(u.clientHeight,"px"))}function s(u,c,h){var g=u.viewport.scale,v=Object(o.default)(u.image,u.viewport.rotation),m=Math.round(v.width*g),E=Math.round(v.height*g),T=u.viewport.translation.x,O=u.viewport.translation.y;return m===c&&E<=h||m<=c&&E===h&&T===0&&O===0}function i(u,c,h){var g=u.viewport.scale,v=u.canvas.width,m=u.canvas.height,E=v/c,T=m/h,O=Math.sqrt(E*T);u.viewport.scale=O*g}n.default=function(u,c){var h=Object(a.getEnabledElement)(u),g=h.canvas.width,v=h.canvas.height;r(u,h.canvas);var m={element:u};Object(l.default)(u,t.default.ELEMENT_RESIZED,m),h.image!==void 0&&(c||s(h,g,v)?Object(f.default)(u):(i(h,g,v),Object(d.default)(u)))}},"./setToPixelCoordinateSystem.js":function(W,n,e){e.r(n);var a=e("./internal/calculateTransform.js");n.default=function(f,d,l){if(f===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(d===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");var o=Object(a.default)(f,l);d.setTransform(o.m[0],o.m[1],o.m[2],o.m[3],o.m[4],o.m[5])}},"./setViewport.js":function(W,n,e){e.r(n);var a=e("./internal/getDefaultViewport.js"),f=e("./enabledElements.js"),d=e("./updateImage.js"),l=1e-6,o=1e-4;n.default=function(t,r){var s=Object(f.getEnabledElement)(t);if(s.viewport===void 0&&(s.viewport=Object(a.default)(s.canvas)),r)for(var i in r)r[i]!==null&&(s.viewport[i]=r[i]);s.viewport.voi.windowWidth&&(s.viewport.voi.windowWidth=Math.max(s.viewport.voi.windowWidth,l)),s.viewport.scale&&(s.viewport.scale=Math.max(s.viewport.scale,o)),s.viewport.rotation%=360,s.viewport.rotation<0&&(s.viewport.rotation+=360),s.image&&Object(d.default)(t)}},"./triggerEvent.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,o;return typeof window.CustomEvent=="function"?o=new CustomEvent(d,{detail:l,cancelable:!0}):(o=document.createEvent("CustomEvent"),o.initCustomEvent(d,!0,!0,l)),f.dispatchEvent(o)}},"./updateImage.js":function(W,n,e){e.r(n);var a=e("./enabledElements.js"),f=e("./internal/drawImage.js");n.default=function(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=Object(a.getEnabledElement)(d);Object(f.default)(o,l)}},"./webgl/createProgramFromString.js":function(W,n,e){e.r(n);function a(d,l,o){var t=d.createShader(o);d.shaderSource(t,l),d.compileShader(t);var r=d.getShaderParameter(t,d.COMPILE_STATUS);if(!r&&!d.isContextLost())var s=d.getShaderInfoLog(t);return t}function f(d,l,o){var t=d.createProgram();d.attachShader(t,l),d.attachShader(t,o),d.linkProgram(t);var r=d.getProgramParameter(t,d.LINK_STATUS);if(!r&&!d.isContextLost())var s=d.getProgramInfoLog(t);return t}n.default=function(d,l,o){var t=a(d,l,d.VERTEX_SHADER),r=a(d,o,d.FRAGMENT_SHADER);return f(d,t,r)}},"./webgl/index.js":function(W,n,e){e.r(n);var a=e("./webgl/renderer.js"),f=e("./webgl/createProgramFromString.js"),d=e("./webgl/textureCache.js"),l={createProgramFromString:f.default,renderer:{render:a.render,initRenderer:a.initRenderer,getRenderCanvas:a.getRenderCanvas,isWebGLAvailable:a.isWebGLAvailable},textureCache:d.default};Object.defineProperty(l,"isWebGLInitialized",{enumerable:!0,configurable:!1,get:function(){return a.isWebGLInitialized}}),n.default=l},"./webgl/renderer.js":function(W,n,e){e.r(n),e.d(n,"isWebGLInitialized",function(){return i}),e.d(n,"getRenderCanvas",function(){return u}),e.d(n,"initRenderer",function(){return h}),e.d(n,"render",function(){return D}),e.d(n,"isWebGLAvailable",function(){return I});var a=e("./webgl/shaders/index.js"),f=e("./webgl/vertexShader.js"),d=e("./webgl/textureCache.js"),l=e("./webgl/createProgramFromString.js"),o=document.createElement("canvas"),t,r,s,i=!1;function u(){return o}function c(){for(var y in a.shaders){var R=a.shaders[y];R.attributes={},R.uniforms={},R.vert=f.vertexShader,R.program=Object(l.default)(t,R.vert,R.frag),R.attributes.texCoordLocation=t.getAttribLocation(R.program,"a_texCoord"),t.enableVertexAttribArray(R.attributes.texCoordLocation),R.attributes.positionLocation=t.getAttribLocation(R.program,"a_position"),t.enableVertexAttribArray(R.attributes.positionLocation),R.uniforms.resolutionLocation=t.getUniformLocation(R.program,"u_resolution")}}function h(){i!==!0&&E(o)&&(C(),c(),i=!0)}function g(y,R,b){y.bufferData(y.ARRAY_BUFFER,new Float32Array([R,b,0,b,R,0,0,0]),y.STATIC_DRAW)}function v(y){y.preventDefault()}function m(y){y.preventDefault(),i=!1,d.default.purgeCache(),h()}function E(y){t=null;try{var R={desynchronized:!0,preserveDrawingBuffer:!0};t=y.getContext("webgl",R)||y.getContext("experimental-webgl",R),y.removeEventListener("webglcontextlost",v,!1),y.addEventListener("webglcontextlost",v,!1),y.removeEventListener("webglcontextrestored",m,!1),y.addEventListener("webglcontextrestored",m,!1)}catch{throw new Error("Error creating WebGL context")}return t||(t=null),t}function T(y){if(y.color)return"rgb";var R=y.getPixelData();return R instanceof Int16Array?"int16":R instanceof Uint16Array?"uint16":R instanceof Int8Array?"int8":"uint8"}function O(y){var R=T(y);return a.shaders.hasOwnProperty(R)?a.shaders[R]:a.shaders.rgb}function M(y){var R={uint8:t.LUMINANCE,int8:t.LUMINANCE_ALPHA,uint16:t.LUMINANCE_ALPHA,int16:t.RGB,rgb:t.RGB},b={int8:1,uint16:2,int16:3,rgb:3},z=T(y),H=R[z],B=t.createTexture();t.bindTexture(t.TEXTURE_2D,B),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_ALIGNMENT,1);var p=a.dataUtilities[z].storedPixelDataToImageData(y,y.width,y.height);t.texImage2D(t.TEXTURE_2D,0,H,y.width,y.height,0,H,t.UNSIGNED_BYTE,p);var A=y.width*y.height*b[z];return{texture:B,sizeInBytes:A}}function P(y){var R=d.default.getImageTexture(y.imageId);return R||(R=M(y),d.default.putImageTexture(y,R)),R.texture}function C(){s=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),t.STATIC_DRAW),r=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,0]),t.STATIC_DRAW)}function _(y,R,b,z,H){t.clearColor(1,0,0,1),t.viewport(0,0,z,H),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.useProgram(y.program),t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(y.attributes.texCoordLocation,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(y.attributes.positionLocation,2,t.FLOAT,!1,0,0);for(var B in R){var p=t.getUniformLocation(y.program,B);if(p){var A=R[B],j=A.type,x=A.value;j==="i"?t.uniform1i(p,x):j==="f"?t.uniform1f(p,x):j==="2f"&&t.uniform2f(p,x[0],x[1])}}g(t,z,H),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,b),t.drawArrays(t.TRIANGLE_STRIP,0,4)}function D(y){var R=y.image;o.width=R.width,o.height=R.height;var b=y.viewport,z=O(R),H=P(R),B={u_resolution:{type:"2f",value:[R.width,R.height]},wc:{type:"f",value:b.voi.windowCenter},ww:{type:"f",value:b.voi.windowWidth},slope:{type:"f",value:R.slope},intercept:{type:"f",value:R.intercept},minPixelValue:{type:"f",value:R.minPixelValue},invert:{type:"i",value:b.invert?1:0}};return _(z,B,H,R.width,R.height),o}function I(){var y={failIfMajorPerformanceCaveat:!0};try{var R=document.createElement("canvas");return!!window.WebGLRenderingContext&&(R.getContext("webgl",y)||R.getContext("experimental-webgl",y))}catch{return!1}}},"./webgl/shaders/index.js":function(W,n,e){e.r(n),e.d(n,"shaders",function(){return t}),e.d(n,"dataUtilities",function(){return r});var a=e("./webgl/shaders/int16.js"),f=e("./webgl/shaders/int8.js"),d=e("./webgl/shaders/rgb.js"),l=e("./webgl/shaders/uint16.js"),o=e("./webgl/shaders/uint8.js"),t={int16:a.int16Shader,int8:f.int8Shader,rgb:d.rgbShader,uint16:l.uint16Shader,uint8:o.uint8Shader},r={int16:a.int16DataUtilities,int8:f.int8DataUtilities,rgb:d.rgbDataUtilities,uint16:l.uint16DataUtilities,uint8:o.uint8DataUtilities}},"./webgl/shaders/int16.js":function(W,n,e){e.r(n),e.d(n,"int16DataUtilities",function(){return d}),e.d(n,"int16Shader",function(){return a});var a={};function f(l){for(var o=l.getPixelData(),t=3,r=new Uint8Array(l.width*l.height*t),s=0,i=0;i<o.length;i++){var u=Math.abs(o[i]);r[s++]=u&255,r[s++]=u>>8,r[s++]=o[i]<0?0:1}return r}var d={storedPixelDataToImageData:f};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.g*65536.0;if (color.b == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/int8.js":function(W,n,e){e.r(n),e.d(n,"int8DataUtilities",function(){return d}),e.d(n,"int8Shader",function(){return a});var a={};function f(l){for(var o=l.getPixelData(),t=2,r=new Uint8Array(l.width*l.height*t),s=0,i=0;i<o.length;i++)r[s++]=o[i],r[s++]=o[i]<0?0:1;return r}var d={storedPixelDataToImageData:f};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.;if (color.a == 0.0)intensity = -intensity;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/rgb.js":function(W,n,e){e.r(n),e.d(n,"rgbDataUtilities",function(){return d}),e.d(n,"rgbShader",function(){return a});var a={};function f(l){var o=l.minPixelValue,t=0,r=0,s=l.width*l.height*4,i=l.width*l.height*3,u=l.getPixelData(),c=new Uint8Array(i);if(o<0)for(;r<s;)c[t++]=u[r++]+-o,c[t++]=u[r++]+-o,c[t++]=u[r++]+-o,r+=1;else for(;r<s;)c[t++]=u[r++],c[t++]=u[r++],c[t++]=u[r++],r+=1;return c}var d={storedPixelDataToImageData:f};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform float minPixelValue;uniform int invert;varying vec2 v_texCoord;void main() {vec3 color = texture2D(u_image, v_texCoord).xyz;color = color * 256.0 * slope + intercept;float center0 = wc - 0.5 - minPixelValue;float width0 = max(ww, 1.0);color = (color - center0) / width0 + 0.5;gl_FragColor = vec4(color, 1);if (invert == 1)gl_FragColor.rgb = 1. - gl_FragColor.rgb;}"},"./webgl/shaders/uint16.js":function(W,n,e){e.r(n),e.d(n,"uint16DataUtilities",function(){return d}),e.d(n,"uint16Shader",function(){return a});var a={};function f(l){for(var o=l.getPixelData(),t=2,r=new Uint8Array(l.width*l.height*t),s=0,i=0;i<o.length;i++){var u=o[i];r[s++]=u&255,r[s++]=u>>8}return r}var d={storedPixelDataToImageData:f};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0 + color.a*65536.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/shaders/uint8.js":function(W,n,e){e.r(n),e.d(n,"uint8DataUtilities",function(){return d}),e.d(n,"uint8Shader",function(){return a});var a={};function f(l){return l.getPixelData()}var d={storedPixelDataToImageData:f};a.frag="precision mediump float;uniform sampler2D u_image;uniform float ww;uniform float wc;uniform float slope;uniform float intercept;uniform int invert;varying vec2 v_texCoord;void main() {vec4 color = texture2D(u_image, v_texCoord);float intensity = color.r*256.0;intensity = intensity * slope + intercept;float center0 = wc - 0.5;float width0 = max(ww, 1.0);intensity = (intensity - center0) / width0 + 0.5;intensity = clamp(intensity, 0.0, 1.0);gl_FragColor = vec4(intensity, intensity, intensity, 1.0);if (invert == 1)gl_FragColor.rgb = 1.0 - gl_FragColor.rgb;}"},"./webgl/textureCache.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./triggerEvent.js"),d={},l=[],o=1024*1024*256,t=0;function r(){return{maximumSizeInBytes:o,cacheSizeInBytes:t,numberOfImagesCached:l.length}}function s(){if(t<=o)return;function v(T,O){return T.timeStamp>O.timeStamp?-1:T.timeStamp<O.timeStamp?1:0}for(l.sort(v);t>o;){var m=l[l.length-1];t-=m.sizeInBytes,delete d[m.imageId],l.pop(),Object(f.default)(a.events,a.default.WEBGL_TEXTURE_REMOVED,{imageId:m.imageId})}var E=r();Object(f.default)(a.events,a.default.WEBGL_TEXTURE_CACHE_FULL,E)}function i(v){if(v===void 0)throw new Error("setMaximumSizeBytes: parameter numBytes must not be undefined");if(v.toFixed===void 0)throw new Error("setMaximumSizeBytes: parameter numBytes must be a number");o=v,s()}function u(v,m){var E=v.imageId;if(v===void 0)throw new Error("putImageTexture: image must not be undefined");if(E===void 0)throw new Error("putImageTexture: imageId must not be undefined");if(m===void 0)throw new Error("putImageTexture: imageTexture must not be undefined");if(Object.prototype.hasOwnProperty.call(d,E)===!0)throw new Error("putImageTexture: imageId already in cache");var T={imageId:E,imageTexture:m,timeStamp:new Date,sizeInBytes:m.sizeInBytes};if(d[E]=T,l.push(T),m.sizeInBytes===void 0)throw new Error("putImageTexture: imageTexture.sizeInBytes must not be undefined");if(m.sizeInBytes.toFixed===void 0)throw new Error("putImageTexture: imageTexture.sizeInBytes is not a number");t+=T.sizeInBytes,s()}function c(v){if(v===void 0)throw new Error("getImageTexture: imageId must not be undefined");var m=d[v];if(m!==void 0)return m.timeStamp=new Date,m.imageTexture}function h(v){if(v===void 0)throw new Error("removeImageTexture: imageId must not be undefined");var m=d[v];if(m===void 0)throw new Error("removeImageTexture: imageId must not be undefined");return l.splice(l.indexOf(m),1),t-=m.sizeInBytes,delete d[v],m.imageTexture}function g(){for(;l.length>0;){var v=l.pop();delete d[v.imageId]}t=0}n.default={purgeCache:g,getImageTexture:c,putImageTexture:u,removeImageTexture:h,setMaximumSizeBytes:i}},"./webgl/vertexShader.js":function(W,n,e){e.r(n),e.d(n,"vertexShader",function(){return a});var a="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}"}})})}(Wt)),Wt.exports}var lt=vn();const hn=It(lt),Zt=yt({__proto__:null,default:hn},[lt]);var Kt={exports:{}};/*! cornerstone-math - 0.1.10 - 2022-06-09 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneMath */var $t;function gn(){return $t||($t=1,function(et,ze){(function(W,n){et.exports=n()})(window,function(){return function(W){var n={};function e(a){if(n[a])return n[a].exports;var f=n[a]={i:a,l:!1,exports:{}};return W[a].call(f.exports,f,f.exports,e),f.l=!0,f.exports}return e.m=W,e.c=n,e.d=function(a,f,d){e.o(a,f)||Object.defineProperty(a,f,{enumerable:!0,get:d})},e.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},e.t=function(a,f){if(1&f&&(a=e(a)),8&f||4&f&&typeof a=="object"&&a&&a.__esModule)return a;var d=Object.create(null);if(e.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&f&&typeof a!="string")for(var l in a)e.d(d,l,(function(o){return a[o]}).bind(null,l));return d},e.n=function(a){var f=a&&a.__esModule?function(){return a.default}:function(){return a};return e.d(f,"a",f),f},e.o=function(a,f){return Object.prototype.hasOwnProperty.call(a,f)},e.p="",e(e.s=4)}([function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function o(t,r){for(var s=0;s<r.length;s++){var i=r[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,r,s){return r&&o(t.prototype,r),s&&o(t,s),t}}(),f=function(o){return o&&o.__esModule?o:{default:o}}(e(2)),d=e(1),l=function(){function o(t,r,s){(function(i,u){if(!(i instanceof u))throw new TypeError("Cannot call a class as a function")})(this,o),this.x=t||0,this.y=r||0,this.z=s||0}return a(o,[{key:"set",value:function(t,r,s){return this.x=t,this.y=r,this.z=s,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setComponent",value:function(t,r){switch(t){case 0:this.x=r;break;case 1:this.y=r;break;case 2:this.z=r;break;default:throw new Error("index is out of range: "+t)}}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"add",value:function(t,r){return r!==void 0?this.addVectors(t,r):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,r){return this.x=t.x+r.x,this.y=t.y+r.y,this.z=t.z+r.z,this}},{key:"sub",value:function(t,r){return r!==void 0?this.subVectors(t,r):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}},{key:"subVectors",value:function(t,r){return this.x=t.x-r.x,this.y=t.y-r.y,this.z=t.z-r.z,this}},{key:"multiply",value:function(t,r){return r!==void 0?this.multiplyVectors(t,r):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,r){return this.x=t.x*r.x,this.y=t.y*r.y,this.z=t.z*r.z,this}},{key:"applyMatrix3",value:function(t){var r=this.x,s=this.y,i=this.z,u=t.elements;return this.x=u[0]*r+u[3]*s+u[6]*i,this.y=u[1]*r+u[4]*s+u[7]*i,this.z=u[2]*r+u[5]*s+u[8]*i,this}},{key:"applyMatrix4",value:function(t){var r=this.x,s=this.y,i=this.z,u=t.elements;return this.x=u[0]*r+u[4]*s+u[8]*i+u[12],this.y=u[1]*r+u[5]*s+u[9]*i+u[13],this.z=u[2]*r+u[6]*s+u[10]*i+u[14],this}},{key:"applyProjection",value:function(t){var r=this.x,s=this.y,i=this.z,u=t.elements,c=1/(u[3]*r+u[7]*s+u[11]*i+u[15]);return this.x=(u[0]*r+u[4]*s+u[8]*i+u[12])*c,this.y=(u[1]*r+u[5]*s+u[9]*i+u[13])*c,this.z=(u[2]*r+u[6]*s+u[10]*i+u[14])*c,this}},{key:"applyQuaternion",value:function(t){var r=this.x,s=this.y,i=this.z,u=t.x,c=t.y,h=t.z,g=t.w,v=g*r+c*i-h*s,m=g*s+h*r-u*i,E=g*i+u*s-c*r,T=-u*r-c*s-h*i;return this.x=v*g+T*-u+m*-h-E*-c,this.y=m*g+T*-c+E*-u-v*-h,this.z=E*g+T*-h+v*-c-m*-u,this}},{key:"transformDirection",value:function(t){var r=this.x,s=this.y,i=this.z,u=t.elements;return this.x=u[0]*r+u[4]*s+u[8]*i,this.y=u[1]*r+u[5]*s+u[9]*i,this.z=u[2]*r+u[6]*s+u[10]*i,this.normalize(),this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){if(t!==0){var r=1/t;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return this}},{key:"min",value:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this}},{key:"max",value:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this}},{key:"clamp",value:function(t,r){return this.x<t.x?this.x=t.x:this.x>r.x&&(this.x=r.x),this.y<t.y?this.y=t.y:this.y>r.y&&(this.y=r.y),this.z<t.z?this.z=t.z:this.z>r.z&&(this.z=r.z),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){var r=this.length();return r!==0&&t!==r&&this.multiplyScalar(t/r),this}},{key:"lerp",value:function(t,r){return this.x+=(t.x-this.x)*r,this.y+=(t.y-this.y)*r,this.z+=(t.z-this.z)*r,this}},{key:"cross",value:function(t,r){if(r!==void 0)return this.crossVectors(t,r);var s=this.x,i=this.y,u=this.z;return this.x=i*t.z-u*t.y,this.y=u*t.x-s*t.z,this.z=s*t.y-i*t.x,this}},{key:"crossVectors",value:function(t,r){var s=t.x,i=t.y,u=t.z,c=r.x,h=r.y,g=r.z;return this.x=i*g-u*h,this.y=u*c-s*g,this.z=s*h-i*c,this}},{key:"angleTo",value:function(t){var r=this.dot(t)/(this.length()*t.length());return Math.acos((0,d.clamp)(r,-1,1))}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var r=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return r*r+s*s+i*i}},{key:"setFromMatrixPosition",value:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this}},{key:"setFromMatrixScale",value:function(t){var r=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),s=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),i=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=r,this.y=s,this.z=i,this}},{key:"setFromMatrixColumn",value:function(t,r){var s=4*t,i=r.elements;return this.x=i[s],this.y=i[s+1],this.z=i[s+2],this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"fromArray",value:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"clone",value:function(){return new o(this.x,this.y,this.z)}}]),o}();l.prototype.projectOnVector=function(){var o=void 0,t=void 0;return function(r){return o===void 0&&(o=new l),o.copy(r).normalize(),t=this.dot(o),this.copy(o).multiplyScalar(t)}}(),l.prototype.projectOnPlane=function(){var o=void 0;return function(t){return o===void 0&&(o=new l),o.copy(this).projectOnVector(t),this.sub(o)}}(),l.prototype.reflect=function(){var o=void 0;return function(t){return o===void 0&&(o=new l),this.sub(o.copy(t).multiplyScalar(2*this.dot(t)))}}(),l.prototype.clampScalar=function(){var o=void 0,t=void 0;return function(r,s){return o===void 0&&(o=new l,t=new l),o.set(r,r,r),t.set(s,s,s),this.clamp(o,t)}}(),l.prototype.applyAxisAngle=function(){var o=void 0;return function(t,r){return o===void 0&&(o=new f.default),this.applyQuaternion(o.setFromAxisAngle(t.normalize(),r)),this}}(),n.default=l},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=1e-4;n.clamp=function(f,d,l){return f<d?d:f>l?l:f},n.degToRad=function(f){return f*(Math.PI/180)},n.approximatelyEquals=function(f,d,l){var o=l||a;return Math.abs(f-d)<=o*Math.max(1,Math.abs(f),Math.abs(d))},n.radToDeg=function(f){return f*(180/Math.PI)},n.sign=function(f){return typeof f=="number"?f?f<0?-1:1:f==f?0:NaN:NaN}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function d(l,o){for(var t=0;t<o.length;t++){var r=o[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(l,r.key,r)}}return function(l,o,t){return o&&d(l.prototype,o),t&&d(l,t),l}}(),f=function(){function d(l,o,t,r){(function(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")})(this,d),this.x=l||0,this.y=o||0,this.z=t||0,this.w=r!==void 0?r:1}return a(d,[{key:"setFromAxisAngle",value:function(l,o){var t=o/2,r=Math.sin(t);return this.x=l.x*r,this.y=l.y*r,this.z=l.z*r,this.w=Math.cos(t),this}},{key:"multiplyQuaternions",value:function(l,o){var t=l.x,r=l.y,s=l.z,i=l.w,u=o.x,c=o.y,h=o.z,g=o.w;return this.x=t*g+i*u+r*h-s*c,this.y=r*g+i*c+s*u-t*h,this.z=s*g+i*h+t*c-r*u,this.w=i*g-t*u-r*c-s*h,this}},{key:"setFromRotationMatrix",value:function(l){var o=l.elements,t=o[0],r=o[4],s=o[8],i=o[1],u=o[5],c=o[9],h=o[2],g=o[6],v=o[10],m=t+u+v,E=void 0;return m>0?(E=.5/Math.sqrt(m+1),this.w=.25/E,this.x=(g-c)*E,this.y=(s-h)*E,this.z=(i-r)*E):t>u&&t>v?(E=2*Math.sqrt(1+t-u-v),this.w=(g-c)/E,this.x=.25*E,this.y=(r+i)/E,this.z=(s+h)/E):u>v?(E=2*Math.sqrt(1+u-t-v),this.w=(s-h)/E,this.x=(r+i)/E,this.y=.25*E,this.z=(c+g)/E):(E=2*Math.sqrt(1+v-t-u),this.w=(i-r)/E,this.x=(s+h)/E,this.y=(c+g)/E,this.z=.25*E),this}}]),d}();n.default=f},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=e(1);function f(o){return o*o}function d(o,t){return f(o.x-t.x)+f(o.y-t.y)}var l={distanceToPoint:function(o,t){return Math.sqrt(function(r,s){var i=d(r.start,r.end);if(i===0)return d(s,r.start);var u=((s.x-r.start.x)*(r.end.x-r.start.x)+(s.y-r.start.y)*(r.end.y-r.start.y))/i;return d(s,u<0?r.start:u>1?r.end:{x:r.start.x+u*(r.end.x-r.start.x),y:r.start.y+u*(r.end.y-r.start.y)})}(o,t))},intersectLine:function(o,t){var r,s,i,u,c,h,g,v,m,E,T,O={},M=o.start.x,P=o.start.y,C=o.end.x,_=o.end.y,D=t.start.x,I=t.start.y,y=t.end.x,R=t.end.y,b=void 0;if(E=(r=_-P)*y+(i=M-C)*R+(c=C*P-M*_),((m=r*D+i*I+c)===0||E===0||(0,a.sign)(m)!==(0,a.sign)(E))&&(v=(s=R-I)*C+(u=D-y)*_+(h=y*I-D*R),(g=s*M+u*P+h)===0||v===0||(0,a.sign)(g)!==(0,a.sign)(v))){T=r*u-s*i,b=i*h-u*c;var z=parseFloat(b/T);b=s*c-r*h;var H=parseFloat(b/T);return O.x=z,O.y=H,O}}};n.default=l},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.Vector3=n.rect=n.quaternion=n.point=n.Plane=n.Matrix4=n.sign=n.radToDeg=n.degToRad=n.clamp=n.lineSegment=n.Line3=void 0;var a=u(e(5)),f=u(e(3)),d=e(1),l=u(e(6)),o=u(e(7)),t=u(e(8)),r=u(e(2)),s=u(e(9)),i=u(e(0));function u(h){return h&&h.__esModule?h:{default:h}}var c={Line3:a.default,lineSegment:f.default,clamp:d.clamp,degToRad:d.degToRad,radToDeg:d.radToDeg,sign:d.sign,Matrix4:l.default,Plane:o.default,point:t.default,quaternion:r.default,rect:s.default,Vector3:i.default};n.Line3=a.default,n.lineSegment=f.default,n.clamp=d.clamp,n.degToRad=d.degToRad,n.radToDeg=d.radToDeg,n.sign=d.sign,n.Matrix4=l.default,n.Plane=o.default,n.point=t.default,n.quaternion=r.default,n.rect=s.default,n.Vector3=i.default,n.default=c},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function o(t,r){for(var s=0;s<r.length;s++){var i=r[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,r,s){return r&&o(t.prototype,r),s&&o(t,s),t}}(),f=function(o){return o&&o.__esModule?o:{default:o}}(e(0)),d=e(1),l=function(){function o(t,r){(function(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")})(this,o),this.start=t!==void 0?t:new f.default,this.end=r!==void 0?r:new f.default}return a(o,[{key:"set",value:function(t,r){return this.start.copy(t),this.end.copy(r),this}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"center",value:function(t){return(t||new f.default).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(t){return(t||new f.default).subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,r){var s=r||new f.default;return this.delta(s).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,r){var s=new f.default,i=new f.default;s.subVectors(t,this.start),i.subVectors(this.end,this.start);var u=i.dot(i),c=i.dot(s)/u;return r&&(c=(0,d.clamp)(c,0,1)),c}},{key:"closestPointToPoint",value:function(t,r,s){var i=this.closestPointToPointParameter(t,r),u=s||new f.default;return this.delta(u).multiplyScalar(i).add(this.start)}},{key:"applyMatrix4",value:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}},{key:"clone",value:function(){return new o().copy(this)}},{key:"intersectLine",value:function(t){var r=this.end.clone().sub(this.start),s=t.end.clone().sub(t.start),i=t.start.clone().sub(this.start),u=r.clone().cross(s),c=i.clone().cross(s),h=i.dot(u)/(i.lengthSq()*u.lengthSq());if((0,d.approximatelyEquals)(h,0)){var g=c.dot(u)/u.lengthSq();if(!(g>1||isNaN(g))){var v=this.start.clone().add(r.clone().multiplyScalar(g));return v.clone().sub(t.start).lengthSq()+v.clone().sub(t.end).lengthSq()<=t.distanceSq()?v:void 0}}}}]),o}();n.default=l},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function l(o,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(o,s.key,s)}}return function(o,t,r){return t&&l(o.prototype,t),r&&l(o,r),o}}(),f=function(l){return l&&l.__esModule?l:{default:l}}(e(0)),d=function(){function l(o,t,r,s,i,u,c,h,g,v,m,E,T,O,M,P){(function(_,D){if(!(_ instanceof D))throw new TypeError("Cannot call a class as a function")})(this,l),this.elements=new Float32Array(16);var C=this.elements;C[0]=o!==void 0?o:1,C[4]=t||0,C[8]=r||0,C[12]=s||0,C[1]=i||0,C[5]=u!==void 0?u:1,C[9]=c||0,C[13]=h||0,C[2]=g||0,C[6]=v||0,C[10]=m!==void 0?m:1,C[14]=E||0,C[3]=T||0,C[7]=O||0,C[11]=M||0,C[15]=P!==void 0?P:1}return a(l,[{key:"makeRotationFromQuaternion",value:function(o){var t=this.elements,r=o.x,s=o.y,i=o.z,u=o.w,c=r+r,h=s+s,g=i+i,v=r*c,m=r*h,E=r*g,T=s*h,O=s*g,M=i*g,P=u*c,C=u*h,_=u*g;return t[0]=1-(T+M),t[4]=m-_,t[8]=E+C,t[1]=m+_,t[5]=1-(v+M),t[9]=O-P,t[2]=E-C,t[6]=O+P,t[10]=1-(v+T),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"multiplyMatrices",value:function(o,t){var r=o.elements,s=t.elements,i=this.elements,u=r[0],c=r[4],h=r[8],g=r[12],v=r[1],m=r[5],E=r[9],T=r[13],O=r[2],M=r[6],P=r[10],C=r[14],_=r[3],D=r[7],I=r[11],y=r[15],R=s[0],b=s[4],z=s[8],H=s[12],B=s[1],p=s[5],A=s[9],j=s[13],x=s[2],L=s[6],U=s[10],S=s[14],w=s[3],G=s[7],$=s[11],Q=s[15];return i[0]=u*R+c*B+h*x+g*w,i[4]=u*b+c*p+h*L+g*G,i[8]=u*z+c*A+h*U+g*$,i[12]=u*H+c*j+h*S+g*Q,i[1]=v*R+m*B+E*x+T*w,i[5]=v*b+m*p+E*L+T*G,i[9]=v*z+m*A+E*U+T*$,i[13]=v*H+m*j+E*S+T*Q,i[2]=O*R+M*B+P*x+C*w,i[6]=O*b+M*p+P*L+C*G,i[10]=O*z+M*A+P*U+C*$,i[14]=O*H+M*j+P*S+C*Q,i[3]=_*R+D*B+I*x+y*w,i[7]=_*b+D*p+I*L+y*G,i[11]=_*z+D*A+I*U+y*$,i[15]=_*H+D*j+I*S+y*Q,this}},{key:"multiply",value:function(o,t){return t!==void 0?this.multiplyMatrices(o,t):this.multiplyMatrices(this,o)}},{key:"getInverse",value:function(o,t){var r=this.elements,s=o.elements,i=s[0],u=s[4],c=s[8],h=s[12],g=s[1],v=s[5],m=s[9],E=s[13],T=s[2],O=s[6],M=s[10],P=s[14],C=s[3],_=s[7],D=s[11],I=s[15];r[0]=m*P*_-E*M*_+E*O*D-v*P*D-m*O*I+v*M*I,r[4]=h*M*_-c*P*_-h*O*D+u*P*D+c*O*I-u*M*I,r[8]=c*E*_-h*m*_+h*v*D-u*E*D-c*v*I+u*m*I,r[12]=h*m*O-c*E*O-h*v*M+u*E*M+c*v*P-u*m*P,r[1]=E*M*C-m*P*C-E*T*D+g*P*D+m*T*I-g*M*I,r[5]=c*P*C-h*M*C+h*T*D-i*P*D-c*T*I+i*M*I,r[9]=h*m*C-c*E*C-h*g*D+i*E*D+c*g*I-i*m*I,r[13]=c*E*T-h*m*T+h*g*M-i*E*M-c*g*P+i*m*P,r[2]=v*P*C-E*O*C+E*T*_-g*P*_-v*T*I+g*O*I,r[6]=h*O*C-u*P*C-h*T*_+i*P*_+u*T*I-i*O*I,r[10]=u*E*C-h*v*C+h*g*_-i*E*_-u*g*I+i*v*I,r[14]=h*v*T-u*E*T-h*g*O+i*E*O+u*g*P-i*v*P,r[3]=m*O*C-v*M*C-m*T*_+g*M*_+v*T*D-g*O*D,r[7]=u*M*C-c*O*C+c*T*_-i*M*_-u*T*D+i*O*D,r[11]=c*v*C-u*m*C-c*g*_+i*m*_+u*g*D-i*v*D,r[15]=u*m*T-c*v*T+c*g*O-i*m*O-u*g*M+i*v*M;var y=i*r[0]+g*r[4]+T*r[8]+C*r[12];if(y===0){var R="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(R);return this.identity(),this}return this.multiplyScalar(1/y),this}},{key:"applyToVector3Array",value:function(){var o=new f.default;return function(t,r,s){r===void 0&&(r=0),s===void 0&&(s=t.length);for(var i=0,u=r;i<s;i+=3,u+=3)o.x=t[u],o.y=t[u+1],o.z=t[u+2],o.applyMatrix4(this),t[u]=o.x,t[u+1]=o.y,t[u+2]=o.z;return t}}},{key:"makeTranslation",value:function(o,t,r){return this.set(1,0,0,o,0,1,0,t,0,0,1,r,0,0,0,1),this}},{key:"multiplyScalar",value:function(o){var t=this.elements;return t[0]*=o,t[4]*=o,t[8]*=o,t[12]*=o,t[1]*=o,t[5]*=o,t[9]*=o,t[13]*=o,t[2]*=o,t[6]*=o,t[10]*=o,t[14]*=o,t[3]*=o,t[7]*=o,t[11]*=o,t[15]*=o,this}},{key:"set",value:function(o,t,r,s,i,u,c,h,g,v,m,E,T,O,M,P){var C=this.elements;return C[0]=o,C[4]=t,C[8]=r,C[12]=s,C[1]=i,C[5]=u,C[9]=c,C[13]=h,C[2]=g,C[6]=v,C[10]=m,C[14]=E,C[3]=T,C[7]=O,C[11]=M,C[15]=P,this}},{key:"makeScale",value:function(o,t,r){return this.set(o,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}}]),l}();n.default=d},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function l(o,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(o,s.key,s)}}return function(o,t,r){return t&&l(o.prototype,t),r&&l(o,r),o}}(),f=function(l){return l&&l.__esModule?l:{default:l}}(e(0)),d=function(){function l(o,t){(function(r,s){if(!(r instanceof s))throw new TypeError("Cannot call a class as a function")})(this,l),this.normal=o!==void 0?o:new f.default(1,0,0),this.constant=t!==void 0?t:0}return a(l,[{key:"set",value:function(o,t){return this.normal.copy(o),this.constant=t,this}},{key:"setComponents",value:function(o,t,r,s){return this.normal.set(o,t,r),this.constant=s,this}},{key:"setFromNormalAndCoplanarPoint",value:function(o,t){return this.normal.copy(o),this.constant=-t.dot(this.normal),this}},{key:"copy",value:function(o){return this.normal.copy(o.normal),this.constant=o.constant,this}},{key:"normalize",value:function(){var o=1/this.normal.length();return this.normal.multiplyScalar(o),this.constant*=o,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(o){return this.normal.dot(o)+this.constant}},{key:"distanceToSphere",value:function(o){return this.distanceToPoint(o.center)-o.radius}},{key:"projectPoint",value:function(o,t){return this.orthoPoint(o,t).sub(o).negate()}},{key:"orthoPoint",value:function(o,t){var r=this.distanceToPoint(o);return(t||new f.default).copy(this.normal).multiplyScalar(r)}},{key:"isIntersectionLine",value:function(o){var t=this.distanceToPoint(o.start),r=this.distanceToPoint(o.end);return t<0&&r>0||r<0&&t>0}},{key:"intersectPlane",value:function(o){var t=this.normal.clone().cross(o.normal),r={origin:new f.default,direction:t};if(this.normal.clone().cross(o.normal).length<1e-10)return r.direction=new f.default,r;var s=this.constant,i=o.constant,u=this.normal.clone().dot(o.normal),c=-(s-i*u)/(1-u*u),h=-(i-s*u)/(1-u*u);return r.origin=this.normal.clone().multiplyScalar(c).add(o.normal.clone().multiplyScalar(h)),r}},{key:"coplanarPoint",value:function(o){return(o||new f.default).copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(o){return this.constant=this.constant-o.dot(this.normal),this}},{key:"equals",value:function(o){return o.normal.equals(this.normal)&&o.constant===this.constant}},{key:"clone",value:function(){return new l().copy(this)}}]),l}();d.prototype.setFromCoplanarPoints=function(){var l=new f.default,o=new f.default;return function(t,r,s){var i=l.subVectors(s,r).cross(o.subVectors(t,r)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}}(),d.prototype.intersectLine=function(){var l=new f.default;return function(o,t){var r=t||new f.default,s=o.delta(l),i=this.normal.dot(s);if(i===0)return this.distanceToPoint(o.start)===0?r.copy(o.start):void 0;var u=-(o.start.dot(this.normal)+this.constant)/i;return u<0||u>1?void 0:r.copy(s).multiplyScalar(u).add(o.start)}}(),n.default=d},function(W,n,e){function a(o,t){return{x:o.x-t.x,y:o.y-t.y}}function f(o,t){return Math.sqrt(d(o,t))}function d(o,t){var r=a(o,t);return r.x*r.x+r.y*r.y}Object.defineProperty(n,"__esModule",{value:!0});var l={subtract:a,copy:function(o){return{x:o.x,y:o.y}},pageToPoint:function(o){return{x:o.pageX,y:o.pageY}},distance:f,distanceSquared:d,insideRect:function(o,t){return!(o.x<t.left||o.x>t.left+t.width||o.y<t.top||o.y>t.top+t.height)},findClosestPoint:function(o,t){var r=[],s=void 0;return o.forEach(function(i,u){var c=f(i,t);r.push(c),s=u===0?c:Math.min(c,s)}),o[r.indexOf(s)]}};n.default=l},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(l){return l&&l.__esModule?l:{default:l}}(e(3));function f(l){return{topLeft:{x:l.left,y:l.top},bottomRight:{x:l.left+l.width,y:l.top+l.height}}}var d={distanceToPoint:function(l,o){var t=655535;return function(r){return[{start:{x:r.left,y:r.top},end:{x:r.left+r.width,y:r.top}},{start:{x:r.left+r.width,y:r.top},end:{x:r.left+r.width,y:r.top+r.height}},{start:{x:r.left+r.width,y:r.top+r.height},end:{x:r.left,y:r.top+r.height}},{start:{x:r.left,y:r.top+r.height},end:{x:r.left,y:r.top}}]}(l).forEach(function(r){var s=a.default.distanceToPoint(r,o);s<t&&(t=s)}),t},getIntersectionRect:function(l,o){var t={topLeft:{},bottomRight:{}};if(function(i,u){var c=void 0,h=void 0,g=f(i),v=f(u);return c=i.width>=0?u.width>=0?!(g.bottomRight.x<=v.topLeft.x||v.bottomRight.x<=g.topLeft.x):!(g.bottomRight.x<=v.bottomRight.x||v.topLeft.x<=g.topLeft.x):u.width>=0?!(g.topLeft.x<=v.topLeft.x||v.bottomRight.x<=g.bottomRight.x):!(g.topLeft.x<=v.bottomRight.x||v.topLeft.x<=g.bottomRight.x),h=i.height>=0?u.height>=0?!(g.bottomRight.y<=v.topLeft.y||v.bottomRight.y<=g.topLeft.y):!(g.bottomRight.y<=v.bottomRight.y||v.topLeft.y<=g.topLeft.y):u.height>=0?!(g.topLeft.y<=v.topLeft.y||v.bottomRight.y<=g.bottomRight.y):!(g.topLeft.y<=v.bottomRight.y||v.top<=g.bottomRight.y),c&&h}(l,o)){var r=f(l),s=f(o);return l.width>=0?o.width>=0?(t.topLeft.x=Math.max(r.topLeft.x,s.topLeft.x),t.bottomRight.x=Math.min(r.bottomRight.x,s.bottomRight.x)):(t.topLeft.x=Math.max(r.topLeft.x,s.bottomRight.x),t.bottomRight.x=Math.min(r.bottomRight.x,s.topLeft.x)):o.width>=0?(t.topLeft.x=Math.min(r.topLeft.x,s.bottomRight.x),t.bottomRight.x=Math.max(r.bottomRight.x,s.topLeft.x)):(t.topLeft.x=Math.min(r.topLeft.x,s.topLeft.x),t.bottomRight.x=Math.max(r.bottomRight.x,s.bottomRight.x)),l.height>=0?o.height>=0?(t.topLeft.y=Math.max(r.topLeft.y,s.topLeft.y),t.bottomRight.y=Math.min(r.bottomRight.y,s.bottomRight.y)):(t.topLeft.y=Math.max(r.topLeft.y,s.bottomRight.y),t.bottomRight.y=Math.min(r.bottomRight.y,s.topLeft.y)):o.height>=0?(t.topLeft.y=Math.min(r.topLeft.y,s.bottomRight.y),t.bottomRight.y=Math.max(r.bottomRight.y,s.topLeft.y)):(t.topLeft.y=Math.min(r.topLeft.y,s.topLeft.y),t.bottomRight.y=Math.max(r.bottomRight.y,s.bottomRight.y)),t}}};n.default=d}])})}(Kt)),Kt.exports}var qt=gn();const mn=It(qt),En=yt({__proto__:null,default:mn},[qt]);var Ft={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var Jt;function Mn(){return Jt||(Jt=1,function(et){(function(ze,W,n,e){var a=["","webkit","Moz","MS","ms","o"],f=W.createElement("div"),d="function",l=Math.round,o=Math.abs,t=Date.now;function r(k,ae,se){return setTimeout(m(k,se),ae)}function s(k,ae,se){return Array.isArray(k)?(i(k,se[ae],se),!0):!1}function i(k,ae,se){var Te;if(k)if(k.forEach)k.forEach(ae,se);else if(k.length!==e)for(Te=0;Te<k.length;)ae.call(se,k[Te],Te,k),Te++;else for(Te in k)k.hasOwnProperty(Te)&&ae.call(se,k[Te],Te,k)}function u(k,ae,se){var Te="DEPRECATED METHOD: "+ae+`
`+se+` AT 
`;return function(){var Ae=new Error("get-stack-trace"),We=Ae&&Ae.stack?Ae.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",He=ze.console&&(ze.console.warn||ze.console.log);return He&&He.call(ze.console,Te,We),k.apply(this,arguments)}}var c;typeof Object.assign!="function"?c=function(ae){if(ae===e||ae===null)throw new TypeError("Cannot convert undefined or null to object");for(var se=Object(ae),Te=1;Te<arguments.length;Te++){var Ae=arguments[Te];if(Ae!==e&&Ae!==null)for(var We in Ae)Ae.hasOwnProperty(We)&&(se[We]=Ae[We])}return se}:c=Object.assign;var h=u(function(ae,se,Te){for(var Ae=Object.keys(se),We=0;We<Ae.length;)(!Te||Te&&ae[Ae[We]]===e)&&(ae[Ae[We]]=se[Ae[We]]),We++;return ae},"extend","Use `assign`."),g=u(function(ae,se){return h(ae,se,!0)},"merge","Use `assign`.");function v(k,ae,se){var Te=ae.prototype,Ae;Ae=k.prototype=Object.create(Te),Ae.constructor=k,Ae._super=Te,se&&c(Ae,se)}function m(k,ae){return function(){return k.apply(ae,arguments)}}function E(k,ae){return typeof k==d?k.apply(ae&&ae[0]||e,ae):k}function T(k,ae){return k===e?ae:k}function O(k,ae,se){i(_(ae),function(Te){k.addEventListener(Te,se,!1)})}function M(k,ae,se){i(_(ae),function(Te){k.removeEventListener(Te,se,!1)})}function P(k,ae){for(;k;){if(k==ae)return!0;k=k.parentNode}return!1}function C(k,ae){return k.indexOf(ae)>-1}function _(k){return k.trim().split(/\s+/g)}function D(k,ae,se){if(k.indexOf&&!se)return k.indexOf(ae);for(var Te=0;Te<k.length;){if(se&&k[Te][se]==ae||!se&&k[Te]===ae)return Te;Te++}return-1}function I(k){return Array.prototype.slice.call(k,0)}function y(k,ae,se){for(var Te=[],Ae=[],We=0;We<k.length;){var He=k[We][ae];D(Ae,He)<0&&Te.push(k[We]),Ae[We]=He,We++}return Te=Te.sort(function(qe,at){return qe[ae]>at[ae]}),Te}function R(k,ae){for(var se,Te,Ae=ae[0].toUpperCase()+ae.slice(1),We=0;We<a.length;){if(se=a[We],Te=se?se+Ae:ae,Te in k)return Te;We++}return e}var b=1;function z(){return b++}function H(k){var ae=k.ownerDocument||k;return ae.defaultView||ae.parentWindow||ze}var B=/mobile|tablet|ip(ad|hone|od)|android/i,p="ontouchstart"in ze,A=R(ze,"PointerEvent")!==e,j=p&&B.test(navigator.userAgent),x="touch",L="pen",U="mouse",S="kinect",w=25,G=1,$=2,Q=4,re=8,le=1,de=2,me=4,Y=8,V=16,te=de|me,ne=Y|V,ue=te|ne,ge=["x","y"],ve=["clientX","clientY"];function Ee(k,ae){var se=this;this.manager=k,this.callback=ae,this.element=k.element,this.target=k.options.inputTarget,this.domHandler=function(Te){E(k.options.enable,[k])&&se.handler(Te)},this.init()}Ee.prototype={handler:function(){},init:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(H(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(H(this.element),this.evWin,this.domHandler)}};function De(k){var ae,se=k.options.inputClass;return se?ae=se:A?ae=je:j?ae=Ke:p?ae=rt:ae=Ie,new ae(k,X)}function X(k,ae,se){var Te=se.pointers.length,Ae=se.changedPointers.length,We=ae&G&&Te-Ae===0,He=ae&(Q|re)&&Te-Ae===0;se.isFirst=!!We,se.isFinal=!!He,We&&(k.session={}),se.eventType=ae,N(k,se),k.emit("hammer.input",se),k.recognize(se),k.session.prevInput=se}function N(k,ae){var se=k.session,Te=ae.pointers,Ae=Te.length;se.firstInput||(se.firstInput=oe(ae)),Ae>1&&!se.firstMultiple?se.firstMultiple=oe(ae):Ae===1&&(se.firstMultiple=!1);var We=se.firstInput,He=se.firstMultiple,Qe=He?He.center:We.center,qe=ae.center=ie(Te);ae.timeStamp=t(),ae.deltaTime=ae.timeStamp-We.timeStamp,ae.angle=Se(Qe,qe),ae.distance=ye(Qe,qe),F(se,ae),ae.offsetDirection=pe(ae.deltaX,ae.deltaY);var at=he(ae.deltaTime,ae.deltaX,ae.deltaY);ae.overallVelocityX=at.x,ae.overallVelocityY=at.y,ae.overallVelocity=o(at.x)>o(at.y)?at.x:at.y,ae.scale=He?Be(He.pointers,Te):1,ae.rotation=He?Re(He.pointers,Te):0,ae.maxPointers=se.prevInput?ae.pointers.length>se.prevInput.maxPointers?ae.pointers.length:se.prevInput.maxPointers:ae.pointers.length,q(se,ae);var ut=k.element;P(ae.srcEvent.target,ut)&&(ut=ae.srcEvent.target),ae.target=ut}function F(k,ae){var se=ae.center,Te=k.offsetDelta||{},Ae=k.prevDelta||{},We=k.prevInput||{};(ae.eventType===G||We.eventType===Q)&&(Ae=k.prevDelta={x:We.deltaX||0,y:We.deltaY||0},Te=k.offsetDelta={x:se.x,y:se.y}),ae.deltaX=Ae.x+(se.x-Te.x),ae.deltaY=Ae.y+(se.y-Te.y)}function q(k,ae){var se=k.lastInterval||ae,Te=ae.timeStamp-se.timeStamp,Ae,We,He,Qe;if(ae.eventType!=re&&(Te>w||se.velocity===e)){var qe=ae.deltaX-se.deltaX,at=ae.deltaY-se.deltaY,ut=he(Te,qe,at);We=ut.x,He=ut.y,Ae=o(ut.x)>o(ut.y)?ut.x:ut.y,Qe=pe(qe,at),k.lastInterval=ae}else Ae=se.velocity,We=se.velocityX,He=se.velocityY,Qe=se.direction;ae.velocity=Ae,ae.velocityX=We,ae.velocityY=He,ae.direction=Qe}function oe(k){for(var ae=[],se=0;se<k.pointers.length;)ae[se]={clientX:l(k.pointers[se].clientX),clientY:l(k.pointers[se].clientY)},se++;return{timeStamp:t(),pointers:ae,center:ie(ae),deltaX:k.deltaX,deltaY:k.deltaY}}function ie(k){var ae=k.length;if(ae===1)return{x:l(k[0].clientX),y:l(k[0].clientY)};for(var se=0,Te=0,Ae=0;Ae<ae;)se+=k[Ae].clientX,Te+=k[Ae].clientY,Ae++;return{x:l(se/ae),y:l(Te/ae)}}function he(k,ae,se){return{x:ae/k||0,y:se/k||0}}function pe(k,ae){return k===ae?le:o(k)>=o(ae)?k<0?de:me:ae<0?Y:V}function ye(k,ae,se){se||(se=ge);var Te=ae[se[0]]-k[se[0]],Ae=ae[se[1]]-k[se[1]];return Math.sqrt(Te*Te+Ae*Ae)}function Se(k,ae,se){se||(se=ge);var Te=ae[se[0]]-k[se[0]],Ae=ae[se[1]]-k[se[1]];return Math.atan2(Ae,Te)*180/Math.PI}function Re(k,ae){return Se(ae[1],ae[0],ve)+Se(k[1],k[0],ve)}function Be(k,ae){return ye(ae[0],ae[1],ve)/ye(k[0],k[1],ve)}var Le={mousedown:G,mousemove:$,mouseup:Q},J="mousedown",Pe="mousemove mouseup";function Ie(){this.evEl=J,this.evWin=Pe,this.pressed=!1,Ee.apply(this,arguments)}v(Ie,Ee,{handler:function(ae){var se=Le[ae.type];se&G&&ae.button===0&&(this.pressed=!0),se&$&&ae.which!==1&&(se=Q),this.pressed&&(se&Q&&(this.pressed=!1),this.callback(this.manager,se,{pointers:[ae],changedPointers:[ae],pointerType:U,srcEvent:ae}))}});var xe={pointerdown:G,pointermove:$,pointerup:Q,pointercancel:re,pointerout:re},ce={2:x,3:L,4:U,5:S},_e="pointerdown",Z="pointermove pointerup pointercancel";ze.MSPointerEvent&&!ze.PointerEvent&&(_e="MSPointerDown",Z="MSPointerMove MSPointerUp MSPointerCancel");function je(){this.evEl=_e,this.evWin=Z,Ee.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}v(je,Ee,{handler:function(ae){var se=this.store,Te=!1,Ae=ae.type.toLowerCase().replace("ms",""),We=xe[Ae],He=ce[ae.pointerType]||ae.pointerType,Qe=He==x,qe=D(se,ae.pointerId,"pointerId");We&G&&(ae.button===0||Qe)?qe<0&&(se.push(ae),qe=se.length-1):We&(Q|re)&&(Te=!0),!(qe<0)&&(se[qe]=ae,this.callback(this.manager,We,{pointers:se,changedPointers:[ae],pointerType:He,srcEvent:ae}),Te&&se.splice(qe,1))}});var Fe={touchstart:G,touchmove:$,touchend:Q,touchcancel:re},K="touchstart",Oe="touchstart touchmove touchend touchcancel";function Ce(){this.evTarget=K,this.evWin=Oe,this.started=!1,Ee.apply(this,arguments)}v(Ce,Ee,{handler:function(ae){var se=Fe[ae.type];if(se===G&&(this.started=!0),!!this.started){var Te=ee.call(this,ae,se);se&(Q|re)&&Te[0].length-Te[1].length===0&&(this.started=!1),this.callback(this.manager,se,{pointers:Te[0],changedPointers:Te[1],pointerType:x,srcEvent:ae})}}});function ee(k,ae){var se=I(k.touches),Te=I(k.changedTouches);return ae&(Q|re)&&(se=y(se.concat(Te),"identifier")),[se,Te]}var fe={touchstart:G,touchmove:$,touchend:Q,touchcancel:re},Me="touchstart touchmove touchend touchcancel";function Ke(){this.evTarget=Me,this.targetIds={},Ee.apply(this,arguments)}v(Ke,Ee,{handler:function(ae){var se=fe[ae.type],Te=be.call(this,ae,se);Te&&this.callback(this.manager,se,{pointers:Te[0],changedPointers:Te[1],pointerType:x,srcEvent:ae})}});function be(k,ae){var se=I(k.touches),Te=this.targetIds;if(ae&(G|$)&&se.length===1)return Te[se[0].identifier]=!0,[se,se];var Ae,We,He=I(k.changedTouches),Qe=[],qe=this.target;if(We=se.filter(function(at){return P(at.target,qe)}),ae===G)for(Ae=0;Ae<We.length;)Te[We[Ae].identifier]=!0,Ae++;for(Ae=0;Ae<He.length;)Te[He[Ae].identifier]&&Qe.push(He[Ae]),ae&(Q|re)&&delete Te[He[Ae].identifier],Ae++;if(Qe.length)return[y(We.concat(Qe),"identifier"),Qe]}var Ue=2500,Ne=25;function rt(){Ee.apply(this,arguments);var k=m(this.handler,this);this.touch=new Ke(this.manager,k),this.mouse=new Ie(this.manager,k),this.primaryTouch=null,this.lastTouches=[]}v(rt,Ee,{handler:function(ae,se,Te){var Ae=Te.pointerType==x,We=Te.pointerType==U;if(!(We&&Te.sourceCapabilities&&Te.sourceCapabilities.firesTouchEvents)){if(Ae)Ve.call(this,se,Te);else if(We&&Ze.call(this,Te))return;this.callback(ae,se,Te)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ve(k,ae){k&G?(this.primaryTouch=ae.changedPointers[0].identifier,we.call(this,ae)):k&(Q|re)&&we.call(this,ae)}function we(k){var ae=k.changedPointers[0];if(ae.identifier===this.primaryTouch){var se={x:ae.clientX,y:ae.clientY};this.lastTouches.push(se);var Te=this.lastTouches,Ae=function(){var We=Te.indexOf(se);We>-1&&Te.splice(We,1)};setTimeout(Ae,Ue)}}function Ze(k){for(var ae=k.srcEvent.clientX,se=k.srcEvent.clientY,Te=0;Te<this.lastTouches.length;Te++){var Ae=this.lastTouches[Te],We=Math.abs(ae-Ae.x),He=Math.abs(se-Ae.y);if(We<=Ne&&He<=Ne)return!0}return!1}var Je=R(f.style,"touchAction"),ke=Je!==e,ht="compute",gt="auto",Ge="manipulation",$e="none",Xe="pan-x",tt="pan-y",nt=nn();function mt(k,ae){this.manager=k,this.set(ae)}mt.prototype={set:function(k){k==ht&&(k=this.compute()),ke&&this.manager.element.style&&nt[k]&&(this.manager.element.style[Je]=k),this.actions=k.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var k=[];return i(this.manager.recognizers,function(ae){E(ae.options.enable,[ae])&&(k=k.concat(ae.getTouchAction()))}),tn(k.join(" "))},preventDefaults:function(k){var ae=k.srcEvent,se=k.offsetDirection;if(this.manager.session.prevented){ae.preventDefault();return}var Te=this.actions,Ae=C(Te,$e)&&!nt[$e],We=C(Te,tt)&&!nt[tt],He=C(Te,Xe)&&!nt[Xe];if(Ae){var Qe=k.pointers.length===1,qe=k.distance<2,at=k.deltaTime<250;if(Qe&&qe&&at)return}if(!(He&&We)&&(Ae||We&&se&te||He&&se&ne))return this.preventSrc(ae)},preventSrc:function(k){this.manager.session.prevented=!0,k.preventDefault()}};function tn(k){if(C(k,$e))return $e;var ae=C(k,Xe),se=C(k,tt);return ae&&se?$e:ae||se?ae?Xe:tt:C(k,Ge)?Ge:gt}function nn(){if(!ke)return!1;var k={},ae=ze.CSS&&ze.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(se){k[se]=ae?ze.CSS.supports("touch-action",se):!0}),k}var Tt=1,ot=2,Et=4,ct=8,dt=ct,Mt=16,st=32;function ft(k){this.options=c({},this.defaults,k||{}),this.id=z(),this.manager=null,this.options.enable=T(this.options.enable,!0),this.state=Tt,this.simultaneous={},this.requireFail=[]}ft.prototype={defaults:{},set:function(k){return c(this.options,k),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(k){if(s(k,"recognizeWith",this))return this;var ae=this.simultaneous;return k=Ot(k,this),ae[k.id]||(ae[k.id]=k,k.recognizeWith(this)),this},dropRecognizeWith:function(k){return s(k,"dropRecognizeWith",this)?this:(k=Ot(k,this),delete this.simultaneous[k.id],this)},requireFailure:function(k){if(s(k,"requireFailure",this))return this;var ae=this.requireFail;return k=Ot(k,this),D(ae,k)===-1&&(ae.push(k),k.requireFailure(this)),this},dropRequireFailure:function(k){if(s(k,"dropRequireFailure",this))return this;k=Ot(k,this);var ae=D(this.requireFail,k);return ae>-1&&this.requireFail.splice(ae,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(k){return!!this.simultaneous[k.id]},emit:function(k){var ae=this,se=this.state;function Te(Ae){ae.manager.emit(Ae,k)}se<ct&&Te(ae.options.event+wt(se)),Te(ae.options.event),k.additionalEvent&&Te(k.additionalEvent),se>=ct&&Te(ae.options.event+wt(se))},tryEmit:function(k){if(this.canEmit())return this.emit(k);this.state=st},canEmit:function(){for(var k=0;k<this.requireFail.length;){if(!(this.requireFail[k].state&(st|Tt)))return!1;k++}return!0},recognize:function(k){var ae=c({},k);if(!E(this.options.enable,[this,ae])){this.reset(),this.state=st;return}this.state&(dt|Mt|st)&&(this.state=Tt),this.state=this.process(ae),this.state&(ot|Et|ct|Mt)&&this.tryEmit(ae)},process:function(k){},getTouchAction:function(){},reset:function(){}};function wt(k){return k&Mt?"cancel":k&ct?"end":k&Et?"move":k&ot?"start":""}function zt(k){return k==V?"down":k==Y?"up":k==de?"left":k==me?"right":""}function Ot(k,ae){var se=ae.manager;return se?se.get(k):k}function it(){ft.apply(this,arguments)}v(it,ft,{defaults:{pointers:1},attrTest:function(k){var ae=this.options.pointers;return ae===0||k.pointers.length===ae},process:function(k){var ae=this.state,se=k.eventType,Te=ae&(ot|Et),Ae=this.attrTest(k);return Te&&(se&re||!Ae)?ae|Mt:Te||Ae?se&Q?ae|ct:ae&ot?ae|Et:ot:st}});function Pt(){it.apply(this,arguments),this.pX=null,this.pY=null}v(Pt,it,{defaults:{event:"pan",threshold:10,pointers:1,direction:ue},getTouchAction:function(){var k=this.options.direction,ae=[];return k&te&&ae.push(tt),k&ne&&ae.push(Xe),ae},directionTest:function(k){var ae=this.options,se=!0,Te=k.distance,Ae=k.direction,We=k.deltaX,He=k.deltaY;return Ae&ae.direction||(ae.direction&te?(Ae=We===0?le:We<0?de:me,se=We!=this.pX,Te=Math.abs(k.deltaX)):(Ae=He===0?le:He<0?Y:V,se=He!=this.pY,Te=Math.abs(k.deltaY))),k.direction=Ae,se&&Te>ae.threshold&&Ae&ae.direction},attrTest:function(k){return it.prototype.attrTest.call(this,k)&&(this.state&ot||!(this.state&ot)&&this.directionTest(k))},emit:function(k){this.pX=k.deltaX,this.pY=k.deltaY;var ae=zt(k.direction);ae&&(k.additionalEvent=this.options.event+ae),this._super.emit.call(this,k)}});function pt(){it.apply(this,arguments)}v(pt,it,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[$e]},attrTest:function(k){return this._super.attrTest.call(this,k)&&(Math.abs(k.scale-1)>this.options.threshold||this.state&ot)},emit:function(k){if(k.scale!==1){var ae=k.scale<1?"in":"out";k.additionalEvent=this.options.event+ae}this._super.emit.call(this,k)}});function jt(){ft.apply(this,arguments),this._timer=null,this._input=null}v(jt,ft,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[gt]},process:function(k){var ae=this.options,se=k.pointers.length===ae.pointers,Te=k.distance<ae.threshold,Ae=k.deltaTime>ae.time;if(this._input=k,!Te||!se||k.eventType&(Q|re)&&!Ae)this.reset();else if(k.eventType&G)this.reset(),this._timer=r(function(){this.state=dt,this.tryEmit()},ae.time,this);else if(k.eventType&Q)return dt;return st},reset:function(){clearTimeout(this._timer)},emit:function(k){this.state===dt&&(k&&k.eventType&Q?this.manager.emit(this.options.event+"up",k):(this._input.timeStamp=t(),this.manager.emit(this.options.event,this._input)))}});function At(){it.apply(this,arguments)}v(At,it,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[$e]},attrTest:function(k){return this._super.attrTest.call(this,k)&&(Math.abs(k.rotation)>this.options.threshold||this.state&ot)}});function xt(){it.apply(this,arguments)}v(xt,it,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:te|ne,pointers:1},getTouchAction:function(){return Pt.prototype.getTouchAction.call(this)},attrTest:function(k){var ae=this.options.direction,se;return ae&(te|ne)?se=k.overallVelocity:ae&te?se=k.overallVelocityX:ae&ne&&(se=k.overallVelocityY),this._super.attrTest.call(this,k)&&ae&k.offsetDirection&&k.distance>this.options.threshold&&k.maxPointers==this.options.pointers&&o(se)>this.options.velocity&&k.eventType&Q},emit:function(k){var ae=zt(k.offsetDirection);ae&&this.manager.emit(this.options.event+ae,k),this.manager.emit(this.options.event,k)}});function Dt(){ft.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}v(Dt,ft,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ge]},process:function(k){var ae=this.options,se=k.pointers.length===ae.pointers,Te=k.distance<ae.threshold,Ae=k.deltaTime<ae.time;if(this.reset(),k.eventType&G&&this.count===0)return this.failTimeout();if(Te&&Ae&&se){if(k.eventType!=Q)return this.failTimeout();var We=this.pTime?k.timeStamp-this.pTime<ae.interval:!0,He=!this.pCenter||ye(this.pCenter,k.center)<ae.posThreshold;this.pTime=k.timeStamp,this.pCenter=k.center,!He||!We?this.count=1:this.count+=1,this._input=k;var Qe=this.count%ae.taps;if(Qe===0)return this.hasRequireFailures()?(this._timer=r(function(){this.state=dt,this.tryEmit()},ae.interval,this),ot):dt}return st},failTimeout:function(){return this._timer=r(function(){this.state=st},this.options.interval,this),st},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==dt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function vt(k,ae){return ae=ae||{},ae.recognizers=T(ae.recognizers,vt.defaults.preset),new Lt(k,ae)}vt.VERSION="2.0.7",vt.defaults={domEvents:!1,touchAction:ht,enable:!0,inputTarget:null,inputClass:null,preset:[[At,{enable:!1}],[pt,{enable:!1},["rotate"]],[xt,{direction:te}],[Pt,{direction:te},["swipe"]],[Dt],[Dt,{event:"doubletap",taps:2},["tap"]],[jt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var an=1,Vt=2;function Lt(k,ae){this.options=c({},vt.defaults,ae||{}),this.options.inputTarget=this.options.inputTarget||k,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=k,this.input=De(this),this.touchAction=new mt(this,this.options.touchAction),Gt(this,!0),i(this.options.recognizers,function(se){var Te=this.add(new se[0](se[1]));se[2]&&Te.recognizeWith(se[2]),se[3]&&Te.requireFailure(se[3])},this)}Lt.prototype={set:function(k){return c(this.options,k),k.touchAction&&this.touchAction.update(),k.inputTarget&&(this.input.destroy(),this.input.target=k.inputTarget,this.input.init()),this},stop:function(k){this.session.stopped=k?Vt:an},recognize:function(k){var ae=this.session;if(!ae.stopped){this.touchAction.preventDefaults(k);var se,Te=this.recognizers,Ae=ae.curRecognizer;(!Ae||Ae&&Ae.state&dt)&&(Ae=ae.curRecognizer=null);for(var We=0;We<Te.length;)se=Te[We],ae.stopped!==Vt&&(!Ae||se==Ae||se.canRecognizeWith(Ae))?se.recognize(k):se.reset(),!Ae&&se.state&(ot|Et|ct)&&(Ae=ae.curRecognizer=se),We++}},get:function(k){if(k instanceof ft)return k;for(var ae=this.recognizers,se=0;se<ae.length;se++)if(ae[se].options.event==k)return ae[se];return null},add:function(k){if(s(k,"add",this))return this;var ae=this.get(k.options.event);return ae&&this.remove(ae),this.recognizers.push(k),k.manager=this,this.touchAction.update(),k},remove:function(k){if(s(k,"remove",this))return this;if(k=this.get(k),k){var ae=this.recognizers,se=D(ae,k);se!==-1&&(ae.splice(se,1),this.touchAction.update())}return this},on:function(k,ae){if(k!==e&&ae!==e){var se=this.handlers;return i(_(k),function(Te){se[Te]=se[Te]||[],se[Te].push(ae)}),this}},off:function(k,ae){if(k!==e){var se=this.handlers;return i(_(k),function(Te){ae?se[Te]&&se[Te].splice(D(se[Te],ae),1):delete se[Te]}),this}},emit:function(k,ae){this.options.domEvents&&rn(k,ae);var se=this.handlers[k]&&this.handlers[k].slice();if(!(!se||!se.length)){ae.type=k,ae.preventDefault=function(){ae.srcEvent.preventDefault()};for(var Te=0;Te<se.length;)se[Te](ae),Te++}},destroy:function(){this.element&&Gt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Gt(k,ae){var se=k.element;if(se.style){var Te;i(k.options.cssProps,function(Ae,We){Te=R(se.style,We),ae?(k.oldCssProps[Te]=se.style[Te],se.style[Te]=Ae):se.style[Te]=k.oldCssProps[Te]||""}),ae||(k.oldCssProps={})}}function rn(k,ae){var se=W.createEvent("Event");se.initEvent(k,!0,!0),se.gesture=ae,ae.target.dispatchEvent(se)}c(vt,{INPUT_START:G,INPUT_MOVE:$,INPUT_END:Q,INPUT_CANCEL:re,STATE_POSSIBLE:Tt,STATE_BEGAN:ot,STATE_CHANGED:Et,STATE_ENDED:ct,STATE_RECOGNIZED:dt,STATE_CANCELLED:Mt,STATE_FAILED:st,DIRECTION_NONE:le,DIRECTION_LEFT:de,DIRECTION_RIGHT:me,DIRECTION_UP:Y,DIRECTION_DOWN:V,DIRECTION_HORIZONTAL:te,DIRECTION_VERTICAL:ne,DIRECTION_ALL:ue,Manager:Lt,Input:Ee,TouchAction:mt,TouchInput:Ke,MouseInput:Ie,PointerEventInput:je,TouchMouseInput:rt,SingleTouchInput:Ce,Recognizer:ft,AttrRecognizer:it,Tap:Dt,Pan:Pt,Swipe:xt,Pinch:pt,Rotate:At,Press:jt,on:O,off:M,each:i,merge:g,extend:h,assign:c,inherit:v,bindFn:m,prefixed:R});var on=typeof ze<"u"?ze:typeof self<"u"?self:{};on.Hammer=vt,et.exports?et.exports=vt:ze[n]=vt})(window,document,"Hammer")}(Ft)),Ft.exports}var en=Mn();const Tn=It(en),On=yt({__proto__:null,default:Tn},[en]);var Nt={exports:{}};/*! cornerstone-tools - 6.0.10 - 2023-07-21 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */var Qt;function Pn(){return Qt||(Qt=1,function(et,ze){(function(n,e){et.exports=e()})(window,function(){return function(W){function n(p){delete installedChunks[p]}var e=window.webpackHotUpdate;window.webpackHotUpdate=function(A,j){y(A,j),e&&e(A,j)};function a(p){var A=document.createElement("script");A.charset="utf-8",A.src=B.p+""+p+"."+l+".hot-update.js",document.head.appendChild(A)}function f(p){return p=p||1e4,new Promise(function(A,j){if(typeof XMLHttpRequest>"u")return j(new Error("No browser support"));try{var x=new XMLHttpRequest,L=B.p+""+l+".hot-update.json";x.open("GET",L,!0),x.timeout=p,x.send(null)}catch(U){return j(U)}x.onreadystatechange=function(){if(x.readyState===4)if(x.status===0)j(new Error("Manifest request to "+L+" timed out."));else if(x.status===404)A();else if(x.status!==200&&x.status!==304)j(new Error("Manifest request to "+L+" failed."));else{try{var U=JSON.parse(x.responseText)}catch(S){j(S);return}A(U)}}})}var d=!0,l="286e7d820af3fc74f409",o=1e4,t={},r,s=[],i=[];function u(p){var A=H[p];if(!A)return B;var j=function(U){return A.hot.active?(H[U]?H[U].parents.indexOf(p)===-1&&H[U].parents.push(p):(s=[p],r=U),A.children.indexOf(U)===-1&&A.children.push(U)):s=[],B(U)},x=function(S){return{configurable:!0,enumerable:!0,get:function(){return B[S]},set:function(w){B[S]=w}}};for(var L in B)Object.prototype.hasOwnProperty.call(B,L)&&L!=="e"&&L!=="t"&&Object.defineProperty(j,L,x(L));return j.e=function(U){return g==="ready"&&v("prepare"),E++,B.e(U).then(S,function(w){throw S(),w});function S(){E--,g==="prepare"&&(T[U]||R(U),E===0&&m===0&&b())}},j.t=function(U,S){return S&1&&(U=j(U)),B.t(U,S&-2)},j}function c(p){var A={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:r!==p,active:!0,accept:function(j,x){if(j===void 0)A._selfAccepted=!0;else if(typeof j=="function")A._selfAccepted=j;else if(typeof j=="object")for(var L=0;L<j.length;L++)A._acceptedDependencies[j[L]]=x||function(){};else A._acceptedDependencies[j]=x||function(){}},decline:function(j){if(j===void 0)A._selfDeclined=!0;else if(typeof j=="object")for(var x=0;x<j.length;x++)A._declinedDependencies[j[x]]=!0;else A._declinedDependencies[j]=!0},dispose:function(j){A._disposeHandlers.push(j)},addDisposeHandler:function(j){A._disposeHandlers.push(j)},removeDisposeHandler:function(j){var x=A._disposeHandlers.indexOf(j);x>=0&&A._disposeHandlers.splice(x,1)},check:I,apply:z,status:function(j){if(!j)return g;h.push(j)},addStatusHandler:function(j){h.push(j)},removeStatusHandler:function(j){var x=h.indexOf(j);x>=0&&h.splice(x,1)},data:t[p]};return r=void 0,A}var h=[],g="idle";function v(p){g=p;for(var A=0;A<h.length;A++)h[A].call(null,p)}var m=0,E=0,T={},O={},M={},P,C,_;function D(p){var A=+p+""===p;return A?+p:p}function I(p){if(g!=="idle")throw new Error("check() is only allowed in idle status");return d=p,v("check"),f(o).then(function(A){if(!A)return v("idle"),null;O={},T={},M=A.c,_=A.h,v("prepare");var j=new Promise(function(L,U){P={resolve:L,reject:U}});C={};var x="cornerstoneTools";return R(x),g==="prepare"&&E===0&&m===0&&b(),j})}function y(p,A){if(!(!M[p]||!O[p])){O[p]=!1;for(var j in A)Object.prototype.hasOwnProperty.call(A,j)&&(C[j]=A[j]);--m===0&&E===0&&b()}}function R(p){M[p]?(O[p]=!0,m++,a(p)):T[p]=!0}function b(){v("ready");var p=P;if(P=null,!!p)if(d)Promise.resolve().then(function(){return z(d)}).then(function(x){p.resolve(x)},function(x){p.reject(x)});else{var A=[];for(var j in C)Object.prototype.hasOwnProperty.call(C,j)&&A.push(D(j));p.resolve(A)}}function z(p){if(g!=="ready")throw new Error("apply() is only allowed in ready status");p=p||{};var A,j,x,L,U;function S(ie){for(var he=[ie],pe={},ye=he.map(function(Ie){return{chain:[Ie],id:Ie}});ye.length>0;){var Se=ye.pop(),Re=Se.id,Be=Se.chain;if(L=H[Re],!(!L||L.hot._selfAccepted)){if(L.hot._selfDeclined)return{type:"self-declined",chain:Be,moduleId:Re};if(L.hot._main)return{type:"unaccepted",chain:Be,moduleId:Re};for(var Le=0;Le<L.parents.length;Le++){var J=L.parents[Le],Pe=H[J];if(Pe){if(Pe.hot._declinedDependencies[Re])return{type:"declined",chain:Be.concat([J]),moduleId:Re,parentId:J};if(he.indexOf(J)===-1){if(Pe.hot._acceptedDependencies[Re]){pe[J]||(pe[J]=[]),w(pe[J],[Re]);continue}delete pe[J],he.push(J),ye.push({chain:Be.concat([J]),id:J})}}}}}return{type:"accepted",moduleId:ie,outdatedModules:he,outdatedDependencies:pe}}function w(ie,he){for(var pe=0;pe<he.length;pe++){var ye=he[pe];ie.indexOf(ye)===-1&&ie.push(ye)}}var G={},$=[],Q={},re=function(){};for(var le in C)if(Object.prototype.hasOwnProperty.call(C,le)){U=D(le);var de;C[le]?de=S(U):de={type:"disposed",moduleId:le};var me=!1,Y=!1,V=!1,te="";switch(de.chain&&(te=`
Update propagation: `+de.chain.join(" -> ")),de.type){case"self-declined":p.onDeclined&&p.onDeclined(de),p.ignoreDeclined||(me=new Error("Aborted because of self decline: "+de.moduleId+te));break;case"declined":p.onDeclined&&p.onDeclined(de),p.ignoreDeclined||(me=new Error("Aborted because of declined dependency: "+de.moduleId+" in "+de.parentId+te));break;case"unaccepted":p.onUnaccepted&&p.onUnaccepted(de),p.ignoreUnaccepted||(me=new Error("Aborted because "+U+" is not accepted"+te));break;case"accepted":p.onAccepted&&p.onAccepted(de),Y=!0;break;case"disposed":p.onDisposed&&p.onDisposed(de),V=!0;break;default:throw new Error("Unexception type "+de.type)}if(me)return v("abort"),Promise.reject(me);if(Y){Q[U]=C[U],w($,de.outdatedModules);for(U in de.outdatedDependencies)Object.prototype.hasOwnProperty.call(de.outdatedDependencies,U)&&(G[U]||(G[U]=[]),w(G[U],de.outdatedDependencies[U]))}V&&(w($,[de.moduleId]),Q[U]=re)}var ne=[];for(j=0;j<$.length;j++)U=$[j],H[U]&&H[U].hot._selfAccepted&&Q[U]!==re&&ne.push({module:U,errorHandler:H[U].hot._selfAccepted});v("dispose"),Object.keys(M).forEach(function(ie){M[ie]===!1&&n(ie)});for(var ue,ge=$.slice();ge.length>0;)if(U=ge.pop(),L=H[U],!!L){var ve={},Ee=L.hot._disposeHandlers;for(x=0;x<Ee.length;x++)A=Ee[x],A(ve);for(t[U]=ve,L.hot.active=!1,delete H[U],delete G[U],x=0;x<L.children.length;x++){var De=H[L.children[x]];De&&(ue=De.parents.indexOf(U),ue>=0&&De.parents.splice(ue,1))}}var X,N;for(U in G)if(Object.prototype.hasOwnProperty.call(G,U)&&(L=H[U],L))for(N=G[U],x=0;x<N.length;x++)X=N[x],ue=L.children.indexOf(X),ue>=0&&L.children.splice(ue,1);v("apply"),l=_;for(U in Q)Object.prototype.hasOwnProperty.call(Q,U)&&(W[U]=Q[U]);var F=null;for(U in G)if(Object.prototype.hasOwnProperty.call(G,U)&&(L=H[U],L)){N=G[U];var q=[];for(j=0;j<N.length;j++)if(X=N[j],A=L.hot._acceptedDependencies[X],A){if(q.indexOf(A)!==-1)continue;q.push(A)}for(j=0;j<q.length;j++){A=q[j];try{A(N)}catch(ie){p.onErrored&&p.onErrored({type:"accept-errored",moduleId:U,dependencyId:N[j],error:ie}),p.ignoreErrored||F||(F=ie)}}}for(j=0;j<ne.length;j++){var oe=ne[j];U=oe.module,s=[U];try{B(U)}catch(ie){if(typeof oe.errorHandler=="function")try{oe.errorHandler(ie)}catch(he){p.onErrored&&p.onErrored({type:"self-accept-error-handler-errored",moduleId:U,error:he,originalError:ie}),p.ignoreErrored||F||(F=he),F||(F=ie)}else p.onErrored&&p.onErrored({type:"self-accept-errored",moduleId:U,error:ie}),p.ignoreErrored||F||(F=ie)}}return F?(v("fail"),Promise.reject(F)):(v("idle"),new Promise(function(ie){ie($)}))}var H={};function B(p){if(H[p])return H[p].exports;var A=H[p]={i:p,l:!1,exports:{},hot:c(p),parents:(i=s,s=[],i),children:[]};return W[p].call(A.exports,A,A.exports,u(p)),A.l=!0,A.exports}return B.m=W,B.c=H,B.d=function(p,A,j){B.o(p,A)||Object.defineProperty(p,A,{enumerable:!0,get:j})},B.r=function(p){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})},B.t=function(p,A){if(A&1&&(p=B(p)),A&8||A&4&&typeof p=="object"&&p&&p.__esModule)return p;var j=Object.create(null);if(B.r(j),Object.defineProperty(j,"default",{enumerable:!0,value:p}),A&2&&typeof p!="string")for(var x in p)B.d(j,x,(function(L){return p[L]}).bind(null,x));return j},B.n=function(p){var A=p&&p.__esModule?function(){return p.default}:function(){return p};return B.d(A,"a",A),A},B.o=function(p,A){return Object.prototype.hasOwnProperty.call(p,A)},B.p="",B.h=function(){return l},u("./index.js")(B.s="./index.js")}({"../node_modules/@babel/runtime/helpers/arrayWithHoles.js":function(W,n){function e(a){if(Array.isArray(a))return a}W.exports=e},"../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js":function(W,n){function e(a){if(Array.isArray(a)){for(var f=0,d=new Array(a.length);f<a.length;f++)d[f]=a[f];return d}}W.exports=e},"../node_modules/@babel/runtime/helpers/assertThisInitialized.js":function(W,n){function e(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}W.exports=e},"../node_modules/@babel/runtime/helpers/asyncToGenerator.js":function(W,n){function e(f,d,l,o,t,r,s){try{var i=f[r](s),u=i.value}catch(c){l(c);return}i.done?d(u):Promise.resolve(u).then(o,t)}function a(f){return function(){var d=this,l=arguments;return new Promise(function(o,t){var r=f.apply(d,l);function s(u){e(r,o,t,s,i,"next",u)}function i(u){e(r,o,t,s,i,"throw",u)}s(void 0)})}}W.exports=a},"../node_modules/@babel/runtime/helpers/classCallCheck.js":function(W,n){function e(a,f){if(!(a instanceof f))throw new TypeError("Cannot call a class as a function")}W.exports=e},"../node_modules/@babel/runtime/helpers/createClass.js":function(W,n){function e(f,d){for(var l=0;l<d.length;l++){var o=d[l];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(f,o.key,o)}}function a(f,d,l){return d&&e(f.prototype,d),l&&e(f,l),f}W.exports=a},"../node_modules/@babel/runtime/helpers/defineProperty.js":function(W,n){function e(a,f,d){return f in a?Object.defineProperty(a,f,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[f]=d,a}W.exports=e},"../node_modules/@babel/runtime/helpers/getPrototypeOf.js":function(W,n){function e(a){return W.exports=e=Object.setPrototypeOf?Object.getPrototypeOf:function(d){return d.__proto__||Object.getPrototypeOf(d)},e(a)}W.exports=e},"../node_modules/@babel/runtime/helpers/inherits.js":function(W,n,e){var a=e("../node_modules/@babel/runtime/helpers/setPrototypeOf.js");function f(d,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");d.prototype=Object.create(l&&l.prototype,{constructor:{value:d,writable:!0,configurable:!0}}),l&&a(d,l)}W.exports=f},"../node_modules/@babel/runtime/helpers/iterableToArray.js":function(W,n){function e(a){if(Symbol.iterator in Object(a)||Object.prototype.toString.call(a)==="[object Arguments]")return Array.from(a)}W.exports=e},"../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js":function(W,n){function e(a,f){var d=[],l=!0,o=!1,t=void 0;try{for(var r=a[Symbol.iterator](),s;!(l=(s=r.next()).done)&&(d.push(s.value),!(f&&d.length===f));l=!0);}catch(i){o=!0,t=i}finally{try{!l&&r.return!=null&&r.return()}finally{if(o)throw t}}return d}W.exports=e},"../node_modules/@babel/runtime/helpers/nonIterableRest.js":function(W,n){function e(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}W.exports=e},"../node_modules/@babel/runtime/helpers/nonIterableSpread.js":function(W,n){function e(){throw new TypeError("Invalid attempt to spread non-iterable instance")}W.exports=e},"../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js":function(W,n,e){var a=e("../node_modules/@babel/runtime/helpers/typeof.js"),f=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js");function d(l,o){return o&&(a(o)==="object"||typeof o=="function")?o:f(l)}W.exports=d},"../node_modules/@babel/runtime/helpers/setPrototypeOf.js":function(W,n){function e(a,f){return W.exports=e=Object.setPrototypeOf||function(l,o){return l.__proto__=o,l},e(a,f)}W.exports=e},"../node_modules/@babel/runtime/helpers/slicedToArray.js":function(W,n,e){var a=e("../node_modules/@babel/runtime/helpers/arrayWithHoles.js"),f=e("../node_modules/@babel/runtime/helpers/iterableToArrayLimit.js"),d=e("../node_modules/@babel/runtime/helpers/nonIterableRest.js");function l(o,t){return a(o)||f(o,t)||d()}W.exports=l},"../node_modules/@babel/runtime/helpers/toConsumableArray.js":function(W,n,e){var a=e("../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js"),f=e("../node_modules/@babel/runtime/helpers/iterableToArray.js"),d=e("../node_modules/@babel/runtime/helpers/nonIterableSpread.js");function l(o){return a(o)||f(o)||d()}W.exports=l},"../node_modules/@babel/runtime/helpers/typeof.js":function(W,n){function e(f){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(l){return typeof l}:e=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},e(f)}function a(f){return typeof Symbol=="function"&&e(Symbol.iterator)==="symbol"?W.exports=a=function(l){return e(l)}:W.exports=a=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":e(l)},a(f)}W.exports=a},"../node_modules/@babel/runtime/regenerator/index.js":function(W,n,e){W.exports=e("../node_modules/regenerator-runtime/runtime-module.js")},"../node_modules/ms/index.js":function(W,n){var e=1e3,a=e*60,f=a*60,d=f*24,l=d*7,o=d*365.25;W.exports=function(u,c){c=c||{};var h=typeof u;if(h==="string"&&u.length>0)return t(u);if(h==="number"&&isFinite(u))return c.long?s(u):r(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function t(u){if(u=String(u),!(u.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(c){var h=parseFloat(c[1]),g=(c[2]||"ms").toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return h*o;case"weeks":case"week":case"w":return h*l;case"days":case"day":case"d":return h*d;case"hours":case"hour":case"hrs":case"hr":case"h":return h*f;case"minutes":case"minute":case"mins":case"min":case"m":return h*a;case"seconds":case"second":case"secs":case"sec":case"s":return h*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function r(u){var c=Math.abs(u);return c>=d?Math.round(u/d)+"d":c>=f?Math.round(u/f)+"h":c>=a?Math.round(u/a)+"m":c>=e?Math.round(u/e)+"s":u+"ms"}function s(u){var c=Math.abs(u);return c>=d?i(u,c,d,"day"):c>=f?i(u,c,f,"hour"):c>=a?i(u,c,a,"minute"):c>=e?i(u,c,e,"second"):u+" ms"}function i(u,c,h,g){var v=c>=h*1.5;return Math.round(u/h)+" "+g+(v?"s":"")}},"../node_modules/process/browser.js":function(W,n){var e=W.exports={},a,f;function d(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?a=setTimeout:a=d}catch{a=d}try{typeof clearTimeout=="function"?f=clearTimeout:f=l}catch{f=l}})();function o(m){if(a===setTimeout)return setTimeout(m,0);if((a===d||!a)&&setTimeout)return a=setTimeout,setTimeout(m,0);try{return a(m,0)}catch{try{return a.call(null,m,0)}catch{return a.call(this,m,0)}}}function t(m){if(f===clearTimeout)return clearTimeout(m);if((f===l||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(m);try{return f(m)}catch{try{return f.call(null,m)}catch{return f.call(this,m)}}}var r=[],s=!1,i,u=-1;function c(){!s||!i||(s=!1,i.length?r=i.concat(r):u=-1,r.length&&h())}function h(){if(!s){var m=o(c);s=!0;for(var E=r.length;E;){for(i=r,r=[];++u<E;)i&&i[u].run();u=-1,E=r.length}i=null,s=!1,t(m)}}e.nextTick=function(m){var E=new Array(arguments.length-1);if(arguments.length>1)for(var T=1;T<arguments.length;T++)E[T-1]=arguments[T];r.push(new g(m,E)),r.length===1&&!s&&o(h)};function g(m,E){this.fun=m,this.array=E}g.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={};function v(){}e.on=v,e.addListener=v,e.once=v,e.off=v,e.removeListener=v,e.removeAllListeners=v,e.emit=v,e.prependListener=v,e.prependOnceListener=v,e.listeners=function(m){return[]},e.binding=function(m){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(m){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},"../node_modules/regenerator-runtime/runtime-module.js":function(W,n,e){var a=function(){return this||typeof self=="object"&&self}()||Function("return this")(),f=a.regeneratorRuntime&&Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime")>=0,d=f&&a.regeneratorRuntime;if(a.regeneratorRuntime=void 0,W.exports=e("../node_modules/regenerator-runtime/runtime.js"),f)a.regeneratorRuntime=d;else try{delete a.regeneratorRuntime}catch{a.regeneratorRuntime=void 0}},"../node_modules/regenerator-runtime/runtime.js":function(W,n){(function(e){var a=Object.prototype,f=a.hasOwnProperty,d,l=typeof Symbol=="function"?Symbol:{},o=l.iterator||"@@iterator",t=l.asyncIterator||"@@asyncIterator",r=l.toStringTag||"@@toStringTag",s=typeof W=="object",i=e.regeneratorRuntime;if(i){s&&(W.exports=i);return}i=e.regeneratorRuntime=s?W.exports:{};function u(j,x,L,U){var S=x&&x.prototype instanceof T?x:T,w=Object.create(S.prototype),G=new B(U||[]);return w._invoke=R(j,L,G),w}i.wrap=u;function c(j,x,L){try{return{type:"normal",arg:j.call(x,L)}}catch(U){return{type:"throw",arg:U}}}var h="suspendedStart",g="suspendedYield",v="executing",m="completed",E={};function T(){}function O(){}function M(){}var P={};P[o]=function(){return this};var C=Object.getPrototypeOf,_=C&&C(C(p([])));_&&_!==a&&f.call(_,o)&&(P=_);var D=M.prototype=T.prototype=Object.create(P);O.prototype=D.constructor=M,M.constructor=O,M[r]=O.displayName="GeneratorFunction";function I(j){["next","throw","return"].forEach(function(x){j[x]=function(L){return this._invoke(x,L)}})}i.isGeneratorFunction=function(j){var x=typeof j=="function"&&j.constructor;return x?x===O||(x.displayName||x.name)==="GeneratorFunction":!1},i.mark=function(j){return Object.setPrototypeOf?Object.setPrototypeOf(j,M):(j.__proto__=M,r in j||(j[r]="GeneratorFunction")),j.prototype=Object.create(D),j},i.awrap=function(j){return{__await:j}};function y(j){function x(S,w,G,$){var Q=c(j[S],j,w);if(Q.type==="throw")$(Q.arg);else{var re=Q.arg,le=re.value;return le&&typeof le=="object"&&f.call(le,"__await")?Promise.resolve(le.__await).then(function(de){x("next",de,G,$)},function(de){x("throw",de,G,$)}):Promise.resolve(le).then(function(de){re.value=de,G(re)},function(de){return x("throw",de,G,$)})}}var L;function U(S,w){function G(){return new Promise(function($,Q){x(S,w,$,Q)})}return L=L?L.then(G,G):G()}this._invoke=U}I(y.prototype),y.prototype[t]=function(){return this},i.AsyncIterator=y,i.async=function(j,x,L,U){var S=new y(u(j,x,L,U));return i.isGeneratorFunction(x)?S:S.next().then(function(w){return w.done?w.value:S.next()})};function R(j,x,L){var U=h;return function(w,G){if(U===v)throw new Error("Generator is already running");if(U===m){if(w==="throw")throw G;return A()}for(L.method=w,L.arg=G;;){var $=L.delegate;if($){var Q=b($,L);if(Q){if(Q===E)continue;return Q}}if(L.method==="next")L.sent=L._sent=L.arg;else if(L.method==="throw"){if(U===h)throw U=m,L.arg;L.dispatchException(L.arg)}else L.method==="return"&&L.abrupt("return",L.arg);U=v;var re=c(j,x,L);if(re.type==="normal"){if(U=L.done?m:g,re.arg===E)continue;return{value:re.arg,done:L.done}}else re.type==="throw"&&(U=m,L.method="throw",L.arg=re.arg)}}}function b(j,x){var L=j.iterator[x.method];if(L===d){if(x.delegate=null,x.method==="throw"){if(j.iterator.return&&(x.method="return",x.arg=d,b(j,x),x.method==="throw"))return E;x.method="throw",x.arg=new TypeError("The iterator does not provide a 'throw' method")}return E}var U=c(L,j.iterator,x.arg);if(U.type==="throw")return x.method="throw",x.arg=U.arg,x.delegate=null,E;var S=U.arg;if(!S)return x.method="throw",x.arg=new TypeError("iterator result is not an object"),x.delegate=null,E;if(S.done)x[j.resultName]=S.value,x.next=j.nextLoc,x.method!=="return"&&(x.method="next",x.arg=d);else return S;return x.delegate=null,E}I(D),D[r]="Generator",D[o]=function(){return this},D.toString=function(){return"[object Generator]"};function z(j){var x={tryLoc:j[0]};1 in j&&(x.catchLoc=j[1]),2 in j&&(x.finallyLoc=j[2],x.afterLoc=j[3]),this.tryEntries.push(x)}function H(j){var x=j.completion||{};x.type="normal",delete x.arg,j.completion=x}function B(j){this.tryEntries=[{tryLoc:"root"}],j.forEach(z,this),this.reset(!0)}i.keys=function(j){var x=[];for(var L in j)x.push(L);return x.reverse(),function U(){for(;x.length;){var S=x.pop();if(S in j)return U.value=S,U.done=!1,U}return U.done=!0,U}};function p(j){if(j){var x=j[o];if(x)return x.call(j);if(typeof j.next=="function")return j;if(!isNaN(j.length)){var L=-1,U=function S(){for(;++L<j.length;)if(f.call(j,L))return S.value=j[L],S.done=!1,S;return S.value=d,S.done=!0,S};return U.next=U}}return{next:A}}i.values=p;function A(){return{value:d,done:!0}}B.prototype={constructor:B,reset:function(j){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(H),!j)for(var x in this)x.charAt(0)==="t"&&f.call(this,x)&&!isNaN(+x.slice(1))&&(this[x]=d)},stop:function(){this.done=!0;var j=this.tryEntries[0],x=j.completion;if(x.type==="throw")throw x.arg;return this.rval},dispatchException:function(j){if(this.done)throw j;var x=this;function L(Q,re){return w.type="throw",w.arg=j,x.next=Q,re&&(x.method="next",x.arg=d),!!re}for(var U=this.tryEntries.length-1;U>=0;--U){var S=this.tryEntries[U],w=S.completion;if(S.tryLoc==="root")return L("end");if(S.tryLoc<=this.prev){var G=f.call(S,"catchLoc"),$=f.call(S,"finallyLoc");if(G&&$){if(this.prev<S.catchLoc)return L(S.catchLoc,!0);if(this.prev<S.finallyLoc)return L(S.finallyLoc)}else if(G){if(this.prev<S.catchLoc)return L(S.catchLoc,!0)}else if($){if(this.prev<S.finallyLoc)return L(S.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(j,x){for(var L=this.tryEntries.length-1;L>=0;--L){var U=this.tryEntries[L];if(U.tryLoc<=this.prev&&f.call(U,"finallyLoc")&&this.prev<U.finallyLoc){var S=U;break}}S&&(j==="break"||j==="continue")&&S.tryLoc<=x&&x<=S.finallyLoc&&(S=null);var w=S?S.completion:{};return w.type=j,w.arg=x,S?(this.method="next",this.next=S.finallyLoc,E):this.complete(w)},complete:function(j,x){if(j.type==="throw")throw j.arg;return j.type==="break"||j.type==="continue"?this.next=j.arg:j.type==="return"?(this.rval=this.arg=j.arg,this.method="return",this.next="end"):j.type==="normal"&&x&&(this.next=x),E},finish:function(j){for(var x=this.tryEntries.length-1;x>=0;--x){var L=this.tryEntries[x];if(L.finallyLoc===j)return this.complete(L.completion,L.afterLoc),H(L),E}},catch:function(j){for(var x=this.tryEntries.length-1;x>=0;--x){var L=this.tryEntries[x];if(L.tryLoc===j){var U=L.completion;if(U.type==="throw"){var S=U.arg;H(L)}return S}}throw new Error("illegal catch attempt")},delegateYield:function(j,x,L){return this.delegate={iterator:p(j),resultName:x,nextLoc:L},this.method==="next"&&(this.arg=d),E}}})(function(){return this||typeof self=="object"&&self}()||Function("return this")())},"./drawing/draw.js":function(W,n,e){e.r(n),n.default=function(a,f){a.save(),f(a),a.restore()}},"./drawing/drawArrow.js":function(W,n,e){e.r(n);var a=e("./drawing/drawLine.js"),f=e("./drawing/drawJoinedLines.js");n.default=function(d,l,o,t,r,s){var i=10,u=Math.atan2(o.y-l.y,o.x-l.x),c={color:t,lineWidth:r};s&&(c.lineDash=s),Object(a.default)(d,void 0,l,o,c,"canvas"),c={color:t,lineWidth:r,fillStyle:t};var h=[{x:o.x-i*Math.cos(u-Math.PI/7),y:o.y-i*Math.sin(u-Math.PI/7)},{x:o.x-i*Math.cos(u+Math.PI/7),y:o.y-i*Math.sin(u+Math.PI/7)},o];Object(f.default)(d,void 0,o,h,c,"canvas")}},"./drawing/drawCircle.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./drawing/path.js");n.default=function(d,l,o,t,r){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"pixel";s==="pixel"&&(o=a.default.cornerstone.pixelToCanvas(l,o)),Object(f.default)(d,r,function(i){i.arc(o.x,o.y,t,0,2*Math.PI)})}},"./drawing/drawEllipse.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./drawing/path.js"),d=e("./util/pointProjector.js");n.default=function(l,o,t,r,s){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"pixel",u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;i==="pixel"&&(t=a.default.cornerstone.pixelToCanvas(o,t),r=a.default.cornerstone.pixelToCanvas(o,r));var c=a.default.cornerstone.getViewport(o),h=o.clientWidth,g=o.clientHeight,v=c.scale,m=c.translation,E=c.rotation-u,T={x:h/2+m.x*v,y:g/2+m.y*v};Math.abs(E)>.05&&(t=Object(d.rotatePoint)(t,T,-E),r=Object(d.rotatePoint)(r,T,-E));var O=Math.abs(t.x-r.x),M=Math.abs(t.y-r.y),P=Math.min(t.x,r.x),C=Math.min(t.y,r.y),_={x:P+O/2,y:C+M/2};Math.abs(E)>.05&&(_=Object(d.rotatePoint)(_,T,E));var D=E*Math.PI/180;Object(f.default)(l,s,function(I){I.ellipse(_.x,_.y,O/2,M/2,D,0,2*Math.PI),I.closePath()})}},"./drawing/drawHandles.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./stateManagement/toolStyle.js"),d=e("./stateManagement/toolColors.js"),l=e("./drawing/path.js"),o=e("./store/index.js");n.default=function(t,r,s){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=r.element,c=d.default.getToolColor();t.strokeStyle=i.color||c;for(var h=Object.keys(s),g=function(T){var O=h[T],M=s[O];if(M.drawnIndependently===!0||i.drawHandlesIfActive===!0&&!M.active||i.hideHandlesIfMoving&&M.moving)return"continue";var P=M.active?f.default.getActiveWidth():f.default.getToolWidth(),C=i.fill,_={lineWidth:P,fillStyle:C};i.lineDash&&(_.lineDash=i.lineDash),Object(l.default)(t,_,function(D){var I=a.default.cornerstone.pixelToCanvas(u,M),y=M.radius||i.handleRadius||o.state.handleRadius;D.arc(I.x,I.y,y,0,2*Math.PI)})},v=0;v<h.length;v++)var m=g(v)}},"./drawing/drawJoinedLines.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./drawing/path.js");n.default=function(d,l,o,t,r){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"pixel";Object(f.default)(d,r,function(i){s==="pixel"&&(o=a.default.cornerstone.pixelToCanvas(l,o),t=t.map(function(u){return a.default.cornerstone.pixelToCanvas(l,u)})),i.moveTo(o.x,o.y),t.forEach(function(u){var c=u.x,h=u.y;i.lineTo(c,h)})})}},"./drawing/drawLine.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return d});var a=e("./externalModules.js"),f=e("./drawing/path.js");function d(l,o,t,r,s){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"pixel";Object(f.default)(l,s,function(u){i==="pixel"&&(t=a.default.cornerstone.pixelToCanvas(o,t),r=a.default.cornerstone.pixelToCanvas(o,r)),u.moveTo(t.x,t.y),u.lineTo(r.x,r.y)})}},"./drawing/drawLines.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./drawing/path.js");n.default=function(d,l,o,t){var r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"pixel";Object(f.default)(d,t,function(s){o.forEach(function(i){var u=i.start,c=i.end;if(r==="pixel"){var h=a.default.cornerstone;u=h.pixelToCanvas(l,u),c=h.pixelToCanvas(l,c)}s.moveTo(u.x,u.y),s.lineTo(c.x,c.y)})})}},"./drawing/drawLink.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./drawing/drawLine.js");n.default=function(d,l,o,t,r,s){var i=d.length>0?a.default.cornerstoneMath.point.findClosestPoint(d,l):l,u=[{x:o.left+o.width/2,y:o.top},{x:o.left,y:o.top+o.height/2},{x:o.left+o.width/2,y:o.top+o.height},{x:o.left+o.width,y:o.top+o.height/2}],c=a.default.cornerstoneMath.point.findClosestPoint(u,i),h={color:r,lineWidth:s,lineDash:[2,3]};Object(f.default)(t,void 0,i,c,h,"canvas")}},"./drawing/drawLinkedTextBox.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./drawing/drawTextBox.js"),d=e("./drawing/drawLink.js"),l=e("./store/index.js"),o=e("./util/clip.js");n.default=function(t,r,s,i,u,c,h,g,v,m){var E=a.default.cornerstone.pixelToCanvas,T=E(r,s);v&&(T.x+=v);var O={centering:{x:!1,y:m}};if(l.state.preventTextBoxOutsideDisplayedArea&&(O.displacer=function(P){return Object(o.clipBoxToDisplayedArea)(r,P)}),s.boundingBox=Object(f.default)(t,i,T.x,T.y,h,O),s.hasMoved){var M=c(u).map(function(P){return E(r,P)});Object(d.default)(M,T,s.boundingBox,t,h,g)}}},"./drawing/drawRect.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./drawing/path.js"),d=e("./util/pointProjector.js");n.default=function(l,o,t,r,s){var i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"pixel",u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(i==="pixel"){var c=a.default.cornerstone;t=c.pixelToCanvas(o,t),r=c.pixelToCanvas(o,r)}var h=a.default.cornerstone.getViewport(o),g=o.clientWidth,v=o.clientHeight,m=h.scale,E=h.translation,T=h.rotation-u,O={x:g/2+E.x*m,y:v/2+E.y*m};Math.abs(T)>.05&&(t=Object(d.rotatePoint)(t,O,-T),r=Object(d.rotatePoint)(r,O,-T));var M=Math.abs(t.x-r.x),P=Math.abs(t.y-r.y);t={x:Math.min(t.x,r.x),y:Math.min(t.y,r.y)},r={x:t.x+M,y:t.y+P};var C={x:t.x+M,y:t.y},_={x:t.x,y:t.y+P};Math.abs(T)>.05&&(t=Object(d.rotatePoint)(t,O,T),r=Object(d.rotatePoint)(r,O,T),C=Object(d.rotatePoint)(C,O,T),_=Object(d.rotatePoint)(_,O,T)),Object(f.default)(l,s,function(D){D.moveTo(t.x,t.y),D.lineTo(C.x,C.y),D.lineTo(r.x,r.y),D.lineTo(_.x,_.y),D.lineTo(t.x,t.y)})}},"./drawing/drawTextBox.js":function(W,n,e){e.r(n),e.d(n,"textBoxWidth",function(){return o});var a=e("./stateManagement/textStyle.js"),f=e("./drawing/draw.js"),d=e("./drawing/fillTextLines.js"),l=e("./drawing/fillBox.js");function o(t,r,s){var i=a.default.getFont(),u=t.font;i&&i!==u&&(t.font=i);var c=t.measureText(r).width;return i&&i!==u&&(t.font=u),c+2*s}n.default=function(t,r,s,i,u){var c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};Object.prototype.toString.call(r)!=="[object Array]"&&(r=[r]);var h=5,g=a.default.getFontSize(),v=a.default.getBackgroundColor(),m=0;r.forEach(function(T){var O=o(t,T,h);m=Math.max(m,O)});var E={width:m,height:h+r.length*(g+h)};return Object(f.default)(t,function(T){T.strokeStyle=u,c.centering&&(c.centering.x===!0&&(s-=E.width/2),c.centering.y===!0&&(i-=E.height/2)),E.left=s,E.top=i,typeof c.displacer=="function"&&c.displacer(E),Object(l.default)(T,E,v),Object(d.default)(T,E,r,u,h)}),E}},"./drawing/fillBox.js":function(W,n,e){e.r(n),n.default=function(a,f,d){a.fillStyle=d,a.fillRect(f.left,f.top,f.width,f.height)}},"./drawing/fillOutsideRect.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./drawing/path.js");n.default=function(d,l,o,t,r){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"pixel";if(s==="pixel"){var i=a.default.cornerstone;o=i.pixelToCanvas(l,o),t=i.pixelToCanvas(l,t)}var u=Math.min(o.x,t.x),c=Math.min(o.y,t.y),h=Math.abs(o.x-t.x),g=Math.abs(o.y-t.y);Object(f.default)(d,r,function(v){v.rect(0,0,v.canvas.clientWidth,v.canvas.clientHeight),v.rect(u+h,c,-h,g)})}},"./drawing/fillTextLines.js":function(W,n,e){e.r(n);var a=e("./stateManagement/textStyle.js");n.default=function(f,d,l,o,t){var r=a.default.getFontSize();f.font=a.default.getFont(),f.textBaseline="top",f.fillStyle=o,l.forEach(function(s,i){f.fillText(s,d.left+t,d.top+t+i*(r+t))})}},"./drawing/getNewContext.js":function(W,n,e){e.r(n),n.default=function(a){var f=a.getContext("2d");return f.setTransform(1,0,0,1,0,0),f}},"./drawing/index.js":function(W,n,e){e.r(n);var a=e("./drawing/draw.js");e.d(n,"draw",function(){return a.default});var f=e("./drawing/drawArrow.js");e.d(n,"drawArrow",function(){return f.default});var d=e("./drawing/drawCircle.js");e.d(n,"drawCircle",function(){return d.default});var l=e("./drawing/drawEllipse.js");e.d(n,"drawEllipse",function(){return l.default});var o=e("./drawing/drawHandles.js");e.d(n,"drawHandles",function(){return o.default});var t=e("./drawing/drawJoinedLines.js");e.d(n,"drawJoinedLines",function(){return t.default});var r=e("./drawing/drawLine.js");e.d(n,"drawLine",function(){return r.default});var s=e("./drawing/drawLines.js");e.d(n,"drawLines",function(){return s.default});var i=e("./drawing/drawLink.js");e.d(n,"drawLink",function(){return i.default});var u=e("./drawing/drawLinkedTextBox.js");e.d(n,"drawLinkedTextBox",function(){return u.default});var c=e("./drawing/drawRect.js");e.d(n,"drawRect",function(){return c.default});var h=e("./drawing/drawTextBox.js");e.d(n,"drawTextBox",function(){return h.default});var g=e("./drawing/fillBox.js");e.d(n,"fillBox",function(){return g.default});var v=e("./drawing/fillOutsideRect.js");e.d(n,"fillOutsideRect",function(){return v.default});var m=e("./drawing/fillTextLines.js");e.d(n,"fillTextLines",function(){return m.default});var E=e("./drawing/getNewContext.js");e.d(n,"getNewContext",function(){return E.default});var T=e("./drawing/path.js");e.d(n,"path",function(){return T.default});var O=e("./drawing/setShadow.js");e.d(n,"setShadow",function(){return O.default});var M=e("./drawing/transformCanvasContext.js");e.d(n,"transformCanvasContext",function(){return M.default});var P=e("./drawing/resetCanvasContextTransform.js");e.d(n,"resetCanvasContextTransform",function(){return P.default})},"./drawing/path.js":function(W,n,e){e.r(n);var a=e("./stateManagement/toolStyle.js");n.default=function(f){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0,o=d.color,t=d.lineWidth,r=d.fillStyle,s=d.lineDash,i=d.shouldDrawLines,u=i===void 0?!0:i;f.beginPath(),f.strokeStyle=o||f.strokeStyle,f.lineWidth=t||t===void 0&&a.default.getToolWidth()||f.lineWidth,s&&f.setLineDash(s),l(f),r&&(f.fillStyle=r,f.fill()),u&&f.stroke(),s&&f.setLineDash([])}},"./drawing/resetCanvasContextTransform.js":function(W,n,e){e.r(n),n.default=function(a){a.setTransform(1,0,0,1,0,0)}},"./drawing/setShadow.js":function(W,n,e){e.r(n);var a=e("./util/getDefault.js");n.default=function(f){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};d.shadow&&(f.shadowColor=Object(a.default)(d.shadowColor,"#000000"),f.shadowBlur=Object(a.default)(d.shadowBlur,0),f.shadowOffsetX=Object(a.default)(d.shadowOffsetX,1),f.shadowOffsetY=Object(a.default)(d.shadowOffsetY,1))}},"./drawing/transformCanvasContext.js":function(W,n,e){e.r(n),n.default=function(a,f,d){if(d.hflip||d.vflip||d.rotation){var l={x:f.width/2+d.translation.x*d.scale,y:f.height/2+d.translation.y*d.scale};a.translate(l.x,l.y),d.rotation&&a.rotate(d.rotation*Math.PI/180),d.vflip&&a.scale(1,-1),d.hflip&&a.scale(-1,1),a.translate(-l.x,-l.y)}}},"./eventDispatchers/imageRenderedEventDispatcher.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./stateManagement/toolState.js"),d=e("./eventListeners/onImageRenderedBrushEventHandler.js"),l=e("./externalModules.js"),o=Object(a.getModule)("segmentation"),t=function(u){var c=u.detail,h=c.element,g=a.state.tools.filter(function(T){return T.element===h&&(T.mode==="active"||T.mode==="passive"||T.mode==="enabled")}),v=Object(f.getToolState)(h,"stack"),m=o.configuration;v&&(m.renderFill||m.renderOutline)&&Object(d.default)(u);var E=c.canvasContext.canvas.getContext("2d");g.forEach(function(T){T.renderToolData&&(E.save(),T.renderToolData(u),E.restore())})},r=function(u){u.addEventListener(l.default.cornerstone.EVENTS.IMAGE_RENDERED,t)},s=function(u){u.removeEventListener(l.default.cornerstone.EVENTS.IMAGE_RENDERED,t)};n.default={enable:r,disable:s}},"./eventDispatchers/index.js":function(W,n,e){e.r(n);var a=e("./eventDispatchers/imageRenderedEventDispatcher.js");e.d(n,"imageRenderedEventDispatcher",function(){return a.default});var f=e("./eventDispatchers/mouseToolEventDispatcher.js");e.d(n,"mouseToolEventDispatcher",function(){return f.default});var d=e("./eventDispatchers/newImageEventDispatcher.js");e.d(n,"newImageEventDispatcher",function(){return d.default});var l=e("./eventDispatchers/touchToolEventDispatcher.js");e.d(n,"touchToolEventDispatcher",function(){return l.default})},"./eventDispatchers/mouseEventHandlers/addNewMeasurement.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./externalModules.js"),d=e("./stateManagement/toolState.js"),l=e("./manipulators/index.js"),o=e("./util/logger.js"),t=e("./util/triggerEvent.js"),r=Object(o.getLogger)("eventDispatchers:mouseEventHandlers");n.default=function(s,i){r.log("addNewMeasurement"),s.preventDefault(),s.stopPropagation();var u=s.detail,c=u.element,h=i.createNewMeasurement(u);if(h){Object(d.addToolState)(c,i.name,h),f.default.cornerstone.updateImage(c);var g=Object.keys(h.handles).length===1?l.moveHandle:l.moveNewHandle,v=new Date().getTime();g(u,i.name,h,h.handles.end,i.options,"mouse",function(m){if(!h.cancelled){var E=i.configuration&&Object(i.configuration).hasOwnProperty("measurementCreationThreshold"),T=E?new Date().getTime()-v<i.configuration.measurementCreationThreshold:!1;if(m&&T===!1){var O=a.default.MEASUREMENT_COMPLETED,M={toolName:i.name,toolType:i.name,element:c,measurementData:h};Object(t.default)(c,O,M)}else Object(d.removeToolState)(c,i.name,h)}})}}},"./eventDispatchers/mouseEventHandlers/index.js":function(W,n,e){e.r(n),e.d(n,"mouseClick",function(){return t}),e.d(n,"mouseDoubleClick",function(){return r}),e.d(n,"mouseUp",function(){return s}),e.d(n,"mouseWheel",function(){return i});var a=e("./eventDispatchers/shared/customCallbackHandler.js"),f=e("./eventDispatchers/mouseEventHandlers/mouseDown.js");e.d(n,"mouseDown",function(){return f.default});var d=e("./eventDispatchers/mouseEventHandlers/mouseDownActivate.js");e.d(n,"mouseDownActivate",function(){return d.default});var l=e("./eventDispatchers/mouseEventHandlers/mouseDrag.js");e.d(n,"mouseDrag",function(){return l.default});var o=e("./eventDispatchers/mouseEventHandlers/mouseMove.js");e.d(n,"mouseMove",function(){return o.default});var t=a.default.bind(null,"Mouse","mouseClickCallback"),r=a.default.bind(null,"Mouse","doubleClickCallback"),s=a.default.bind(null,"Mouse","mouseUpCallback"),i=a.default.bind(null,"MouseWheel","mouseWheelCallback")},"./eventDispatchers/mouseEventHandlers/mouseDown.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./stateManagement/toolState.js"),d=e("./store/getToolsWithMoveableHandles.js"),l=e("./util/findAndMoveHelpers.js"),o=e("./store/getInteractiveToolsForElement.js"),t=e("./store/getToolsWithDataForElement.js"),r=e("./store/filterToolsUsableWithMultiPartTools.js");n.default=function(s){if(!a.state.isToolLocked){var i=s.detail,u=s.detail.element,c=s.detail.currentPoints.canvas,h=Object(o.default)(u,a.getters.mouseTools()),g=h.filter(function(H){return H.mode==="active"&&Array.isArray(H.options.mouseButtonMask)&&H.options.mouseButtonMask.includes(i.buttons)&&H.options.isMouseActive});if(a.state.isMultiPartToolActive&&(g=Object(r.default)(g)),g.length>0){var v=g.find(function(H){return typeof H.preMouseDownCallback=="function"});if(v){var m=v.preMouseDownCallback(s);if(m)return}}if(!a.state.isMultiPartToolActive){var E=Object(t.default)(u,h),T=Object(d.default)(u,E,c,"mouse");if(T.length>0){var O=T[0],M=Object(f.getToolState)(u,O.name),P=Object(l.findHandleDataNearImagePoint)(u,M,O.name,c),C=P.handle,_=P.data;O.handleSelectedCallback(s,_,C,"mouse");return}var D=h.filter(function(H){var B=Object(f.getToolState)(u,H.name),p=B&&B.data&&H.pointNearTool&&B.data.some(function(A){return H.pointNearTool(u,A,c,"mouse")});return p});if(D.length>0){var I=D[0],y=Object(f.getToolState)(u,I.name),R=y.data.find(function(H){return I.pointNearTool(u,H,c)});I.toolSelectedCallback(s,R,"mouse");return}if(g.length>0){var b=g.find(function(H){return typeof H.postMouseDownCallback=="function"});if(b){var z=b.postMouseDownCallback(s);if(z)return}}}}}},"./eventDispatchers/mouseEventHandlers/mouseDownActivate.js":function(W,n,e){e.r(n);var a=e("./eventDispatchers/mouseEventHandlers/addNewMeasurement.js"),f=e("./store/index.js"),d=e("./tools/base/BaseAnnotationTool.js"),l=e("./util/getActiveTool.js");n.default=function(o){if(!f.state.isToolLocked){var t=o.detail,r=t.element,s=t.buttons,i=Object(l.default)(r,s,"mouse");if(i){if(typeof i.preMouseDownActivateCallback=="function"){var u=i.preMouseDownActivateCallback(o);if(u)return}f.state.isMultiPartToolActive||(i.addNewMeasurement?i.addNewMeasurement(o,"mouse"):i instanceof d.default&&Object(a.default)(o,i))}}}},"./eventDispatchers/mouseEventHandlers/mouseDrag.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./store/getActiveToolsForElement.js"),d=e("./store/filterToolsUsableWithMultiPartTools.js");n.default=function(l){if(!a.state.isToolLocked){var o,t=l.detail,r=t.element;if(o=Object(f.default)(r,a.getters.mouseTools()),o=o.filter(function(i){return Array.isArray(i.options.mouseButtonMask)&&i.options.mouseButtonMask.includes(t.buttons)&&i.options.isMouseActive}),o=o.filter(function(i){return typeof i.mouseDragCallback=="function"}),a.state.isMultiPartToolActive&&(o=Object(d.default)(o)),o.length!==0){var s=o[0];s.mouseDragCallback(l)}}}},"./eventDispatchers/mouseEventHandlers/mouseMove.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./store/index.js"),d=e("./store/getInteractiveToolsForElement.js"),l=e("./store/getToolsWithDataForElement.js");n.default=function(o){if(!(f.state.isToolLocked||f.state.isMultiPartToolActive)){var t,r=o.detail,s=r.element,i=r.currentPoints;f.state.mousePositionImage=i.image,t=Object(d.default)(s,f.getters.mouseTools());var u=t.filter(function(v){return v.mode==="active"&&v.options.isMouseActive}),c=!1;u.length>0&&(c=u.some(function(v){return v.updateOnMouseMove})),t=Object(l.default)(s,t);for(var h=0;h<t.length;h++){var g=t[h];typeof g.mouseMoveCallback=="function"&&(c=g.mouseMoveCallback(o)||c)}c===!0&&a.default.cornerstone.updateImage(s)}}},"./eventDispatchers/mouseToolEventDispatcher.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./eventDispatchers/mouseEventHandlers/index.js"),d=function(t){t.addEventListener(a.default.MOUSE_CLICK,f.mouseClick),t.addEventListener(a.default.MOUSE_DOWN,f.mouseDown),t.addEventListener(a.default.MOUSE_DOWN_ACTIVATE,f.mouseDownActivate),t.addEventListener(a.default.MOUSE_DOUBLE_CLICK,f.mouseDoubleClick),t.addEventListener(a.default.MOUSE_DRAG,f.mouseDrag),t.addEventListener(a.default.MOUSE_MOVE,f.mouseMove),t.addEventListener(a.default.MOUSE_UP,f.mouseUp),t.addEventListener(a.default.MOUSE_WHEEL,f.mouseWheel)},l=function(t){t.removeEventListener(a.default.MOUSE_CLICK,f.mouseClick),t.removeEventListener(a.default.MOUSE_DOWN,f.mouseDown),t.removeEventListener(a.default.MOUSE_DOWN_ACTIVATE,f.mouseDownActivate),t.removeEventListener(a.default.MOUSE_DOUBLE_CLICK,f.mouseDoubleClick),t.removeEventListener(a.default.MOUSE_DRAG,f.mouseDrag),t.removeEventListener(a.default.MOUSE_MOVE,f.mouseMove),t.removeEventListener(a.default.MOUSE_UP,f.mouseUp),t.removeEventListener(a.default.MOUSE_WHEEL,f.mouseWheel)};n.default={enable:d,disable:l}},"./eventDispatchers/newImageEventDispatcher.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./externalModules.js"),d=function(r){if(a.state.isToolLocked)return!1;var s=r.detail.element,i=a.state.tools.filter(function(u){return u.element===s&&(u.mode==="active"||u.mode==="passive"||u.mode==="enabled")});if(i.length===0)return!1;i.forEach(function(u){u.newImageCallback&&u.newImageCallback(r)})},l=function(r){r.addEventListener(f.default.cornerstone.EVENTS.NEW_IMAGE,d)},o=function(r){r.removeEventListener(f.default.cornerstone.EVENTS.NEW_IMAGE,d)};n.default={enable:l,disable:o}},"./eventDispatchers/shared/customCallbackHandler.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./store/getActiveToolsForElement.js"),d=e("./store/filterToolsUsableWithMultiPartTools.js");n.default=function(l,o,t){if(a.state.isToolLocked)return!1;var r=t.detail.element,s=a.state.tools.filter(function(i){return i.supportedInteractionTypes.includes(l)});if(s=Object(f.default)(r,s,l),s=s.filter(function(i){return typeof i[o]=="function"}),a.state.isMultiPartToolActive&&(s=Object(d.default)(s)),s.length===0)return!1;s[0][o](t)}},"./eventDispatchers/touchEventHandlers/addNewMeasurement.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./externalModules.js"),d=e("./store/index.js"),l=e("./manipulators/anyHandlesOutsideImage.js"),o=e("./manipulators/index.js"),t=e("./stateManagement/toolState.js"),r=e("./util/triggerEvent.js"),s=e("./util/logger.js"),i=Object(s.getLogger)("eventDispatchers:touchEventHandlers");n.default=function(u,c){i.log("addNewMeasurement"),u.preventDefault(),u.stopPropagation();var h=u.detail,g=h.element,v=c.createNewMeasurement(h);if(v){if(Object(t.addToolState)(g,c.name,v),Object.keys(v.handles).length===1&&h.type===a.default.TAP){v.active=!1,v.handles.end.active=!1,v.handles.end.highlight=!1,v.invalidated=!0;var m=d.state.deleteIfHandleOutsideImage||c.options.deleteIfHandleOutsideImage;m&&Object(l.default)(h,v.handles)&&Object(t.removeToolState)(g,c.name,v),f.default.cornerstone.updateImage(g);return}f.default.cornerstone.updateImage(g),Object(o.moveNewHandle)(h,c.name,v,v.handles.end,c.options,"touch",function(){var E=a.default.MEASUREMENT_COMPLETED,T={toolName:c.name,toolType:c.name,element:g,measurementData:v};Object(r.default)(g,E,T)})}}},"./eventDispatchers/touchEventHandlers/index.js":function(W,n,e){e.r(n),e.d(n,"doubleTap",function(){return t}),e.d(n,"touchDrag",function(){return r}),e.d(n,"touchEnd",function(){return s}),e.d(n,"touchPinch",function(){return i}),e.d(n,"touchPress",function(){return u}),e.d(n,"touchRotate",function(){return c});var a=e("./eventDispatchers/shared/customCallbackHandler.js"),f=e("./eventDispatchers/touchEventHandlers/multiTouchDrag.js");e.d(n,"multiTouchDrag",function(){return f.default});var d=e("./eventDispatchers/touchEventHandlers/tap.js");e.d(n,"tap",function(){return d.default});var l=e("./eventDispatchers/touchEventHandlers/touchStart.js");e.d(n,"touchStart",function(){return l.default});var o=e("./eventDispatchers/touchEventHandlers/touchStartActive.js");e.d(n,"touchStartActive",function(){return o.default});var t=a.default.bind(null,"DoubleTap","doubleTapCallback"),r=a.default.bind(null,"Touch","touchDragCallback"),s=a.default.bind(null,"Touch","touchEndCallback"),i=a.default.bind(null,"TouchPinch","touchPinchCallback"),u=a.default.bind(null,"Touch","touchPressCallback"),c=a.default.bind(null,"TouchRotate","touchRotateCallback")},"./eventDispatchers/touchEventHandlers/multiTouchDrag.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./store/getActiveToolsForElement.js"),d=e("./store/filterToolsUsableWithMultiPartTools.js");n.default=function(l){if(a.state.isToolLocked)return!1;var o=l.detail,t=o.element,r=o.numPointers,s=a.state.tools.filter(function(u){return u.supportedInteractionTypes.includes("MultiTouch")});if(s=Object(f.default)(t,s,"MultiTouch"),s=s.filter(function(u){return typeof u.multiTouchDragCallback=="function"&&r===u.configuration.touchPointers}),a.state.isMultiPartToolActive&&(s=Object(d.default)(s)),s.length===0)return!1;var i=s[0];i.multiTouchDragCallback(l)}},"./eventDispatchers/touchEventHandlers/shared/deactivateAllToolInstances.js":function(W,n,e){e.r(n),n.default=function(f){if(f)for(var d=0;d<f.data.length;d++){var l=f.data[d];l.active=!1,l.handles&&a(l.handles)}};function a(f){Object.keys(f).forEach(function(d){var l=f[d];l.active=!1})}},"./eventDispatchers/touchEventHandlers/tap.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./eventDispatchers/touchEventHandlers/touchStartActive.js"),d=e("./store/index.js"),l=e("./store/getActiveToolsForElement.js"),o=e("./store/getToolsWithDataForElement.js"),t=e("./stateManagement/toolState.js"),r=e("./manipulators/getHandleNearImagePoint.js"),s=e("./manipulators/index.js"),i=e("./eventDispatchers/touchEventHandlers/shared/deactivateAllToolInstances.js");n.default=function(u){if(!(d.state.isToolLocked||d.state.isMultiPartToolActive)){var c,h=28,g=u.detail.element,v=u.detail.currentPoints.canvas;c=Object(l.default)(g,d.getters.touchTools()),c=Object(o.default)(g,c);var m=c.filter(function(I){for(var y=Object(t.getToolState)(g,I.name),R=0;R<y.data.length;R++)if(Object(r.default)(g,y.data[R].handles,v,h)!==void 0)return!0;return!1});if(m.length>0){var E=m[0],T=Object(t.getToolState)(g,E.name),O=T.data.find(function(I){return Object(r.default)(g,I.handles,v,h)!==void 0});T.data.active=!0,O.active=!0,a.default.cornerstone.updateImage(g),Object(s.moveHandle)(u.detail,E.name,T.data,O,E.options,"touch",function(){return Object(i.default)(T)}),u.stopImmediatePropagation(),u.preventDefault();return}var M=c.filter(function(I){var y=Object(t.getToolState)(g,I.name),R=y&&y.data&&I.pointNearTool&&y.data.some(function(b){return I.pointNearTool(g,b,v)});return R});if(M.length>0){var P=M[0],C=Object(t.getToolState)(g,P.name),_=C.data.find(function(I){return P.pointNearTool(g,I,v)});_.active=!0,a.default.cornerstone.updateImage(g),Object(s.moveAllHandles)(u.detail,P.name,_,null,P.options,"touch",function(){return Object(i.default)(C)}),u.stopImmediatePropagation(),u.preventDefault();return}var D=Object(l.default)(g,d.getters.touchTools());return D.length>0&&D[0].touchStartActiveCallback?D[0].touchStartActiveCallback(u):Object(f.default)(u),!1}}},"./eventDispatchers/touchEventHandlers/touchStart.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./util/findAndMoveHelpers.js"),d=e("./store/getToolsWithMoveableHandles.js"),l=e("./stateManagement/toolState.js"),o=e("./store/getInteractiveToolsForElement.js"),t=e("./store/getToolsWithDataForElement.js"),r=e("./store/filterToolsUsableWithMultiPartTools.js");n.default=function(s){if(!a.state.isToolLocked){var i=s.detail,u=i.element,c=i.startPoints.canvas,h=Object(o.default)(u,a.getters.touchTools()),g=h.filter(function(H){return H.mode==="active"&&H.options.isTouchActive});if(a.state.isMultiPartToolActive&&(g=Object(r.default)(g)),g.length>0){var v=g.find(function(H){return typeof H.preTouchStartCallback=="function"});if(v){var m=v.preTouchStartCallback(s);if(m)return}}if(!a.state.isMultiPartToolActive){var E=Object(t.default)(u,h),T=Object(d.default)(u,E,c,"touch");if(T.length>0){var O=T[0],M=Object(l.getToolState)(u,O.name),P=Object(f.findHandleDataNearImagePoint)(u,M,O.name,c,"touch"),C=P.handle,_=P.data;O.handleSelectedCallback(s,_,C,"touch");return}var D=E.filter(function(H){var B=Object(l.getToolState)(u,H.name),p=B&&B.data&&H.pointNearTool&&B.data.some(function(A){return H.pointNearTool(u,A,c,"touch")});return p});if(D.length>0){var I=D[0],y=Object(l.getToolState)(u,I.name),R=y.data.find(function(H){return I.pointNearTool(u,H,c)});I.toolSelectedCallback(s,R,"touch");return}if(g.length>0){var b=g.find(function(H){return typeof H.postTouchStartCallback=="function"});if(b){var z=b.postTouchStartCallback(s);if(z)return}}}}}},"./eventDispatchers/touchEventHandlers/touchStartActive.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./eventDispatchers/touchEventHandlers/addNewMeasurement.js"),d=e("./tools/base/BaseAnnotationTool.js"),l=e("./util/getActiveTool.js");n.default=function(o){if(!(a.state.isToolLocked||a.state.isMultiPartToolActive)){var t=o.detail.element,r=Object(l.default)(t,null,"touch");r&&r.addNewMeasurement?r.addNewMeasurement(o,"touch"):r instanceof d.default&&Object(f.default)(o,r)}}},"./eventDispatchers/touchToolEventDispatcher.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./eventDispatchers/touchEventHandlers/index.js"),d=function(t){t.addEventListener(a.default.TAP,f.tap),t.addEventListener(a.default.TOUCH_START,f.touchStart,{passive:!1}),t.addEventListener(a.default.TOUCH_DRAG,f.touchDrag,{passive:!1}),t.addEventListener(a.default.TOUCH_END,f.touchEnd),t.addEventListener(a.default.TOUCH_START_ACTIVE,f.touchStartActive),t.addEventListener(a.default.TOUCH_PRESS,f.touchPress),t.addEventListener(a.default.DOUBLE_TAP,f.doubleTap),t.addEventListener(a.default.TOUCH_PINCH,f.touchPinch),t.addEventListener(a.default.TOUCH_ROTATE,f.touchRotate),t.addEventListener(a.default.MULTI_TOUCH_DRAG,f.multiTouchDrag)},l=function(t){t.removeEventListener(a.default.TAP,f.tap),t.removeEventListener(a.default.TOUCH_START,f.touchStart),t.removeEventListener(a.default.TOUCH_DRAG,f.touchDrag),t.removeEventListener(a.default.TOUCH_END,f.touchEnd),t.removeEventListener(a.default.TOUCH_START_ACTIVE,f.touchStartActive),t.removeEventListener(a.default.TOUCH_PRESS,f.touchPress),t.removeEventListener(a.default.DOUBLE_TAP,f.doubleTap),t.removeEventListener(a.default.TOUCH_PINCH,f.touchPinch),t.removeEventListener(a.default.TOUCH_ROTATE,f.touchRotate),t.removeEventListener(a.default.MULTI_TOUCH_DRAG,f.multiTouchDrag)};n.default={enable:d,disable:l}},"./eventListeners/index.js":function(W,n,e){e.r(n);var a=e("./eventListeners/mouseEventListeners.js");e.d(n,"mouseEventListeners",function(){return a.default});var f=e("./eventListeners/wheelEventListener.js");e.d(n,"wheelEventListener",function(){return f.default});var d=e("./eventListeners/touchEventListeners.js");e.d(n,"touchEventListeners",function(){return d.default})},"./eventListeners/internals/normalizeWheel.js":function(W,n,e){e.r(n);var a=10,f=40,d=800;n.default=function(l){var o=0,t=0,r=0,s=0;return"detail"in l&&(t=l.detail),"wheelDelta"in l&&(t=-l.wheelDelta/120),"wheelDeltaY"in l&&(t=-l.wheelDeltaY/120),"wheelDeltaX"in l&&(o=-l.wheelDeltaX/120),r=o*a,s=t*a,"deltaY"in l&&(s=l.deltaY),"deltaX"in l&&(r=l.deltaX),(r||s)&&l.deltaMode&&(l.deltaMode===1?(r*=f,s*=f):(r*=d,s*=d)),r&&!o&&(o=r<1?-1:1),s&&!t&&(t=s<1?-1:1),{spinX:o,spinY:t,pixelX:r,pixelY:s}}},"./eventListeners/internals/renderSegmentation.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return o});var a=e("./store/index.js"),f=e("./eventListeners/internals/renderSegmentationFill.js"),d=e("./eventListeners/internals/renderSegmentationOutline.js"),l=Object(a.getModule)("segmentation");function o(s,i,u,c,h){t(h)&&Object(f.default)(s,i,c,u,h),r(h)&&Object(d.default)(s,i,c,u,h)}function t(s){var i=l.configuration;return i.renderFill&&(s&&i.fillAlpha!==0||!s&&i.fillAlphaInactive!==0)}function r(s){var i=l.configuration;return i.renderOutline&&(s&&i.outlineAlpha!==0||!s&&i.outlineAlphaInactive!==0)}},"./eventListeners/internals/renderSegmentationFill.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return o}),e.d(n,"getLabelmapCanvas",function(){return t}),e.d(n,"renderFill",function(){return r});var a=e("./store/index.js"),f=e("./drawing/index.js"),d=e("./externalModules.js"),l=Object(a.getModule)("segmentation");function o(i,u,c,h,g){var v=t(i,u,c);r(i,v,g)}function t(i,u,c){var h=l.state,g=i.detail,v=g.image,m=v.width,E=v.height,T=u.segmentsHidden,O=c.pixelData,M=h.colorLutTables[u.colorLUTIndex],P=document.createElement("canvas");P.width=m,P.height=E;for(var C=Object(f.getNewContext)(P),_=new ImageData(m,E),D=_.data,I=0;I<O.length;I++){var y=O[I];if(y!==0&&!T[y]){var R=M[O[I]];D[4*I]=R[0],D[4*I+1]=R[1],D[4*I+2]=R[2],D[4*I+3]=R[3]}}return C.putImageData(_,0,0),P}function r(i,u,c){var h=l.configuration,g=i.detail,v=g.canvasContext,m=g.element,E=g.image,T=g.viewport,O=v.getTransform(),M=Object(f.getNewContext)(v.canvas),P=d.default.cornerstone.pixelToCanvas(m,{x:0,y:0}),C=d.default.cornerstone.pixelToCanvas(m,{x:E.width,y:0}),_=d.default.cornerstone.pixelToCanvas(m,{x:E.width,y:E.height}),D=d.default.cornerstoneMath.point.distance(P,C),I=d.default.cornerstoneMath.point.distance(C,_),y=v.canvas,R=M.imageSmoothingEnabled,b=M.globalAlpha;M.imageSmoothingEnabled=!1,M.globalAlpha=c?h.fillAlpha:h.fillAlphaInactive,Object(f.transformCanvasContext)(M,y,T);var z=s(g);M.drawImage(u,y.width/2-D/2+z.x,y.height/2-I/2+z.y,D,I),M.globalAlpha=b,M.imageSmoothingEnabled=R,M.setTransform(O)}function s(i){var u=i.viewport,c=i.image,h=u.scale,g=u.scale;return c.rowPixelSpacing<c.columnPixelSpacing?h*=c.columnPixelSpacing/c.rowPixelSpacing:c.columnPixelSpacing<c.rowPixelSpacing&&(g*=c.rowPixelSpacing/c.columnPixelSpacing),{x:u.translation.x*h,y:u.translation.y*g}}},"./eventListeners/internals/renderSegmentationOutline.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return o}),e.d(n,"renderOutline",function(){return t}),e.d(n,"getOutline",function(){return r}),e.d(n,"_addTopRightCorner",function(){return c});var a=e("./store/index.js"),f=e("./externalModules.js"),d=e("./drawing/index.js");e("./index.js");var l=Object(a.getModule)("segmentation");function o(O,M,P,C,_){var D=l.configuration,I=r(O,M,P,D.outlineWidth);t(O,I,M.colorLUTIndex,_)}function t(O,M,P){var C=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,_=l.configuration,D=l.state,I=O.detail,y=I.element,R=I.canvasContext,b=_.outlineWidth||1,z=R.getTransform(),H=Object(d.getNewContext)(R.canvas),B=D.colorLutTables[P],p=H.globalAlpha;H.globalAlpha=C?_.outlineAlpha:_.outlineAlphaInactive,Object(d.draw)(H,function(A){for(var j=1;j<M.length;j++)if(M[j]){var x=B[j];Object(d.drawLines)(A,y,M[j],{color:"rgba(".concat(x[0],", ").concat(x[1],", ").concat(x[2],", 1.0 )"),lineWidth:b},"canvas")}}),H.globalAlpha=p,H.setTransform(z)}function r(O,M,P,C){var _=O.detail,D=_.element,I=_.image,y=_.viewport,R=I.width,b=I.height;C=C||1;var z=M.segmentsHidden,H=P.pixelData,B=M.activeSegmentIndex,p=[];P.segmentsOnLabelmap.forEach(function(G){var $=!z[G];$&&(p[G]=[])}),p[B]||(p[B]=[]);for(var A=function($){return{x:$%R,y:Math.floor($/R)}},j=s(y,C),x=0;x<H.length;x++){var L=H[x];if(L!==0){var U=!z[L];if(U){var S=A(x),w=i(S,b,R);(w.top===void 0||H[w.top]!==L)&&v(p[L],D,S,j),(w.bottom===void 0||H[w.bottom]!==L)&&m(p[L],D,S,j),(w.left===void 0||H[w.left]!==L)&&E(p[L],D,S,j),(w.right===void 0||H[w.right]!==L)&&T(p[L],D,S,j),w.topLeft!==void 0&&H[w.topLeft]!==L&&H[w.top]===L&&H[w.left]===L&&u(p[L],D,S,j),w.topRight!==void 0&&H[w.topRight]!==L&&H[w.top]===L&&H[w.right]===L&&c(p[L],D,S,j),w.bottomLeft!==void 0&&H[w.bottomLeft]!==L&&H[w.bottom]===L&&H[w.left]===L&&h(p[L],D,S,j),w.bottomRight!==void 0&&H[w.bottomRight]!==L&&H[w.bottom]===L&&H[w.right]===L&&g(p[L],D,S,j)}}}return p}function s(O,M){var P=M/2,C=O.rotation;C*=Math.PI/180;var _=Math.cos(C),D=Math.sin(C),I=[_,D],y=[-D,_],R={x:P*I[0],y:P*I[1]},b={x:P*y[0],y:P*y[1]};return O.hflip&&(R.x*=-1,R.y*=-1),O.vflip&&(b.x*=-1,b.y*=-1),{i:R,j:b}}function i(O,M,P){var C=O.y*P+O.x,_={},D=O.y-1>=0,I=O.y+1<M,y=O.x-1>=0,R=O.x+1<P;return D&&(_.top=C-P,R&&(_.topRight=_.top+1),y&&(_.topLeft=_.top-1)),I&&(_.bottom=C+P,R&&(_.bottomRight=_.bottom+1),y&&(_.bottomLeft=_.bottom-1)),y&&(_.left=C-1),R&&(_.right=C+1),_}function u(O,M,P,C){var _=f.default.cornerstone.pixelToCanvas,D=_(M,P);D.x+=C.j.x,D.y+=C.j.y;var I={x:D.x,y:D.y};I.x+=C.i.x*2,I.y+=C.i.y*2,O.push({start:D,end:I})}function c(O,M,P,C){var _=f.default.cornerstone.pixelToCanvas,D=_(M,{x:P.x+1,y:P.y});D.x+=C.j.x,D.y+=C.j.y;var I={x:D.x,y:D.y};I.x-=C.i.x*2,I.y-=C.i.y*2,O.push({start:D,end:I})}function h(O,M,P,C){var _=f.default.cornerstone.pixelToCanvas,D=_(M,{x:P.x,y:P.y+1});D.x-=C.j.x,D.y-=C.j.y;var I={x:D.x,y:D.y};I.x+=C.i.x*2,I.y+=C.i.y*2,O.push({start:D,end:I})}function g(O,M,P,C){var _=f.default.cornerstone.pixelToCanvas,D=_(M,{x:P.x+1,y:P.y+1});D.x-=C.j.x,D.y-=C.j.y;var I={x:D.x,y:D.y};I.x-=C.i.x*2,I.y-=C.i.y*2,O.push({start:D,end:I})}function v(O,M,P,C){var _=f.default.cornerstone.pixelToCanvas,D=_(M,P),I=_(M,{x:P.x+1,y:P.y});D.x+=C.j.x,D.y+=C.j.y,I.x+=C.j.x,I.y+=C.j.y,O.push({start:D,end:I})}function m(O,M,P,C){var _=f.default.cornerstone.pixelToCanvas,D=_(M,{x:P.x,y:P.y+1}),I=_(M,{x:P.x+1,y:P.y+1});D.x-=C.j.x,D.y-=C.j.y,I.x-=C.j.x,I.y-=C.j.y,O.push({start:D,end:I})}function E(O,M,P,C){var _=f.default.cornerstone.pixelToCanvas,D=_(M,P),I=_(M,{x:P.x,y:P.y+1});D.x+=C.i.x,D.y+=C.i.y,I.x+=C.i.x,I.y+=C.i.y,O.push({start:D,end:I})}function T(O,M,P,C){var _=f.default.cornerstone.pixelToCanvas,D=_(M,{x:P.x+1,y:P.y}),I=_(M,{x:P.x+1,y:P.y+1});D.x-=C.i.x,D.y-=C.i.y,I.x-=C.i.x,I.y-=C.i.y,O.push({start:D,end:I})}},"./eventListeners/mouseEventListeners.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./externalModules.js"),d=e("./util/copyPoints.js"),l=e("./util/triggerEvent.js"),o=e("./util/logger.js"),t=Object(o.getLogger)("eventListeners:mouseEventListeners"),r=!0,s,i=200,u=new Map;function c(O){if(typeof O.buttons=="number")return O.buttons;switch(O.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function h(){r=!1}function g(O){var M=O.currentTarget,P=f.default.cornerstone.getEnabledElement(M);if(P.image){var C=a.default.MOUSE_DOUBLE_CLICK,_={page:f.default.cornerstoneMath.point.pageToPoint(O),image:f.default.cornerstone.pageToPixel(M,O.pageX,O.pageY),client:{x:O.clientX,y:O.clientY}};_.canvas=f.default.cornerstone.pixelToCanvas(M,_.image);var D=Object(d.default)(_);t.log("double-click: %o",c(O));var I={event:O,buttons:c(O),viewport:f.default.cornerstone.getViewport(M),image:P.image,element:M,startPoints:_,lastPoints:D,currentPoints:_,deltaPoints:{x:0,y:0},type:C};Object(l.default)(M,C,I)}}function v(O){var M=O.currentTarget,P=f.default.cornerstone.getEnabledElement(M);if(!P.image)return;s=setTimeout(h,i),M.removeEventListener("mousemove",m);var C={page:f.default.cornerstoneMath.point.pageToPoint(O),image:f.default.cornerstone.pageToPixel(M,O.pageX,O.pageY),client:{x:O.clientX,y:O.clientY}};C.canvas=f.default.cornerstone.pixelToCanvas(M,C.image);var _=Object(d.default)(C),D={event:O,buttons:c(O),viewport:f.default.cornerstone.getViewport(M),image:P.image,element:M,startPoints:C,lastPoints:_,currentPoints:C,deltaPoints:{x:0,y:0},type:a.default.MOUSE_DOWN},I=Object(l.default)(D.element,a.default.MOUSE_DOWN,D);I&&(D.type=a.default.MOUSE_DOWN_ACTIVATE,Object(l.default)(D.element,a.default.MOUSE_DOWN_ACTIVATE,D));function y(b){var z=a.default.MOUSE_DRAG,H={page:f.default.cornerstoneMath.point.pageToPoint(b),image:f.default.cornerstone.pageToPixel(M,b.pageX,b.pageY),client:{x:b.clientX,y:b.clientY}};H.canvas=f.default.cornerstone.pixelToCanvas(M,H.image);var B={page:f.default.cornerstoneMath.point.subtract(H.page,_.page),image:f.default.cornerstoneMath.point.subtract(H.image,_.image),client:f.default.cornerstoneMath.point.subtract(H.client,_.client),canvas:f.default.cornerstoneMath.point.subtract(H.canvas,_.canvas)};t.log("mousemove: %o",c(b));var p={buttons:c(b),viewport:f.default.cornerstone.getViewport(M),image:P.image,element:M,startPoints:C,lastPoints:_,currentPoints:H,deltaPoints:B,type:z,ctrlKey:b.ctrlKey,metaKey:b.metaKey,shiftKey:b.shiftKey};Object(l.default)(p.element,z,p),_=Object(d.default)(H)}function R(b){clearTimeout(s);var z=a.default.MOUSE_UP;r&&(z=a.default.MOUSE_CLICK);var H={page:f.default.cornerstoneMath.point.pageToPoint(b),image:f.default.cornerstone.pageToPixel(M,b.pageX,b.pageY),client:{x:b.clientX,y:b.clientY}};H.canvas=f.default.cornerstone.pixelToCanvas(M,H.image);var B={page:f.default.cornerstoneMath.point.subtract(H.page,_.page),image:f.default.cornerstoneMath.point.subtract(H.image,_.image),client:f.default.cornerstoneMath.point.subtract(H.client,_.client),canvas:f.default.cornerstoneMath.point.subtract(H.canvas,_.canvas)};t.log("mouseup: %o",c(b));var p={event:b,buttons:c(b),viewport:f.default.cornerstone.getViewport(M),image:P.image,element:M,startPoints:C,lastPoints:_,currentPoints:H,deltaPoints:B,type:z};Object(l.default)(p.element,z,p),document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",R),u.delete(y),u.delete(R),M.addEventListener("mousemove",m),r=!0}document.addEventListener("mousemove",y),document.addEventListener("mouseup",R),u.set(y,"mousemove"),u.set(R,"mouseup")}function m(O){var M=O.currentTarget,P=f.default.cornerstone.getEnabledElement(M);if(P.image){var C=a.default.MOUSE_MOVE,_={page:f.default.cornerstoneMath.point.pageToPoint(O),image:f.default.cornerstone.pageToPixel(M,O.pageX,O.pageY),client:{x:O.clientX,y:O.clientY}};_.canvas=f.default.cornerstone.pixelToCanvas(M,_.image);var D=Object(d.default)(_),I={page:f.default.cornerstoneMath.point.pageToPoint(O),image:f.default.cornerstone.pageToPixel(M,O.pageX,O.pageY),client:{x:O.clientX,y:O.clientY}};I.canvas=f.default.cornerstone.pixelToCanvas(M,I.image);var y={page:f.default.cornerstoneMath.point.subtract(I.page,D.page),image:f.default.cornerstoneMath.point.subtract(I.image,D.image),client:f.default.cornerstoneMath.point.subtract(I.client,D.client),canvas:f.default.cornerstoneMath.point.subtract(I.canvas,D.canvas)},R={viewport:f.default.cornerstone.getViewport(M),image:P.image,element:M,startPoints:_,lastPoints:D,currentPoints:I,deltaPoints:y,type:C};Object(l.default)(M,C,R),D=Object(d.default)(I)}}function E(O){O.removeEventListener("mousedown",v),O.removeEventListener("mousemove",m),O.removeEventListener("dblclick",g),u.forEach(function(M,P){document.removeEventListener(M,P)}),u.clear()}function T(O){E(O),O.addEventListener("mousedown",v),O.addEventListener("mousemove",m),O.addEventListener("dblclick",g)}n.default={enable:T,disable:E}},"./eventListeners/onImageRenderedBrushEventHandler.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./eventListeners/internals/renderSegmentation.js"),d=Object(a.getModule)("segmentation");n.default=function(t){var r=t.detail,s=r.element,i=d.configuration,u=d.getters,c=u.labelmaps3D(s),h=c.activeLabelmapIndex,g=c.labelmaps3D,v=c.currentImageIdIndex;g&&(i.shouldRenderInactiveLabelmaps&&o(t,g,h,v),l(t,g,h,v))};function l(t,r,s,i){var u=r[s];if(u){var c=u.labelmaps2D[i];c&&Object(f.default)(t,u,s,c,!0)}}function o(t,r,s,i){for(var u=0;u<r.length;u++){var c=r[u];if(!(u===s||!c)){var h=c.labelmaps2D[i];h&&Object(f.default)(t,c,u,h,!1)}}}},"./eventListeners/preventGhostClick.js":function(W,n,e){e.r(n);var a=2e3,f={mouse:0,touch:1},d,l;function o(v,m){var E=Date.now();if(v!==d){if(E-l<=a)return m.preventDefault(),m.stopPropagation(),m.stopImmediatePropagation(),!1;d=v}l=E}var t=o.bind(null,f.mouse),r=o.bind(null,f.touch);function s(v,m,E){var T=E?t:r;m.forEach(function(O){v.addEventListener(O,T,{passive:!1})})}function i(v,m,E){var T=E?t:r;m.forEach(function(O){v.removeEventListener(O,T)})}var u=["mousedown","mouseup"],c=["touchstart","touchend"];function h(v){i(v,u,f.mouse),i(v,c,f.touch)}function g(v){h(v),s(v,u,f.mouse),s(v,c,f.touch)}n.default={enable:g,disable:h}},"./eventListeners/touchEventListeners.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./externalModules.js"),d=e("./util/copyPoints.js"),l=e("./eventListeners/preventGhostClick.js"),o=e("./util/triggerEvent.js"),t=e("./toolOptions.js"),r,s,i,u,c,h,g,v,m=1,E=0,T=!1,O=!1,M,P=700,C=5,_="touchInput";function D(b){var z=b.currentTarget||b.srcEvent.currentTarget,H=f.default.cornerstone.getEnabledElement(z);if(H.image){var B,p,A,j,x;switch(b.preventDefault(),(b.pointers&&b.pointers.length>1||b.touches&&b.touches.length>1)&&(O=!1,clearTimeout(g)),b.type){case"tap":O=!1,clearTimeout(g),s={page:f.default.cornerstoneMath.point.pageToPoint(b.pointers[0]),image:f.default.cornerstone.pageToPixel(z,b.pointers[0].pageX,b.pointers[0].pageY),client:{x:b.pointers[0].clientX,y:b.pointers[0].clientY}},s.canvas=f.default.cornerstone.pixelToCanvas(z,s.image),B=a.default.TAP,c={event:b,viewport:f.default.cornerstone.getViewport(z),image:H.image,element:z,currentPoints:s,type:B,isTouchEvent:!0},Object(o.default)(z,B,c);break;case"doubletap":O=!1,clearTimeout(g),s={page:f.default.cornerstoneMath.point.pageToPoint(b.pointers[0]),image:f.default.cornerstone.pageToPixel(z,b.pointers[0].pageX,b.pointers[0].pageY),client:{x:b.pointers[0].clientX,y:b.pointers[0].clientY}},s.canvas=f.default.cornerstone.pixelToCanvas(z,s.image),B=a.default.DOUBLE_TAP,c={event:b,viewport:f.default.cornerstone.getViewport(z),image:H.image,element:z,currentPoints:s,type:B,isTouchEvent:!0},Object(o.default)(z,B,c);break;case"pinchstart":O=!1,clearTimeout(g),m=1;break;case"pinchmove":if(O=!1,clearTimeout(g),T===!0){m=b.scale,T=!1;break}p=(b.scale-m)/m,r={page:b.center,image:f.default.cornerstone.pageToPixel(z,b.center.x,b.center.y)},r.canvas=f.default.cornerstone.pixelToCanvas(z,r.image),B=a.default.TOUCH_PINCH,c={event:b,startPoints:r,viewport:f.default.cornerstone.getViewport(z),image:H.image,element:z,direction:b.scale<1?1:-1,scaleChange:p,type:B,isTouchEvent:!0},Object(o.default)(z,B,c),m=b.scale;break;case"touchstart":m=1,clearTimeout(g),clearTimeout(h),h=setTimeout(function(){r={page:f.default.cornerstoneMath.point.pageToPoint(b.touches[0]),image:f.default.cornerstone.pageToPixel(z,b.touches[0].pageX,b.touches[0].pageY),client:{x:b.touches[0].clientX,y:b.touches[0].clientY}},r.canvas=f.default.cornerstone.pixelToCanvas(z,r.image),B=a.default.TOUCH_START,b.touches.length>1&&(B=a.default.MULTI_TOUCH_START),c={event:b,viewport:f.default.cornerstone.getViewport(z),image:H.image,element:z,startPoints:r,currentPoints:r,type:B,isTouchEvent:!0};var L=Object(o.default)(z,B,c);L===!0&&(B=a.default.TOUCH_START_ACTIVE,b.touches.length>1&&(B=a.default.MULTI_TOUCH_START_ACTIVE),c.type=B,Object(o.default)(z,B,c)),i=Object(d.default)(r)},50),O=!0,v=0,g=setTimeout(function(){O&&(s={page:f.default.cornerstoneMath.point.pageToPoint(b.touches[0]),image:f.default.cornerstone.pageToPixel(z,b.touches[0].pageX,b.touches[0].pageY),client:{x:b.touches[0].clientX,y:b.touches[0].clientY}},s.canvas=f.default.cornerstone.pixelToCanvas(z,r.image),B=a.default.TOUCH_PRESS,c={event:b,viewport:f.default.cornerstone.getViewport(z),image:H.image,element:z,currentPoints:s,type:B,isTouchEvent:!0},Object(o.default)(z,B,c))},P);break;case"touchend":m=1,O=!1,clearTimeout(g),setTimeout(function(){r={page:f.default.cornerstoneMath.point.pageToPoint(b.changedTouches[0]),image:f.default.cornerstone.pageToPixel(z,b.changedTouches[0].pageX,b.changedTouches[0].pageY),client:{x:b.changedTouches[0].clientX,y:b.changedTouches[0].clientY}},r.canvas=f.default.cornerstone.pixelToCanvas(z,r.image),B=a.default.TOUCH_END,c={event:b,viewport:f.default.cornerstone.getViewport(z),image:H.image,element:z,startPoints:r,currentPoints:r,type:B,isTouchEvent:!0},Object(o.default)(z,B,c)},50);break;case"panmove":A={x:b.deltaX-M.x,y:b.deltaY-M.y},M={x:b.deltaX,y:b.deltaY},s={page:{x:i.page.x+A.x,y:i.page.y+A.y},image:f.default.cornerstone.pageToPixel(z,i.page.x+A.x,i.page.y+A.y),client:{x:i.client.x+A.x,y:i.client.y+A.y}},s.canvas=f.default.cornerstone.pixelToCanvas(z,s.image),u={page:f.default.cornerstoneMath.point.subtract(s.page,i.page),image:f.default.cornerstoneMath.point.subtract(s.image,i.image),client:f.default.cornerstoneMath.point.subtract(s.client,i.client),canvas:f.default.cornerstoneMath.point.subtract(s.canvas,i.canvas)},v+=Math.sqrt(u.page.x*u.page.x+u.page.y*u.page.y),v>C&&(O=!1,clearTimeout(g)),B=a.default.TOUCH_DRAG,b.pointers.length>1&&(B=a.default.MULTI_TOUCH_DRAG),c={viewport:f.default.cornerstone.getViewport(z),image:H.image,element:z,startPoints:r,lastPoints:i,currentPoints:s,deltaPoints:u,numPointers:b.pointers.length,type:B,isTouchEvent:!0},Object(o.default)(z,B,c),i=Object(d.default)(s);break;case"panstart":M={x:b.deltaX,y:b.deltaY},s={page:f.default.cornerstoneMath.point.pageToPoint(b.pointers[0]),image:f.default.cornerstone.pageToPixel(z,b.pointers[0].pageX,b.pointers[0].pageY),client:{x:b.pointers[0].clientX,y:b.pointers[0].clientY}},s.canvas=f.default.cornerstone.pixelToCanvas(z,s.image),i=Object(d.default)(s);break;case"panend":if(O=!1,clearTimeout(g),!i)return!1;s={page:f.default.cornerstoneMath.point.pageToPoint(b.pointers[0]),image:f.default.cornerstone.pageToPixel(z,b.pointers[0].pageX,b.pointers[0].pageY),client:{x:b.pointers[0].clientX,y:b.pointers[0].clientY}},s.canvas=f.default.cornerstone.pixelToCanvas(z,s.image),u={page:f.default.cornerstoneMath.point.subtract(s.page,i.page),image:f.default.cornerstoneMath.point.subtract(s.image,i.image),client:f.default.cornerstoneMath.point.subtract(s.client,i.client),canvas:f.default.cornerstoneMath.point.subtract(s.canvas,i.canvas)},B=a.default.TOUCH_DRAG_END,c={event:b.srcEvent,viewport:f.default.cornerstone.getViewport(z),image:H.image,element:z,startPoints:r,lastPoints:i,currentPoints:s,deltaPoints:u,type:B,isTouchEvent:!0},Object(o.default)(z,B,c),j=b.pointers.length-b.changedPointers.length,j===2&&(T=!0);break;case"rotatemove":O=!1,clearTimeout(g),x=b.rotation-E,E=b.rotation,B=a.default.TOUCH_ROTATE,c={event:b.srcEvent,viewport:f.default.cornerstone.getViewport(z),image:H.image,element:z,rotation:x,type:B},Object(o.default)(z,B,c);break}return!1}}function I(b){y(b);var z=f.default.Hammer,H={inputClass:z.SUPPORT_POINTER_EVENTS?z.PointerEventInput:z.TouchInput},B=new z.Manager(b,H),p={pointers:0,direction:z.DIRECTION_ALL,threshold:0},A=new z.Pan(p),j=new z.Pinch({threshold:0}),x=new z.Rotate({threshold:0});j.recognizeWith(A),j.recognizeWith(x),x.recognizeWith(A);var L=new z.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});L.recognizeWith(A),B.add([L,A,x,j]),B.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",D),l.default.enable(b);var U=["touchstart","touchend"];U.forEach(function(w){b.addEventListener(w,D,{passive:!1})});var S=Object(t.getToolOptions)(_,b);S.hammer=B,Object(t.setToolOptions)(_,b,S)}function y(b){l.default.disable(b);var z=["touchstart","touchend"];z.forEach(function(p){b.removeEventListener(p,D)});var H=Object(t.getToolOptions)(_,b),B=H.hammer;B&&(B.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",D),B.input.destroy()),H.hammer=null,Object(t.clearToolOptions)(_,b)}var R={enable:I,disable:y};n.default=R},"./eventListeners/wheelEventListener.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./externalModules.js"),d=e("./util/triggerEvent.js"),l=e("./eventListeners/internals/normalizeWheel.js");function o(s){var i=s.currentTarget,u=f.default.cornerstone.getEnabledElement(i);if(u.image&&!(s.deltaY>-1&&s.deltaY<1)){s.preventDefault();var c=s.pageX,h=s.pageY,g=f.default.cornerstone.pageToPixel(i,c,h),v=Object(l.default)(s),m=v.spinX,E=v.spinY,T=v.pixelX,O=v.pixelY,M=E<0?-1:1,P={element:i,viewport:f.default.cornerstone.getViewport(i),detail:s,image:u.image,direction:M,spinX:m,spinY:E,pixelX:T,pixelY:O,pageX:c,pageY:h,imageX:g.x,imageY:g.y};Object(d.default)(i,a.default.MOUSE_WHEEL,P)}}function t(s){r(s),s.addEventListener("wheel",o,{passive:!1})}function r(s){s.removeEventListener("wheel",o,{passive:!1})}n.default={enable:t,disable:r}},"./eventListeners/windowResizeHandler.js":function(W,n,e){e.r(n),e.d(n,"forceEnabledElementResize",function(){return r});var a=e("./store/index.js"),f=e("./externalModules.js"),d=function(){l(),window.addEventListener("resize",t,!1)},l=function(){window.removeEventListener("resize",t,!1)},o;function t(){o||(o=setTimeout(function(){o=null,r()},66))}var r=function(){a.state.enabledElements.forEach(function(i){f.default.cornerstone.resize(i)})};n.default={enable:d,disable:l}},"./events.js":function(W,n,e){e.r(n);var a={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_COMPLETED:"cornerstonetoolsmeasurementcompleted",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll",STACK_PREFETCH_IMAGE_LOADED:"cornerstonetoolsstackprefetchimageloaded",STACK_PREFETCH_DONE:"cornerstonetoolsstackprefetchdone",LABELMAP_MODIFIED:"cornersontetoolslabelmapmodified"};n.default=a},"./externalModules.js":function(W,n,e){e.r(n);var a=window.cornerstone,f=window.cornerstoneMath,d=window.Hammer;n.default={set cornerstone(l){a=l},get cornerstone(){return a},set cornerstoneMath(l){f=l},get cornerstoneMath(){return f},set Hammer(l){d=l},get Hammer(){return d}}},"./importInternal.js":function(W,n,e){e.r(n);var a=e("./lib.js");n.default=function(f){return a.lib[f]}},"./index.js":function(W,n,e){e.r(n);var a=e("./tools/annotation/index.js");e.d(n,"AngleTool",function(){return a.AngleTool}),e.d(n,"ArrowAnnotateTool",function(){return a.ArrowAnnotateTool}),e.d(n,"BidirectionalTool",function(){return a.BidirectionalTool}),e.d(n,"CircleRoiTool",function(){return a.CircleRoiTool}),e.d(n,"CobbAngleTool",function(){return a.CobbAngleTool}),e.d(n,"EllipticalRoiTool",function(){return a.EllipticalRoiTool}),e.d(n,"FreehandRoiTool",function(){return a.FreehandRoiTool}),e.d(n,"LengthTool",function(){return a.LengthTool}),e.d(n,"ProbeTool",function(){return a.ProbeTool}),e.d(n,"RectangleRoiTool",function(){return a.RectangleRoiTool}),e.d(n,"TextMarkerTool",function(){return a.TextMarkerTool});var f=e("./tools/segmentation/index.js");e.d(n,"BrushTool",function(){return f.BrushTool}),e.d(n,"SphericalBrushTool",function(){return f.SphericalBrushTool}),e.d(n,"RectangleScissorsTool",function(){return f.RectangleScissorsTool}),e.d(n,"FreehandScissorsTool",function(){return f.FreehandScissorsTool}),e.d(n,"CircleScissorsTool",function(){return f.CircleScissorsTool}),e.d(n,"CorrectionScissorsTool",function(){return f.CorrectionScissorsTool});var d=e("./tools/index.js");e.d(n,"CrosshairsTool",function(){return d.CrosshairsTool}),e.d(n,"DoubleTapFitToWindowTool",function(){return d.DoubleTapFitToWindowTool}),e.d(n,"DragProbeTool",function(){return d.DragProbeTool}),e.d(n,"EraserTool",function(){return d.EraserTool}),e.d(n,"FreehandRoiSculptorTool",function(){return d.FreehandRoiSculptorTool}),e.d(n,"MagnifyTool",function(){return d.MagnifyTool}),e.d(n,"OverlayTool",function(){return d.OverlayTool}),e.d(n,"OrientationMarkersTool",function(){return d.OrientationMarkersTool}),e.d(n,"PanMultiTouchTool",function(){return d.PanMultiTouchTool}),e.d(n,"PanTool",function(){return d.PanTool}),e.d(n,"ReferenceLinesTool",function(){return d.ReferenceLinesTool}),e.d(n,"RotateTool",function(){return d.RotateTool}),e.d(n,"RotateTouchTool",function(){return d.RotateTouchTool}),e.d(n,"ScaleOverlayTool",function(){return d.ScaleOverlayTool}),e.d(n,"StackScrollMouseWheelTool",function(){return d.StackScrollMouseWheelTool}),e.d(n,"StackScrollMultiTouchTool",function(){return d.StackScrollMultiTouchTool}),e.d(n,"StackScrollTool",function(){return d.StackScrollTool}),e.d(n,"WwwcRegionTool",function(){return d.WwwcRegionTool}),e.d(n,"WwwcTool",function(){return d.WwwcTool}),e.d(n,"ZoomMouseWheelTool",function(){return d.ZoomMouseWheelTool}),e.d(n,"ZoomTool",function(){return d.ZoomTool}),e.d(n,"ZoomTouchPinchTool",function(){return d.ZoomTouchPinchTool});var l=e("./init.js");e.d(n,"init",function(){return l.default});var o=e("./stackTools/stackPrefetch.js");e.d(n,"stackPrefetch",function(){return o.default});var t=e("./stackTools/stackRenderers.js");e.d(n,"stackRenderers",function(){return t.default});var r=e("./stackTools/playClip.js");e.d(n,"playClip",function(){return r.playClip}),e.d(n,"stopClip",function(){return r.stopClip});var s=e("./store/index.js");e.d(n,"store",function(){return s.default}),e.d(n,"getModule",function(){return s.getModule});var i=e("./store/getToolForElement.js");e.d(n,"getToolForElement",function(){return i.default});var u=e("./store/addTool.js");e.d(n,"addTool",function(){return u.addTool}),e.d(n,"addToolForElement",function(){return u.addToolForElement});var c=e("./store/removeTool.js");e.d(n,"removeTool",function(){return c.removeTool}),e.d(n,"removeToolForElement",function(){return c.removeToolForElement});var h=e("./store/setToolOptions.js");e.d(n,"setToolOptions",function(){return h.setToolOptions}),e.d(n,"setToolOptionsForElement",function(){return h.setToolOptionsForElement});var g=e("./store/setToolMode.js");e.d(n,"setToolActive",function(){return g.setToolActive}),e.d(n,"setToolActiveForElement",function(){return g.setToolActiveForElement}),e.d(n,"setToolEnabled",function(){return g.setToolEnabled}),e.d(n,"setToolEnabledForElement",function(){return g.setToolEnabledForElement}),e.d(n,"setToolDisabled",function(){return g.setToolDisabled}),e.d(n,"setToolDisabledForElement",function(){return g.setToolDisabledForElement}),e.d(n,"setToolPassive",function(){return g.setToolPassive}),e.d(n,"setToolPassiveForElement",function(){return g.setToolPassiveForElement});var v=e("./store/isToolActiveForElement.js");e.d(n,"isToolActiveForElement",function(){return v.default});var m=e("./stateManagement/toolState.js");e.d(n,"addToolState",function(){return m.addToolState}),e.d(n,"getToolState",function(){return m.getToolState}),e.d(n,"removeToolState",function(){return m.removeToolState}),e.d(n,"clearToolState",function(){return m.clearToolState}),e.d(n,"setElementToolStateManager",function(){return m.setElementToolStateManager}),e.d(n,"getElementToolStateManager",function(){return m.getElementToolStateManager});var E=e("./stateManagement/textStyle.js");e.d(n,"textStyle",function(){return E.default});var T=e("./stateManagement/toolStyle.js");e.d(n,"toolStyle",function(){return T.default});var O=e("./stateManagement/toolColors.js");e.d(n,"toolColors",function(){return O.default});var M=e("./stateManagement/toolCoordinates.js");e.d(n,"toolCoordinates",function(){return M.default});var P=e("./stateManagement/stackSpecificStateManager.js");e.d(n,"stackSpecificStateManager",function(){return P.stackSpecificStateManager}),e.d(n,"newStackSpecificToolStateManager",function(){return P.newStackSpecificToolStateManager}),e.d(n,"addStackStateManager",function(){return P.addStackStateManager});var C=e("./stateManagement/loadHandlerManager.js");e.d(n,"loadHandlerManager",function(){return C.default});var _=e("./stateManagement/imageIdSpecificStateManager.js");e.d(n,"newImageIdSpecificToolStateManager",function(){return _.newImageIdSpecificToolStateManager}),e.d(n,"globalImageIdSpecificToolStateManager",function(){return _.globalImageIdSpecificToolStateManager});var D=e("./stateManagement/frameOfReferenceStateManager.js");e.d(n,"newFrameOfReferenceSpecificToolStateManager",function(){return D.newFrameOfReferenceSpecificToolStateManager}),e.d(n,"globalFrameOfReferenceSpecificToolStateManager",function(){return D.globalFrameOfReferenceSpecificToolStateManager});var I=e("./eventListeners/windowResizeHandler.js");e.d(n,"forceEnabledElementResize",function(){return I.forceEnabledElementResize});var y=e("./orientation/index.js");e.d(n,"orientation",function(){return y.default});var R=e("./util/SaveAs.js");e.d(n,"SaveAs",function(){return R.default});var b=e("./util/logger.js");e.d(n,"enableLogger",function(){return b.enable}),e.d(n,"disableLogger",function(){return b.disable});var z=e("./thirdParty/register.js");e.d(n,"register",function(){return z.default});var H=e("./thirdParty/registerSome.js");e.d(n,"registerSome",function(){return H.default});var B=e("./synchronization/wwwcSynchronizer.js");e.d(n,"wwwcSynchronizer",function(){return B.default});var p=e("./synchronization/updateImageSynchronizer.js");e.d(n,"updateImageSynchronizer",function(){return p.default});var A=e("./synchronization/Synchronizer.js");e.d(n,"Synchronizer",function(){return A.default});var j=e("./synchronization/stackScrollSynchronizer.js");e.d(n,"stackScrollSynchronizer",function(){return j.default});var x=e("./synchronization/stackImagePositionSynchronizer.js");e.d(n,"stackImagePositionSynchronizer",function(){return x.default});var L=e("./synchronization/stackImagePositionOffsetSynchronizer.js");e.d(n,"stackImagePositionOffsetSynchronizer",function(){return L.default});var U=e("./synchronization/stackImageIndexSynchronizer.js");e.d(n,"stackImageIndexSynchronizer",function(){return U.default});var S=e("./synchronization/panZoomSynchronizer.js");e.d(n,"panZoomSynchronizer",function(){return S.default});var w=e("./externalModules.js");e.d(n,"external",function(){return w.default});var G=e("./events.js");e.d(n,"EVENTS",function(){return G.default});var $=e("./version.js");e.d(n,"version",function(){return $.default});var Q=e("./importInternal.js");e.d(n,"importInternal",function(){return Q.default}),e.d(n,"import",function(){return Q.default});var re={AngleTool:a.AngleTool,ArrowAnnotateTool:a.ArrowAnnotateTool,BidirectionalTool:a.BidirectionalTool,CircleRoiTool:a.CircleRoiTool,CobbAngleTool:a.CobbAngleTool,EllipticalRoiTool:a.EllipticalRoiTool,FreehandRoiTool:a.FreehandRoiTool,LengthTool:a.LengthTool,ProbeTool:a.ProbeTool,RectangleRoiTool:a.RectangleRoiTool,TextMarkerTool:a.TextMarkerTool,BrushTool:f.BrushTool,SphericalBrushTool:f.SphericalBrushTool,RectangleScissorsTool:f.RectangleScissorsTool,FreehandScissorsTool:f.FreehandScissorsTool,CircleScissorsTool:f.CircleScissorsTool,CorrectionScissorsTool:f.CorrectionScissorsTool,CrosshairsTool:d.CrosshairsTool,DoubleTapFitToWindowTool:d.DoubleTapFitToWindowTool,DragProbeTool:d.DragProbeTool,EraserTool:d.EraserTool,FreehandRoiSculptorTool:d.FreehandRoiSculptorTool,MagnifyTool:d.MagnifyTool,OverlayTool:d.OverlayTool,OrientationMarkersTool:d.OrientationMarkersTool,PanMultiTouchTool:d.PanMultiTouchTool,PanTool:d.PanTool,ReferenceLinesTool:d.ReferenceLinesTool,RotateTool:d.RotateTool,RotateTouchTool:d.RotateTouchTool,ScaleOverlayTool:d.ScaleOverlayTool,StackScrollMouseWheelTool:d.StackScrollMouseWheelTool,StackScrollMultiTouchTool:d.StackScrollMultiTouchTool,StackScrollTool:d.StackScrollTool,WwwcRegionTool:d.WwwcRegionTool,WwwcTool:d.WwwcTool,ZoomMouseWheelTool:d.ZoomMouseWheelTool,ZoomTool:d.ZoomTool,ZoomTouchPinchTool:d.ZoomTouchPinchTool,init:l.default,stackPrefetch:o.default,stackRenderers:t.default,playClip:r.playClip,stopClip:r.stopClip,store:s.default,getModule:s.getModule,getToolForElement:i.default,addTool:u.addTool,addToolForElement:u.addToolForElement,removeTool:c.removeTool,removeToolForElement:c.removeToolForElement,setToolOptions:h.setToolOptions,setToolOptionsForElement:h.setToolOptionsForElement,isToolActiveForElement:v.default,setToolActive:g.setToolActive,setToolActiveForElement:g.setToolActiveForElement,setToolEnabled:g.setToolEnabled,setToolEnabledForElement:g.setToolEnabledForElement,setToolDisabled:g.setToolDisabled,setToolDisabledForElement:g.setToolDisabledForElement,setToolPassive:g.setToolPassive,setToolPassiveForElement:g.setToolPassiveForElement,addToolState:m.addToolState,getToolState:m.getToolState,removeToolState:m.removeToolState,clearToolState:m.clearToolState,setElementToolStateManager:m.setElementToolStateManager,getElementToolStateManager:m.getElementToolStateManager,textStyle:E.default,toolStyle:T.default,toolColors:O.default,toolCoordinates:M.default,stackSpecificStateManager:P.stackSpecificStateManager,newStackSpecificToolStateManager:P.newStackSpecificToolStateManager,addStackStateManager:P.addStackStateManager,loadHandlerManager:C.default,newImageIdSpecificToolStateManager:_.newImageIdSpecificToolStateManager,globalImageIdSpecificToolStateManager:_.globalImageIdSpecificToolStateManager,newFrameOfReferenceSpecificToolStateManager:D.newFrameOfReferenceSpecificToolStateManager,globalFrameOfReferenceSpecificToolStateManager:D.globalFrameOfReferenceSpecificToolStateManager,forceEnabledElementResize:I.forceEnabledElementResize,orientation:y.default,SaveAs:R.default,enableLogger:b.enable,disableLogger:b.disable,importInternal:Q.default,import:Q.default,register:z.default,registerSome:H.default,wwwcSynchronizer:B.default,updateImageSynchronizer:p.default,Synchronizer:A.default,stackScrollSynchronizer:j.default,stackImagePositionSynchronizer:x.default,stackImagePositionOffsetSynchronizer:L.default,stackImageIndexSynchronizer:U.default,panZoomSynchronizer:S.default,external:w.default,EVENTS:G.default,version:$.default};n.default=re},"./init.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./store/index.js"),d=e("./store/internals/addEnabledElement.js"),l=e("./store/internals/removeEnabledElement.js"),o=e("./eventListeners/windowResizeHandler.js");n.default=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t(),s();var u=Object(f.getModule)("globalConfiguration");Array.isArray(i)?i.forEach(function(c){var h=c.moduleName,g=c.configuration,v=Object(f.getModule)(h);v&&(v.configuration=Object.assign({},v.configuration,g))}):u.configuration=Object.assign({},u.configuration,i),u.configuration.autoResizeViewports&&o.default.enable()};function t(){r();var i=a.default.cornerstone,u=i.EVENTS.ELEMENT_ENABLED,c=i.EVENTS.ELEMENT_DISABLED;i.events.addEventListener(u,d.default),i.events.addEventListener(c,l.default)}function r(){var i=a.default.cornerstone,u=i.EVENTS.ELEMENT_ENABLED,c=i.EVENTS.ELEMENT_DISABLED;i.events.removeEventListener(u,d.default),i.events.removeEventListener(c,l.default)}function s(){var i=f.default.modules;Object.keys(i).forEach(function(u){typeof i[u].onRegisterCallback=="function"&&i[u].onRegisterCallback()})}},"./lib.js":function(W,n,e){e.r(n),e.d(n,"lib",function(){return ve});var a=e("./tools/base/BaseTool.js"),f=e("./tools/base/BaseAnnotationTool.js"),d=e("./tools/base/BaseBrushTool.js"),l=e("./manipulators/index.js"),o=e("./util/findAndMoveHelpers.js"),t=e("./mixins/index.js"),r=e("./tools/cursors/index.js"),s=e("./drawing/index.js"),i=e("./util/clip.js"),u=e("./util/debounce.js"),c=e("./util/deepmerge.js"),h=e("./util/getDefault.js"),g=e("./util/getPixelSpacing.js"),v=e("./util/isEmptyObject.js"),m=e("./util/isObject.js"),E=e("./util/isPointInImage.js"),T=e("./util/isPointInPolygon.js"),O=e("./util/throttle.js"),M=e("./util/wait.js"),P=e("./util/getKeyPressData.js"),C=e("./util/getProximityThreshold.js"),_=e("./drawing/drawTextBox.js"),D=e("./drawing/drawArrow.js"),I=e("./drawing/drawLink.js"),y=e("./drawing/drawLinkedTextBox.js"),R=e("./drawing/drawHandles.js"),b=e("./util/getActiveTool.js"),z=e("./util/getLuminance.js"),H=e("./util/getROITextBoxCoords.js"),B=e("./util/copyPoints.js"),p=e("./util/calculateSUV.js"),A=e("./util/setContextToDisplayFontSize.js"),j=e("./util/scrollToIndex.js"),x=e("./util/scroll.js"),L=e("./util/roundToDecimal.js"),U=e("./util/pointProjector.js"),S=e("./util/lineSegDistance.js"),w=e("./util/logger.js"),G=e("./util/pointInsideBoundingBox.js"),$=e("./util/makeUnselectable.js"),Q=e("./util/getRGBPixels.js"),re=e("./util/getMaxSimultaneousRequests.js"),le=e("./util/angleBetweenPoints.js"),de=e("./util/numbersWithCommas.js"),me=e("./tools/cursors/MouseCursor.js"),Y=e("./util/ellipse/index.js"),V=e("./util/freehand/index.js"),te=e("./util/segmentation/index.js"),ne=e("./util/zoom/index.js"),ue=e("./util/triggerEvent.js"),ge=e("./util/convertToVector3.js"),ve={"base/BaseTool":a.default,"base/BaseAnnotationTool":f.default,"base/BaseBrushTool":d.default,"tools/cursors/MouseCursor":me.default,"tools/cursors":r,"manipulators/anyHandlesOutsideImage":l.anyHandlesOutsideImage,"manipulators/getHandleNearImagePoint":l.getHandleNearImagePoint,"manipulators/getHandlePixelPosition":l.getHandlePixelPosition,"manipulators/handleActivator":l.handleActivator,"manipulators/moveAllHandles":l.moveAllHandles,"manipulators/moveHandle":l.moveHandle,"manipulators/moveNewHandle":l.moveNewHandle,"manipulators/moveHandleNearImagePoint":o.moveHandleNearImagePoint,"manipulators/findHandleDataNearImagePoint":o.findHandleDataNearImagePoint,"manipulators/moveAnnotation":o.moveAnnotation,"mixins/activeOrDisabledBinaryTool":t.default.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":t.default.enabledOrDisabledBinaryTool,"drawing/getNewContext":s.getNewContext,"drawing/draw":s.draw,"drawing/path":s.path,"drawing/setShadow":s.setShadow,"drawing/drawLine":s.drawLine,"drawing/drawLines":s.drawLines,"drawing/drawJoinedLines":s.drawJoinedLines,"drawing/drawCircle":s.drawCircle,"drawing/drawEllipse":s.drawEllipse,"drawing/drawRect":s.drawRect,"drawing/fillOutsideRect":s.fillOutsideRect,"drawing/drawTextBox":_.default,"drawing/drawArrow":D.default,"drawing/fillBox":s.fillBox,"drawing/fillTextLines":s.fillTextLines,"drawing/drawLink":I.default,"drawing/drawLinkedTextBox":y.default,"drawing/drawHandles":R.default,"drawing/textBoxWidth":_.textBoxWidth,"util/getActiveTool":b.default,"util/getLuminance":z.default,"util/getROITextBoxCoords":H.default,"util/copyPoints":B.default,"util/calculateSUV":p.default,"util/setContextToDisplayFontSize":A.default,"util/scrollToIndex":j.default,"util/scroll":x.default,"util/roundToDecimal":L.default,"util/projectPatientPointToImagePlane":U.projectPatientPointToImagePlane,"util/imagePointToPatientPoint":U.imagePointToPatientPoint,"util/planePlaneIntersection":U.planePlaneIntersection,"util/pointInsideBoundingBox":G.default,"util/makeUnselectable":$.default,"util/getRGBPixels":Q.default,"util/getBrowserInfo":re.getBrowserInfo,"util/isMobileDevice":re.isMobileDevice,"util/angleBetweenPoints":le.default,"util/numbersWithCommas":de.default,"util/lineSegDistance":S.default,"util/triggerEvent":ue.default,"util/convertToVector3":ge.default,"util/clip":i.clip,"util/clipToBox":i.clipToBox,"util/clipBoxToDisplayedArea":i.clipBoxToDisplayedArea,"util/debounce":u.default,"util/deepmerge":c.default,"util/getDefault":h.default,"util/getProximityThreshold":C.default,"util/getPixelSpacing":g.default,"util/isEmptyObject":v.default,"util/isObject":m.default,"util/isPointInImage":E.default,"util/isPointInPolygon":T.default,"util/getLogger":w.getLogger,"util/throttle":O.default,"util/wait":M.wait,"util/waitForEnabledElementImageToLoad":M.waitForEnabledElementImageToLoad,"util/getKeyPressData":P.default,"util/ellipseUtils":Y.default,"util/freehandUtils":V.default,"util/segmentationUtils":te,"util/zoomUtils":ne.default}},"./manipulators/anyHandlesOutsideImage.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(f,d){var l=f.image,o={left:0,top:0,width:l.width,height:l.height},t=!1;return Object.keys(d).forEach(function(r){var s=d[r];s.allowedOutsideImage!==!0&&a.default.cornerstoneMath.point.insideRect(s,o)===!1&&(t=!0)}),t}},"./manipulators/getHandleNearImagePoint.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/typeof.js"),f=e.n(a),d=e("./externalModules.js"),l=e("./util/pointInsideBoundingBox.js"),o=function r(s,i,u,c){var h;if(i){if(Array.isArray(i))for(var g=Object.keys(i),v=0;v<g.length;v++){var m=g[v],E=i[m];if(!(!E.hasOwnProperty("x")||!E.hasOwnProperty("y"))&&t(E,s,u,c)){h=E;break}}else if(f()(i)==="object")for(var T=Object.keys(i),O=0;O<T.length;O++){var M=T[O];if(Array.isArray(i[M])){if(h=r(s,i[M],u,c),h)break}else{var P=i[M];if(t(P,s,u,c)){h=P;break}}}return h}},t=function(s,i,u,c){if(s.hasOwnProperty("pointNearHandle")){if(s.pointNearHandle(i,s,u))return!0}else if(s.hasBoundingBox===!0){if(Object(l.default)(s,u))return!0}else{var h=d.default.cornerstone.pixelToCanvas(i,s),g=d.default.cornerstoneMath.point.distance(h,u);if(g<=c)return!0}return!1};n.default=o},"./manipulators/getHandlePixelPosition.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./store/index.js");n.default=function(d,l){var o=d.currentPoints,t=d.element,r=o.page,s=f.state.handleTouchOffset,i=0,u=0;return l==="touch"&&(i=s.x,u=s.y),a.default.cornerstone.pageToPixel(t,r.x+i,r.y+u)}},"./manipulators/handleActivator.js":function(W,n,e){e.r(n);var a=e("./manipulators/getHandleNearImagePoint.js");n.default=function(d,l,o,t){t||(t=6);var r=f(l),s=Object(a.default)(d,l,o,t);return r!==s?(s!==void 0&&(s.active=!0),r!==void 0&&(r.active=!1),!0):!1};function f(d){var l;return Object.keys(d).forEach(function(o){var t=d[o];if(t.active===!0){l=t;return}}),l}},"./manipulators/index.js":function(W,n,e){e.r(n);var a=e("./manipulators/anyHandlesOutsideImage.js");e.d(n,"anyHandlesOutsideImage",function(){return a.default});var f=e("./manipulators/getHandleNearImagePoint.js");e.d(n,"getHandleNearImagePoint",function(){return f.default});var d=e("./manipulators/getHandlePixelPosition.js");e.d(n,"getHandlePixelPosition",function(){return d.default});var l=e("./manipulators/handleActivator.js");e.d(n,"handleActivator",function(){return l.default});var o=e("./manipulators/moveAllHandles.js");e.d(n,"moveAllHandles",function(){return o.default});var t=e("./manipulators/moveHandle.js");e.d(n,"moveHandle",function(){return t.default});var r=e("./manipulators/moveNewHandle.js");e.d(n,"moveNewHandle",function(){return r.default})},"./manipulators/moveAllHandles.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./externalModules.js"),d=e("./manipulators/anyHandlesOutsideImage.js"),l=e("./stateManagement/toolState.js"),o=e("./util/triggerEvent.js"),t=e("./util/clip.js"),r=e("./store/index.js"),s=e("./util/getActiveTool.js"),i=e("./tools/base/BaseAnnotationTool.js"),u=e("./util/logger.js"),c=Object(u.getLogger)("manipulators:moveAllHandles"),h=Object(r.getModule)("manipulatorState"),g={mouse:[a.default.MOUSE_DRAG],touch:[a.default.TOUCH_DRAG]},v={mouse:[a.default.MOUSE_UP,a.default.MOUSE_CLICK],touch:[a.default.TOUCH_END,a.default.TOUCH_DRAG_END,a.default.TOUCH_PINCH,a.default.TOUCH_PRESS,a.default.TAP]};n.default=function(M,P,C,_){var D=M.element,I=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},y=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"mouse",R=arguments.length>6?arguments[6]:void 0;I=Object.assign({deleteIfHandleOutsideImage:r.state.deleteIfHandleOutsideImage,preventHandleOutsideImage:r.state.preventHandleOutsideImage},I);var b=m.bind(this,P,C,I,y),z=function H(B){T(P,C,I,y,{dragHandler:b,upOrEndHandler:H},B,R)};h.setters.addActiveManipulatorForElement(D,E.bind(null,C,I,y,{dragHandler:b,upOrEndHandler:z},D,R)),C.active=!0,r.state.isToolLocked=!0,g[y].forEach(function(H){D.addEventListener(H,b)}),v[y].forEach(function(H){D.addEventListener(H,z)})};function m(M,P){var C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},_=arguments.length>3?arguments[3]:void 0,D=arguments.length>4?arguments[4]:void 0,I=D.detail,y=I.element,R=I.image,b=I.buttons,z=D.detail.deltaPoints.image,H=z.x,B=z.y;P.active=!0,P.invalidated=!0;for(var p=Object.keys(P.handles),A=0;A<p.length;A++){var j=p[A],x=P.handles[j];x.movesIndependently===!0||!x.hasOwnProperty("x")||!x.hasOwnProperty("y")||(x.x+=H,x.y+=B,C.preventHandleOutsideImage&&Object(t.clipToBox)(x,R))}f.default.cornerstone.updateImage(y);var L=Object(s.default)(y,b,_);L instanceof i.default&&L.updateCachedStats(R,y,P);var U=a.default.MEASUREMENT_MODIFIED,S={toolName:M,toolType:M,element:y,measurementData:P};Object(o.default)(y,U,S),D.preventDefault(),D.stopPropagation()}function E(M){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0,_=arguments.length>3?arguments[3]:void 0,D=_.dragHandler,I=_.upOrEndHandler,y=arguments.length>4?arguments[4]:void 0,R=arguments.length>5?arguments[5]:void 0;O(M,P,C,{dragHandler:D,upOrEndHandler:I},y,R,!1)}function T(M,P){var C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},_=arguments.length>3?arguments[3]:void 0,D=arguments.length>4?arguments[4]:void 0,I=D.dragHandler,y=D.upOrEndHandler,R=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0,z=R.detail,H=z.element;h.setters.removeActiveManipulatorForElement(H),C.deleteIfHandleOutsideImage&&Object(d.default)(z,P.handles)&&Object(l.removeToolState)(H,M,P),O(P,C,_,{dragHandler:I,upOrEndHandler:y},H,b,!0)}function O(M){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0,_=arguments.length>3?arguments[3]:void 0,D=_.dragHandler,I=_.upOrEndHandler,y=arguments.length>4?arguments[4]:void 0,R=arguments.length>5?arguments[5]:void 0,b=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;M.active=!1,M.invalidated=!0,r.state.isToolLocked=!1,g[C].forEach(function(z){y.removeEventListener(z,D)}),v[C].forEach(function(z){y.removeEventListener(z,I)}),typeof P.doneMovingCallback=="function"&&(c.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),P.doneMovingCallback(b)),typeof R=="function"&&R(b),f.default.cornerstone.updateImage(y)}},"./manipulators/moveHandle.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./externalModules.js"),d=e("./manipulators/anyHandlesOutsideImage.js"),l=e("./manipulators/getHandlePixelPosition.js"),o=e("./stateManagement/toolState.js"),t=e("./util/triggerEvent.js"),r=e("./util/clip.js"),s=e("./store/index.js"),i=e("./util/getActiveTool.js"),u=e("./tools/base/BaseAnnotationTool.js"),c=e("./util/logger.js"),h=Object(c.getLogger)("manipulators:moveHandle"),g=Object(s.getModule)("manipulatorState"),v={value:!1},m={mouse:[a.default.MOUSE_DRAG],touch:[a.default.TOUCH_DRAG]},E={mouse:[a.default.MOUSE_UP,a.default.MOUSE_CLICK],touch:[a.default.TOUCH_END,a.default.TOUCH_DRAG_END,a.default.TOUCH_PINCH,a.default.TOUCH_PRESS,a.default.TAP]};n.default=function(_,D,I,y){var R=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},b=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"mouse",z=arguments.length>6?arguments[6]:void 0;R=Object.assign({deleteIfHandleOutsideImage:s.state.deleteIfHandleOutsideImage,preventHandleOutsideImage:s.state.preventHandleOutsideImage},R);var H=_.element,B=T.bind(this,D,I,y,R,b),p=function x(){M(D,_,I,y,R,b,{dragHandler:B,upOrEndHandler:x},z)};if(g.setters.addActiveManipulatorForElement(H,O.bind(null,D,_,I,y,R,b,{dragHandler:B,upOrEndHandler:p},z)),y.active=!0,y.moving=!0,I.active=!0,s.state.isToolLocked=!0,m[b].forEach(function(x){H.addEventListener(x,B)}),E[b].forEach(function(x){H.addEventListener(x,p)}),b==="touch"){v.value=!0;var A=f.default.cornerstone.getEnabledElement(H),j=Object(l.default)(_,b);C(y,v,A,j)}};function T(_,D,I,y,R,b){var z=b.detail,H=z.image,B=z.element,p=z.buttons,A=Object(l.default)(b.detail,R);v.value=!1,I.active=!0,I.hasMoved=!0,I.x=A.x,I.y=A.y,D.invalidated=!0,y.preventHandleOutsideImage&&Object(r.clipToBox)(I,H),f.default.cornerstone.updateImage(B);var j=Object(i.default)(B,p,R);j instanceof u.default&&j.updateCachedStats(H,B,D);var x=a.default.MEASUREMENT_MODIFIED,L={toolName:_,toolType:_,element:B,measurementData:D};Object(t.default)(B,x,L)}function O(_,D,I,y){var R=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},b=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,H=z.dragHandler,B=z.upOrEndHandler,p=arguments.length>7?arguments[7]:void 0;P(_,D,I,y,R,b,{dragHandler:H,upOrEndHandler:B},p,!1)}function M(_,D,I,y){var R=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},b=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,H=z.dragHandler,B=z.upOrEndHandler,p=arguments.length>7?arguments[7]:void 0,A=D.element;g.setters.removeActiveManipulatorForElement(A),P(_,D,I,y,R,b,{dragHandler:H,upOrEndHandler:B},p,!0)}function P(_,D,I,y){var R=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},b=arguments.length>5?arguments[5]:void 0,z=arguments.length>6?arguments[6]:void 0,H=z.dragHandler,B=z.upOrEndHandler,p=arguments.length>7?arguments[7]:void 0,A=arguments.length>8&&arguments[8]!==void 0?arguments[8]:!0,j=D.element;y.active=!1,y.moving=!1,I.active=!1,I.invalidated=!0,v.value=!1,s.state.isToolLocked=!1,m[b].forEach(function(x){j.removeEventListener(x,H)}),E[b].forEach(function(x){j.removeEventListener(x,B)}),R.deleteIfHandleOutsideImage&&Object(d.default)(D,I.handles)&&Object(o.removeToolState)(j,_,I),typeof R.doneMovingCallback=="function"&&(h.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),R.doneMovingCallback(A)),typeof p=="function"&&p(A),f.default.cornerstone.updateImage(j)}function C(_,D,I,y){if(D.value){var R=Math.abs(_.y-y.y),b=R/10;if(R<1){_.y=y.y,D.value=!1;return}_.y>y.y?_.y-=b:_.y<y.y&&(_.y+=b),f.default.cornerstone.updateImage(I.element),f.default.cornerstone.requestAnimationFrame(function(){C(_,D,I,y)})}}},"./manipulators/moveNewHandle.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./externalModules.js"),d=e("./manipulators/anyHandlesOutsideImage.js"),l=e("./manipulators/getHandlePixelPosition.js"),o=e("./stateManagement/toolState.js"),t=e("./util/triggerEvent.js"),r=e("./util/clip.js"),s=e("./store/index.js"),i=e("./util/getActiveTool.js"),u=e("./tools/base/BaseAnnotationTool.js"),c=e("./util/logger.js"),h=Object(c.getLogger)("manipulators:moveNewHandle"),g=Object(s.getModule)("manipulatorState"),v={mouse:[a.default.MOUSE_MOVE,a.default.MOUSE_DRAG],touch:[a.default.TOUCH_DRAG]},m={mouse:[a.default.MOUSE_UP,a.default.MOUSE_CLICK],touch:[a.default.TOUCH_END,a.default.TOUCH_PINCH,a.default.TAP]};n.default=function(C,_,D,I,y){var R=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"mouse",b=arguments.length>6?arguments[6]:void 0;y=Object.assign({deleteIfHandleOutsideImage:s.state.deleteIfHandleOutsideImage,preventHandleOutsideImage:s.state.preventHandleOutsideImage},y),y.hasMoved=!1;var z=C.element;D.active=!0,I.moving=!0,I.active=!0,s.state.isToolLocked=!0;function H(p){E(_,D,I,y,R,p)}function B(p){O(_,D,I,y,R,{moveHandler:H,moveEndHandler:B},p,b)}v[R].forEach(function(p){z.addEventListener(p,H)}),z.addEventListener(a.default.TOUCH_START,P),m[R].forEach(function(p){z.addEventListener(p,B)}),g.setters.addActiveManipulatorForElement(z,M.bind(null,D,I,y,R,{moveHandler:H,moveEndHandler:B},z,b))};function E(C,_,D,I,y,R){var b=R.detail,z=b.image,H=b.element,B=b.buttons,p=Object(l.default)(R.detail,y);I.hasMoved=!0,_.invalidated=!0,D.active=!0,D.x=p.x,D.y=p.y,I&&I.preventHandleOutsideImage&&Object(r.clipToBox)(D,z),f.default.cornerstone.updateImage(H);var A=Object(i.default)(H,B,y);A instanceof u.default&&A.updateCachedStats(z,H,_);var j=a.default.MEASUREMENT_MODIFIED,x={toolName:C,toolType:C,element:H,measurementData:_};Object(t.default)(H,j,x)}function T(C,_,D,I,y){var R=I.moveHandler,b=I.moveEndHandler,z=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;v[C].forEach(function(H){D.removeEventListener(H,R)}),m[C].forEach(function(H){D.removeEventListener(H,b)}),D.removeEventListener(a.default.TOUCH_START,P),s.state.isToolLocked=!1,typeof y=="function"&&y(z),typeof _.doneMovingCallback=="function"&&(h.warn("`options.doneMovingCallback` has been depricated. See https://github.com/cornerstonejs/cornerstoneTools/pull/915 for details."),_.doneMovingCallback(z)),f.default.cornerstone.updateImage(D)}function O(C,_,D,I,y,R,b,z){var H=R.moveHandler,B=R.moveEndHandler,p=b.detail,A=p.element,j=!0;if(I.hasMoved!==!1){var x=Object(l.default)(p,y);_.active=!1,_.invalidated=!0,D.active=!1,D.moving=!1,D.x=x.x,D.y=x.y,g.setters.removeActiveManipulatorForElement(A),I.preventHandleOutsideImage&&Object(r.clipToBox)(D,b.detail.image),I.deleteIfHandleOutsideImage&&Object(d.default)(b.detail,_.handles)&&(_.cancelled=!0,j=!1,Object(o.removeToolState)(A,C,_)),T(y,I,A,{moveHandler:H,moveEndHandler:B},z,j)}}function M(C,_,D,I,y,R,b){var z=y.moveHandler,H=y.moveEndHandler;C.active=!1,C.invalidated=!0,_.active=!1,T(I,D,R,{moveHandler:z,moveEndHandler:H},b,!1)}function P(C){return C.stopImmediatePropagation(),!1}},"./mixins/activeOrDisabledBinaryTool.js":function(W,n,e){e.r(n);var a=e("./store/setToolMode.js");function f(l){Object(a.setToolDisabledForElement)(l,this.name)}function d(l){Object(a.setToolActiveForElement)(l,this.name)}n.default={passiveCallback:f,enabledCallback:d}},"./mixins/enabledOrDisabledBinaryTool.js":function(W,n,e){e.r(n);var a=e("./store/setToolMode.js");function f(l){Object(a.setToolDisabledForElement)(l,this.name)}function d(l){Object(a.setToolEnabledForElement)(l,this.name)}n.default={passiveCallback:f,activeCallback:d}},"./mixins/index.js":function(W,n,e){e.r(n);var a=e("./mixins/activeOrDisabledBinaryTool.js"),f=e("./mixins/enabledOrDisabledBinaryTool.js"),d=e("./mixins/segmentation/circleSegmentationMixin.js"),l=e("./mixins/segmentation/polylineSegmentationMixin.js"),o=e("./mixins/segmentation/freehandSegmentationMixin.js"),t=e("./mixins/segmentation/rectangleSegmentationMixin.js"),r=e("./mixins/segmentation/renderBrushMixin.js");n.default={activeOrDisabledBinaryTool:a.default,enabledOrDisabledBinaryTool:f.default,circleSegmentationMixin:d.default,polylineSegmentationMixin:l.default,freehandSegmentationMixin:o.default,rectangleSegmentationMixin:t.default,renderBrushMixin:r.default}},"./mixins/segmentation/circleSegmentationMixin.js":function(W,n,e){e.r(n);var a=e("./drawing/index.js"),f=e("./externalModules.js"),d=e("./util/isEmptyObject.js"),l=e("./store/index.js"),o=e("./util/segmentation/index.js"),t=Object(l.getModule)("segmentation"),r=t.getters,s=t.setters;function i(){this.handles={start:{},end:{}}}function u(v){var m=this,E=v.detail,T=E.element,O=r.brushColor(T,!0),M=Object(a.getNewContext)(E.canvasContext.canvas),P=f.default.cornerstoneMath.point.distance;Object(a.draw)(M,function(C){if(!m.handles)return null;var _=f.default.cornerstone.pixelToCanvas(T,m.handles.start),D=f.default.cornerstone.pixelToCanvas(T,m.handles.end),I=P(_,D);Object(a.drawCircle)(C,T,m.handles.start,I,{color:O})})}function c(v){var m=!0,E=v.detail.element,T=v.detail.currentPoints.image;return Object(d.default)(this.handles.start)?this.handles.start=T:(this.handles.end=T,this._applyStrategy(v)),f.default.cornerstone.updateImage(E),m}function h(v){var m=v.detail,E=m.element,T=m.currentPoints,O=T.image;this.handles.end=O,f.default.cornerstone.updateImage(E)}function g(v){v.detail.handles=this.handles;var m=v.detail.element,E=r.labelmap2D(m),T=E.labelmap2D,O=E.labelmap3D,M=E.currentImageIdIndex,P=T.pixelData,C=P.slice(),_={start:{x:this.handles.start.x,y:this.handles.start.y},end:{x:this.handles.end.x,y:this.handles.end.y}},D={points:_,pixelData:P,segmentIndex:O.activeSegmentIndex,segmentationMixinType:"circleSegmentationMixin"};this.applyActiveStrategy(v,D);var I={imageIdIndex:M,diff:Object(o.getDiffBetweenPixelData)(C,P)};s.pushState(this.element,[I]),s.updateSegmentsOnLabelmap2D(T),f.default.cornerstone.updateImage(m),this._resetHandles()}n.default={postTouchStartCallback:c,postMouseDownCallback:c,mouseClickCallback:c,touchDragCallback:h,mouseDragCallback:h,mouseMoveCallback:h,touchEndCallback:g,mouseUpCallback:g,initializeMixin:i,renderToolData:u,_resetHandles:i,_applyStrategy:g}},"./mixins/segmentation/freehandSegmentationMixin.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a),d=e("./externalModules.js"),l=e("./store/index.js"),o=e("./util/logger.js"),t=e("./drawing/index.js"),r=e("./util/segmentation/index.js"),s=Object(o.getLogger)("tools:ScissorsTool"),i=Object(l.getModule)("segmentation"),u=i.getters,c=i.setters;function h(O){var M=O.detail,P=M.element,C=u.brushColor(P,!0),_=Object(t.getNewContext)(M.canvasContext.canvas),D=this.handles.points;D.length<2||Object(t.draw)(_,function(I){for(var y=0;y<D.length;y++){var R=f()(D[y].lines);y===D.length-1&&R.push(D[0]),Object(t.drawJoinedLines)(I,P,D[y],R,{color:C})}})}function g(O){var M=O.detail.element,P=O.detail.currentPoints.image,C=this.handles.points;if(!C.length)return s.warn("Something went wrong, empty handles detected."),null;C.push({x:P.x,y:P.y,lines:[]}),this.currentHandle+=1,d.default.cornerstone.updateImage(M)}function v(O){var M=O.detail,P=O.detail.element;this._addPoint(M),d.default.cornerstone.updateImage(P)}function m(O){var M=this.handles.points,P=O.detail.element,C=u.labelmap2D(P),_=C.labelmap2D,D=C.labelmap3D,I=C.currentImageIdIndex,y=_.pixelData,R=y.slice(),b={points:M,pixelData:y,segmentIndex:D.activeSegmentIndex,segmentationMixinType:"freehandSegmentationMixin"};this.applyActiveStrategy(O,b);var z={imageIdIndex:I,diff:Object(r.getDiffBetweenPixelData)(R,y)};c.pushState(this.element,[z]),c.updateSegmentsOnLabelmap2D(_),d.default.cornerstone.updateImage(P),this._resetHandles()}function E(){this.handles={points:[]},this.currentHandle=0}function T(O){var M=this.handles.points;M.length&&M[this.currentHandle-1].lines.push({x:O.currentPoints.image.x,y:O.currentPoints.image.y,lines:[]}),M.push({x:O.currentPoints.image.x,y:O.currentPoints.image.y,lines:[]}),this.currentHandle+=1,d.default.cornerstone.updateImage(O.element)}n.default={postTouchStartCallback:g,postMouseDownCallback:g,mouseClickCallback:g,touchDragCallback:v,mouseDragCallback:v,mouseMoveCallback:v,touchEndCallback:m,mouseUpCallback:m,initializeMixin:E,renderToolData:h,_resetHandles:E,_addPoint:T,_applyStrategy:m}},"./mixins/segmentation/polylineSegmentationMixin.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a),d=e("./drawing/index.js"),l=e("./store/index.js"),o=e("./mixins/segmentation/freehandSegmentationMixin.js"),t=Object(l.getModule)("segmentation"),r=t.getters;function s(u){var c=this,h=u.detail,g=h.element,v=r.brushColor(g,!0),m=Object(d.getNewContext)(h.canvasContext.canvas),E=this.handles;Object(d.draw)(m,function(T){var O=E.points.length>1;if(O)for(var M=0;M<E.points.length;M++){var P=f()(E.points[M].lines);Object(d.drawJoinedLines)(T,g,c.handles.points[M],P,{color:v})}})}var i=Object.assign({},o.default,{renderToolData:s});n.default=i},"./mixins/segmentation/rectangleSegmentationMixin.js":function(W,n,e){e.r(n);var a=e("./drawing/index.js"),f=e("./externalModules.js"),d=e("./util/isEmptyObject.js"),l=e("./store/index.js"),o=e("./util/segmentation/index.js"),t=Object(l.getModule)("segmentation"),r=t.getters,s=t.setters;function i(v){var m=this,E=v.detail,T=E.element,O=r.brushColor(T,!0),M=Object(a.getNewContext)(E.canvasContext.canvas);Object(a.draw)(M,function(P){Object(a.drawRect)(P,T,m.handles.start,m.handles.end,{color:O})})}function u(v){var m=!0,E=v.detail.element,T=v.detail.currentPoints.image;return Object(d.default)(this.handles.start)?this.handles.start=T:(this.handles.end=T,this._applyStrategy(v)),f.default.cornerstone.updateImage(E),m}function c(v){var m=v.detail,E=m.element,T=m.currentPoints.image;this.handles.end=T,f.default.cornerstone.updateImage(E)}function h(v){v.detail.handles=this.handles;var m=v.detail.element,E=r.labelmap2D(m),T=E.labelmap2D,O=E.labelmap3D,M=E.currentImageIdIndex,P=T.pixelData,C=P.slice(),_=[{x:this.handles.start.x,y:this.handles.start.y},{x:this.handles.end.x,y:this.handles.end.y}],D={points:_,pixelData:P,segmentIndex:O.activeSegmentIndex,segmentationMixinType:"rectangleSegmentationMixin"};this.applyActiveStrategy(v,D);var I={imageIdIndex:M,diff:Object(o.getDiffBetweenPixelData)(C,P)};s.pushState(this.element,[I]),s.updateSegmentsOnLabelmap2D(T),f.default.cornerstone.updateImage(m),this._resetHandles()}function g(){this.handles={start:{},end:{}}}n.default={postTouchStartCallback:u,postMouseDownCallback:u,mouseClickCallback:u,touchDragCallback:c,mouseDragCallback:c,mouseMoveCallback:c,touchEndCallback:h,mouseUpCallback:h,initializeMixin:g,renderToolData:i,_resetHandles:g,_applyStrategy:h}},"./mixins/segmentation/renderBrushMixin.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./store/index.js");function d(l){var o=a.default.cornerstone,t=Object(f.getModule)("segmentation"),r=t.getters,s=t.configuration,i=l.detail,u=i.viewport,c;if(this._drawing?c=this._lastImageCoords:this._mouseUpRender?(c=this._lastImageCoords,this._mouseUpRender=!1):c=f.default.state.mousePositionImage,!!c){var h=i.image,g=h.rows,v=h.columns,m=c,E=m.x,T=m.y;if(!(E<0||E>v||T<0||T>g)){var O=s.radius,M=i.canvasContext,P=i.element,C=r.brushColor(P,this._drawing);M.setTransform(1,0,0,1,0,0);var _=O*u.scale,D=o.pixelToCanvas(P,c);M.beginPath(),M.strokeStyle=C,M.ellipse(D.x,D.y,_,_,0,0,2*Math.PI),M.stroke()}}}n.default={renderBrush:d}},"./orientation/getOrientationString.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./util/convertToVector3.js");n.default=function(d){for(var l=Object(f.default)(d),o="",t=l.x<0?"R":"L",r=l.y<0?"A":"P",s=l.z<0?"F":"H",i=new a.default.cornerstoneMath.Vector3(Math.abs(l.x),Math.abs(l.y),Math.abs(l.z)),u=1e-4,c=0;c<3;c++)if(i.x>u&&i.x>i.y&&i.x>i.z)o+=t,i.x=0;else if(i.y>u&&i.y>i.x&&i.y>i.z)o+=r,i.y=0;else if(i.z>u&&i.z>i.x&&i.z>i.y)o+=s,i.z=0;else if(i.x>u&&i.y>u&&i.x===i.y)o+=t+r,i.x=0,i.y=0;else if(i.x>u&&i.z>u&&i.x===i.z)o+=t+s,i.x=0,i.z=0;else if(i.y>u&&i.z>u&&i.y===i.z)o+=r+s,i.y=0,i.z=0;else break;return o}},"./orientation/index.js":function(W,n,e){e.r(n);var a=e("./orientation/getOrientationString.js"),f=e("./orientation/invertOrientationString.js"),d={getOrientationString:a.default,invertOrientationString:f.default};n.default=d},"./orientation/invertOrientationString.js":function(W,n,e){e.r(n),n.default=function(a){var f=a.replace("H","f");return f=f.replace("F","h"),f=f.replace("R","l"),f=f.replace("L","r"),f=f.replace("A","p"),f=f.replace("P","a"),f=f.toUpperCase(),f}},"./stackTools/fusionRenderer.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return r});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("./externalModules.js"),t=e("./stateManagement/toolState.js"),r=function(){function s(){f()(this,s),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return l()(s,[{key:"render",value:function(u,c){var h=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");if(!c){var g=Object(t.getToolState)(u,"stack");c=g.data}var v=o.default.cornerstone,m=c[0],E=m.imageIds[this.currentImageIdIndex],T=c.slice(1,c.length);v.loadAndCacheImage(E).then(function(O){var M=h.layerIds[0];M?v.setLayerImage(u,O,M):(M=v.addLayer(u,O,m.options),h.layerIds.push(M)),v.displayImage(u,O),T.forEach(function(P,C){var _=h.findImageFn(P.imageIds,E),D=C+1,I=h.layerIds[D];I||(I=v.addLayer(u,void 0,P.options),h.layerIds.push(I)),_?v.loadAndCacheImage(_).then(function(y){v.setLayerImage(u,y,I),v.updateImage(u)}):(v.setLayerImage(u,void 0,I),v.setActiveLayer(u,M),v.updateImage(u))})})}}]),s}()},"./stackTools/playClip.js":function(W,n,e){e.r(n),e.d(n,"playClip",function(){return u}),e.d(n,"stopClip",function(){return c});var a=e("./events.js"),f=e("./externalModules.js"),d=e("./stateManagement/loadHandlerManager.js"),l=e("./stateManagement/toolState.js"),o=e("./util/triggerEvent.js"),t="playClip";function r(h,g){var v,m,E,T=0,O=h.length,M=[];for(M.isTimeVarying=!1,(typeof g!="number"||g<=0)&&(g=1),v=1;v<O;v++)E=Number(h[v])/g|0,M.push(E),v===1?m=E:E!==m&&(M.isTimeVarying=!0),T+=E;return M.length>0&&(M.isTimeVarying?E=T/M.length|0:E=M[0],M.push(E)),M}function s(h){var g=h.intervalId;typeof g<"u"&&(h.intervalId=void 0,h.usingFrameTimeVector?clearTimeout(g):clearInterval(g))}function i(h){var g={element:h};Object(o.default)(h,a.default.CLIP_STOPPED,g)}function u(h,g){var v,m;if(h===void 0)throw new Error("playClip: element must not be undefined");var E=Object(l.getToolState)(h,"stack");if(!(!E||!E.data||!E.data.length)){var T=f.default.cornerstone,O;if(E.data.length>1){var M=Object(l.getToolState)(h,"stackRenderer");M&&M.data&&M.data.length&&(O=M.data[0])}var P=E.data[0],C=Object(l.getToolState)(h,t);!C||!C.data||!C.data.length?(v={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},Object(l.addToolState)(h,t,v)):(v=C.data[0],s(v)),(g<0||g>0)&&(v.framesPerSecond=Number(g),v.reverse=v.framesPerSecond<0,v.ignoreFrameTimeVector=!0),v.ignoreFrameTimeVector!==!0&&v.frameTimeVector&&v.frameTimeVector.length===P.imageIds.length&&(m=r(v.frameTimeVector,v.speed));var _=function(){var I,y,R,b,z=P.currentImageIdIndex,H=P.imageIds.length;if(v.reverse?z--:z++,!v.loop&&(z<0||z>=H)){s(v),i(h);return}z>=H&&(z=0),z<0&&(z=H-1),z!==P.currentImageIdIndex&&(y=d.default.getStartLoadHandler(h),R=d.default.getEndLoadHandler(h),b=d.default.getErrorLoadingHandler(h),y&&y(h),P.preventCache===!0?I=T.loadImage(P.imageIds[z]):I=T.loadAndCacheImage(P.imageIds[z]),I.then(function(B){try{P.currentImageIdIndex=z,O?(O.currentImageIdIndex=z,O.render(h,E.data)):T.displayImage(h,B),R&&R(h,B)}catch{return}},function(B){var p=P.imageIds[z];b&&b(h,p,B)}))};m&&m.length>0&&m.isTimeVarying?(v.usingFrameTimeVector=!0,v.intervalId=setTimeout(function D(){v.intervalId=setTimeout(D,m[P.currentImageIdIndex]),_()},0)):(v.usingFrameTimeVector=!1,v.intervalId=setInterval(_,1e3/Math.abs(v.framesPerSecond)))}}function c(h){var g=Object(l.getToolState)(h,t);!g||!g.data||!g.data.length||s(g.data[0])}},"./stackTools/stackPrefetch.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./stateManagement/loadHandlerManager.js"),d=e("./stateManagement/toolState.js"),l=e("./util/logger.js");e("./util/triggerEvent.js"),e("./events.js");var o=Object(l.getLogger)("stackTools:stackPrefetch"),t="stackPrefetch",r="prefetch",s=0,i=!0,u={maxImagesToPrefetch:1/0,preserveExistingPool:!1},c,h=10;function g(D,I){D=Math.round(D)||0,I=Math.round(I)||0;var y=[],R=I-D+1;if(R<=0)return y;for(;R--;)y[R]=I--;return y}function v(D,I){var y=0,R=D.length-1;return D.forEach(function(b,z){b<I?y=Math.max(z,y):b>I&&(R=Math.min(z,R))}),{low:y,high:R}}function m(D){var I=Object(d.getToolState)(D,"stack");if(!I||!I.data||!I.data.length)return;var y=I.data[0],R=Object(d.getToolState)(D,t);if(!R)return;var b=R.data[0]||{};if((!b.indicesToRequest||!b.indicesToRequest.length)&&(b.enabled=!1),b.enabled===!1)return;function z(le){var de=b.indicesToRequest.indexOf(le);de>-1&&b.indicesToRequest.splice(de,1)}R.data[0].indicesToRequest.sort(function(le,de){return le-de});var H=b.indicesToRequest.slice();if(H.forEach(function(le){var de=y.imageIds[le];if(de){var me=a.default.cornerstone.imageCache.getImageLoadObject(de);me&&z(le)}}),!!b.indicesToRequest.length){u.preserveExistingPool||a.default.cornerstone.imageLoadPoolManager.clearRequestStack(r);var B=v(b.indicesToRequest,y.currentImageIdIndex),p,A;f.default.getErrorLoadingHandler(D);for(var j=B.low,x=B.high,L=[];j>=0||x<b.indicesToRequest.length;){var U=y.currentImageIdIndex,S=U-b.indicesToRequest[j]>u.maxImagesToPrefetch,w=b.indicesToRequest[x]-U>u.maxImagesToPrefetch,G=!S&&j>=0,$=!w&&x<b.indicesToRequest.length;if(!$&&!G)break;G&&(A=b.indicesToRequest[j--],p=y.imageIds[A],L.push(p)),$&&(A=b.indicesToRequest[x++],p=y.imageIds[A],L.push(p))}var Q,re={addToBeginning:i,priority:s,requestType:r};Q=function(de){return a.default.cornerstone.loadAndCacheImage(de,re)},L.reverse().forEach(function(le){a.default.cornerstone.imageLoadPoolManager.addRequest(Q.bind(null,le),r,{imageId:le},s,i)})}}function E(D){return function(I){var y=I.detail,R;try{R=Object(d.getToolState)(D,"stack")}catch{return}if(!(!R||!R.data||!R.data.length)){var b=R.data[0],z=b.imageIds.indexOf(y.imageId);if(!(z<0)){var H=Object(d.getToolState)(D,t);!H||!H.data||!H.data.length||H.data[0].indicesToRequest.push(z)}}}}function T(D){clearTimeout(c),c=setTimeout(function(){var I=D.target;try{m(I)}catch{return}},h)}function O(D){var I=Object(d.getToolState)(D,t);I.data=[];var y=Object(d.getToolState)(D,"stack");if(!(!y||!y.data||!y.data.length)){var R=y.data[0];if(R.preventCache===!0){o.warn("A stack that should not be cached was given the stackPrefetch");return}var b={indicesToRequest:g(0,R.imageIds.length-1),enabled:!0,direction:1},z=b.indicesToRequest.indexOf(R.currentImageIdIndex);b.indicesToRequest.splice(z,1),Object(d.addToolState)(D,t,b),m(D),D.removeEventListener(a.default.cornerstone.EVENTS.NEW_IMAGE,T),D.addEventListener(a.default.cornerstone.EVENTS.NEW_IMAGE,T);var H=E(D);a.default.cornerstone.events.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,H),a.default.cornerstone.events.addEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,H)}}function M(D){clearTimeout(c),D.removeEventListener(a.default.cornerstone.EVENTS.NEW_IMAGE,T);var I=E(D);a.default.cornerstone.events.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,I);var y=Object(d.getToolState)(D,t);y&&y.data.length&&(y.data[0].enabled=!1,a.default.cornerstone.imageLoadPoolManager.clearRequestStack(r))}function P(){return u}function C(D){u=D}var _={enable:O,disable:M,getConfiguration:P,setConfiguration:C};n.default=_},"./stackTools/stackRenderers.js":function(W,n,e){e.r(n);var a=e("./stackTools/fusionRenderer.js"),f={};f.FusionRenderer=a.default,n.default=f},"./stateManagement/frameOfReferenceStateManager.js":function(W,n,e){e.r(n),e.d(n,"newFrameOfReferenceSpecificToolStateManager",function(){return a}),e.d(n,"globalFrameOfReferenceSpecificToolStateManager",function(){return f});function a(){var d={};function l(r,s,i){d.hasOwnProperty(r)===!1&&(d[r]={});var u=d[r];u.hasOwnProperty(s)===!1&&(u[s]={data:[]});var c=u[s];c.data.push(i)}function o(r,s){if(d.hasOwnProperty(r)!==!1){var i=d[r];if(i.hasOwnProperty(s)!==!1){var u=i[s];return u}}}function t(r,s,i){if(d.hasOwnProperty(r)!==!1){var u=d[r];if(u.hasOwnProperty(s)!==!1){for(var c=u[s],h=-1,g=0;g<c.data.length;g++)c.data[g]===i&&(h=g);h!==-1&&c.data.splice(h,1)}}}return{get:o,add:l,remove:t}}var f=a()},"./stateManagement/imageIdSpecificStateManager.js":function(W,n,e){e.r(n),e.d(n,"newImageIdSpecificToolStateManager",function(){return f}),e.d(n,"globalImageIdSpecificToolStateManager",function(){return d});var a=e("./externalModules.js");function f(){var l={};function o(T){return l[T]}function t(T,O){l[T]=O}function r(){return l}function s(T){l=T}function i(T,O,M){var P=a.default.cornerstone.getEnabledElement(T);P.image&&u(P.image.imageId,O,M)}function u(T,O,M){l.hasOwnProperty(T)===!1&&(l[T]={});var P=l[T];P.hasOwnProperty(O)===!1&&(P[O]={data:[]});var C=P[O];C.data.push(M)}function c(T,O){var M=a.default.cornerstone.getEnabledElement(T);if(M.image)return h(M.image.imageId,O)}function h(T,O){if(l.hasOwnProperty(T)!==!1){var M=l[T];if(M.hasOwnProperty(O)!==!1)return M[O]}}function g(T,O,M){var P=a.default.cornerstone.getEnabledElement(T);P.image&&v(P.image.imageId,O,M)}function v(T,O,M){var P=l[T];P[O]=M}function m(T){var O=a.default.cornerstone.getEnabledElement(T);O.image&&E(O.image.imageId)}function E(T){l.hasOwnProperty(T)!==!1&&delete l[T]}return{get:c,add:i,set:g,clear:m,getImageIdToolState:h,addImageIdToolState:u,setImageIdToolState:v,clearImageIdToolState:E,saveImageIdToolState:o,restoreImageIdToolState:t,saveToolState:r,restoreToolState:s,toolState:l}}var d=f()},"./stateManagement/loadHandlerManager.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f="DEFAULT",d={},l={},o={};function t(m){if(!m)return f;var E=a.default.cornerstone.getEnabledElement(m).uuid;if(!E)throw new Error("Something went wrong when getting uuid from element");return E}function r(m){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;if(!m)throw new Error("The Handler function must be defined");var T=t(E);d[T]=m}function s(m){var E=t(m);return d[E]||d[f]}function i(m){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;if(!m)throw new Error("The Handler function must be defined");var T=t(E);l[T]=m}function u(m){var E=t(m);return l[E]||l[f]}function c(m){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;if(!m)throw new Error("The Handler function must be defined");var T=t(E);o[T]=m}function h(m){var E=t(m);return o[E]||o[f]}function g(m){var E=t(m);delete d[E],delete l[E],delete o[E]}var v={setStartLoadHandler:r,getStartLoadHandler:s,setEndLoadHandler:i,getEndLoadHandler:u,setErrorLoadingHandler:c,getErrorLoadingHandler:h,removeHandlers:g};n.default=v},"./stateManagement/stackSpecificStateManager.js":function(W,n,e){e.r(n),e.d(n,"stackSpecificStateManager",function(){return o}),e.d(n,"newStackSpecificToolStateManager",function(){return d}),e.d(n,"addStackStateManager",function(){return l});var a=e("./stateManagement/imageIdSpecificStateManager.js"),f=e("./stateManagement/toolState.js");function d(t,r){var s={};function i(){return s}function u(v){s=v}function c(v,m,E){if(t.indexOf(m)>=0){s.hasOwnProperty(m)===!1&&(s[m]={data:[]});var T=s[m];T.data.push(E)}else return r.add(v,m,E)}function h(v,m){return t.indexOf(m)>=0?(s.hasOwnProperty(m)===!1&&(s[m]={data:[]}),s[m]):r.get(v,m)}var g={get:h,add:c,saveToolState:i,restoreToolState:u,toolState:s};return g}function l(t,r){var s=Object(f.getElementToolStateManager)(t);s||(s=a.globalImageIdSpecificToolStateManager);var i=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];r&&(i=i.concat(r));var u=d(i,s);Object(f.setElementToolStateManager)(t,u)}var o={newStackSpecificToolStateManager:d,addStackStateManager:l}},"./stateManagement/textStyle.js":function(W,n,e){e.r(n);var a={fontSize:15,fontFamily:"Arial",backgroundColor:"transparent"};function f(c){var h=c.split("px ");h.length===2&&(t(parseFloat(h[0])),l(h[1]))}function d(){return"".concat(a.fontSize,"px ").concat(a.fontFamily)}function l(c){if(typeof c!="string")throw new Error("Font family must be a valid string");a.fontFamily=c}function o(){return a.fontFamily}function t(c){if(typeof c!="number"||isNaN(c)||!isFinite(c))throw new Error("Font size must be a valid number");a.fontSize=parseFloat(c)}function r(){return a.fontSize}function s(c){a.backgroundColor=c}function i(){return a.backgroundColor}var u={setFont:f,getFont:d,setFontSize:t,getFontSize:r,setFontFamily:l,getFontFamily:o,setBackgroundColor:s,getBackgroundColor:i};n.default=u},"./stateManagement/toolColors.js":function(W,n,e){e.r(n);var a="white",f="greenyellow",d="transparent";function l(h){d=h}function o(){return d}function t(h){a=h}function r(){return a}function s(h){f=h}function i(){return f}function u(h){return h.color?h.color:h.active?f:a}var c={setFillColor:l,getFillColor:o,setToolColor:t,getToolColor:r,setActiveColor:s,getActiveColor:i,getColorIfActive:u};n.default=c},"./stateManagement/toolCoordinates.js":function(W,n,e){e.r(n);var a;function f(o){a=o.currentPoints.canvas}function d(){return a}var l={setCoords:f,getCoords:d};n.default=l},"./stateManagement/toolState.js":function(W,n,e){e.r(n),e.d(n,"addToolState",function(){return r}),e.d(n,"getToolState",function(){return s}),e.d(n,"removeToolState",function(){return i}),e.d(n,"clearToolState",function(){return u}),e.d(n,"setElementToolStateManager",function(){return c}),e.d(n,"getElementToolStateManager",function(){return t});var a=e("./events.js"),f=e("./externalModules.js"),d=e("./stateManagement/imageIdSpecificStateManager.js"),l=e("./util/triggerEvent.js"),o=e("./util/uuidv4.js");function t(h){var g=f.default.cornerstone.getEnabledElement(h);return g.toolStateManager===void 0&&(g.toolStateManager=d.globalImageIdSpecificToolStateManager),g.toolStateManager}function r(h,g,v){var m=t(h);v.uuid=v.uuid||Object(o.default)(),m.add(h,g,v);var E=a.default.MEASUREMENT_ADDED,T={toolName:g,toolType:g,element:h,measurementData:v};Object(l.default)(h,E,T)}function s(h,g){var v=t(h);return v.get(h,g)}function i(h,g,v){var m=t(h),E=m.get(h,g);if(!(!E||!E.data||!E.data.length)){for(var T=-1,O=0;O<E.data.length;O++)E.data[O]===v&&(T=O);if(T!==-1){E.data.splice(T,1);var M=a.default.MEASUREMENT_REMOVED,P={toolName:g,toolType:g,element:h,measurementData:v};Object(l.default)(h,M,P)}}}function u(h,g){var v=t(h),m=v.get(h,g);m!==void 0&&(m.data=[])}function c(h,g){var v=f.default.cornerstone.getEnabledElement(h);v.toolStateManager=g}},"./stateManagement/toolStyle.js":function(W,n,e){e.r(n);var a=1,f=2;function d(s){a=s}function l(){return a}function o(s){f=s}function t(){return f}var r={setToolWidth:d,getToolWidth:l,setActiveWidth:o,getActiveWidth:t};n.default=r},"./store/addTool.js":function(W,n,e){e.r(n),e.d(n,"addTool",function(){return t}),e.d(n,"addToolForElement",function(){return o});var a=e("./store/index.js"),f=e("./store/getToolForElement.js"),d=e("./util/logger.js"),l=Object(d.getLogger)("addTool"),o=function(i,u,c){var h=new u(c),g=Object(f.default)(i,h.name);if(g){l.warn("%s has already been added to the target element",h.name);return}h.element=i,a.default.state.tools.push(h)},t=function(i,u){r(i,u),a.default.state.enabledElements.forEach(function(c){o(c,i,u)})},r=function(i,u){var c=Object(a.getModule)("globalConfiguration"),h=c.configuration;if(h.globalToolSyncEnabled){var g=new i(u),v=a.default.state.globalTools[g.name]!==void 0;if(v){l.warn("%s has already been added globally",g.name);return}a.default.state.globalTools[g.name]={tool:i,props:u,activeBindings:[]}}}},"./store/filterToolsUsableWithMultiPartTools.js":function(W,n,e){e.r(n);var a=e("./tools/base/BaseAnnotationTool.js"),f=e("./tools/base/BaseBrushTool.js");n.default=function(d){return d.filter(function(l){return!l.isMultiPartTool&&!(l instanceof a.default)&&!(l instanceof f.default)})}},"./store/getActiveToolsForElement.js":function(W,n,e){e.r(n),n.default=function(a,f,d){return f.filter(function(l){return l.element===a&&l.mode==="active"&&(d===void 0||l.options["is".concat(d,"Active")])})}},"./store/getInteractiveToolsForElement.js":function(W,n,e){e.r(n),n.default=function(a,f){return f.filter(function(d){return d.element===a&&(d.mode==="active"||d.mode==="passive")})}},"./store/getToolForElement.js":function(W,n,e){e.r(n);var a=e("./store/index.js");n.default=function(f,d){return a.state.tools.find(function(l){return l.element===f&&l.name===d})}},"./store/getToolsWithDataForElement.js":function(W,n,e){e.r(n);var a=e("./stateManagement/toolState.js");n.default=function(f,d){return d.filter(function(l){var o=Object(a.getToolState)(f,l.name);return o&&o.data.length>0})}},"./store/getToolsWithMoveableHandles.js":function(W,n,e){e.r(n);var a=e("./stateManagement/toolState.js"),f=e("./manipulators/getHandleNearImagePoint.js"),d=e("./util/getProximityThreshold.js");n.default=function(l,o,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"mouse";return o.filter(function(s){for(var i=Object(d.default)(r,s.name),u=Object(a.getToolState)(l,s.name),c=0;c<u.data.length;c++)if(Object(f.default)(l,u.data[c].handles,t,i)!==void 0)return!0;return!1})}},"./store/index.js":function(W,n,e){e.r(n),e.d(n,"state",function(){return r}),e.d(n,"getters",function(){return s}),e.d(n,"modules",function(){return i}),e.d(n,"getModule",function(){return u});var a=e("./store/modules/segmentationModule/index.js"),f=e("./store/modules/manipulatorStateModule.js"),d=e("./store/modules/cursorModule.js"),l=e("./store/modules/globalConfigurationModule.js"),o=e("./externalModules.js"),t=e("./util/logger.js");Object(t.getLogger)("store:modules:storeLogger");var r={globalTools:{},globalToolChangeHistory:[],enabledElements:[],tools:[],isToolLocked:!1,activeMultiPartTool:null,mousePositionImage:{},clickProximity:6,touchProximity:10,handleRadius:6,deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,preventTextBoxOutsideDisplayedArea:!1,handleTouchOffset:{x:0,y:-57},svgCursorUrl:null},s={mouseTools:function(){return r.tools.filter(function(h){return h.supportedInteractionTypes.includes("Mouse")})},touchTools:function(){return r.tools.filter(function(h){return h.supportedInteractionTypes.includes("Touch")})},enabledElementByUID:function(h){return r.enabledElements.find(function(g){return o.default.cornerstone.getEnabledElement(g).uuid===h})}},i={segmentation:a.default,cursor:d.default,globalConfiguration:l.default,manipulatorState:f.default};function u(c){return i[c]}n.default={modules:i,state:r,getters:s}},"./store/internals/addEnabledElement.js":function(W,n,e){e.r(n);var a=e("./eventListeners/index.js"),f=e("./eventDispatchers/index.js"),d=e("./store/addTool.js"),l=e("./store/setToolMode.js"),o=e("./store/index.js"),t=e("./util/logger.js"),r=Object(t.getLogger)("internals:addEnabledElement");n.default=function(h){r.log("EVENT:ELEMENT_ENABLED");var g=h.detail.element;f.imageRenderedEventDispatcher.enable(g),f.newImageEventDispatcher.enable(g);var v=Object(o.getModule)("globalConfiguration"),m=v.configuration;m.mouseEnabled&&(a.mouseEventListeners.enable(g),a.wheelEventListener.enable(g),f.mouseToolEventDispatcher.enable(g)),m.touchEnabled&&(a.touchEventListeners.enable(g),f.touchToolEventDispatcher.enable(g)),s(g)};var s=function(g){o.default.state.enabledElements.push(g),o.default.modules&&i(g),u(g),c(g)};function i(h){var g=o.default.modules;Object.keys(g).forEach(function(v){typeof g[v].enabledElementCallback=="function"&&g[v].enabledElementCallback(h)})}function u(h){var g=Object(o.getModule)("globalConfiguration"),v=g.configuration;v.globalToolSyncEnabled&&Object.keys(o.default.state.globalTools).forEach(function(m){var E=o.default.state.globalTools[m],T=E.tool,O=E.props;Object(d.addToolForElement)(h,T,O)})}function c(h){var g=Object(o.getModule)("globalConfiguration"),v=g.configuration;if(v.globalToolSyncEnabled){var m={active:l.setToolActiveForElement,passive:l.setToolPassiveForElement,enabled:l.setToolEnabledForElement,disabled:l.setToolDisabledForElement};o.default.state.globalToolChangeHistory.forEach(function(E){var T=E.args.slice(0);T.unshift(h),m[E.mode].apply(null,T)})}}},"./store/internals/removeEnabledElement.js":function(W,n,e){e.r(n);var a=e("./eventListeners/index.js"),f=e("./eventDispatchers/index.js"),d=e("./store/index.js"),l=e("./util/logger.js"),o=e("./stateManagement/loadHandlerManager.js"),t=e("./store/setToolMode.js"),r=Object(l.getLogger)("internals:removeEnabledElement");n.default=function(h){r.log("EVENT:ELEMENT_DISABLED");var g=h.detail.element,v=Object(d.getModule)("globalConfiguration"),m=v.configuration;f.imageRenderedEventDispatcher.disable(g),f.newImageEventDispatcher.disable(g),m.mouseEnabled&&(a.mouseEventListeners.disable(g),a.wheelEventListener.disable(g),f.mouseToolEventDispatcher.disable(g)),m.touchEnabled&&(a.touchEventListeners.disable(g),f.touchToolEventDispatcher.disable(g)),s(g),i(g),u(g)};var s=function(g){d.default.state.tools.forEach(function(v){v.element===g&&Object(t.setToolDisabledForElement)(v.element,v.name)}),d.default.state.tools=d.default.state.tools.filter(function(v){return v.element!==g})},i=function(g){d.default.modules&&c(g);var v=d.default.state.enabledElements.findIndex(function(m){return m===g});v>-1?d.default.state.enabledElements.splice(v,1):r.warn("unable to remove element")},u=function(g){o.default.removeHandlers(g)};function c(h){var g=d.default.modules;Object.keys(g).forEach(function(v){typeof g[v].removeEnabledElementCallback=="function"&&g[v].removeEnabledElementCallback(h)})}},"./store/isToolActiveForElement.js":function(W,n,e){e.r(n);var a=e("./store/getToolForElement.js");n.default=function(f,d){var l=Object(a.default)(f,d);return l.mode==="active"}},"./store/modules/cursorModule.js":function(W,n,e){e.r(n),e("./externalModules.js");var a={iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:`
    <path stroke="ACTIVE_COLOR" d="M8 16L8 0"></path>
    <path stroke="ACTIVE_COLOR" d="M16 8L0 8"></path>
  `},f={defaultOptions:function(o){Object.assign(a,o)}},d={defaultOptions:function(){return a}};n.default={configuration:a,getters:d,setters:f}},"./store/modules/globalConfigurationModule.js":function(W,n,e){e.r(n);var a={mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1,showSVGCursors:!1,autoResizeViewports:!0,lineDash:[4,4]};n.default={configuration:a}},"./store/modules/manipulatorStateModule.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f={activeManipulators:{}};function d(c,h){var g=a.default.cornerstone.getEnabledElement(c),v=g.uuid;f.activeManipulators[v]=h}function l(c){var h=a.default.cornerstone.getEnabledElement(c),g=h.uuid,v=f.activeManipulators;delete v[g]}function o(c){var h=a.default.cornerstone.getEnabledElement(c),g=h.uuid;t(g)}function t(c){var h=f.activeManipulators,g=h[c];typeof g=="function"&&g(),delete h[c]}function r(){var c=f.activeManipulators;Object.keys(c).forEach(function(h){return t(h)})}function s(c){var h=c.detail,g=h.element;l(g)}function i(c){var h=a.default.cornerstone.EVENTS.NEW_IMAGE;c.removeEventListener(h,s),l(c)}function u(c){var h=a.default.cornerstone.EVENTS.NEW_IMAGE;c.removeEventListener(h,s),c.addEventListener(h,s)}n.default={setters:{addActiveManipulatorForElement:d,removeActiveManipulatorForElement:l,cancelActiveManipulatorsForElement:o,cancelActiveManipulators:r},state:f,enabledElementCallback:u,removeEnabledElementCallback:i}},"./store/modules/segmentationModule/activeLabelmapIndex.js":function(W,n,e){e.r(n),e.d(n,"getActiveLabelmapIndex",function(){return t}),e.d(n,"setActiveLabelmapIndex",function(){return r});var a=e("./store/modules/segmentationModule/getElement.js"),f=e("./stateManagement/toolState.js"),d=e("./store/modules/segmentationModule/addLabelmap3D.js"),l=e("./store/modules/segmentationModule/state.js"),o=e("./externalModules.js");function t(s){var i=Object(a.default)(s);if(i){var u=Object(f.getToolState)(i,"stack"),c=u.data[0],h=c.imageIds[0],g=l.default.series[h];if(g)return g.activeLabelmapIndex}}function r(s){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=Object(a.default)(s);if(u){var c=o.default.cornerstone,h=Object(f.getToolState)(u,"stack"),g=h.data[0],v=c.getEnabledElement(u),m=v.image,E=m.rows,T=m.columns,O=g.imageIds.length,M=E*T*O,P=g.imageIds[0],C=l.default.series[P];C?(C.activeLabelmapIndex=i,C.labelmaps3D[i]||Object(d.default)(C,i,M)):(l.default.series[P]={activeLabelmapIndex:i,labelmaps3D:[]},C=l.default.series[P],Object(d.default)(C,i,M)),c.updateImage(u)}}},"./store/modules/segmentationModule/activeSegmentIndex.js":function(W,n,e){e.r(n),e.d(n,"getActiveSegmentIndex",function(){return o}),e.d(n,"setActiveSegmentIndex",function(){return t}),e.d(n,"incrementActiveSegmentIndex",function(){return r}),e.d(n,"decrementActiveSegmentIndex",function(){return s});var a=e("./store/modules/segmentationModule/getElement.js"),f=e("./stateManagement/toolState.js"),d=e("./store/modules/segmentationModule/state.js"),l=e("./store/index.js");function o(u,c){var h=Object(a.default)(u);if(h){var g=Object(f.getToolState)(h,"stack"),v=g.data[0],m=v.imageIds[0],E=d.default.series[m];if(E){c=c===void 0?E.activeLabelmapIndex:c;var T=E.labelmaps3D[c];if(T)return T.activeSegmentIndex}return 1}}function t(u,c){var h=Object(a.default)(u);if(h){var g=Object(f.getToolState)(h,"stack"),v=g.data[0],m=v.imageIds[0],E=d.default.series[m];if(E){var T=E.activeLabelmapIndex,O=E.labelmaps3D[T],M=Object(l.getModule)("segmentation"),P=M.configuration;c<=0?c=1:c>P.segmentsPerLabelmap&&(c=P.segmentsPerLabelmap),O.activeSegmentIndex=c}}}function r(u){var c=Object(a.default)(u);c&&i(c,"increase")}function s(u){var c=Object(a.default)(u);c&&i(c,"decrease")}function i(u){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"increase",h=Object(l.getModule)("segmentation"),g=h.configuration,v=Object(f.getToolState)(u,"stack"),m=v.data[0],E=m.imageIds[0],T=d.default.series[E];if(T){var O=T.activeLabelmapIndex,M=T.labelmaps3D[O];switch(c){case"increase":M.activeSegmentIndex++,M.activeSegmentIndex>g.segmentsPerLabelmap&&(M.activeSegmentIndex=1);break;case"decrease":M.activeSegmentIndex--,M.activeSegmentIndex<=0&&(M.activeSegmentIndex=g.segmentsPerLabelmap);break}}}},"./store/modules/segmentationModule/addLabelmap2D.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return o});var a=e("./store/modules/segmentationModule/arrayTypes.js"),f=e("./store/index.js"),d=a.default.UINT_16_ARRAY,l=a.default.FLOAT_32_ARRAY;function o(t,r,s,i,u){var c=Object(f.getModule)("segmentation"),h=c.configuration,g=i*u,v=g*s,m;switch(h.arrayType){case d:m=new Uint16Array(t.labelmaps3D[r].buffer,v*2,g);break;case l:m=new Float32Array(t.labelmaps3D[r].buffer,v*4,g);break;default:throw new Error("Unsupported Array Type ".concat(h.arrayType))}t.labelmaps3D[r].labelmaps2D[s]={pixelData:m,segmentsOnLabelmap:[]}}},"./store/modules/segmentationModule/addLabelmap3D.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return o});var a=e("./store/modules/segmentationModule/arrayTypes.js"),f=e("./store/index.js"),d=a.default.UINT_16_ARRAY,l=a.default.FLOAT_32_ARRAY;function o(t,r,s){var i=Object(f.getModule)("segmentation"),u=i.configuration,c;switch(u.arrayType){case d:c=2;break;case l:c=4;break;default:throw new Error("Unsupported Array Type ".concat(u.arrayType))}t.labelmaps3D[r]={buffer:new ArrayBuffer(s*c),labelmaps2D:[],metadata:[],activeSegmentIndex:1,colorLUTIndex:0,segmentsHidden:[],undo:[],redo:[]}}},"./store/modules/segmentationModule/arrayTypes.js":function(W,n,e){e.r(n);var a={UINT_16_ARRAY:0,FLOAT_32_ARRAY:1};n.default=a},"./store/modules/segmentationModule/colorLUT.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return r}),e.d(n,"setColorLUTIndexForLabelmap3D",function(){return s}),e.d(n,"getColorForSegmentIndexColorLUT",function(){return i}),e.d(n,"setColorForSegmentIndexOfColorLUT",function(){return u}),e.d(n,"getColorLUT",function(){return c});var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a),d=e("./util/logger.js"),l=e("./store/modules/segmentationModule/state.js"),o=e("./store/index.js"),t=Object(d.getLogger)("store:modules:segmentationModule:setColorLUT");function r(D){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],y=Object(o.getModule)("segmentation"),R=y.configuration,b=R.segmentsPerLabelmap;I?(h(I,b),I.length<b&&(I=[].concat(f()(I),f()(g(b-I.length))))):I=I||g(b),I.unshift([0,0,0,0]),l.default.colorLutTables[D]=I}function s(D,I){D.colorLUTIndex=I}function i(D,I){var y=c(D);return y[I]}function u(D,I,y){var R=c(D);R[I]=y}function c(D){return typeof D=="number"?l.default.colorLutTables[D]:l.default.colorLutTables[D.colorLUTIndex]}function h(D,I){D.length<I?t.warn("The provided colorLUT only provides ".concat(D.length," labels, whereas segmentsPerLabelmap is set to ").concat(I,". Autogenerating the rest.")):D.length>I&&t.warn("segmentsPerLabelmap is set to ".concat(I,", and the provided colorLUT provides ").concat(D.length,". Using the first ").concat(I," colors from the LUT."))}function g(){for(var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:255,I=[],y=0;y<D;y++)I.push(_(E(),C()));return I}var v=137.5,m=222.5;function E(){return m+=v,m>=360&&(m-=360),m}var T=.6,O=.82,M=.3,P=.07;function C(){if(T+=P,T>O){var D=T-O;T=M+D}return T}function _(D){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.6,R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,b=(1-Math.abs(2*y-1))*I,z=b*(1-Math.abs(D/60%2-1)),H=y-b/2,B,p,A;return D<60?(B=b,p=z,A=0):D<120?(B=z,p=b,A=0):D<180?(B=0,p=b,A=z):D<240?(B=0,p=z,A=b):D<300?(B=z,p=0,A=b):D<360&&(B=b,p=0,A=z),[(B+H)*255,(p+H)*255,(A+H)*255,R]}},"./store/modules/segmentationModule/defaultConfiguration.js":function(W,n,e){e.r(n);var a=e("./store/modules/segmentationModule/arrayTypes.js"),f=a.default.UINT_16_ARRAY,d={renderOutline:!0,renderFill:!0,shouldRenderInactiveLabelmaps:!0,radius:10,minRadius:1,maxRadius:50,fillAlpha:.2,fillAlphaInactive:.1,outlineAlpha:.7,outlineAlphaInactive:.35,outlineWidth:3,storeHistory:!0,segmentsPerLabelmap:65535,arrayType:f};n.default=d},"./store/modules/segmentationModule/deleteSegment.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return o});var a=e("./store/modules/segmentationModule/getElement.js"),f=e("./stateManagement/toolState.js"),d=e("./store/modules/segmentationModule/state.js"),l=e("./externalModules.js");function o(t,r,s){if(r){var i=Object(a.default)(t);if(i){var u=Object(f.getToolState)(i,"stack"),c=u.data[0],h=c.imageIds[0],g=d.default.series[h];if(g){s=s===void 0?g.activeLabelmapIndex:s;var v=g.labelmaps3D[s];if(v){delete v.metadata[r];for(var m=v.labelmaps2D,E=0;E<m.length;E++){var T=m[E];if(T&&T.segmentsOnLabelmap.includes(r)){var O=T.pixelData,M=T.segmentsOnLabelmap.indexOf(r);T.segmentsOnLabelmap.splice(M,1);for(var P=0;P<O.length;P++)O[P]===r&&(O[P]=0)}}l.default.cornerstone.updateImage(i)}}}}}},"./store/modules/segmentationModule/getBrushColor.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return t});var a=e("./stateManagement/toolState.js"),f=e("./store/modules/segmentationModule/state.js"),d=e("./store/modules/segmentationModule/getElement.js"),l=e("./util/logger.js"),o=Object(l.getLogger)("store:modules:segmentationModule:getBrushColor");function t(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=Object(d.default)(r);if(i){var u=Object(a.getToolState)(i,"stack");if(!u){o.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.");return}var c=u.data[0],h=c.imageIds[0],g=f.default.series[h],v;if(g){var m=g.activeLabelmapIndex,E=g.labelmaps3D[m],T=E.activeSegmentIndex;v=f.default.colorLutTables[E.colorLUTIndex][T]}else v=f.default.colorLutTables[0][1];return s?"rgba(".concat(v[0],", ").concat(v[1],", ").concat(v[2],", 1.0 )"):"rgba(".concat(v[0],", ").concat(v[1],", ").concat(v[2],", 0.8 )")}}},"./store/modules/segmentationModule/getElement.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./store/index.js");function f(d){return d instanceof HTMLElement?d:a.getters.enabledElementByUID(d)}},"./store/modules/segmentationModule/getLabelmap2D.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return v}),e.d(n,"getLabelmap2DByImageIdIndex",function(){return m});var a=e("./store/modules/segmentationModule/getElement.js"),f=e("./stateManagement/toolState.js"),d=e("./store/modules/segmentationModule/getSegmentsOnPixeldata.js"),l=e("./store/modules/segmentationModule/addLabelmap3D.js"),o=e("./store/modules/segmentationModule/addLabelmap2D.js"),t=e("./externalModules.js"),r=e("./store/modules/segmentationModule/state.js"),s=e("./store/modules/segmentationModule/arrayTypes.js"),i=e("./store/index.js"),u=e("./util/logger.js"),c=s.default.UINT_16_ARRAY,h=s.default.FLOAT_32_ARRAY,g=Object(u.getLogger)("store:modules:segmentationModule:getLabelmap2D");function v(E){var T=Object(a.default)(E);if(T){var O=t.default.cornerstone,M=Object(f.getToolState)(T,"stack");if(!M){g.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.");return}var P=M.data[0],C=O.getEnabledElement(T),_=P.currentImageIdIndex,D=C.image,I=D.rows,y=D.columns,R=P.imageIds.length,b=P.imageIds[0],z=r.default.series[b],H;if(z){if(H=z.activeLabelmapIndex,!z.labelmaps3D[H]){var B=I*y*R;Object(l.default)(z,H,B)}z.labelmaps3D[H].labelmaps2D[_]||Object(o.default)(z,H,_,I,y)}else{H=0,r.default.series[b]={activeLabelmapIndex:H,labelmaps3D:[]},z=r.default.series[b];var p=I*y*R;Object(l.default)(z,H,p),Object(o.default)(z,H,_,I,y)}var A=z.labelmaps3D[H];return{labelmap2D:A.labelmaps2D[_],labelmap3D:A,currentImageIdIndex:_,activeLabelmapIndex:H}}}function m(E,T,O,M){if(!E.labelmaps2D[T]){var P=Object(i.getModule)("segmentation"),C=P.configuration,_=O*M,D=_*T,I;switch(C.arrayType){case c:I=new Uint16Array(E.buffer,D*2,_);break;case h:I=new Float32Array(E.buffer,D*4,_);break;default:throw new Error("Unsupported Array Type ".concat(C.arrayType))}E.labelmaps2D[T]={pixelData:I,segmentsOnLabelmap:Object(d.default)(I)}}return E.labelmaps2D[T]}},"./store/modules/segmentationModule/getLabelmapBuffers.js":function(W,n,e){e.r(n),e.d(n,"getLabelmapBuffers",function(){return i}),e.d(n,"getActiveLabelmapBuffer",function(){return u});var a=e("./store/modules/segmentationModule/getElement.js"),f=e("./stateManagement/toolState.js"),d=e("./store/modules/segmentationModule/getLabelmaps3D.js"),l=e("./store/modules/segmentationModule/state.js"),o=e("./store/modules/segmentationModule/arrayTypes.js"),t=e("./store/index.js"),r=o.default.UINT_16_ARRAY,s=o.default.FLOAT_32_ARRAY;function i(c,h){var g=Object(a.default)(c);if(g){var v=Object(d.default)(g),m=v.labelmaps3D;if(!m)return[];var E=Object(t.getModule)("segmentation"),T=E.configuration,O,M;switch(T.arrayType){case r:O="Uint16Array",M="2";break;case s:O="Float32Array",M="4";break;default:throw new Error("Unsupported Array Type ".concat(T.arrayType))}var P=l.default.colorLutTables;if(h!==void 0){var C=m[h];return C?{labelmapIndex:h,bytesPerVoxel:M,type:O,buffer:C.buffer,colorLUT:P[C.colorLUTIndex]}:void 0}for(var _=[],D=0;D<m.length;D++){var I=m[D];I&&_.push({labelmapIndex:D,bytesPerVoxel:2,buffer:I.buffer,colorLUT:P[I.colorLUTIndex]})}return _}}function u(c){var h=Object(a.default)(c);if(h){var g=Object(f.getToolState)(h,"stack"),v=g.data[0].imageIds,m=v[0],E=l.default.series[m];if(E){var T=E.activeLabelmapIndex;return i(h,T)}}}},"./store/modules/segmentationModule/getLabelmapStats.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return r}),e.d(n,"_calculateLabelmapStats",function(){return i});var a=e("./store/modules/segmentationModule/getElement.js"),f=e("./stateManagement/toolState.js"),d=e("./store/modules/segmentationModule/state.js"),l=e("./externalModules.js"),o=e("./util/logger.js"),t=Object(o.getLogger)("store:modules:segmentationModule:getLabelmapStats");function r(g,v,m){var E=l.default.cornerstone,T=Object(a.default)(g);if(!T)return null;var O=Object(f.getToolState)(T,"stack"),M=O.data[0].imageIds,P=M[0];return new Promise(function(C){var _=d.default.series[P];_||C(null);var D=s(M),I=D.sufficientMetadata,y=D.imagePlanes;I||(t.warn("Insufficient imagePlaneModule information to calculate volume statistics."),C(null)),m=m===void 0?_.activeLabelmapIndex:m;for(var R=_.labelmaps3D[m],b=[],z=0;z<M.length;z++)b.push(E.loadAndCacheImage(M[z]));Promise.all(b).then(function(H){var B=i(R,H,y,v);C(B)})})}function s(g){for(var v=[],m=l.default.cornerstone,E=m.metaData,T=!0,O=0;O<g.length;O++){var M=E.get("imagePlaneModule",g[O]);if(!M){T=!1;break}v.push(M)}return{sufficientMetadata:T,imagePlanes:v}}function i(g,v,m,E){for(var T=u(g,v,m,E),O=0,M=T[0].values[0],P=M,C=0,_=0;_<T.length;_++){var D=T[_],I=D.values,y=D.voxelInMM3;C+=y*I.length;var R=0;I.forEach(function(p){p>M?M=p:p<P&&(P=p),R+=p}),O+=R*y}O/=C;for(var b=0,z=0;z<T.length;z++){var H=T[z],I=H.values,y=H.voxelInMM3,B=0;I.forEach(function(j){B+=Math.pow(j-O,2)}),b+=B*y}return b/=C,b=Math.sqrt(b),{volume:C,mean:O,stdDev:b,max:M,min:P}}function u(g,v,m,E){for(var T=v[0],O=T.rowPixelSpacing,M=T.columnPixelSpacing,P=g.labelmaps2D,C=[],_=0;_<P.length;_++){var D=P[_];if(D&&D.segmentsOnLabelmap.includes(E)){for(var I=c(v,m,_),y=I*O*M,R=D.pixelData,b=v[_].getPixelData(),z=[],H=0;H<R.length;H++)R[H]===E&&z.push(b[H]);C.push({voxelInMM3:y,values:z})}}return C}function c(g,v,m){var E=g.length,T=v[m].imagePositionPatient;if(m===0){var O=v[m+1].imagePositionPatient;return h(T,O)}else if(m===E-1){var M=v[m-1].imagePositionPatient;return h(T,M)}var P=v[m-1].imagePositionPatient,C=v[m+1].imagePositionPatient;return(h(T,P)+h(T,C))/2}function h(g,v){return Math.sqrt(Math.pow(g[0]-v[0],2)+Math.pow(g[1]-v[1],2)+Math.pow(g[2]-v[2],2))}},"./store/modules/segmentationModule/getLabelmaps3D.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return t}),e.d(n,"getLabelmap3D",function(){return r});var a=e("./stateManagement/toolState.js"),f=e("./store/modules/segmentationModule/getElement.js"),d=e("./store/modules/segmentationModule/state.js"),l=e("./util/logger.js"),o=Object(l.getLogger)("store:modules:segmentationModule:getLabelmaps3D");function t(s){var i=Object(f.default)(s);if(i){var u=Object(a.getToolState)(i,"stack");if(!u){o.error("Consumers must define stacks in their application if using segmentations in cornerstoneTools.");return}var c=u.data[0],h=c.imageIds[0],g=d.default.series[h],v,m;return g&&(v=g.labelmaps3D,m=g.activeLabelmapIndex),{labelmaps3D:v,activeLabelmapIndex:m,currentImageIdIndex:c.currentImageIdIndex}}}function r(s,i){var u=t(s),c=u.labelmaps3D,h=u.activeLabelmapIndex;return i=i!==void 0?i:h,c[i]}},"./store/modules/segmentationModule/getSegmentOfActiveLabelmapAtEvent.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return t});var a=e("./stateManagement/toolState.js"),f=e("./store/modules/segmentationModule/state.js"),d=e("./util/isPointInImage.js"),l=e("./util/logger.js"),o=Object(l.getLogger)("store:modules:segmentationModule:getSegmentOfActiveLabelmapAtEvent");function t(r){var s=r.detail,i=s.element,u=s.image,c=s.currentPoints;if(!c){o.warn("Not a cornerstone input event.");return}var h=u.width,g=u.height;if(i){var v=Object(a.getToolState)(i,"stack"),m=v.data[0],E=m.currentImageIdIndex,T=m.imageIds[0],O=f.default.series[T],M=O.activeLabelmapIndex,P=O.labelmaps3D[M];if(P){var C=P.labelmaps2D[E];if(C){var _=C.pixelData,D=c.image,I=D.x,y=D.y;if(I=Math.floor(I),y=Math.floor(y),Object(d.default)({x:I,y},g,h)){var R=_[y*h+I];return R===0?void 0:{segmentIndex:R,metadata:P.metadata[R]}}}}}}},"./store/modules/segmentationModule/getSegmentsOnPixeldata.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return d});var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a);function d(l){return f()(new Set(l))}},"./store/modules/segmentationModule/history.js":function(W,n,e){e.r(n),e.d(n,"pushState",function(){return o}),e.d(n,"undo",function(){return t}),e.d(n,"redo",function(){return r});var a=e("./store/modules/segmentationModule/getLabelmaps3D.js"),f=e("./util/logger.js"),d=e("./externalModules.js"),l=Object(f.getLogger)("util:segmentation:labelmap3DHistory");function o(i,u,c){var h=Object(a.getLabelmap3D)(i,c);h.undo.push(u),h.redo=[]}function t(i,u){var c=Object(a.getLabelmap3D)(i,u),h=c.undo,g=c.redo;if(!h.length){l.warn("No undos left.");return}var v=h.pop();s(c,v,1),g.push(v),d.default.cornerstone.updateImage(i)}function r(i,u){var c=Object(a.getLabelmap3D)(i,u),h=c.undo,g=c.redo;if(!g.length){l.warn("No redos left.");return}var v=g.pop();s(c,v,2),h.push(v),d.default.cornerstone.updateImage(i)}function s(i,u,c){var h=i.labelmaps2D;u.forEach(function(g){for(var v=g.imageIdIndex,m=g.diff,E=h[v],T=E.pixelData,O=0;O<m.length;O++){var M=m[O];T[M[0]]=M[c]}})}},"./store/modules/segmentationModule/index.js":function(W,n,e){e.r(n);var a=e("./store/modules/segmentationModule/metadata.js"),f=e("./store/modules/segmentationModule/activeLabelmapIndex.js"),d=e("./store/modules/segmentationModule/activeSegmentIndex.js"),l=e("./store/modules/segmentationModule/segmentVisibility.js"),o=e("./store/modules/segmentationModule/getLabelmapBuffers.js"),t=e("./store/modules/segmentationModule/setLabelmap3D.js"),r=e("./store/modules/segmentationModule/getLabelmapStats.js"),s=e("./store/modules/segmentationModule/getLabelmaps3D.js"),i=e("./store/modules/segmentationModule/getLabelmap2D.js"),u=e("./store/modules/segmentationModule/getSegmentOfActiveLabelmapAtEvent.js"),c=e("./store/modules/segmentationModule/colorLUT.js"),h=e("./store/modules/segmentationModule/getBrushColor.js"),g=e("./store/modules/segmentationModule/getSegmentsOnPixeldata.js"),v=e("./store/modules/segmentationModule/deleteSegment.js"),m=e("./store/modules/segmentationModule/state.js"),E=e("./store/modules/segmentationModule/defaultConfiguration.js"),T=e("./store/modules/segmentationModule/history.js"),O=e("./store/modules/segmentationModule/setRadius.js");function M(){Object(c.default)(0)}n.default={state:m.default,configuration:E.default,onRegisterCallback:M,getters:{metadata:a.getMetadata,labelmap3D:s.getLabelmap3D,labelmaps3D:s.default,activeLabelmapIndex:f.getActiveLabelmapIndex,activeSegmentIndex:d.getActiveSegmentIndex,isSegmentVisible:l.isSegmentVisible,labelmap2D:i.default,labelmap2DByImageIdIndex:i.getLabelmap2DByImageIdIndex,labelmapStats:r.default,segmentOfActiveLabelmapAtEvent:u.default,brushColor:h.default,labelmapBuffers:o.getLabelmapBuffers,activeLabelmapBuffer:o.getActiveLabelmapBuffer,colorLUT:c.getColorLUT,colorForSegmentIndexColorLUT:c.getColorForSegmentIndexColorLUT},setters:{metadata:a.setMetadata,labelmap3DForElement:t.setLabelmap3DForElement,labelmap3DByFirstImageId:t.setLabelmap3DByFirstImageId,incrementActiveSegmentIndex:d.incrementActiveSegmentIndex,decrementActiveSegmentIndex:d.decrementActiveSegmentIndex,activeSegmentIndex:d.setActiveSegmentIndex,toggleSegmentVisibility:l.toggleSegmentVisibility,updateSegmentsOnLabelmap2D:function(C){C.segmentsOnLabelmap=Object(g.default)(C.pixelData)},deleteSegment:v.default,colorLUT:c.default,colorLUTIndexForLabelmap3D:c.setColorLUTIndexForLabelmap3D,colorForSegmentIndexOfColorLUT:c.setColorForSegmentIndexOfColorLUT,activeLabelmapIndex:f.setActiveLabelmapIndex,radius:O.default,pushState:T.pushState,undo:T.undo,redo:T.redo}}},"./store/modules/segmentationModule/metadata.js":function(W,n,e){e.r(n),e.d(n,"getMetadata",function(){return s}),e.d(n,"setMetadata",function(){return i});var a=e("./store/modules/segmentationModule/getElement.js"),f=e("./store/modules/segmentationModule/addLabelmap3D.js"),d=e("./stateManagement/toolState.js"),l=e("./externalModules.js"),o=e("./util/logger.js"),t=e("./store/modules/segmentationModule/state.js"),r=Object(o.getLogger)("store:modules:segmentationModule:metadata");function s(u,c,h){var g=Object(a.default)(u);if(g){var v=Object(d.getToolState)(g,"stack"),m=v.data[0],E=m.imageIds[0],T=t.default.series[E];if(!T){r.warn("brushStackState is undefined");return}if(c=c===void 0?T.activeLabelmapIndex:c,!T.labelmaps3D[c]){r.warn("No labelmap3D of labelmap index ".concat(c," on stack."));return}var O=T.labelmaps3D[c];return h===void 0?O.metadata:O.metadata[h]}}function i(u){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,h=arguments.length>2?arguments[2]:void 0,g=arguments.length>3?arguments[3]:void 0,v=Object(a.default)(u);if(v){var m=l.default.cornerstone,E=Object(d.getToolState)(v,"stack"),T=E.data[0],O=T.imageIds[0],M=t.default.series[O];if(M||(t.default.series[O]={labelmapIndex:c,labelmaps3D:[]},M=t.default.series[O]),!M.labelmaps3D[c]){var P=m.getEnabledElement(v),C=P.image,_=C.rows,D=C.columns,I=T.imageIds.length,y=_*D*I;Object(f.default)(M,c,y)}var R=M.labelmaps3D[c];R.metadata[h]=g}}},"./store/modules/segmentationModule/segmentVisibility.js":function(W,n,e){e.r(n),e.d(n,"isSegmentVisible",function(){return t}),e.d(n,"toggleSegmentVisibility",function(){return r});var a=e("./store/modules/segmentationModule/getElement.js"),f=e("./stateManagement/toolState.js"),d=e("./store/modules/segmentationModule/state.js"),l=e("./util/logger.js"),o=Object(l.getLogger)("store:modules:segmentationModule:segmentVisibility");function t(s,i,u){if(i){var c=Object(a.default)(s);if(c){var h=Object(f.getToolState)(c,"stack"),g=h.data[0],v=g.imageIds[0],m=d.default.series[v];if(!m){o.warn("brushStackState is undefined");return}if(u=u===void 0?m.activeLabelmapIndex:u,!m.labelmaps3D[u]){o.warn("No labelmap3D of labelmap index ".concat(u," on stack."));return}var E=m.labelmaps3D[u],T=!E.segmentsHidden[i];return T}}}function r(s,i,u){if(i){var c=Object(a.default)(s);if(c){var h=Object(f.getToolState)(c,"stack"),g=h.data[0],v=g.imageIds[0],m=d.default.series[v];if(!m){o.warn("brushStackState is undefined");return}if(u=u===void 0?m.activeLabelmapIndex:u,!m.labelmaps3D[u]){o.warn("No labelmap3D of labelmap index ".concat(u," on stack."));return}var E=m.labelmaps3D[u],T=E.segmentsHidden;return T[i]=!T[i],!T[i]}}}},"./store/modules/segmentationModule/setLabelmap3D.js":function(W,n,e){e.r(n),e.d(n,"setLabelmap3DByFirstImageId",function(){return c}),e.d(n,"setLabelmap3DForElement",function(){return u});var a=e("./store/modules/segmentationModule/getElement.js"),f=e("./stateManagement/toolState.js"),d=e("./store/modules/segmentationModule/state.js"),l=e("./store/modules/segmentationModule/getSegmentsOnPixeldata.js"),o=e("./util/segmentation/index.js"),t=e("./store/modules/segmentationModule/arrayTypes.js"),r=e("./store/index.js"),s=t.default.UINT_16_ARRAY,i=t.default.FLOAT_32_ARRAY;function u(h,g,v){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],E=arguments.length>4?arguments[4]:void 0,T=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0,O=Object(a.default)(h);if(O){var M=Object(f.getToolState)(O,"stack"),P=M.data[0].imageIds.length,C=M.data[0].imageIds[0];c(C,g,v,m,P,E,T),Object(o.triggerLabelmapModifiedEvent)(O,v)}}function c(h,g,v){var m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],E=arguments.length>4?arguments[4]:void 0,T=arguments.length>5?arguments[5]:void 0,O=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0,M=Object(r.getModule)("segmentation"),P=M.configuration,C=d.default.series[h];C||(d.default.series[h]={activeLabelmapIndex:v,labelmaps3D:[]},C=d.default.series[h]),C.labelmaps3D[v]={buffer:g,labelmaps2D:[],metadata:m,activeSegmentIndex:1,colorLUTIndex:O,segmentsHidden:[],undo:[],redo:[]};for(var _=C.labelmaps3D[v].labelmaps2D,D=g.byteLength/E,I=0;I<E;I++){var y=void 0;switch(P.arrayType){case s:y=new Uint16Array(g,D*I,D/2);break;case i:y=new Float32Array(g,D*I,D/4);break;default:throw new Error("Unsupported Array Type ".concat(P.arrayType))}var R=T?T[I]:Object(l.default)(y);R&&R.some(function(b){return b})&&(_[I]={pixelData:y,segmentsOnLabelmap:R})}}},"./store/modules/segmentationModule/setRadius.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./store/index.js");function f(d){var l=Object(a.getModule)("segmentation"),o=l.configuration;o.radius=Math.min(Math.max(d,o.minRadius),o.maxRadius)}},"./store/modules/segmentationModule/state.js":function(W,n,e){e.r(n);var a={series:{},colorLutTables:[]};n.default=a},"./store/removeTool.js":function(W,n,e){e.r(n),e.d(n,"removeTool",function(){return d}),e.d(n,"removeToolForElement",function(){return f});var a=e("./store/index.js"),f=function(t,r){var s=a.default.state.tools.findIndex(function(i){return i.element===t&&i.name===r});s>=0&&a.default.state.tools.splice(s,1)},d=function(t){l(t),a.default.state.enabledElements.forEach(function(r){f(r,t)})},l=function(t){var r=Object(a.getModule)("globalConfiguration"),s=r.configuration;s.globalToolSyncEnabled&&a.default.state.globalTools[t]&&delete a.default.state.globalTools[t]}},"./store/setToolCursor.js":function(W,n,e){e.r(n),e.d(n,"setToolCursor",function(){return d}),e.d(n,"resetToolCursor",function(){return l}),e.d(n,"hideToolCursor",function(){return o});var a=e("./store/index.js"),f=a.modules.globalConfiguration;function d(r,s){if(f.configuration.showSVGCursors){var i=s.getIconWithPointerSVG(),u=s.mousePoint,c=window.URL.createObjectURL(i);r.style.cursor="url('".concat(c,"') ").concat(u,", auto"),a.state.svgCursorUrl=c}}function l(r){t(r,"initial")}function o(r){f.configuration.showSVGCursors&&t(r,"none")}function t(r,s){a.state.svgCursorUrl&&window.URL.revokeObjectURL(a.state.svgCursorUrl),a.state.svgCursorUrl=null,r.style.cursor=s}},"./store/setToolMode.js":function(W,n,e){e.r(n),e.d(n,"setToolActive",function(){return c}),e.d(n,"setToolActiveForElement",function(){return i}),e.d(n,"setToolDisabled",function(){return g}),e.d(n,"setToolDisabledForElement",function(){return h}),e.d(n,"setToolEnabled",function(){return m}),e.d(n,"setToolEnabledForElement",function(){return v}),e.d(n,"setToolPassive",function(){return T}),e.d(n,"setToolPassiveForElement",function(){return E}),e.d(n,"setToolMode",function(){return M}),e.d(n,"setToolModeForElement",function(){return O}),e.d(n,"_getNormalizedOptions",function(){return z}),e.d(n,"_mergeMouseButtonMask",function(){return H});var a=e("./events.js"),f=e("./util/triggerEvent.js"),d=e("./store/getToolForElement.js"),l=e("./store/setToolCursor.js"),o=e("./util/logger.js"),t=e("./store/index.js"),r=Object(t.getModule)("globalConfiguration"),s=Object(o.getLogger)("store:setToolMode"),i=function(p,A,j,x){x===void 0&&Array.isArray(j)&&(x=j,j=null);var L=Object(d.default)(p,A);L&&(P(p,L,j,x),L.supportedInteractionTypes.forEach(function(U){x===void 0||x.includes(U)?j["is".concat(U,"Active")]=!0:j["is".concat(U,"Active")]=!1}),r.configuration.showSVGCursors&&L.supportedInteractionTypes.includes("Mouse")&&u(p,j,L)),O("active",null,p,A,j)};function u(B,p,A){var j;typeof p=="number"?j=[p]:j=p.mouseButtonMask,j.includes(1)&&(A.svgCursor?Object(l.setToolCursor)(A.element,A.svgCursor):A.hideDefaultCursor?Object(l.hideToolCursor)(B):Object(l.resetToolCursor)(B))}var c=function(p,A,j){y("active",p,A,j),t.default.state.enabledElements.forEach(function(x){i(x,p,A,j)})},h=O.bind(null,"disabled",null),g=M.bind(null,"disabled",null),v=O.bind(null,"enabled",null),m=M.bind(null,"enabled",null),E=O.bind(null,"passive",a.default.TOOL_DEACTIVATED),T=M.bind(null,"passive",a.default.TOOL_DEACTIVATED);function O(B,p,A,j,x){var L=Object(d.default)(A,j);if(!L){s.warn('Unable to find tool "%s" for enabledElement',j);return}if(x=z(x),Array.isArray(x.mouseButtonMask)&&x.mouseButtonMask.length!==0&&Array.isArray(L.options.mouseButtonMask)&&(x.mouseButtonMask=H(x.mouseButtonMask,L.options.mouseButtonMask)),L.mode=B,L.mergeOptions(x),L["".concat(B,"Callback")]&&L["".concat(B,"Callback")](A,x),p){var U={options:x,toolName:j,toolType:j,type:p};Object(f.default)(A,p,U)}}function M(B,p,A,j){y(B,A,j),t.default.state.enabledElements.forEach(function(x){O(B,p,x,A,j)})}function P(B,p,A,j){p.supportedInteractionTypes.forEach(function(L){if(j===void 0||j.includes(L)){var U=b[L];U?U(p,B,A):s.warn("Unable to resolve input conflicts for type %s",L)}});var x=t.default.state.tools.filter(function(L){return L.element===B&&L.mode==="active"&&L.supportedInteractionTypes.length>0});x.forEach(function(L){var U=!1;L.supportedInteractionTypes.forEach(function(S){L.options["is".concat(S,"Active")]&&(U=!0)}),U||(s.log("Setting tool %s's to PASSIVE",L.name),E(B,L.name))})}function C(B,p,A){var j=z(A).mouseButtonMask,x=Array.isArray(j)&&j.length>0;if(x){var L=t.default.state.tools.find(function(U){return U.element===p&&U.mode==="active"&&U.options.isMouseActive===!0&&Array.isArray(U.options.mouseButtonMask)&&U.options.mouseButtonMask.some(function(S){return j.includes(S)})});L&&(L.options.mouseButtonMask=L.options.mouseButtonMask.filter(function(U){return!j.includes(U)}),L.options.mouseButtonMask.length===0&&(L.options.isMouseActive=!1))}}function _(B,p){var A=t.default.state.tools.find(function(x){return x.element===p&&x.mode==="active"&&x.options.isTouchActive===!0}),j=t.default.state.tools.find(function(x){return x.element===p&&x.mode==="active"&&x.options.isMultiTouchActive===!0&&x.configuration.touchPointers===1});A&&(s.log("Setting tool %s's isTouchActive to false",A.name),A.options.isTouchActive=!1),j&&(s.log("Setting tool %s's isTouchActive to false",j.name),j.options.isMultiTouchActive=!1)}function D(B,p){var A=t.default.state.tools.find(function(x){return x.element===p&&x.mode==="active"&&x.options.isMultiTouchActive===!0&&x.configuration.touchPointers===B.configuration.touchPointers}),j;B.configuration.touchPointers===1&&(j=t.default.state.tools.find(function(x){return x.element===p&&x.mode==="active"&&x.options.isTouchActive===!0})),A&&(s.log("Setting tool %s's isMultiTouchActive to false",A.name),A.options.isMultiTouchActive=!1),j&&(s.log("Setting tool %s's isTouchActive to false",j.name),j.options.isTouchActive=!1)}function I(B,p,A){var j="is".concat(B,"Active"),x=t.default.state.tools.find(function(L){return L.element===A&&L.mode==="active"&&L.options[j]===!0});x&&(s.log("Setting tool %s's %s to false",x.name,j),x.options[j]=!1)}function y(B,p,A,j){if(r.configuration.globalToolSyncEnabled){var x={mode:B,args:[p,A]};j&&x.push(j),t.default.state.globalToolChangeHistory.push(x);var L=50;t.default.state.globalToolChangeHistory.length>L&&t.default.state.globalToolChangeHistory.shift();var U=t.default.state.globalTools[p];if(!U){s.warn("setToolMode call for tool not available globally: ".concat(p));return}if(B==="active"){var S=R(p,A,j);Object.keys(t.default.state.globalTools).forEach(function(w){var G=t.default.state.globalTools[w];G.activeBindings=G.activeBindings.filter(function($){return!S.includes($)})}),S.some(function(w){return w.includes("Mouse-DELETE")})&&(U.activeBindings=U.activeBindings.filter(function(w){return!w.includes("Mouse")}),S=S.filter(function(w){return!w.includes("Mouse")})),U.activeBindings=U.activeBindings.concat(S)}else U.activeBindings=[]}}function R(B,p,A){A===void 0&&Array.isArray(p)&&(A=p,p=null);var j=[],x=t.default.state.globalTools[B];if(x){var L=new x.tool(x.props);L.supportedInteractionTypes.forEach(function(U){if(A===void 0||A.includes(U))if(U==="Mouse"){var S=z(p).mouseButtonMask;Array.isArray(S)&&S.length>0?S.forEach(function(w){return j.push("".concat(U,"-").concat(w))}):Array.isArray(S)&&S.length===0&&j.push("".concat(U,"-DELETE"))}else U==="MultiTouch"?j.push("".concat(U,"-").concat(L.configuration.touchPointers)):j.push(U)})}return j}var b={Mouse:C,MouseWheel:I.bind(void 0,"MouseWheel"),Touch:_,TouchPinch:I.bind(void 0,"TouchPinch"),TouchRotate:I.bind(void 0,"TouchRotate"),DoubleTap:I.bind(void 0,"DoubleTap"),MultiTouch:D};function z(B){return Array.isArray(B)?B={mouseButtonMask:B}:B!==Object(B)&&(B={mouseButtonMask:[B]}),B.hasOwnProperty("mouseButtonMask")||(B.mouseButtonMask=[]),Array.isArray(B.mouseButtonMask)||(B.mouseButtonMask=[B.mouseButtonMask]),B.mouseButtonMask=B.mouseButtonMask.filter(function(p){return typeof p=="number"&&p!==0}),B}function H(B,p){return B.concat(p).reduce(function(A,j){return A.indexOf(j)===-1&&A.push(j),A},[])}},"./store/setToolOptions.js":function(W,n,e){e.r(n),e.d(n,"setToolOptions",function(){return l}),e.d(n,"setToolOptionsForElement",function(){return d});var a=e("./store/getToolForElement.js"),f=e("./store/index.js"),d=function(t,r,s){var i=Object(a.default)(t,r);i&&i.mergeOptions(s)},l=function(t,r){f.state.enabledElements.forEach(function(s){d(s,t,r)})}},"./synchronization/Synchronizer.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./util/convertToVector3.js"),d=e("./toolOptions.js");function l(t){return t.filter(function(r,s,i){return i.indexOf(r)===s})}function o(t,r){a.default.cornerstone;var s=this,i=[],u=[],c=!1,h={},g=r;this.enabled=!0,this.setHandler=function(m){g=m},this.getHandler=function(){return g},this.getDistances=function(){if(!(!i.length||!u.length)){var m=a.default.cornerstone;h.distances={},h.imageIds={sourceElements:[],targetElements:[]},i.forEach(function(E){var T=m.getEnabledElement(E);if(!(!T||!T.image)){var O=T.image.imageId,M=m.metaData.get("imagePlaneModule",O);if(!(!M||!M.imagePositionPatient)){var P=Object(f.default)(M.imagePositionPatient);h.hasOwnProperty(T)||(h.distances[O]={},h.imageIds.sourceElements.push(O),u.forEach(function(C){var _=m.getEnabledElement(C);if(!(!_||!_.image)){var D=_.image.imageId;if(h.imageIds.targetElements.push(D),E!==C&&O!==D&&!h.distances[O].hasOwnProperty(D)){var I=m.metaData.get("imagePlaneModule",D);if(!(!I||!I.imagePositionPatient)){var y=Object(f.default)(I.imagePositionPatient);h.distances[O][D]=y.clone().sub(P)}}}}),Object.keys(h.distances[O]).length||delete h.distances[O])}}})}},this.fireEvent=function(m,E){var T=!s.enabled,O=!i.length||!u.length;T||O||(c=!0,u.forEach(function(M){var P=u.indexOf(M);if(P!==-1){var C=h.imageIds.targetElements[P],_=i.indexOf(m);if(_!==-1){var D=h.imageIds.sourceElements[_],I;D===C?I=0:h.distances[D]!==void 0&&(I=h.distances[D][C]),g(s,m,M,E,I)}}}),c=!1)},this.onEvent=function(m){var E=m.detail;c!==!0&&s.fireEvent(m.currentTarget,E)},this.addSource=function(m){var E=i.indexOf(m);E===-1&&(i.push(m),t.split(" ").forEach(function(T){m.addEventListener(T,s.onEvent)}),s.getDistances(),s.updateDisableHandlers())},this.addTarget=function(m){var E=u.indexOf(m);E===-1&&(u.push(m),s.getDistances(),g(s,m,m,0),s.updateDisableHandlers())},this.add=function(m){s.addSource(m),s.addTarget(m)},this.removeSource=function(m){var E=i.indexOf(m);E!==-1&&(i.splice(E,1),t.split(" ").forEach(function(T){m.removeEventListener(T,s.onEvent)}),s.getDistances(),s.fireEvent(m),s.updateDisableHandlers())},this.removeTarget=function(m){var E=u.indexOf(m);E!==-1&&(u.splice(E,1),s.getDistances(),g(s,m,m,0),s.updateDisableHandlers())},this.remove=function(m){s.removeTarget(m),s.removeSource(m)},this.getSourceElements=function(){return i},this.getTargetElements=function(){return u},this.displayImage=function(m,E,T){c=!0,a.default.cornerstone.displayImage(m,E,T),c=!1},this.setViewport=function(m,E){c=!0,a.default.cornerstone.setViewport(m,E),c=!1};function v(m){var E=m.detail.element;s.remove(E),Object(d.clearToolOptionsByElement)(E)}this.updateDisableHandlers=function(){var m=l(i.concat(u));m.forEach(function(E){E.removeEventListener(a.default.cornerstone.EVENTS.ELEMENT_DISABLED,v),E.addEventListener(a.default.cornerstone.EVENTS.ELEMENT_DISABLED,v)})},this.destroy=function(){var m=l(i.concat(u));m.forEach(function(E){s.remove(E)})}}n.default=o},"./synchronization/panZoomSynchronizer.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(f,d,l){if(l!==d){var o=a.default.cornerstone,t=o.getViewport(d),r=o.getViewport(l);r.scale===t.scale&&r.translation.x===t.translation.x&&r.translation.y===t.translation.y||(r.scale=t.scale,r.translation.x=t.translation.x,r.translation.y=t.translation.y,f.setViewport(l,r))}}},"./synchronization/stackImageIndexSynchronizer.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./stateManagement/toolState.js"),d=e("./stateManagement/loadHandlerManager.js"),l=e("./util/clip.js");n.default=function(o,t,r){if(r!==t){var s=a.default.cornerstone,i=Object(f.getToolState)(t,"stack"),u=i.data[0],c=Object(f.getToolState)(r,"stack"),h=c.data[0],g=u.currentImageIdIndex;if(g=Object(l.default)(g,0,h.imageIds.length-1),g!==h.currentImageIdIndex){var v=d.default.getStartLoadHandler(r),m=d.default.getEndLoadHandler(r),E=d.default.getErrorLoadingHandler(r);v&&v(r);var T;h.preventCache===!0?T=s.loadImage(h.imageIds[g]):T=s.loadAndCacheImage(h.imageIds[g]),T.then(function(O){var M=s.getViewport(r);h.currentImageIdIndex=g,o.displayImage(r,O,M),m&&m(r,O)},function(O){var M=h.imageIds[g];E&&E(r,M,O)})}}}},"./synchronization/stackImagePositionOffsetSynchronizer.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./stateManagement/toolState.js"),d=e("./stateManagement/loadHandlerManager.js"),l=e("./util/convertToVector3.js");n.default=function(o,t,r,s,i){if(r!==t){var u=a.default.cornerstone,c=Object(f.getToolState)(t,"stack").data[0],h=c.imageIds[c.currentImageIdIndex],g=u.metaData.get("imagePlaneModule",h);if(!(g===void 0||g.imagePositionPatient===void 0)){var v=Object(l.default)(g.imagePositionPatient),m=Object(f.getToolState)(r,"stack"),E=m.data[0],T=Number.MAX_VALUE,O=-1;if(i){var M=v.clone().add(i);if(E.imageIds.forEach(function(y,R){var b=u.metaData.get("imagePlaneModule",y);if(!(b===void 0||b.imagePositionPatient===void 0)){var z=Object(l.default)(b.imagePositionPatient),H=M.distanceToSquared(z);H<T&&(T=H,O=R)}}),!(O===E.currentImageIdIndex||O===-1)){var P=d.default.getStartLoadHandler(r),C=d.default.getEndLoadHandler(r),_=d.default.getErrorLoadingHandler(r);E.currentImageIdIndex=O;var D=E.imageIds[O];P&&P(r);var I;E.preventCache===!0?I=u.loadImage(D):I=u.loadAndCacheImage(D),I.then(function(y){var R=u.getViewport(r);E.currentImageIdIndex===O&&(o.displayImage(r,y,R),C&&C(r,y))},function(y){var R=E.imageIds[O];_&&_(r,R,y)})}}}}}},"./synchronization/stackImagePositionSynchronizer.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./stateManagement/toolState.js"),d=e("./stateManagement/loadHandlerManager.js"),l=e("./util/convertToVector3.js");n.default=function(o,t,r){if(r!==t){var s=a.default.cornerstone,i=Object(f.getToolState)(t,"stack").data[0],u=i.imageIds[i.currentImageIdIndex],c=s.metaData.get("imagePlaneModule",u);if(!(c===void 0||c.imagePositionPatient===void 0)){var h=Object(l.default)(c.imagePositionPatient),g=Object(f.getToolState)(r,"stack"),v=g.data[0],m=Number.MAX_VALUE,E=-1;if(v.imageIds.forEach(function(_,D){var I=s.metaData.get("imagePlaneModule",_);if(!(I===void 0||I.imagePositionPatient===void 0)){var y=Object(l.default)(I.imagePositionPatient),R=y.distanceToSquared(h);R<m&&(m=R,E=D)}}),E!==v.currentImageIdIndex){var T=d.default.getStartLoadHandler(r),O=d.default.getEndLoadHandler(r),M=d.default.getErrorLoadingHandler(r);v.currentImageIdIndex=E;var P=v.imageIds[E];if(T&&T(r),E!==-1){var C;v.preventCache===!0?C=s.loadImage(P):C=s.loadAndCacheImage(P),C.then(function(_){var D=s.getViewport(r);v.currentImageIdIndex===E&&(o.displayImage(r,_,D),O&&O(r,_))},function(_){var D=v.imageIds[E];M&&M(r,D,_)})}}}}}},"./synchronization/stackScrollSynchronizer.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./stateManagement/toolState.js"),d=e("./stateManagement/loadHandlerManager.js"),l=e("./util/clip.js");n.default=function(o,t,r,s){if(t!==r&&!(!s||!s.direction)){var i=a.default.cornerstone,u=Object(f.getToolState)(r,"stack"),c=u.data[0],h=c.currentImageIdIndex+s.direction;if(h=Object(l.default)(h,0,c.imageIds.length-1),c.currentImageIdIndex!==h){var g=d.default.getStartLoadHandler(r),v=d.default.getEndLoadHandler(r),m=d.default.getErrorLoadingHandler(r);c.currentImageIdIndex=h;var E=c.imageIds[h];g&&g(r);var T;c.preventCache===!0?T=i.loadImage(E):T=i.loadAndCacheImage(E),T.then(function(O){var M=i.getViewport(r);c.currentImageIdIndex===h&&(o.displayImage(r,O,M),v&&v(r,O))},function(O){var M=c.imageIds[h];m&&m(r,M,O)})}}}},"./synchronization/updateImageSynchronizer.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(f,d,l){l!==d&&a.default.cornerstone.updateImage(l)}},"./synchronization/wwwcSynchronizer.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(f,d,l){if(l!==d){var o=a.default.cornerstone,t=o.getViewport(d),r=o.getViewport(l);r.voi.windowWidth===t.voi.windowWidth&&r.voi.windowCenter===t.voi.windowCenter&&r.invert===t.invert||(r.voi.windowWidth=t.voi.windowWidth,r.voi.windowCenter=t.voi.windowCenter,r.invert=t.invert,f.setViewport(l,r))}}},"./thirdParty/register.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/typeof.js"),f=e.n(a),d=e("./thirdParty/registerModule.js"),l=e("./thirdParty/registerMixin.js"),o=e("./thirdParty/registerItem.js"),t=e("./util/logger.js"),r=Object(t.getLogger)("thirdParty:register");n.default=function(i,u,c){var h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(s(i,u,c))switch(i){case"module":Object(d.default)(u,c,h);break;case"mixin":Object(l.default)(u,c,h);break;default:Object(o.default)(i,u,c,h)}};function s(i,u,c){return i?u?f()(c)!=="object"&&typeof c!="function"?(r.warn("The %s is a %s, it should be an Object or a function.",c,f()(c)),!1):!0:(r.warn("The %s must have a name in order to register.",i),!1):(r.warn("The type must be given in order to register."),!1)}},"./thirdParty/registerItem.js":function(W,n,e){e.r(n);var a=e("./lib.js"),f=e("./util/logger.js"),d=Object(f.getLogger)("thirdParty:registerType");n.default=function(o,t,r){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i="".concat(o,"/").concat(t),u=l(i);if(u&&!s){d.warn("%s is already registered",i);return}u&&d.warn("Overwriting %s",i),a.lib[i]=r};function l(o){return a.lib[o]!==void 0}},"./thirdParty/registerMixin.js":function(W,n,e){e.r(n);var a=e("./lib.js"),f=e("./mixins/index.js"),d=e("./util/logger.js"),l=Object(d.getLogger)("thirdParty:registerMixin");n.default=function(t,r){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=o(t);if(i&&!s){l.warn("mixins/%s is already registered",t);return}i&&l.warn("Overwriting mixins/%s",t),f.default[t]=r,a.lib["mixins/".concat(t)]=f.default[t]};function o(t){return f.default[t]!==void 0}},"./thirdParty/registerModule.js":function(W,n,e){e.r(n);var a=e("./store/index.js"),f=e("./util/logger.js"),d=Object(f.getLogger)("thirdParty:registerModule");n.default=function(o,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=l(o);if(s&&!r){d.warn("A module with the name %s is already registered",o);return}s&&d.warn("Overwriting module %s",o),a.modules[o]=t,typeof a.modules[o].onRegisterCallback=="function"&&a.modules[o].onRegisterCallback()};function l(o){return a.modules[o]!==void 0}},"./thirdParty/registerSome.js":function(W,n,e){e.r(n);var a=e("./thirdParty/register.js");n.default=function(f){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;f.forEach(function(l){var o=l.type,t=l.name,r=l.item;Object(a.default)(o,t,r,d)})}},"./toolOptions.js":function(W,n,e){e.r(n),e.d(n,"getToolOptions",function(){return f}),e.d(n,"setToolOptions",function(){return d}),e.d(n,"clearToolOptions",function(){return l}),e.d(n,"clearToolOptionsByToolType",function(){return o}),e.d(n,"clearToolOptionsByToolName",function(){return t}),e.d(n,"clearToolOptionsByElement",function(){return r});var a={};function f(s,i){if(!a[s])return{};var u=a[s],c=u.find(function(h){return h.element===i});return c?c.options:{}}function d(s,i,u){if(!a[s]){a[s]=[{element:i,options:u}];return}var c=a[s],h=c.findIndex(function(v){return v.element===i});if(h===-1)a[s].push({element:i,options:u});else{var g=a[s][h].options||{};a[s][h].options=Object.assign(g,u)}}function l(s,i){var u=a[s];u&&(a[s]=u.filter(function(c){return c.element!==i}))}function o(s){return t(s)}function t(s){delete a[s]}function r(s){for(var i in a)a[i]=a[i].filter(function(u){return u.element!==s})}},"./tools/CrosshairsTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return C});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./tools/base/BaseTool.js"),v=e("./externalModules.js"),m=e("./stateManagement/loadHandlerManager.js"),E=e("./stateManagement/toolState.js"),T=e("./util/pointProjector.js"),O=e("./util/convertToVector3.js"),M=e("./toolOptions.js"),P=e("./tools/cursors/index.js"),C=function(_){h()(D,_);function D(){var I,y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,D);var R={name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"],svgCursor:P.crosshairsCursor};return I=t()(this,s()(D).call(this,y,R)),I.preMouseDownCallback=I._chooseLocation.bind(u()(I)),I.mouseDragCallback=I._chooseLocation.bind(u()(I)),I.touchDragCallback=I._chooseLocation.bind(u()(I)),I}return l()(D,[{key:"_chooseLocation",value:function(y){var R=y.detail,b=R.element;y.stopImmediatePropagation();var z=Object(E.getToolState)(b,this.name);if(z){var H=b,B=v.default.cornerstone.getEnabledElement(H),p=B.image.imageId,A=v.default.cornerstone.metaData.get("imagePlaneModule",p);if(A){var j=R.currentPoints.image,x=Object(T.imagePointToPatientPoint)(j,A),L=z.data[0].synchronizationContext,U=L.getSourceElements();U.forEach(function(S){if(S!==H){var w=Number.MAX_VALUE,G=-1,$=Object(E.getToolState)(S,"stack");if($!==void 0){var Q=$.data[0];if(Q.imageIds.forEach(function(Y,V){var te=v.default.cornerstone.metaData.get("imagePlaneModule",Y);if(!(!te||!te.imagePositionPatient||!te.rowCosines||!te.columnCosines)){var ne=Object(O.default)(te.imagePositionPatient),ue=Object(O.default)(te.rowCosines),ge=Object(O.default)(te.columnCosines),ve=ge.clone().cross(ue.clone()),Ee=Math.abs(ve.clone().dot(ne)-ve.clone().dot(x));Ee<w&&(w=Ee,G=V)}}),G!==Q.currentImageIdIndex&&G!==-1&&Q.imageIds[G]!==void 0){var re=m.default.getStartLoadHandler(S),le=m.default.getEndLoadHandler(S),de=m.default.getErrorLoadingHandler(S);re&&re(S);var me;Q.preventCache===!0?me=v.default.cornerstone.loadImage(Q.imageIds[G]):me=v.default.cornerstone.loadAndCacheImage(Q.imageIds[G]),me.then(function(Y){var V=v.default.cornerstone.getViewport(S);Q.currentImageIdIndex=G,v.default.cornerstone.displayImage(S,Y,V),le&&le(S,Y)},function(Y){var V=Q.imageIds[G];de&&de(S,V,Y)})}}}})}}}},{key:"activeCallback",value:function(y,R){var b=R.mouseButtonMask,z=R.synchronizationContext;Object(M.setToolOptions)(this.name,y,{mouseButtonMask:b}),Object(E.clearToolState)(y,this.name),Object(E.addToolState)(y,this.name,{synchronizationContext:z})}}]),D}(g.default)},"./tools/DoubleTapFitToWindowTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return g});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseTool.js"),g=function(v){u()(m,v);function m(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,m);var T={name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]};return t()(this,s()(m).call(this,E,T))}return l()(m,[{key:"doubleTapCallback",value:function(T){var O=T.detail;c.default.cornerstone.fitToWindow(O.element)}}]),m}(h.default)},"./tools/DragProbeTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return _});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./externalModules.js"),v=e("./tools/base/BaseTool.js"),m=e("./stateManagement/textStyle.js"),E=e("./stateManagement/toolColors.js"),T=e("./util/getRGBPixels.js"),O=e("./util/calculateSUV.js"),M=e("./drawing/index.js"),P=e("./drawing/drawTextBox.js"),C=e("./tools/cursors/index.js"),_=function(y){h()(R,y);function R(){var b,z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,R);var H={name:"DragProbe",strategies:{default:D,minimal:I},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],svgCursor:C.probeCursor};return b=t()(this,s()(R).call(this,z,H)),b.touchDragCallback=b._movingEventCallback.bind(u()(b)),b.touchEndCallback=b._endMovingEventCallback.bind(u()(b)),b.mouseDragCallback=b._movingEventCallback.bind(u()(b)),b.mouseUpCallback=b._endMovingEventCallback.bind(u()(b)),b.dragEventData={},b}return l()(R,[{key:"_movingEventCallback",value:function(z){var H=z.detail,B=H.element;this.dragEventData=H,g.default.cornerstone.updateImage(B)}},{key:"_endMovingEventCallback",value:function(z){var H=z.detail,B=H.element;this.dragEventData={},g.default.cornerstone.updateImage(B)}},{key:"renderToolData",value:function(z){this.dragEventData.currentPoints&&z&&z.detail&&Object.keys(this.dragEventData.currentPoints).length&&(z.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(z))}}]),R}(v.default);function D(y){var R=this.configuration,b=g.default.cornerstone,z=y.detail,H=z.element,B=z.image,p=z.currentPoints,A=z.canvasContext,j=Object(M.getNewContext)(A.canvas),x=E.default.getActiveColor(),L=m.default.getFontSize(),U=Math.round(p.image.x),S=Math.round(p.image.y);U<0||S<0||U>=B.columns||S>=B.rows||Object(M.draw)(j,function(w){Object(M.setShadow)(w,R);var G="".concat(U,", ").concat(S),$,Q;if(B.color)$=Object(T.default)(H,U,S,1,1),Q="R: ".concat($[0]," G: ").concat($[1]," B: ").concat($[2]," A: ").concat($[3]);else{$=b.getStoredPixels(H,U,S,1,1);var re=$[0],le=re*B.slope+B.intercept,de=Object(O.default)(B,re);Q="SP: ".concat(re," MO: ").concat(parseFloat(le.toFixed(3))),de&&(Q+=" SUV: ".concat(parseFloat(de.toFixed(3))))}var me={x:p.canvas.x+5,y:p.canvas.y-5};Object(P.default)(w,Q,me.x,me.y+L+5,x),Object(P.default)(w,G,me.x,me.y,x)})}function I(y){var R=this.configuration,b=g.default.cornerstone,z=y.detail,H=z.element,B=z.image,p=z.currentPoints,A=z.canvasContext,j=z.isTouchEvent,x=Object(M.getNewContext)(A.canvas),L=E.default.getActiveColor(),U=p.page.y-m.default.getFontSize()/2;j&&(U=p.page.y-m.default.getFontSize()*4);var S=b.pageToPixel(H,p.page.x,U);S.x<0||S.y<0||S.x>=B.columns||S.y>=B.rows||Object(M.draw)(x,function(w){Object(M.setShadow)(w,R);var G=b.metaData.get("generalSeriesModule",B.imageId),$=G&&G.modality,Q,re="";if(B.color)Q=Object(T.default)(H,S.x,S.y,1,1),re="R: ".concat(Q[0]," G: ").concat(Q[1]," B: ").concat(Q[2]);else{Q=b.getStoredPixels(H,S.x,S.y,1,1);var le=Q[0],de=le*B.slope+B.intercept,me=parseFloat(de.toFixed(2));if($==="CT")re+="HU: ".concat(me);else if($==="PT"){re+=me;var Y=Object(O.default)(B,le);Y&&(re+=" SUV: ".concat(parseFloat(Y.toFixed(2))))}else re+=me}var V=b.pixelToCanvas(H,S),te={x:12,y:-(m.default.getFontSize()+10)/2},ne=6,ue=5,ge=Object(P.textBoxWidth)(w,re,ue);j&&(te={x:-ge/2,y:-m.default.getFontSize()-10-2*ne}),Object(M.drawCircle)(w,H,V,ne,{color:L},"canvas"),Object(P.default)(w,re,V.x+te.x,V.y+te.y,L)})}},"./tools/EraserTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return O});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./externalModules.js"),v=e("./tools/base/BaseTool.js"),m=e("./stateManagement/toolState.js"),E=e("./store/index.js"),T=e("./tools/cursors/index.js"),O=function(M){h()(P,M);function P(){var C,_=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,P);var D={name:"Eraser",supportedInteractionTypes:["Mouse","Touch"],svgCursor:T.eraserCursor};return C=t()(this,s()(P).call(this,_,D)),C.preMouseDownCallback=C._deleteAllNearbyTools.bind(u()(C)),C.preTouchStartCallback=C._deleteAllNearbyTools.bind(u()(C)),C}return l()(P,[{key:"_deleteAllNearbyTools",value:function(_){var D=_.detail.currentPoints.canvas,I=_.detail.element;E.state.tools.forEach(function(R){var b=Object(m.getToolState)(I,R.name);b&&b.data.forEach(function(z){typeof R.pointNearTool=="function"&&R.pointNearTool(I,z,D)&&(Object(m.removeToolState)(I,R.name,z),g.default.cornerstone.updateImage(I))})});var y=!0;return y}}]),P}(v.default)},"./tools/FreehandRoiSculptorTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return R});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./events.js"),v=e("./externalModules.js"),m=e("./stateManagement/toolColors.js"),E=e("./drawing/drawHandles.js"),T=e("./store/index.js"),O=e("./stateManagement/toolState.js"),M=e("./util/clip.js"),P=e("./store/getToolForElement.js"),C=e("./tools/base/BaseTool.js"),_=e("./store/setToolCursor.js"),D=e("./tools/cursors/index.js"),I=e("./util/freehand/index.js"),y=I.default.FreehandHandleData,R=function(H){h()(B,H);function B(){var p,A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,B);var j={name:"FreehandRoiSculptor",referencedToolName:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch","DoubleTap"],mixins:["activeOrDisabledBinaryTool"],configuration:b(),svgCursor:D.freehandRoiSculptorCursor};return p=t()(this,s()(B).call(this,A,j)),p.updateOnMouseMove=!0,p.isMultiPartTool=!0,p.referencedToolName=p.initialConfiguration.referencedToolName,p._active=!1,p.activeMouseUpCallback=p.activeMouseUpCallback.bind(u()(p)),p.activeTouchEndCallback=p.activeTouchEndCallback.bind(u()(p)),p.activeMouseDragCallback=p.activeMouseDragCallback.bind(u()(p)),p}return l()(B,[{key:"renderToolData",value:function(A){var j=A.detail;if(this.configuration.currentTool===null)return!1;var x=j.element,L=this.configuration,U=Object(O.getToolState)(x,this.referencedToolName),S=U.data[L.currentTool];if(!S)return!1;if(this._active){var w=j.canvasContext.canvas.getContext("2d"),G={color:this.configuration.dragColor,fill:null,handleRadius:this._toolSizeCanvas};Object(E.default)(w,j,this.configuration.mouseLocation.handles,G)}else this.configuration.showCursorOnHover&&!this._recentTouchEnd&&this._renderHoverCursor(A)}},{key:"doubleClickCallback",value:function(A){var j=A.detail;this._selectFreehandTool(j),v.default.cornerstone.updateImage(j.element)}},{key:"doubleTapCallback",value:function(A){var j=A.detail;this._selectFreehandTool(j),v.default.cornerstone.updateImage(j.element)}},{key:"preTouchStartCallback",value:function(A){return this._initialiseSculpting(A),!0}},{key:"preMouseDownCallback",value:function(A){if(this.options.mouseButtonMask.includes(A.detail.buttons))return this._initialiseSculpting(A),!0}},{key:"activeMouseDragCallback",value:function(A){var j=this.configuration;if(this._active){var x=A.detail,L=Object(O.getToolState)(x.element,this.referencedToolName);if(L){var U=L.data[j.currentTool].handles.points;this._getMouseLocation(x),this._sculpt(x,U),v.default.cornerstone.updateImage(x.element)}}}},{key:"activeMouseUpCallback",value:function(A){this._activeEnd(A)}},{key:"activeTouchEndCallback",value:function(A){this._activeEnd(A),this._deselectAllTools(A),this._recentTouchEnd=!0}},{key:"_activeEnd",value:function(A){var j=A.detail,x=j.element,L=this.configuration;this._active=!1,T.state.isMultiPartToolActive=!1,this._getMouseLocation(j),this._invalidateToolData(j),L.mouseUpRender=!0,this._deactivateSculpt(x),v.default.cornerstone.updateImage(j.element),z(A)}},{key:"_renderHoverCursor",value:function(A){var j=A.detail,x=j.element,L=j.canvasContext.canvas.getContext("2d"),U=Object(O.getToolState)(x,this.referencedToolName),S=U.data[this.configuration.currentTool];this._recentTouchEnd=!1;var w;this.configuration.mouseUpRender?(w=this.configuration.mouseLocation.handles.start,this.configuration.mouseUpRender=!1):w=T.state.mousePositionImage;var G=Object(P.default)(x,this.referencedToolName),$=G.distanceFromPointCanvas(x,S,w);if(this.configuration.mouseLocation.handles.start.x=w.x,this.configuration.mouseLocation.handles.start.y=w.y,this.configuration.limitRadiusOutsideRegion){var Q=$;$=this._limitCursorRadiusCanvas(j,$),Q>this.configuration.hoverCursorFadeDistance*$&&(L.globalAlpha=this.configuration.hoverCursorFadeAlpha)}var re={fill:null,color:this.configuration.hoverColor,handleRadius:$};Object(E.default)(L,j,this.configuration.mouseLocation.handles,re),this.configuration.limitRadiusOutsideRegion&&(L.globalAlpha=1)}},{key:"newImageCallback",value:function(A){this._deselectAllTools(A)}},{key:"enabledCallback",value:function(A){this._deselectAllTools(A)}},{key:"passiveCallback",value:function(A){this._deselectAllTools(A)}},{key:"disabledCallback",value:function(A){this._deselectAllTools(A)}},{key:"_selectFreehandTool",value:function(A){var j=this.configuration,x=A.element,L=this._getClosestFreehandToolOnElement(x,A);L!==void 0&&(j.currentTool=L,Object(_.hideToolCursor)(x))}},{key:"_activateFreehandTool",value:function(A,j){var x=Object(O.getToolState)(A,this.referencedToolName),L=x.data,U=this.configuration;U.currentTool=j;for(var S=0;S<L.length;S++)S===j?L[S].active=!0:L[S].active=!1}},{key:"_initialiseSculpting",value:function(A){var j=A.detail,x=this.configuration,L=j.element;x.currentTool===null&&(this._selectFreehandTool(j),x.currentTool===null)||(this._active=!0,T.state.isMultiPartToolActive=!0,this._configureToolSize(j),this._getMouseLocation(j),this._activateFreehandTool(L,x.currentTool),this._activateSculpt(L),v.default.cornerstone.updateImage(j.element))}},{key:"_sculpt",value:function(A,j){var x=this.configuration;this._sculptData={element:A.element,image:A.image,mousePoint:A.currentPoints.image,points:j,toolSize:this._toolSizeImage,minSpacing:x.minSpacing,maxSpacing:Math.max(this._toolSizeImage,x.minSpacing*2)};var L=this._pushHandles();L.first!==void 0&&(this._insertNewHandles(L),this._consolidateHandles())}},{key:"_pushHandles",value:function(){for(var A=this._sculptData,j=A.points,x=A.mousePoint,L=A.toolSize,U={},S=0;S<j.length;S++){var w=v.default.cornerstoneMath.point.distance(j[S],x);w>L||(this._pushOneHandle(S,w),U.first===void 0&&(U.first=S),U.last=S)}return U}},{key:"_pushOneHandle",value:function(A,j){var x=this._sculptData,L=x.points,U=x.mousePoint,S=x.toolSize,w=x.image,G=L[A],$={x:(G.x-U.x)/j,y:(G.y-U.y)/j},Q={x:U.x+S*$.x,y:U.y+S*$.y};Object(M.clipToBox)(Q,w),G.x=Q.x,G.y=Q.y;var re=this.constructor._getPreviousHandleIndex(A,L.length);L[re].lines.pop(),L[re].lines.push(G)}},{key:"_insertNewHandles",value:function(A){for(var j=this._findNewHandleIndicies(A),x=0,L=0;L<j.length;L++){var U=j[L]+1+x;this._insertHandleRadially(U),x++}}},{key:"_findNewHandleIndicies",value:function(A){for(var j=this._sculptData,x=j.points,L=j.maxSpacing,U=[],S=A.first;S<=A.last;S++)this._checkSpacing(S,x,U,L);var w=this.constructor._getNextHandleIndex(A.last,x.length);if(w!==A.first){this._checkSpacing(w,x,U,L);var G=this.constructor._getPreviousHandleIndex(A.first,x.length);G!==w&&this._checkSpacing(G,x,U,L)}return U}},{key:"_checkSpacing",value:function(A,j,x,L){var U=this.constructor._getNextHandleIndex(A,j.length),S=v.default.cornerstoneMath.point.distance(j[A],j[U]);S>L&&x.push(A)}},{key:"_insertHandleRadially",value:function(A){var j=this._sculptData.points,x=A-1,L=this.constructor._getNextHandleIndexBeforeInsert(A,j.length),U=this._getInsertPosition(A,x,L),S=new y(U);j.splice(A,0,S),j[x].lines.pop(),j[x].lines.push(j[A]),I.default.addLine(j,A)}},{key:"_consolidateHandles",value:function(){var A=this._sculptData.points;if(!(A.length<=3)){var j=this._findCloseHandlePairs();this._mergeCloseHandles(j)}}},{key:"_findCloseHandlePairs",value:function(){for(var A=this._sculptData,j=A.points,x=A.minSpacing,L=[],U=j.length,S=0;S<U;S++){var w=this.constructor._getNextHandleIndex(S,j.length),G=v.default.cornerstoneMath.point.distance(j[S],j[w]);if(G<x){var $=[S,w];L.push($),S===0&&(U-=1),S++}}return L}},{key:"_mergeCloseHandles",value:function(A){for(var j=0,x=0;x<A.length;x++){var L=this.constructor._getCorrectedPair(A[x],j);this._combineHandles(L),j++}var U=this._findCloseHandlePairs();U.length&&this._mergeCloseHandles(U)}},{key:"_combineHandles",value:function(A){var j=this._sculptData,x=j.points,L=j.image,U={x:(x[A[0]].x+x[A[1]].x)/2,y:(x[A[0]].y+x[A[1]].y)/2};Object(M.clipToBox)(U,L),x[A[0]].x=U.x,x[A[0]].y=U.y;var S=this.constructor._getNextHandleIndex(A[1],x.length);x[A[0]].lines.pop(),x[A[0]].lines.push(x[S]),x.splice(A[1],1)}},{key:"_configureToolSize",value:function(A){var j=A.element,x=this.configuration,L=x.currentTool,U=A.currentPoints.image,S=Object(O.getToolState)(j,this.referencedToolName),w=S.data[L],G=Object(P.default)(j,this.referencedToolName),$=G.distanceFromPoint(j,w,U),Q=G.distanceFromPointCanvas(j,w,U);x.limitRadiusOutsideRegion&&($=this._limitCursorRadiusImage(A,$),Q=this._limitCursorRadiusCanvas(A,Q)),this._toolSizeImage=$,this._toolSizeCanvas=Q}},{key:"_getMouseLocation",value:function(A){var j=this.configuration;j.mouseLocation.handles.start.x=A.currentPoints.image.x,j.mouseLocation.handles.start.y=A.currentPoints.image.y,Object(M.clipToBox)(j.mouseLocation.handles.start,A.image)}},{key:"_activateSculpt",value:function(A){this._deactivateSculpt(A),A.addEventListener(g.default.MOUSE_UP,this.activeMouseUpCallback),A.addEventListener(g.default.MOUSE_CLICK,this.activeMouseUpCallback),A.addEventListener(g.default.MOUSE_DRAG,this.activeMouseDragCallback),A.addEventListener(g.default.TOUCH_END,this.activeTouchEndCallback),A.addEventListener(g.default.TOUCH_TAP,this.activeTouchEndCallback),A.addEventListener(g.default.TOUCH_DRAG,this.activeMouseDragCallback),v.default.cornerstone.updateImage(A)}},{key:"_deactivateSculpt",value:function(A){A.removeEventListener(g.default.MOUSE_UP,this.activeMouseUpCallback),A.removeEventListener(g.default.MOUSE_CLICK,this.activeMouseUpCallback),A.removeEventListener(g.default.MOUSE_DRAG,this.activeMouseDragCallback),A.removeEventListener(g.default.TOUCH_END,this.activeTouchEndCallback),A.removeEventListener(g.default.TOUCH_TAP,this.activeTouchEndCallback),A.removeEventListener(g.default.TOUCH_DRAG,this.activeMouseDragCallback),v.default.cornerstone.updateImage(A)}},{key:"_invalidateToolData",value:function(A){var j=this.configuration,x=A.element,L=Object(O.getToolState)(x,this.referencedToolName),U=L.data[j.currentTool];U.invalidated=!0}},{key:"_deselectAllTools",value:function(A){var j=this.configuration,x=Object(O.getToolState)(this.element,this.referencedToolName);if(j.currentTool=null,x)for(var L=0;L<x.data.length;L++)x.data[L].active=!1;Object(_.setToolCursor)(this.element,this.svgCursor),v.default.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(A,j){return this._limitCursorRadius(A,j,!0)}},{key:"_limitCursorRadiusImage",value:function(A,j){return this._limitCursorRadius(A,j,!1)}},{key:"_limitCursorRadius",value:function(A,j){var x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,L=A.element,U=A.image,S=this.configuration,w=Object(O.getToolState)(L,this.referencedToolName),G=w.data[S.currentTool],$=1;if(x){var Q=v.default.cornerstone.pixelToCanvas(L,{x:0,y:0}),re=v.default.cornerstone.pixelToCanvas(L,{x:U.width,y:U.height}),le=(re.x-Q.x)*(re.y-Q.y);$=le/(U.width*U.height)}var de=G.area*$,me=Math.pow(de/Math.PI,.5);return Math.min(j,me)}},{key:"_getClosestFreehandToolOnElement",value:function(A,j){var x=Object(P.default)(A,this.referencedToolName),L=Object(O.getToolState)(A,this.referencedToolName);if(L){for(var U=L.data,S=j.currentPoints.image,w={distance:1/0,toolIndex:null},G=0;G<U.length;G++){var $=x.distanceFromPoint(A,U[G],S);$!==-1&&$<w.distance&&(w.distance=$,w.toolIndex=G)}return w.toolIndex}}},{key:"_getInsertPosition",value:function(A,j,x){var L=this._sculptData,U=L.points,S=L.toolSize,w=L.mousePoint,G=L.image,$={x:(U[j].x+U[x].x)/2,y:(U[j].y+U[x].y)/2},Q=v.default.cornerstoneMath.point.distance(w,$),re;if(Q<S){var le={x:($.x-w.x)/Q,y:($.y-w.y)/Q};re={x:w.x+S*le.x,y:w.y+S*le.y}}else re=$;return Object(M.clipToBox)(re,G),re}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(A){if(typeof A!="number")throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=A}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(A){if(typeof A!="number")throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=A}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(A){if(typeof A!="boolean")throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=A,v.default.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(A){if(typeof A!="boolean")throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=A,v.default.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(A){if(typeof A!="number")throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");A=Math.max(Math.min(A,1),0),this.configuration.hoverCursorFadeAlpha=A,v.default.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(A){if(typeof A!="number")throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");A=Math.max(A,1),this.configuration.hoverCursorFadeDistance=A,v.default.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(A,j){var x=[A[0]-j,A[1]-j];return x[1]<0&&(x[1]=0),x}},{key:"_getNextHandleIndex",value:function(A,j){return A===j-1?0:A+1}},{key:"_getPreviousHandleIndex",value:function(A,j){return A===0?j-1:A-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(A,j){return A===j?0:A}}]),B}(C.default);function b(){return{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:1,currentTool:null,dragColor:m.default.getActiveColor(),hoverColor:m.default.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}}function z(H){H.stopImmediatePropagation(),H.stopPropagation(),H.preventDefault()}},"./tools/MagnifyTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return O});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./externalModules.js"),v=e("./drawing/index.js"),m=e("./tools/base/BaseTool.js"),E=e("./store/setToolCursor.js"),T=e("./tools/cursors/index.js"),O=function(M){h()(P,M);function P(){var C,_=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,P);var D={name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2},svgCursor:T.magnifyCursor};return C=t()(this,s()(P).call(this,_,D)),C.zoomCanvas=void 0,C.zoomElement=void 0,C.activeCallback=C._createMagnificationCanvas.bind(u()(C)),C.enabledCallback=C._createMagnificationCanvas.bind(u()(C)),C.disabledCallback=C._destroyMagnificationCanvas.bind(u()(C)),C.postTouchStartCallback=C._addMagnifyingGlass.bind(u()(C)),C.touchDragCallback=C._updateMagnifyingGlass.bind(u()(C)),C.touchEndCallback=C._removeMagnifyingGlass.bind(u()(C)),C.touchDragEndCallback=C._removeMagnifyingGlass.bind(u()(C)),C.postMouseDownCallback=C._addMagnifyingGlass.bind(u()(C)),C.mouseDragCallback=C._updateMagnifyingGlass.bind(u()(C)),C.mouseUpCallback=C._removeMagnifyingGlass.bind(u()(C)),C.mouseClickCallback=C._removeMagnifyingGlass.bind(u()(C)),C.newImageCallback=C._drawMagnificationTool.bind(u()(C)),C}return l()(P,[{key:"_addMagnifyingGlass",value:function(_){var D=this;this._removeZoomElement(),this._drawZoomedElement(_),window.requestAnimationFrame(function(){return D._drawMagnificationTool(_)}),Object(E.hideToolCursor)(_.detail.element),_.preventDefault(),_.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(_){this._drawMagnificationTool(_),_.preventDefault(),_.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(_){var D=_.detail.element;Object(E.setToolCursor)(this.element,this.svgCursor),D.querySelector(".magnifyTool").style.display="none",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(_){var D=_.detail.element,I=D.querySelector(".magnifyTool");if(I||this._createMagnificationCanvas(D),this.zoomCanvas!==void 0){var y=D.querySelector("canvas:not(.magnifyTool)"),R=Object(v.getNewContext)(I),b=g.default.cornerstone.pixelToCanvas(_.detail.element,_.detail.currentPoints.image),z=Math.min(this.configuration.magnifySize,y.width,y.height),H=this.configuration.magnificationLevel;I.width=z,I.height=z,b.x=Math.max(b.x,.5*z/H),b.x=Math.min(b.x,y.width-.5*z/H),b.y=Math.max(b.y,.5*z/H),b.y=Math.min(b.y,y.height-.5*z/H);var B={x:b.x*H-.5*z,y:b.y*H-.5*z};B.x=Math.max(B.x,0),B.y=Math.max(B.y,0),R.drawImage(this.zoomCanvas,B.x,B.y,z,z,0,0,z,z);var p=_.detail.isTouchEvent?120:0,A={top:Math.max(b.y-.5*z-p,0),left:Math.max(b.x-.5*z,0)},j=I.getBoundingClientRect();A.top=Math.min(A.top,y.height-j.height),A.left=Math.min(A.left,y.width-j.width),I.style.top="".concat(A.top,"px"),I.style.left="".concat(A.left,"px"),I.style.display="block"}}},{key:"_drawZoomedElement",value:function(_){var D=_.detail.element,I=_.detail.enabledElement;I===void 0&&(I=g.default.cornerstone.getEnabledElement(D));var y=this.configuration.magnificationLevel,R=I.canvas,b=I.image;this.zoomElement||(this.zoomElement=document.createElement("div"),this.zoomElement.width=R.width*y,this.zoomElement.height=R.height*y,g.default.cornerstone.enable(this.zoomElement,I.options));var z=g.default.cornerstone.getEnabledElement(this.zoomElement),H=g.default.cornerstone.getViewport(I.element);this.zoomCanvas=z.canvas,this.zoomCanvas.width=R.width*y,this.zoomCanvas.height=R.height*y,z.viewport=Object.assign({},H),H.scale*=y,g.default.cornerstone.displayImage(this.zoomElement,b),g.default.cornerstone.setViewport(this.zoomElement,H)}},{key:"_removeZoomElement",value:function(){this.zoomElement!==void 0&&(g.default.cornerstone.disable(this.zoomElement),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(_){if(_.querySelector(".magnifyTool")===null){var D=document.createElement("canvas");D.classList.add("magnifyTool"),D.width=this.configuration.magnifySize,D.height=this.configuration.magnifySize,D.style.position="absolute",D.style.display="none",_.appendChild(D)}}},{key:"_destroyMagnificationCanvas",value:function(_){var D=_.querySelector(".magnifyTool");D&&_.removeChild(D)}}]),P}(m.default)},"./tools/OrientationMarkersTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return T});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseTool.js"),g=e("./orientation/index.js"),v=e("./drawing/index.js"),m=e("./stateManagement/toolColors.js"),E=e("./drawing/drawTextBox.js"),T=function(_){u()(D,_);function D(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,D);var y={name:"OrientationMarkers",configuration:{drawAllMarkers:!0},mixins:["enabledOrDisabledBinaryTool"]};return t()(this,s()(D).call(this,I,y))}return l()(D,[{key:"enabledCallback",value:function(y){this.forceImageUpdate(y)}},{key:"disabledCallback",value:function(y){this.forceImageUpdate(y)}},{key:"forceImageUpdate",value:function(y){var R=c.default.cornerstone,b=R.getEnabledElement(y);b.image&&R.updateImage(y)}},{key:"renderToolData",value:function(y){var R=y.detail,b=Object(v.getNewContext)(R.canvasContext.canvas),z=R.element,H=P(z);if(H){var B=C(z),p=m.default.getToolColor(),A={top:Object(E.textBoxWidth)(b,H.top,0),left:Object(E.textBoxWidth)(b,H.left,0),right:Object(E.textBoxWidth)(b,H.right,0),bottom:Object(E.textBoxWidth)(b,H.bottom,0),height:Object(E.textBoxWidth)(b,"M",0)};O(b,H,B,A,p),this.configuration.drawAllMarkers&&M(b,H,B,A,p)}}}]),D}(h.default),O=function(D,I,y,R,b){Object(E.default)(D,I.top,y.top.x-R.top/2,y.top.y,b),Object(E.default)(D,I.left,y.left.x-R.left/2,y.left.y,b)},M=function(D,I,y,R,b){Object(E.default)(D,I.right,y.right.x-R.right,y.right.y,b),Object(E.default)(D,I.bottom,y.bottom.x-R.bottom/2,y.bottom.y-R.height,b)},P=function(D){var I=c.default.cornerstone,y=I.getEnabledElement(D),R=I.metaData.get("imagePlaneModule",y.image.imageId);if(!(!R||!R.rowCosines||!R.columnCosines)){var b=g.default.getOrientationString(R.rowCosines),z=g.default.getOrientationString(R.columnCosines),H=g.default.invertOrientationString(b),B=g.default.invertOrientationString(z);return{top:B,bottom:z,left:H,right:b}}},C=function(D){var I=c.default.cornerstone.getEnabledElement(D),y=c.default.cornerstone.pixelToCanvas(D,{x:I.image.width/2,y:5}),R=c.default.cornerstone.pixelToCanvas(D,{x:I.image.width/2,y:I.image.height-15}),b=c.default.cornerstone.pixelToCanvas(D,{x:5,y:I.image.height/2}),z=c.default.cornerstone.pixelToCanvas(D,{x:I.image.width-10,y:I.image.height/2});return{top:y,bottom:R,left:b,right:z}}},"./tools/OverlayTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return m});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./store/index.js"),h=e("./externalModules.js"),g=e("./tools/base/BaseTool.js"),v=c.modules.globalConfiguration,m=function(E){u()(T,E);function T(){var O,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,T);var P={name:"Overlay",configuration:{},mixins:["enabledOrDisabledBinaryTool"]},C=Object.assign(P,M);return O=t()(this,s()(T).call(this,C)),O.initialConfiguration=C,O}return l()(T,[{key:"enabledCallback",value:function(M){this.forceImageUpdate(M)}},{key:"disabledCallback",value:function(M){this.forceImageUpdate(M)}},{key:"forceImageUpdate",value:function(M){var P=h.default.cornerstone.getEnabledElement(M);P.image&&h.default.cornerstone.updateImage(M)}},{key:"setupRender",value:function(M){if(M){var P=h.default.cornerstone.metaData.get("overlayPlaneModule",M.imageId);if(!(!P||!P.overlays||!P.overlays.length))return P}}},{key:"setupViewport",value:function(M){if(M.overlayColor===void 0&&(M.overlayColor=v.configuration.overlayColor||"white"),M.overlayColor!==!1)return!0}},{key:"renderToolData",value:function(M){var P=M.detail,C=P.enabledElement,_=P.image,D=P.viewport,I=P.canvasContext,y=this.setupRender(_);if(!(!P||!C||!y)&&this.setupViewport(D)){var R=_.columns,b=_.rows;y.overlays.forEach(function(z){if(z.visible!==!1){var H=document.createElement("canvas");H.width=R,H.height=b;var B=H.getContext("2d");B.fillStyle=z.fillStyle||D.overlayColor,z.type==="R"&&(B.fillRect(0,0,H.width,H.height),B.globalCompositeOperation="xor");for(var p=0,A=0;A<z.rows;A++)for(var j=0;j<z.columns;j++)z.pixelData[p++]>0&&B.fillRect(j,A,1,1);var x=!isNaN(parseFloat(z.x))&&isFinite(z.x)?z.x:0,L=!isNaN(parseFloat(z.y))&&isFinite(z.y)?z.y:0;I.drawImage(H,x,L)}})}}}]),T}(g.default)},"./tools/PanMultiTouchTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return m});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./externalModules.js"),v=e("./tools/base/BaseTool.js"),m=function(E){h()(T,E);function T(){var O,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,T);var P={name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}};return O=t()(this,s()(T).call(this,M,P)),O.multiTouchDragCallback=O._dragCallback.bind(u()(O)),O}return l()(T,[{key:"_dragCallback",value:function(M){var P=M.detail,C=P.element,_=P.viewport;if(P.numPointers===this.configuration.touchPointers){var D=this._getTranslation(P);this._applyTranslation(_,D),g.default.cornerstone.setViewport(C,_)}}},{key:"_getTranslation",value:function(M){var P=M.viewport,C=M.image,_=M.deltaPoints,D=P.scale,I=P.scale;return C.rowPixelSpacing<C.columnPixelSpacing?D*=C.columnPixelSpacing/C.rowPixelSpacing:C.columnPixelSpacing<C.rowPixelSpacing&&(I*=C.rowPixelSpacing/C.columnPixelSpacing),{x:_.page.x/D,y:_.page.y/I}}},{key:"_applyTranslation",value:function(M,P){M.translation.x+=P.x,M.translation.y+=P.y}}]),T}(v.default)},"./tools/PanTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return E});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./externalModules.js"),v=e("./tools/base/BaseTool.js"),m=e("./tools/cursors/index.js"),E=function(T){h()(O,T);function O(){var M,P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,O);var C={name:"Pan",supportedInteractionTypes:["Mouse","Touch"],svgCursor:m.panCursor};return M=t()(this,s()(O).call(this,P,C)),M.touchDragCallback=M._dragCallback.bind(u()(M)),M.mouseDragCallback=M._dragCallback.bind(u()(M)),M}return l()(O,[{key:"_dragCallback",value:function(P){var C=P.detail,_=C.element,D=C.viewport,I=this._getTranslation(C);this._applyTranslation(D,I),g.default.cornerstone.setViewport(_,D)}},{key:"_getTranslation",value:function(P){var C=P.viewport,_=P.image,D=P.deltaPoints,I=C.scale,y=C.scale;return _.rowPixelSpacing<_.columnPixelSpacing?I*=_.columnPixelSpacing/_.rowPixelSpacing:_.columnPixelSpacing<_.rowPixelSpacing&&(y*=_.rowPixelSpacing/_.columnPixelSpacing),{x:D.page.x/I,y:D.page.y/y}}},{key:"_applyTranslation",value:function(P,C){P.translation.x+=C.x,P.translation.y+=C.y}}]),O}(v.default)},"./tools/ReferenceLinesTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return _});var a=e("../node_modules/@babel/runtime/regenerator/index.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/asyncToGenerator.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/createClass.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),h=e.n(c),g=e("../node_modules/@babel/runtime/helpers/inherits.js"),v=e.n(g),m=e("./externalModules.js"),E=e("./tools/base/BaseTool.js"),T=e("./drawing/index.js"),O=e("./tools/referenceLines/renderActiveReferenceLine.js"),M=e("./util/wait.js"),P=e("./util/logger.js"),C=Object(P.getLogger)("tools:ReferenceLinesTool"),_=function(D){v()(I,D);function I(){var y,R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};t()(this,I);var b={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:O.default}};return y=u()(this,h()(I).call(this,R,b)),y.renderer=null,y.synchronizationContext=null,y}return s()(I,[{key:"enabledCallback",value:function(){var y=l()(f.a.mark(function b(z){var H,B,p,A,j=arguments;return f.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return H=j.length>1&&j[1]!==void 0?j[1]:{},B=H.synchronizationContext,p=this.configuration.renderer,L.next=4,Object(M.waitForEnabledElementImageToLoad)(z);case 4:if(A=L.sent,!(!A||!p||!B)){L.next=8;break}return C.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),L.abrupt("return");case 8:this.renderer=p,this.synchronizationContext=B,this.forceImageUpdate(z);case 11:case"end":return L.stop()}},b,this)}));function R(b){return y.apply(this,arguments)}return R}()},{key:"disabledCallback",value:function(R){this.forceImageUpdate(R)}},{key:"forceImageUpdate",value:function(R){var b=m.default.cornerstone.getEnabledElement(R);b.image&&m.default.cornerstone.updateImage(R)}},{key:"renderToolData",value:function(R){var b=this,z=R.detail;if(!(!this.renderer||!this.synchronizationContext)){var H=this.synchronizationContext.getSourceElements(),B=Object(T.getNewContext)(z.canvasContext.canvas);m.default.cornerstone.setToPixelCoordinateSystem(z.enabledElement,B),H.forEach(function(p){p!==R.currentTarget&&b.renderer(B,z,R.currentTarget,p)})}}}]),I}(E.default)},"./tools/RotateTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return m});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseTool.js"),g=e("./util/angleBetweenPoints.js"),v=e("./tools/cursors/index.js"),m=function(M){u()(P,M);function P(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,P);var _={name:"Rotate",strategies:{default:E,horizontal:T,vertical:O},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{roundAngles:!1,flipHorizontal:!1,flipVertical:!1,rotateScale:1},svgCursor:v.rotateCursor};return t()(this,s()(P).call(this,C,_))}return l()(P,[{key:"touchDragCallback",value:function(_){this.dragCallback(_)}},{key:"mouseDragCallback",value:function(_){this.dragCallback(_)}},{key:"postMouseDownCallback",value:function(_){this.initialRotation=_.detail.viewport.rotation}},{key:"dragCallback",value:function(_){_.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(_),c.default.cornerstone.setViewport(_.detail.element,_.detail.viewport)}}]),P}(h.default);function E(M){var P=this.configuration,C=P.roundAngles,_=P.rotateScale,D=M.detail,I=D.element,y=D.viewport,R=D.startPoints,b=D.currentPoints,z=y.initialRotation?y.initialRotation:y.rotation,H=I.getBoundingClientRect(I),B=I.clientWidth,p=I.clientHeight,A=y.scale,j=y.translation,x={x:H.left+B/2+j.x*A,y:H.top+p/2+j.y*A},L=Object(g.default)(x,R.client,b.client);L.angle*=_,C&&(L.angle=Math.ceil(L.angle)),L.direction<0&&(L.angle=-L.angle),y.rotation=z+L.angle}function T(M){var P=this.configuration,C=P.roundAngles,_=P.flipHorizontal,D=P.rotateScale,I=M.detail,y=I.viewport,R=I.startPoints,b=I.currentPoints,z=y.initialRotation,H=R.client.x,B=b.client.x,p=(B-H)*D;C&&(p=Math.round(Math.abs(p))*(p>0?1:-1)),_&&(p=-p),y.rotation=z+p}function O(M){var P=this.configuration,C=P.roundAngles,_=P.flipVertical,D=P.rotateScale,I=M.detail,y=I.viewport,R=I.startPoints,b=I.currentPoints,z=y.initialRotation,H=R.client.y,B=b.client.y,p=(B-H)*D;C&&(p=Math.round(Math.abs(p))*(p>0?1:-1)),_&&(p=-p),y.rotation=z+p}},"./tools/RotateTouchTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return g});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseTool.js"),g=function(v){u()(m,v);function m(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,m);var T={name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]};return t()(this,s()(m).call(this,E,T))}return l()(m,[{key:"touchRotateCallback",value:function(T){var O=T.detail,M=O.element,P=O.viewport,C=O.rotation;P.rotation+=C,c.default.cornerstone.setViewport(M,P)}}]),m}(h.default)},"./tools/ScaleOverlayTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return O});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseTool.js"),g=e("./drawing/index.js"),v=e("./stateManagement/toolStyle.js"),m=e("./stateManagement/toolColors.js"),E=e("./util/logger.js"),T=Object(E.getLogger)("tools:ScaleOverlayTool"),O=function(_){u()(D,_);function D(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,D);var y={name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]};return t()(this,s()(D).call(this,I,y))}return l()(D,[{key:"enabledCallback",value:function(y){this.forceImageUpdate(y)}},{key:"disabledCallback",value:function(y){this.forceImageUpdate(y)}},{key:"forceImageUpdate",value:function(y){var R=c.default.cornerstone.getEnabledElement(y);R.image&&c.default.cornerstone.updateImage(y)}},{key:"renderToolData",value:function(y){var R=y.detail,b=Object(g.getNewContext)(R.canvasContext.canvas),z=R.image,H=R.viewport,B=R.element,p=z.rowPixelSpacing,A=z.columnPixelSpacing,j=c.default.cornerstone.metaData.get("imagePlaneModule",z.imageId);if(j&&(p=j.rowPixelSpacing||j.rowImagePixelSpacing,A=j.columnPixelSpacing||j.colImagePixelSpacing),!p||!A){T.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"));return}var x={width:b.canvas.width,height:b.canvas.height},L=10/p*H.scale,U=10/A*H.scale,S=M(x,.25,.05),w=M(x,.05,.15);if(!(!x.width||!x.height||!S||!w)){var G=m.default.getToolColor(),$=v.default.getToolWidth(),Q=Object.assign({},{hscaleBounds:S,vscaleBounds:w,verticalMinorTick:L,horizontalMinorTick:U,verticalLine:{start:{x:w.bottomRight.x,y:w.topLeft.y},end:{x:w.bottomRight.x,y:w.bottomRight.y}},horizontalLine:{start:{x:S.topLeft.x,y:S.bottomRight.y},end:{x:S.bottomRight.x,y:S.bottomRight.y}},color:G,lineWidth:$},this.configuration);Object(g.draw)(b,function(re){Object(g.setShadow)(re,Q),Object(g.drawLine)(re,B,Q.verticalLine.start,Q.verticalLine.end,{color:Q.color,lineWidth:Q.lineWidth},"canvas"),P(re,B,Q),Object(g.drawLine)(re,B,Q.horizontalLine.start,Q.horizontalLine.end,{color:Q.color,lineWidth:Q.lineWidth},"canvas"),C(re,B,Q)})}}}]),D}(h.default),M=function(D,I,y){var R=I*Math.min(1e3,D.width),b=y*Math.min(1e3,D.height),z={left:R,top:b,width:D.width-2*R,height:D.height-2*b};return{topLeft:{x:z.left,y:z.top},bottomRight:{x:z.left+z.width,y:z.top+z.height}}},P=function(D,I,y){for(var R=0;y.verticalLine.start.y+R*y.verticalMinorTick<=y.vscaleBounds.bottomRight.y;){var b=y.color,z=y.lineWidth,H={x:y.verticalLine.start.x,y:y.verticalLine.start.y+R*y.verticalMinorTick},B={x:0,y:y.verticalLine.start.y+R*y.verticalMinorTick};R%5===0?B.x=y.verticalLine.start.x-y.majorTickLength:B.x=y.verticalLine.start.x-y.minorTickLength,Object(g.drawLine)(D,I,H,B,{color:b,lineWidth:z},"canvas"),R++}},C=function(D,I,y){for(var R=0;y.horizontalLine.start.x+R*y.horizontalMinorTick<=y.hscaleBounds.bottomRight.x;){var b=y.color,z=y.lineWidth,H={x:y.horizontalLine.start.x+R*y.horizontalMinorTick,y:y.horizontalLine.start.y},B={x:y.horizontalLine.start.x+R*y.horizontalMinorTick,y:0};R%5===0?B.y=y.horizontalLine.start.y-y.majorTickLength:B.y=y.horizontalLine.start.y-y.minorTickLength,Object(g.drawLine)(D,I,H,B,{color:b,lineWidth:z},"canvas"),R++}}},"./tools/StackScrollMouseWheelTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return g});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./tools/base/BaseTool.js"),h=e("./util/scroll.js"),g=function(v){u()(m,v);function m(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,m);var T={name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0,invert:!1}};return t()(this,s()(m).call(this,E,T))}return l()(m,[{key:"mouseWheelCallback",value:function(T){var O=T.detail,M=O.direction,P=O.element,C=this.configuration,_=C.loop,D=C.allowSkipping,I=C.invert,y=I?-M:M;Object(h.default)(P,y,_,D)}}]),m}(c.default)},"./tools/StackScrollMultiTouchTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return T});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./tools/base/BaseTool.js"),v=e("./util/scroll.js"),m=e("./stateManagement/toolState.js"),E=e("./toolOptions.js"),T=function(O){h()(M,O);function M(){var P,C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,M);var _={name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}};return P=t()(this,s()(M).call(this,C,_)),P.multiTouchDragCallback=P._dragCallback.bind(u()(P)),P}return l()(M,[{key:"_dragCallback",value:function(C){var _=C.detail;if(_.numPointers===this.configuration.touchPointers){var D=_.element,I=_.deltaPoints,y=this.configuration,R=y.loop,b=y.allowSkipping,z=Object(E.getToolOptions)(this.name,D),H=this._getPixelPerImage(D),B=this._getDeltaY(D,I.page.y);if(!H)return;if(Math.abs(B)>=H){var p=Math.round(B/H);Object(v.default)(D,p,R,b),z.deltaY=B%H}else z.deltaY=B;Object(E.setToolOptions)(this.name,D,z)}}},{key:"_getDeltaY",value:function(C,_){var D=Object(E.getToolOptions)(this.name,C),I=D.deltaY||0;return I+_}},{key:"_getPixelPerImage",value:function(C){var _=Object(m.getToolState)(C,"stack");if(!(!_||!_.data||!_.data.length)){var D=_.data[0],I=this.configuration.stackScrollSpeed;return I||Math.max(2,C.offsetHeight/Math.max(D.imageIds.length,8))}}}]),M}(g.default)},"./tools/StackScrollTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return O});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./tools/base/BaseTool.js"),v=e("./util/scroll.js"),m=e("./stateManagement/toolState.js"),E=e("./toolOptions.js"),T=e("./tools/cursors/index.js"),O=function(M){h()(P,M);function P(){var C,_=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,P);var D={name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0},svgCursor:T.stackScrollCursor};return C=t()(this,s()(P).call(this,_,D)),C.mouseDragCallback=C._dragCallback.bind(u()(C)),C.touchDragCallback=C._dragCallback.bind(u()(C)),C}return l()(P,[{key:"_dragCallback",value:function(_){var D=_.detail,I=D.element,y=D.deltaPoints,R=this.configuration,b=R.loop,z=R.allowSkipping,H=Object(E.getToolOptions)(this.name,I),B=this._getPixelPerImage(I),p=this._getDeltaY(I,y.page.y);if(B){if(Math.abs(p)>=B){var A=Math.round(p/B);Object(v.default)(I,A,b,z),H.deltaY=p%B}else H.deltaY=p;Object(E.setToolOptions)(this.name,I,H)}}},{key:"_getDeltaY",value:function(_,D){var I=Object(E.getToolOptions)(this.name,_),y=I.deltaY||0;return y+D}},{key:"_getPixelPerImage",value:function(_){var D=Object(m.getToolState)(_,"stack");if(!(!D||!D.data||!D.data.length)){var I=D.data[0],y=this.configuration.stackScrollSpeed;return y||Math.max(2,_.offsetHeight/Math.max(I.imageIds.length,8))}}}]),P}(g.default)},"./tools/WwwcRegionTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return P});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./externalModules.js"),v=e("./tools/base/BaseTool.js"),m=e("./drawing/index.js"),E=e("./util/clip.js"),T=e("./util/getLuminance.js"),O=e("./stateManagement/toolColors.js"),M=e("./tools/cursors/index.js"),P=function(I){h()(y,I);function y(){var R,b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,y);var z={name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10},svgCursor:M.wwwcRegionCursor};return R=t()(this,s()(y).call(this,b,z)),R._resetHandles(),R.postTouchStartCallback=R._startOutliningRegion.bind(u()(R)),R.touchDragCallback=R._setHandlesAndUpdate.bind(u()(R)),R.touchEndCallback=R._applyStrategy.bind(u()(R)),R.postMouseDownCallback=R._startOutliningRegion.bind(u()(R)),R.mouseClickCallback=R._startOutliningRegion.bind(u()(R)),R.mouseDragCallback=R._setHandlesAndUpdate.bind(u()(R)),R.mouseMoveCallback=R._setHandlesAndUpdate.bind(u()(R)),R.mouseUpCallback=R._applyStrategy.bind(u()(R)),R}return l()(y,[{key:"renderToolData",value:function(b){var z=this,H=b.detail,B=H.element,p=O.default.getColorIfActive({active:!0}),A=Object(m.getNewContext)(H.canvasContext.canvas);Object(m.draw)(A,function(j){Object(m.drawRect)(j,B,z.handles.start,z.handles.end,{color:p})})}},{key:"_startOutliningRegion",value:function(b){var z=!0,H=b.detail.element,B=b.detail.currentPoints.image;return C(this.handles.start)?this.handles.start=B:(this.handles.end=B,this._applyStrategy(b)),g.default.cornerstone.updateImage(H),z}},{key:"_setHandlesAndUpdate",value:function(b){var z=b.detail.element,H=b.detail.currentPoints.image;this.handles.end=H,g.default.cornerstone.updateImage(z)}},{key:"_applyStrategy",value:function(b){C(this.handles.start)||C(this.handles.end)||(b.detail.handles=this.handles,_(b,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),y}(v.default),C=function(y){return Object.keys(y).length===0&&y.constructor===Object},_=function(y,R){var b=y.detail,z=b.image,H=b.element,B=y.detail.handles,p=B.start,A=B.end,j=Math.min(p.x,A.x),x=Math.min(p.y,A.y),L=Math.abs(p.x-A.x),U=Math.abs(p.y-A.y);j=Object(E.default)(j,0,z.width),x=Object(E.default)(x,0,z.height),L=Math.floor(Math.min(L,Math.abs(z.width-j))),U=Math.floor(Math.min(U,Math.abs(z.height-x)));var S=Object(T.default)(H,j,x,L,U),w=D(S,z.minPixelValue,z.maxPixelValue),G=b.viewport;R.minWindowWidth===void 0&&(R.minWindowWidth=10),G.voi.windowWidth=Math.max(Math.abs(w.max-w.min),R.minWindowWidth),G.voi.windowCenter=w.mean,G.voiLUT=void 0,g.default.cornerstone.setViewport(H,G),g.default.cornerstone.updateImage(H)},D=function(y,R,b){var z=y.length,H=b,B=R,p=0;if(z<2)return{min:H,max:B,mean:(R+b)/2};for(var A=0;A<z;A++){var j=y[A];H=Math.min(H,j),B=Math.max(B,j),p+=j}return{min:H,max:B,mean:p/z}}},"./tools/WwwcTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return v});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseTool.js"),g=e("./tools/cursors/index.js"),v=function(E){u()(T,E);function T(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,T);var M={name:"Wwwc",strategies:{basicLevelingStrategy:m},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0},svgCursor:g.wwwcCursor};return t()(this,s()(T).call(this,O,M))}return l()(T,[{key:"mouseDragCallback",value:function(M){this.applyActiveStrategy(M),c.default.cornerstone.setViewport(M.detail.element,M.detail.viewport)}},{key:"touchDragCallback",value:function(M){M.stopImmediatePropagation(),this.applyActiveStrategy(M),c.default.cornerstone.setViewport(M.detail.element,M.detail.viewport)}}]),T}(h.default);function m(E){var T=this.configuration.orientation,O=E.detail,M=O.image.maxPixelValue*O.image.slope+O.image.intercept,P=O.image.minPixelValue*O.image.slope+O.image.intercept,C=M-P,_=C/1024,D=O.deltaPoints.page.x*_,I=O.deltaPoints.page.y*_;T===0?(O.viewport.voi.windowWidth+=D,O.viewport.voi.windowCenter+=I):(O.viewport.voi.windowWidth+=I,O.viewport.voi.windowCenter+=D),O.viewport.voiLUT=void 0}},"./tools/ZoomMouseWheelTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return v});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseTool.js"),g=e("./util/zoom/index.js"),v=function(m){u()(E,m);function E(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,E);var O={name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}};return t()(this,s()(E).call(this,T,O))}return l()(E,[{key:"mouseWheelCallback",value:function(O){var M=O.detail,P=M.element,C=M.viewport,_=M.spinY,D=this.configuration,I=D.invert,y=D.maxScale,R=D.minScale,b=I?_/4:-_/4,z=Object(g.changeViewportScale)(C,b,{maxScale:y,minScale:R});c.default.cornerstone.setViewport(P,z)}}]),E}(h.default)},"./tools/ZoomTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return O});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseTool.js"),g=e("./util/clip.js"),v=e("./util/zoom/index.js"),m=e("./tools/cursors/index.js"),E=v.default.correctShift,T=v.default.changeViewportScale,O=function(D){u()(I,D);function I(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,I);var R={name:"Zoom",strategies:{default:P,translate:C,zoomToCenter:_},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20},svgCursor:m.zoomCursor};return t()(this,s()(I).call(this,y,R))}return l()(I,[{key:"touchDragCallback",value:function(R){M.call(this,R)}},{key:"mouseDragCallback",value:function(R){M.call(this,R)}}]),I}(h.default),M=function(I){var y=I.detail.deltaPoints.page.y;if(!y)return!1;this.applyActiveStrategy(I,this.configuration),c.default.cornerstone.setViewport(I.detail.element,I.detail.viewport)};function P(D){var I=this.configuration,y=I.invert,R=I.maxScale,b=I.minScale,z=D.detail.deltaPoints.page.y,H=y?-z/100:z/100,B=D.detail,p=B.element,A=B.viewport,j=[D.detail.startPoints.page.x,D.detail.startPoints.page.y,D.detail.startPoints.image.x,D.detail.startPoints.image.y],x=j[0],L=j[1],U=j[2],S=j[3],w=T(A,H,{maxScale:R,minScale:b});c.default.cornerstone.setViewport(p,w);var G=c.default.cornerstone.pageToPixel(p,x,L),$={x:U-G.x,y:S-G.y};$=E($,w),A.translation.x-=$.x,A.translation.y-=$.y}function C(D){var I=this.configuration,y=I.invert,R=I.preventZoomOutsideImage,b=I.maxScale,z=I.minScale,H=D.detail.deltaPoints.page.y,B=y?-H/100:H/100,p=D.detail.image,A=D.detail.viewport,j=[D.detail.startPoints.image.x,D.detail.startPoints.image.y],x=j[0],L=j[1],U=T(A,B,{maxScale:b,minScale:z}),S={x:0,y:0},w=8,G=3,$=.01;if(B<0)U.scale<G&&(Math.abs(U.translation.x)<$?U.translation.x=0:S.x=U.translation.x/w,Math.abs(U.translation.y)<$?U.translation.y=0:S.y=U.translation.y/w);else{R&&Object(g.clipToBox)(D.detail.startPoints.image,p);var Q={x:p.width/2-x,y:p.height/2-L};Q=E(Q,U);var re={x:U.translation.x-Q.x,y:U.translation.y-Q.y};Math.abs(re.x)<$?U.translation.x=Q.x:S.x=re.x/w,Math.abs(re.y)<$?U.translation.y=Q.y:S.y=re.y/w}U.translation.x-=S.x,U.translation.y-=S.y}function _(D){var I=this.configuration,y=I.invert,R=I.maxScale,b=I.minScale,z=D.detail.deltaPoints.page.y,H=y?-z/100:z/100,B=D.detail.viewport;T(B,H,{maxScale:R,minScale:b})}},"./tools/ZoomTouchPinchTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return m});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseTool.js"),g=e("./util/zoom/index.js"),v=g.default.correctShift,m=function(E){u()(T,E);function T(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,T);var M={name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}};return t()(this,s()(T).call(this,O,M))}return l()(T,[{key:"touchPinchCallback",value:function(M){var P=M.detail,C=P.element,_=P.viewport,D=P.scaleChange,I=[M.detail.startPoints.page.x,M.detail.startPoints.page.y,M.detail.startPoints.image.x,M.detail.startPoints.image.y],y=I[0],R=I[1],b=I[2],z=I[3],H=this.configuration,B=H.maxScale,p=H.minScale;_.scale+=D*_.scale,B&&_.scale>B?_.scale=B:p&&_.scale<p&&(_.scale=p),c.default.cornerstone.setViewport(C,_);var A=c.default.cornerstone.pageToPixel(C,y,R),j={x:b-A.x,y:z-A.y};j=v(j,_),_.translation.x-=j.x,_.translation.y-=j.y,c.default.cornerstone.setViewport(C,_)}}]),T}(h.default)},"./tools/annotation/AngleTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return H});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseAnnotationTool.js"),g=e("./stateManagement/toolState.js"),v=e("./stateManagement/toolStyle.js"),m=e("./stateManagement/toolColors.js"),E=e("./manipulators/index.js"),T=e("./drawing/index.js"),O=e("./drawing/drawLinkedTextBox.js"),M=e("./drawing/drawTextBox.js"),P=e("./drawing/drawHandles.js"),C=e("./util/lineSegDistance.js"),_=e("./util/roundToDecimal.js"),D=e("./tools/cursors/index.js"),I=e("./util/triggerEvent.js"),y=e("./events.js"),R=e("./util/getPixelSpacing.js"),b=e("./util/throttle.js"),z=e("./store/index.js"),H=function(A){u()(j,A);function j(){var x,L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,j);var U={name:"Angle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:D.angleCursor,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return x=t()(this,s()(j).call(this,L,U)),x.preventNewMeasurement=!1,x.throttledUpdateCachedStats=Object(b.default)(x.updateCachedStats,110),x}return l()(j,[{key:"createNewMeasurement",value:function(L){return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:L.currentPoints.image.x,y:L.currentPoints.image.y,highlight:!0,active:!1},middle:{x:L.currentPoints.image.x,y:L.currentPoints.image.y,highlight:!0,active:!0},end:{x:L.currentPoints.image.x,y:L.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(L,U,S){return U.visible===!1?!1:Object(C.default)(L,U.handles.start,U.handles.middle,S)<25||Object(C.default)(L,U.handles.middle,U.handles.end,S)<25}},{key:"updateCachedStats",value:function(L,U,S){var w=p(L,S.handles.middle,S.handles.start),G=p(L,S.handles.end,S.handles.middle),$=p(L,S.handles.end,S.handles.start),Q=B(w),re=B(G),le=B($),de=Math.acos((Math.pow(Q,2)+Math.pow(re,2)-Math.pow(le,2))/(2*Q*re));de*=180/Math.PI,S.rAngle=Object(_.default)(de,2),S.invalidated=!1}},{key:"renderToolData",value:function(L){var U=this,S=L.detail,w=S.enabledElement,G=this.configuration,$=G.handleRadius,Q=G.drawHandlesOnHover,re=G.hideHandlesIfMoving,le=G.renderDashed,de=Object(g.getToolState)(L.currentTarget,this.name),me=Object(z.getModule)("globalConfiguration").configuration.lineDash;if(!de)return;for(var Y=Object(T.getNewContext)(S.canvasContext.canvas),V=S.image,te=S.element,ne=Object(R.default)(V),ue=ne.rowPixelSpacing,ge=ne.colPixelSpacing,ve=v.default.getToolWidth(),Ee=function(oe){var ie=de.data[oe];if(ie.visible===!1)return"continue";Object(T.draw)(Y,function(he){Object(T.setShadow)(he,U.configuration);var pe=m.default.getColorIfActive(ie),ye=c.default.cornerstone.pixelToCanvas(S.element,ie.handles.start),Se=c.default.cornerstone.pixelToCanvas(S.element,ie.handles.middle),Re={color:pe};le&&(Re.lineDash=me),Object(T.drawJoinedLines)(he,S.element,ie.handles.start,[ie.handles.middle,ie.handles.end],Re);var Be={color:pe,handleRadius:$,drawHandlesIfActive:Q,hideHandlesIfMoving:re};if(U.configuration.drawHandles&&Object(P.default)(he,S,ie.handles,Be),ie.invalidated===!0&&(ie.rAngle?U.throttledUpdateCachedStats(V,te,ie):U.updateCachedStats(V,te,ie)),ie.rAngle){var Le=N(ie,ue,ge),J=15,Pe;if(!ie.handles.textBox.hasMoved){Pe={x:Se.x,y:Se.y};var Ie=5,xe=Object(M.textBoxWidth)(he,Le,Ie);Se.x<ye.x?Pe.x-=J+xe+10:Pe.x+=J;var ce=c.default.cornerstone.internal.getTransform(w);ce.invert();var _e=ce.transformPoint(Pe.x,Pe.y);ie.handles.textBox.x=_e.x,ie.handles.textBox.y=_e.y}Object(O.default)(he,S.element,ie.handles.textBox,Le,ie.handles,F,pe,ve,0,!0)}})},De=0;De<de.data.length;De++)var X=Ee(De);function N(q,oe,ie){var he=!oe||!ie?" (isotropic)":"",pe="00B0";return q.rAngle.toString()+String.fromCharCode(parseInt(pe,16))+he}function F(q){return[q.start,q.middle,q.end]}}},{key:"addNewMeasurement",value:function(L,U){var S=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,L.preventDefault(),L.stopPropagation();var w=L.detail,G=this.createNewMeasurement(w),$=L.detail.element;Object(g.addToolState)($,this.name,G),c.default.cornerstone.updateImage($),Object(E.moveNewHandle)(w,this.name,G,G.handles.middle,this.options,U,function(Q){if(G.active=!1,!Q){Object(g.removeToolState)($,S.name,G),S.preventNewMeasurement=!1;return}G.handles.end.active=!0,c.default.cornerstone.updateImage($),Object(E.moveNewHandle)(w,S.name,G,G.handles.end,S.options,U,function(re){re?(G.active=!1,c.default.cornerstone.updateImage($)):Object(g.removeToolState)($,S.name,G),S.preventNewMeasurement=!1,c.default.cornerstone.updateImage($);var le={toolName:S.name,toolType:S.name,element:$,measurementData:G};Object(I.default)($,y.default.MEASUREMENT_COMPLETED,le)})})}}}]),j}(h.default);function B(A){return Math.sqrt(Math.pow(A.x,2)+Math.pow(A.y,2))}function p(A,j,x){var L=Object(R.default)(A),U=L.rowPixelSpacing,S=L.colPixelSpacing;return{x:(j.x-x.x)*(S||1),y:(j.y-x.y)*(U||1)}}},"./tools/annotation/ArrowAnnotateTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return H});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseAnnotationTool.js"),g=e("./events.js"),v=e("./stateManagement/toolStyle.js"),m=e("./stateManagement/textStyle.js"),E=e("./stateManagement/toolColors.js"),T=e("./manipulators/index.js"),O=e("./util/pointInsideBoundingBox.js"),M=e("./util/lineSegDistance.js"),P=e("./util/triggerEvent.js"),C=e("./stateManagement/toolState.js"),_=e("./drawing/drawLinkedTextBox.js"),D=e("./drawing/index.js"),I=e("./drawing/drawArrow.js"),y=e("./drawing/drawHandles.js"),R=e("./drawing/drawTextBox.js"),b=e("./tools/cursors/index.js"),z=e("./store/index.js"),H=function(A){u()(j,A);function j(){var x,L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,j);var U={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:B,changeTextCallback:p,drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,arrowFirst:!0,renderDashed:!1,allowEmptyLabel:!1},svgCursor:b.arrowAnnotateCursor};return x=t()(this,s()(j).call(this,L,U)),x.preventNewMeasurement=!1,x}return l()(j,[{key:"createNewMeasurement",value:function(L){return{visible:!0,active:!0,color:void 0,handles:{start:{x:L.detail.currentPoints.image.x,y:L.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:L.detail.currentPoints.image.x,y:L.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(L,U,S){return U.visible===!1?!1:Object(M.default)(L,U.handles.start,U.handles.end,S)<25}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(L){var U=this,S=L.detail,w=S.element,G=S.enabledElement,$=this.configuration,Q=$.handleRadius,re=$.drawHandlesOnHover,le=$.hideHandlesIfMoving,de=$.renderDashed,me=Object(C.getToolState)(w,this.name);if(!me)return;var Y=L.detail.canvasContext.canvas,V=Object(D.getNewContext)(Y),te=v.default.getToolWidth(),ne;de&&(ne=Object(z.getModule)("globalConfiguration").configuration.lineDash);for(var ue=function(N){var F=me.data[N];if(F.visible===!1)return"continue";Object(D.draw)(V,function(q){Object(D.setShadow)(q,U.configuration);var oe=E.default.getColorIfActive(F),ie=c.default.cornerstone.pixelToCanvas(w,F.handles.start),he=c.default.cornerstone.pixelToCanvas(w,F.handles.end);U.configuration.arrowFirst?Object(I.default)(q,he,ie,oe,te,ne):Object(I.default)(q,ie,he,oe,te,ne);var pe={color:oe,handleRadius:Q,drawHandlesIfActive:re,hideHandlesIfMoving:le};U.configuration.drawHandles&&Object(y.default)(q,L.detail,F.handles,pe);var ye=Ee(F);if(ye&&ye!==""){var Se=5,Re=Object(R.textBoxWidth)(q,ye,Se),Be=m.default.getFontSize()+10,Le=Math.max(Re,Be)/2+5;if(he.x<ie.x&&(Le=-Le),!F.handles.textBox.hasMoved){var J;U.configuration.arrowFirst?J={x:he.x-Re/2+Le,y:he.y-Be/2}:J={x:ie.x-Re/2-Le,y:ie.y-Be/2};var Pe=c.default.cornerstone.internal.getTransform(G);Pe.invert();var Ie=Pe.transformPoint(J.x,J.y);F.handles.textBox.x=Ie.x,F.handles.textBox.y=Ie.y}Object(_.default)(q,w,F.handles.textBox,ye,F.handles,De,oe,te,0,!1)}})},ge=0;ge<me.data.length;ge++)var ve=ue(ge);function Ee(X){return X.text}function De(X){var N={x:(X.start.x+X.end.x)/2,y:(X.start.y+X.end.y)/2};return[X.start,N,X.end]}}},{key:"addNewMeasurement",value:function(L,U){var S=this,w=L.detail.element,G=this.createNewMeasurement(L),$=this.configuration.allowEmptyLabel;Object(C.addToolState)(w,this.name,G),c.default.cornerstone.updateImage(w),Object(T.moveNewHandle)(L.detail,this.name,G,G.handles.end,this.options,U,function(Q){Q?G.text===void 0&&S.configuration.getTextCallback(function(re){if(re||$){G.text=re,G.active=!1;var le={toolName:S.name,toolType:S.name,element:w,measurementData:G};c.default.cornerstone.updateImage(w),Object(P.default)(w,g.default.MEASUREMENT_COMPLETED,le)}else Object(C.removeToolState)(w,S.name,G)},L.detail):Object(C.removeToolState)(w,S.name,G),c.default.cornerstone.updateImage(w)})}},{key:"doubleClickCallback",value:function(L){return this._updateTextForNearbyAnnotation(L)}},{key:"touchPressCallback",value:function(L){return this._updateTextForNearbyAnnotation(L)}},{key:"_updateTextForNearbyAnnotation",value:function(L){var U=L.detail.element,S=L.detail.currentPoints.canvas,w=Object(C.getToolState)(U,this.name);if(!w)return!1;for(var G=0;G<w.data.length;G++){var $=w.data[G];if(this.pointNearTool(U,$,S)||Object(O.default)($.handles.textBox,S))return $.active=!0,c.default.cornerstone.updateImage(U),this.configuration.changeTextCallback($,L.detail,this._doneChangingTextCallback.bind(this,U,$)),L.stopImmediatePropagation(),L.preventDefault(),L.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(L,U,S,w){w===!0?Object(C.removeToolState)(L,this.name,U):U.text=S,U.active=!1,c.default.cornerstone.updateImage(L),Object(P.default)(L,g.default.MEASUREMENT_MODIFIED,{toolName:this.name,toolType:this.name,element:L,measurementData:U})}}]),j}(h.default);function B(A){A(prompt("Enter your annotation:"))}function p(A,j,x){x(prompt("Change your annotation:"))}},"./tools/annotation/BidirectionalTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return b});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./tools/base/BaseAnnotationTool.js"),v=e("./tools/annotation/bidirectionalTool/createNewMeasurement.js"),m=e("./tools/annotation/bidirectionalTool/pointNearTool.js"),E=e("./tools/annotation/bidirectionalTool/renderToolData.js"),T=e("./tools/annotation/bidirectionalTool/addNewMeasurement.js"),O=e("./tools/annotation/bidirectionalTool/mouseMoveCallback.js"),M=e("./tools/annotation/bidirectionalTool/handleSelectedCallback.js"),P=e("./tools/annotation/bidirectionalTool/handleSelectedMouseCallback.js"),C=e("./tools/annotation/bidirectionalTool/handleSelectedTouchCallback.js"),_=e("./tools/cursors/index.js"),D=e("./util/throttle.js"),I=e("./util/getPixelSpacing.js"),y=e("./tools/annotation/bidirectionalTool/utils/calculateLongestAndShortestDiameters.js"),R=function(H,B,p){return p()},b=function(z){h()(H,z);function H(B){var p;f()(this,H);var A={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:R,getMeasurementLocationCallback:R,textBox:"",shadow:"",drawHandles:!0,drawHandlesOnHover:!0,hideHandlesIfMoving:!1,renderDashed:!1,additionalData:[]},svgCursor:_.bidirectionalCursor};return p=t()(this,s()(H).call(this,B,A)),p.throttledUpdateCachedStats=Object(D.default)(p.updateCachedStats,110),p.createNewMeasurement=v.default.bind(u()(p)),p.pointNearTool=m.default.bind(u()(p)),p.renderToolData=E.default.bind(u()(p)),p.addNewMeasurement=T.default.bind(u()(p)),p._moveCallback=O.default.bind(u()(p)),p.handleSelectedCallback=M.default.bind(u()(p)),p.handleSelectedMouseCallback=P.default.bind(u()(p)),p.handleSelectedTouchCallback=C.default.bind(u()(p)),p}return l()(H,[{key:"updateCachedStats",value:function(p,A,j){if(j.toolName===this.name){var x=Object(I.default)(p),L=Object(y.default)(j,x),U=L.longestDiameter,S=L.shortestDiameter;j.longestDiameter=U,j.shortestDiameter=S,j.invalidated=!1}}}]),H}(g.default)},"./tools/annotation/CircleRoiTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return z});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseAnnotationTool.js"),g=e("./stateManagement/toolState.js"),v=e("./stateManagement/toolStyle.js"),m=e("./stateManagement/toolColors.js"),E=e("./store/index.js"),T=e("./drawing/index.js"),O=e("./util/calculateSUV.js"),M=e("./util/ellipse/index.js"),P=e("./util/getROITextBoxCoords.js"),C=e("./util/numbersWithCommas.js"),_=e("./util/throttle.js"),D=e("./util/logger.js"),I=e("./util/getPixelSpacing.js"),y=e("./tools/cursors/index.js"),R=e("./util/getCircleCoords.js"),b=Object(D.getLogger)("tools:annotation:CircleRoiTool"),z=function(L){u()(U,L);function U(){var S,w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,U);var G={name:"CircleRoi",supportedInteractionTypes:["Mouse","Touch"],svgCursor:y.circleRoiCursor,configuration:{centerPointRadius:0,renderDashed:!1,hideHandlesIfMoving:!1}};return S=t()(this,s()(U).call(this,w,G)),S.throttledUpdateCachedStats=Object(_.default)(S.updateCachedStats,110),S}return l()(U,[{key:"createNewMeasurement",value:function(w){var G=w&&w.currentPoints&&w.currentPoints.image;if(!G){b.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));return}return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:w.currentPoints.image.x,y:w.currentPoints.image.y,highlight:!0,active:!1},end:{x:w.currentPoints.image.x,y:w.currentPoints.image.y,highlight:!0,active:!0},initialRotation:w.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(w,G,$,Q){var re=G&&G.handles&&G.handles.start&&G.handles.end,le=c.default.cornerstoneMath.point.distance;if(re||b.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!re||G.visible===!1)return!1;var de=Q==="mouse"?15:25,me=c.default.cornerstone.pixelToCanvas(w,G.handles.start),Y=c.default.cornerstone.pixelToCanvas(w,G.handles.end),V=le(me,$),te=le(me,Y);return V>te-de/2&&V<te+de/2}},{key:"updateCachedStats",value:function(w,G,$){var Q=c.default.cornerstone.metaData.get("generalSeriesModule",w.imageId)||{},re=Q.modality,le=Object(I.default)(w),de=x(w,G,$.handles,re,le);$.cachedStats=de,$.invalidated=!1}},{key:"renderToolData",value:function(w){var G=this,$=Object(g.getToolState)(w.currentTarget,this.name);if($){var Q=c.default.cornerstoneMath.point.distance,re=w.detail,le=re.image,de=re.element,me=re.canvasContext,Y=v.default.getToolWidth(),V=this.configuration,te=V.handleRadius,ne=V.drawHandlesOnHover,ue=V.hideHandlesIfMoving,ge=V.renderDashed,ve=V.centerPointRadius,Ee=Object(T.getNewContext)(me.canvas),De=Object(I.default)(le),X=De.rowPixelSpacing,N=De.colPixelSpacing,F=Object(E.getModule)("globalConfiguration").configuration.lineDash,q=c.default.cornerstone.metaData.get("generalSeriesModule",le.imageId)||{},oe=q.modality,ie=X&&N;Object(T.draw)(Ee,function(he){for(var pe=0;pe<$.data.length;pe++){var ye=$.data[pe];if(ye.visible!==!1){var Se=m.default.getColorIfActive(ye),Re={color:Se,handleRadius:te,drawHandlesIfActive:ne,hideHandlesIfMoving:ue};Object(T.setShadow)(he,G.configuration);var Be=c.default.cornerstone.pixelToCanvas(de,ye.handles.start),Le=c.default.cornerstone.pixelToCanvas(de,ye.handles.end),J=Q(Be,Le),Pe={color:Se};if(ge&&(Pe.lineDash=F),Object(T.drawCircle)(he,de,ye.handles.start,J,Pe,"pixel"),ve&&J>3*ve&&Object(T.drawCircle)(he,de,ye.handles.start,ve,Pe,"pixel"),ye.handles&&(ye.handles.start.drawnIndependently=!0,ye.handles.end.drawnIndependently=!0),Object(T.drawHandles)(he,re,ye.handles,Re),ye.invalidated===!0&&(ye.cachedStats?G.throttledUpdateCachedStats(le,de,ye):G.updateCachedStats(le,de,ye)),!ye.handles.textBox.hasMoved){var Ie=Object(P.default)(re.viewport,ye.handles);Object.assign(ye.handles.textBox,Ie)}var xe=function(Z){return H(Z.start,Z.end)},ce=p(he,le.color,ye.cachedStats,oe,ie,G.configuration);ye.unit=B(oe,G.configuration.showHounsfieldUnits),Object(T.drawLinkedTextBox)(he,de,ye.handles.textBox,ce,ye.handles,xe,Se,Y,10,!0)}}})}}}]),U}(h.default);function H(L,U){var S=Object(R.default)(L,U),w=S.left,G=S.top,$=S.width,Q=S.height;return[{x:w+$/2,y:G},{x:w,y:G+Q/2},{x:w+$/2,y:G+Q},{x:w+$,y:G+Q/2}]}function B(L,U){return L==="CT"&&U!==!1?"HU":""}function p(L,U){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},w=S.area,G=w===void 0?0:w,$=S.radius,Q=$===void 0?0:$,re=S.perimeter,le=re===void 0?0:re,de=S.mean,me=de===void 0?0:de,Y=S.stdDev,V=Y===void 0?0:Y,te=S.min,ne=te===void 0?0:te,ue=S.max,ge=ue===void 0?0:ue,ve=S.meanStdDevSUV,Ee=ve===void 0?0:ve,De=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},F=N.showMinMax||!1,q=[],oe=[];if(!U){var ie=Ee&&Ee.mean!==0,he=B(De,N.showHounsfieldUnits),pe="Mean: ".concat(Object(C.default)(me.toFixed(2))," ").concat(he),ye="Std Dev: ".concat(Object(C.default)(V.toFixed(2))," ").concat(he);if(ie){for(var Se=" SUV: ",Re="".concat(Se).concat(Object(C.default)(Ee.mean.toFixed(2))),Be="".concat(Se).concat(Object(C.default)(Ee.stdDev.toFixed(2))),Le=Math.floor(L.measureText("".concat(ye,"     ")).width);L.measureText(pe).width<Le;)pe+=" ";oe.push("".concat(pe).concat(Re)),oe.push("".concat(ye,"     ").concat(Be))}else oe.push("".concat(pe,"     ").concat(ye));if(F){for(var J="Min: ".concat(ne," ").concat(he),Pe="Max: ".concat(ge," ").concat(he),Ie=Math.floor(ie?L.measureText("".concat(ye,"     ")).width:L.measureText("".concat(pe,"     ")).width);L.measureText(J).width<Ie;)J+=" ";oe.push("".concat(J).concat(Pe))}}return q.push(A(G,X)),Q&&q.push(j(Q,"Radius",X)),le&&q.push(j(le,"Perimeter",X)),oe.forEach(function(xe){return q.push(xe)}),q}function A(L,U){var S=U?" mm".concat(""):" px".concat("");return"Area: ".concat(Object(C.default)(L.toFixed(2))).concat(S)}function j(L,U,S){if(!L)return"";var w=S?" mm":" px";return"".concat(U,": ").concat(Object(C.default)(L.toFixed(1))).concat(w)}function x(L,U,S,w,G){var $=Object(R.default)(S.start,S.end),Q=c.default.cornerstone.getPixels(U,$.left,$.top,$.width,$.height),re=Object(M.calculateEllipseStatistics)(Q,$),le;w==="PT"&&(le={mean:Object(O.default)(L,re.mean,!0)||0,stdDev:Object(O.default)(L,re.stdDev,!0)||0});var de=$.width*(G&&G.colPixelSpacing||1)/2,me=2*Math.PI*de,Y=Math.PI*($.width*(G&&G.colPixelSpacing||1)/2)*($.height*(G&&G.rowPixelSpacing||1)/2);return{area:Y||0,radius:de||0,perimeter:me||0,count:re.count||0,mean:re.mean||0,variance:re.variance||0,stdDev:re.stdDev||0,min:re.min||0,max:re.max||0,meanStdDevSUV:le}}},"./tools/annotation/CobbAngleTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return H});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseAnnotationTool.js"),g=e("./stateManagement/textStyle.js"),v=e("./stateManagement/toolState.js"),m=e("./stateManagement/toolStyle.js"),E=e("./stateManagement/toolColors.js"),T=e("./manipulators/index.js"),O=e("./drawing/index.js"),M=e("./drawing/drawHandles.js"),P=e("./drawing/drawLinkedTextBox.js"),C=e("./util/lineSegDistance.js"),_=e("./util/roundToDecimal.js"),D=e("./events.js"),I=e("./tools/cursors/index.js"),y=e("./util/triggerEvent.js"),R=e("./util/throttle.js"),b=e("./util/getPixelSpacing.js"),z=e("./store/index.js"),H=function(B){u()(p,B);function p(){var A,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,p);var x={name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"],svgCursor:I.cobbAngleCursor,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1}};return A=t()(this,s()(p).call(this,j,x)),A.hasIncomplete=!1,A.throttledUpdateCachedStats=Object(R.default)(A.updateCachedStats,110),A}return l()(p,[{key:"createNewMeasurement",value:function(j){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,invalidated:!0,complete:!1,value:"",handles:{start:{x:j.currentPoints.image.x,y:j.currentPoints.image.y,highlight:!0,active:!1},end:{x:j.currentPoints.image.x,y:j.currentPoints.image.y,highlight:!0,active:!0},start2:{x:j.currentPoints.image.x,y:j.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:j.currentPoints.image.x+1,y:j.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(j,x,L){if(x.visible===!1||this.hasIncomplete)return!1;var U=Object(C.default)(j,x.handles.start,x.handles.end,L)<25,S=Object(C.default)(j,x.handles.start2,x.handles.end2,L)<25;return U||S}},{key:"updateCachedStats",value:function(j,x,L){var U=Object(b.default)(j),S=U.rowPixelSpacing,w=U.colPixelSpacing,G=(Math.ceil(L.handles.start.x)-Math.ceil(L.handles.end.x))*(w||1),$=(Math.ceil(L.handles.start.y)-Math.ceil(L.handles.end.y))*(S||1),Q=(Math.ceil(L.handles.start2.x)-Math.ceil(L.handles.end2.x))*(w||1),re=(Math.ceil(L.handles.start2.y)-Math.ceil(L.handles.end2.y))*(S||1),le=Math.acos(Math.abs((G*Q+$*re)/(Math.sqrt(G*G+$*$)*Math.sqrt(Q*Q+re*re))));le*=180/Math.PI,L.rAngle=Object(_.default)(le,2),L.invalidated=!1}},{key:"renderToolData",value:function(j){var x=this,L=j.detail,U=this.configuration,S=U.handleRadius,w=U.drawHandlesOnHover,G=U.hideHandlesIfMoving,$=U.renderDashed,Q=Object(v.getToolState)(j.currentTarget,this.name);if(!Q)return;for(var re=Object(O.getNewContext)(L.canvasContext.canvas),le=m.default.getToolWidth(),de=Object(z.getModule)("globalConfiguration").configuration.lineDash,me=g.default.getFont(),Y=j.detail.element,V=c.default.cornerstone.getEnabledElement(Y).image,te=Object(b.default)(V),ne=te.rowPixelSpacing,ue=te.colPixelSpacing,ge=function(N){var F=Q.data[N];if(F.visible===!1)return"continue";F.value||(F.value=x.textBoxText(F,ne,ue)),Object(O.draw)(re,function(q){Object(O.setShadow)(q,x.configuration);var oe=E.default.getColorIfActive(F),ie={color:oe};$&&(ie.lineDash=de),Object(O.drawLine)(q,L.element,F.handles.start,F.handles.end,ie),F.complete&&Object(O.drawLine)(q,L.element,F.handles.start2,F.handles.end2,ie);var he={color:oe,handleRadius:S,drawHandlesIfActive:w,hideHandlesIfMoving:G};x.configuration.drawHandles&&Object(M.default)(q,L,F.handles,he),q.fillStyle=oe;var pe=F.value;if(!F.handles.textBox.hasMoved){var ye={x:(F.handles.start.x+F.handles.end.x)/2,y:(F.handles.start.y+F.handles.end.y)/2-10};q.font=me,F.handles.textBox.x=ye.x,F.handles.textBox.y=ye.y}Object(P.default)(q,L.element,F.handles.textBox,pe,F.handles,De,oe,le,0,!0)})},ve=0;ve<Q.data.length;ve++)var Ee=ge(ve);function De(X){return[X.start,X.start2,X.end,X.end2]}}},{key:"getIncomplete",value:function(j){var x=Object(v.getToolState)(j,this.name);if(x&&Array.isArray(x.data))return x.data.find(function(L){var U=L.complete;return U===!1})}},{key:"addNewMeasurement",value:function(j,x){var L=this;j.preventDefault(),j.stopPropagation();var U=j.detail,S,w,G=function(le){if(!le){Object(v.removeToolState)($,L.name,S);return}var de=D.default.MEASUREMENT_COMPLETED,me={toolName:L.name,toolType:L.name,element:$,measurementData:S};Object(y.default)($,de,me)},$=j.detail.element,Q=this.getIncomplete($);Q?(S=Q,S.complete=!0,S.handles.start2={x:U.currentPoints.image.x,y:U.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},S.handles.end2={x:U.currentPoints.image.x,y:U.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},w=S.handles.end2,this.hasIncomplete=!1,G=function(le){if(!le){Object(v.removeToolState)($,L.name,S);return}var de=D.default.MEASUREMENT_COMPLETED,me={toolName:L.name,toolType:L.name,element:$,measurementData:S};Object(y.default)($,de,me)}):(S=this.createNewMeasurement(U),Object(v.addToolState)($,this.name,S),w=S.handles.end),c.default.cornerstone.updateImage($),Object(T.moveNewHandle)(U,this.name,S,w,this.options,x,G)}},{key:"onMeasureModified",value:function(j){var x=j.detail.element,L=c.default.cornerstone.getEnabledElement(x).image,U=Object(b.default)(L),S=U.rowPixelSpacing,w=U.colPixelSpacing;if(j.detail.toolName===this.name){var G=j.detail.measurementData;G.invalidated===!0&&(G.rAngle?this.throttledUpdateCachedStats(L,x,G):this.updateCachedStats(L,x,G)),G.value=this.textBoxText(G,S,w)}}},{key:"textBoxText",value:function(j,x,L){var U=j.rAngle;if(U===void 0||Number.isNaN(U))return"";var S=!x||!L?" (isotropic)":"";return"".concat(U,"").concat(S)}},{key:"activeCallback",value:function(j){this.onMeasureModified=this.onMeasureModified.bind(this),j.addEventListener(D.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(j){this.onMeasureModified=this.onMeasureModified.bind(this),j.addEventListener(D.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(j){j.removeEventListener(D.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(j){j.removeEventListener(D.default.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),p}(h.default)},"./tools/annotation/EllipticalRoiTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return z});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseAnnotationTool.js"),g=e("./stateManagement/toolState.js"),v=e("./stateManagement/toolStyle.js"),m=e("./stateManagement/toolColors.js"),E=e("./manipulators/getHandleNearImagePoint.js"),T=e("./drawing/index.js"),O=e("./util/calculateSUV.js"),M=e("./util/ellipse/index.js"),P=e("./util/getROITextBoxCoords.js"),C=e("./util/numbersWithCommas.js"),_=e("./util/throttle.js"),D=e("./tools/cursors/index.js"),I=e("./util/logger.js"),y=e("./util/getPixelSpacing.js"),R=e("./store/index.js"),b=Object(I.getLogger)("tools:annotation:EllipticalRoiTool"),z=function(L){u()(U,L);function U(){var S,w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,U);var G={name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:D.ellipticalRoiCursor};return S=t()(this,s()(U).call(this,w,G)),S.throttledUpdateCachedStats=Object(_.default)(S.updateCachedStats,110),S}return l()(U,[{key:"createNewMeasurement",value:function(w){var G=w&&w.currentPoints&&w.currentPoints.image;if(!G){b.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));return}return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:w.currentPoints.image.x,y:w.currentPoints.image.y,highlight:!0,active:!1},end:{x:w.currentPoints.image.x,y:w.currentPoints.image.y,highlight:!0,active:!0},initialRotation:w.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(w,G,$,Q){var re=G&&G.handles&&G.handles.start&&G.handles.end,le=re;if(le||b.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!le||G.visible===!1)return!1;var de=Object(E.default)(w,G.handles,$,6);if(de)return!0;var me=Q==="mouse"?15:25,Y=c.default.cornerstone.pixelToCanvas(w,G.handles.start),V=c.default.cornerstone.pixelToCanvas(w,G.handles.end),te={left:Math.min(Y.x,V.x)+me/2,top:Math.min(Y.y,V.y)+me/2,width:Math.abs(Y.x-V.x)-me,height:Math.abs(Y.y-V.y)-me},ne={left:Math.min(Y.x,V.x)-me/2,top:Math.min(Y.y,V.y)-me/2,width:Math.abs(Y.x-V.x)+me,height:Math.abs(Y.y-V.y)+me},ue=Object(M.pointInEllipse)(te,$),ge=Object(M.pointInEllipse)(ne,$);return!!(ge&&!ue)}},{key:"updateCachedStats",value:function(w,G,$){var Q=c.default.cornerstone.metaData.get("generalSeriesModule",w.imageId)||{},re=Q.modality,le=Object(y.default)(w),de=j(w,G,$.handles,re,le);$.cachedStats=de,$.invalidated=!1}},{key:"renderToolData",value:function(w){var G=this,$=Object(g.getToolState)(w.currentTarget,this.name);if($){var Q=w.detail,re=Q.image,le=Q.element,de=v.default.getToolWidth(),me=Object(R.getModule)("globalConfiguration").configuration.lineDash,Y=this.configuration,V=Y.handleRadius,te=Y.drawHandlesOnHover,ne=Y.hideHandlesIfMoving,ue=Y.renderDashed,ge=Object(T.getNewContext)(Q.canvasContext.canvas),ve=Object(y.default)(re),Ee=ve.rowPixelSpacing,De=ve.colPixelSpacing,X=c.default.cornerstone.metaData.get("generalSeriesModule",re.imageId)||{},N=X.modality,F=Ee&&De;Object(T.draw)(ge,function(q){for(var oe=0;oe<$.data.length;oe++){var ie=$.data[oe];if(ie.visible!==!1){var he=m.default.getColorIfActive(ie),pe={color:he,handleRadius:V,drawHandlesIfActive:te,hideHandlesIfMoving:ne};Object(T.setShadow)(q,G.configuration);var ye={color:he};if(ue&&(ye.lineDash=me),Object(T.drawEllipse)(q,le,ie.handles.start,ie.handles.end,ye,"pixel",ie.handles.initialRotation),Object(T.drawHandles)(q,Q,ie.handles,pe),ie.invalidated===!0&&(ie.cachedStats?G.throttledUpdateCachedStats(re,le,ie):G.updateCachedStats(re,le,ie)),!ie.handles.textBox.hasMoved){var Se=Object(P.default)(Q.viewport,ie.handles);Object.assign(ie.handles.textBox,Se)}var Re=function(J){return H(J.start,J.end)},Be=p(q,re.color,ie.cachedStats,N,F,G.configuration);ie.unit=B(N,G.configuration.showHounsfieldUnits),Object(T.drawLinkedTextBox)(q,le,ie.handles.textBox,Be,ie.handles,Re,he,de,10,!0)}}})}}}]),U}(h.default);function H(L,U){var S=x(L,U),w=S.left,G=S.top,$=S.width,Q=S.height;return[{x:w+$/2,y:G},{x:w,y:G+Q/2},{x:w+$/2,y:G+Q},{x:w+$,y:G+Q/2}]}function B(L,U){return L==="CT"&&U!==!1?"HU":""}function p(L,U){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},w=S.area,G=w===void 0?0:w,$=S.mean,Q=$===void 0?0:$,re=S.stdDev,le=re===void 0?0:re,de=S.min,me=de===void 0?0:de,Y=S.max,V=Y===void 0?0:Y,te=S.meanStdDevSUV,ne=te===void 0?0:te,ue=arguments.length>3?arguments[3]:void 0,ge=arguments.length>4?arguments[4]:void 0,ve=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},Ee=ve.showMinMax||!1,De=[],X=[];if(!U){var N=ne&&ne.mean!==0,F=B(ue,ve.showHounsfieldUnits),q="Mean: ".concat(Object(C.default)(Q.toFixed(2))," ").concat(F),oe="Std Dev: ".concat(Object(C.default)(le.toFixed(2))," ").concat(F);if(N){for(var ie=" SUV: ",he="".concat(ie).concat(Object(C.default)(ne.mean.toFixed(2))),pe="".concat(ie).concat(Object(C.default)(ne.stdDev.toFixed(2))),ye=Math.floor(L.measureText("".concat(oe,"     ")).width);L.measureText(q).width<ye;)q+=" ";X.push("".concat(q).concat(he)),X.push("".concat(oe,"     ").concat(pe))}else X.push("".concat(q)),X.push("".concat(oe));if(Ee){for(var Se="Min: ".concat(me," ").concat(F),Re="Max: ".concat(V," ").concat(F),Be=Math.floor(N?L.measureText("".concat(oe,"     ")).width:L.measureText("".concat(q,"     ")).width);L.measureText(Se).width<Be;)Se+=" ";X.push("".concat(Se).concat(Re))}}return De.push(A(G,ge)),X.forEach(function(Le){return De.push(Le)}),De}function A(L,U){var S=U?" mm".concat(""):" px".concat("");return"Area: ".concat(Object(C.default)(L.toFixed(2))).concat(S)}function j(L,U,S,w,G){var $=x(S.start,S.end),Q=c.default.cornerstone.getPixels(U,$.left,$.top,$.width,$.height),re=Object(M.calculateEllipseStatistics)(Q,$),le;w==="PT"&&(le={mean:Object(O.default)(L,re.mean,!0)||0,stdDev:Object(O.default)(L,re.stdDev,!0)||0});var de=Math.PI*($.width*(G.colPixelSpacing||1)/2)*($.height*(G.rowPixelSpacing||1)/2);return{area:de||0,count:re.count||0,mean:re.mean||0,variance:re.variance||0,stdDev:re.stdDev||0,min:re.min||0,max:re.max||0,meanStdDevSUV:le}}function x(L,U){return{left:Math.round(Math.min(L.x,U.x)),top:Math.round(Math.min(L.y,U.y)),width:Math.round(Math.abs(L.x-U.x)),height:Math.round(Math.abs(L.y-U.y))}}},"./tools/annotation/FreehandRoiTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return Q});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./events.js"),v=e("./externalModules.js"),m=e("./tools/base/BaseAnnotationTool.js"),E=e("./stateManagement/toolState.js"),T=e("./stateManagement/toolStyle.js"),O=e("./stateManagement/toolColors.js"),M=e("./store/index.js"),P=e("./util/triggerEvent.js"),C=e("./util/findAndMoveHelpers.js"),_=e("./util/pointInsideBoundingBox.js"),D=e("./util/calculateSUV.js"),I=e("./util/numbersWithCommas.js"),y=e("./util/getPixelSpacing.js"),R=e("./drawing/index.js"),b=e("./drawing/drawLinkedTextBox.js"),z=e("./drawing/drawHandles.js"),H=e("./util/clip.js"),B=e("./store/setToolCursor.js"),p=e("./tools/cursors/index.js"),A=e("./util/freehand/index.js"),j=e("./util/logger.js"),x=e("./util/throttle.js"),L=Object(j.getLogger)("tools:annotation:FreehandRoiTool"),U=A.default.insertOrDelete,S=A.default.freehandArea,w=A.default.calculateFreehandStatistics,G=A.default.freehandIntersect,$=A.default.FreehandHandleData,Q=function(de){h()(me,de);function me(){var Y,V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,me);var te={name:"FreehandRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:re(),svgCursor:p.freehandRoiCursor};return Y=t()(this,s()(me).call(this,V,te)),Y.isMultiPartTool=!0,Y._drawing=!1,Y._dragging=!1,Y._modifying=!1,Y._drawingMouseDownCallback=Y._drawingMouseDownCallback.bind(u()(Y)),Y._drawingMouseMoveCallback=Y._drawingMouseMoveCallback.bind(u()(Y)),Y._drawingMouseDragCallback=Y._drawingMouseDragCallback.bind(u()(Y)),Y._drawingMouseUpCallback=Y._drawingMouseUpCallback.bind(u()(Y)),Y._drawingMouseDoubleClickCallback=Y._drawingMouseDoubleClickCallback.bind(u()(Y)),Y._editMouseUpCallback=Y._editMouseUpCallback.bind(u()(Y)),Y._editMouseDragCallback=Y._editMouseDragCallback.bind(u()(Y)),Y._drawingTouchStartCallback=Y._drawingTouchStartCallback.bind(u()(Y)),Y._drawingTouchDragCallback=Y._drawingTouchDragCallback.bind(u()(Y)),Y._drawingDoubleTapClickCallback=Y._drawingDoubleTapClickCallback.bind(u()(Y)),Y._editTouchDragCallback=Y._editTouchDragCallback.bind(u()(Y)),Y.throttledUpdateCachedStats=Object(x.default)(Y.updateCachedStats,110),Y}return l()(me,[{key:"createNewMeasurement",value:function(V){var te=V&&V.currentPoints&&V.currentPoints.image;if(!te){L.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));return}var ne={visible:!0,active:!0,invalidated:!0,color:void 0,handles:{points:[]}};return ne.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},ne}},{key:"pointNearTool",value:function(V,te,ne){var ue=te&&te.handles&&te.handles.points;if(!ue)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));if(!ue||te.visible===!1)return!1;var ge=this._pointNearHandle(V,te,ne);return ge!==void 0}},{key:"distanceFromPoint",value:function(V,te,ne){for(var ue=1/0,ge=0;ge<te.handles.points.length;ge++){var ve=v.default.cornerstoneMath.point.distance(te.handles.points[ge],ne);ue=Math.min(ue,ve)}return ue===1/0?-1:ue}},{key:"distanceFromPointCanvas",value:function(V,te,ne){var ue=1/0;if(!te)return-1;for(var ge=v.default.cornerstone.pixelToCanvas(V,ne),ve=te.handles.points,Ee=0;Ee<ve.length;Ee++){var De=v.default.cornerstone.pixelToCanvas(V,ve[Ee]),X=v.default.cornerstoneMath.point.distance(De,ge);ue=Math.min(ue,X)}return ue===1/0?-1:ue}},{key:"updateCachedStats",value:function(V,te,ne){for(var ue,ge,ve=v.default.cornerstone.metaData.get("generalSeriesModule",V.imageId),Ee=ve?ve.modality:null,De=ne.handles.points,X={left:De[0].x,right:De[0].x,bottom:De[0].y,top:De[0].x},N=0;N<De.length;N++)X.left=Math.min(X.left,De[N].x),X.right=Math.max(X.right,De[N].x),X.bottom=Math.min(X.bottom,De[N].y),X.top=Math.max(X.top,De[N].y);var F={left:X.left,top:X.bottom,width:Math.abs(X.right-X.left),height:Math.abs(X.top-X.bottom)};if(ne.polyBoundingBox=F,!V.color){var q=v.default.cornerstone.getPixels(te,F.left,F.top,F.width,F.height);ue=w.call(this,q,F,ne.handles.points),Ee==="PT"&&(ge={mean:Object(D.default)(V,(ue.mean-V.intercept)/V.slope),stdDev:Object(D.default)(V,(ue.stdDev-V.intercept)/V.slope)}),ue&&!isNaN(ue.mean)&&(ne.meanStdDev=ue,ne.meanStdDevSUV=ge)}var oe=Object(y.default)(V),ie=oe.colPixelSpacing,he=oe.rowPixelSpacing,pe=(ie||1)*(he||1),ye=S(ne.handles.points,pe);isNaN(ye)||(ne.area=ye),ne.invalidated=!1}},{key:"renderToolData",value:function(V){var te=this,ne=V.detail,ue=Object(E.getToolState)(V.currentTarget,this.name);if(!ue)return;for(var ge=ne.image,ve=ne.element,Ee=this.configuration,De=v.default.cornerstone.metaData.get("generalSeriesModule",ge.imageId),X=De?De.modality:null,N=Object(R.getNewContext)(ne.canvasContext.canvas),F=T.default.getToolWidth(),q=Ee.renderDashed,oe=Object(M.getModule)("globalConfiguration").configuration.lineDash,ie=function(Be){var Le=ue.data[Be];if(Le.visible===!1)return"continue";Object(R.draw)(N,function(J){var Pe=O.default.getColorIfActive(Le),Ie;Le.active?Le.handles.invalidHandlePlacement?(Pe=Ee.invalidColor,Ie=Ee.invalidColor):(Pe=O.default.getColorIfActive(Le),Ie=O.default.getFillColor()):Ie=O.default.getToolColor();var xe={color:Pe};if(q&&(xe.lineDash=oe),Le.handles.points.length){var ce=Le.handles.points;Object(R.drawJoinedLines)(J,ve,ce[0],ce,xe),Le.polyBoundingBox?Object(R.drawJoinedLines)(J,ve,ce[ce.length-1],[ce[0]],xe):Object(R.drawJoinedLines)(J,ve,ce[ce.length-1],[Ee.mouseLocation.handles.start],xe)}if(xe={color:Pe,fill:Ie},(Ee.alwaysShowHandles||Le.active&&Le.polyBoundingBox)&&(xe.handleRadius=Ee.activeHandleRadius,te.configuration.drawHandles&&Object(z.default)(J,ne,Le.handles.points,xe)),Le.canComplete){xe.handleRadius=Ee.completeHandleRadius;var _e=Le.handles.points[0];te.configuration.drawHandles&&Object(z.default)(J,ne,[_e],xe)}if(Le.active&&!Le.polyBoundingBox){xe.handleRadius=Ee.activeHandleRadius,te.configuration.drawHandles&&Object(z.default)(J,ne,Ee.mouseLocation.handles,xe);var Z=Le.handles.points[0];te.configuration.drawHandles&&Object(z.default)(J,ne,[Z],xe)}if(Le.invalidated===!0&&!Le.active&&(Le.meanStdDev&&Le.meanStdDevSUV&&Le.area?te.throttledUpdateCachedStats(ge,ve,Le):te.updateCachedStats(ge,ve,Le)),Le.polyBoundingBox&&!Le.handles.textBox.freehand){Le.handles.textBox.hasMoved||(Le.handles.textBox.x=Le.polyBoundingBox.left+Le.polyBoundingBox.width,Le.handles.textBox.y=Le.polyBoundingBox.top+Le.polyBoundingBox.height/2);var je=ye.call(te,Le);Object(b.default)(J,ve,Le.handles.textBox,je,Le.handles.points,Se,Pe,F,0,!0)}})},he=0;he<ue.data.length;he++)var pe=ie(he);function ye(Re){var Be=Re.meanStdDev,Le=Re.meanStdDevSUV,J=Re.area,Pe=[];if(Be&&Be.mean!==void 0){var Ie="";X==="CT"&&(Ie="HU"),Re.unit=Ie;var xe="Mean: ".concat(Object(I.default)(Be.mean.toFixed(2))," ").concat(Ie),ce="StdDev: ".concat(Object(I.default)(Be.stdDev.toFixed(2))," ").concat(Ie);if(Le&&Le.mean!==void 0){var _e=" SUV: ";xe+=_e+Object(I.default)(Le.mean.toFixed(2)),ce+=_e+Object(I.default)(Le.stdDev.toFixed(2))}Pe.push(xe),Pe.push(ce)}if(J){var Z=" mm".concat(""),je=Object(y.default)(ge),Fe=je.rowPixelSpacing,K=je.colPixelSpacing;(!Fe||!K)&&(Z=" pixels".concat(""));var Oe="Area: ".concat(Object(I.default)(J.toFixed(2))).concat(Z);Pe.push(Oe)}return Pe}function Se(Re){return Re}}},{key:"addNewMeasurement",value:function(V){var te=V.detail;this._startDrawing(V),this._addPoint(te),le(V)}},{key:"preMouseDownCallback",value:function(V){var te=V.detail,ne=this._pointNearHandleAllTools(te);return te.event.ctrlKey?(ne!==void 0&&ne.handleNearby.hasBoundingBox||U.call(this,V,ne),le(V),!0):!1}},{key:"handleSelectedCallback",value:function(V,te,ne){var ue=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"mouse",ge=V.detail.element,ve=Object(E.getToolState)(ge,this.name);if(ne.hasBoundingBox){Object(C.moveHandleNearImagePoint)(V,this,te,ne,ue);return}var Ee=this.configuration;Ee.dragOrigin={x:ne.x,y:ne.y};for(var De=0;De<ve.data.length;De++)for(var X=ve.data[De].handles.points,N=0;N<X.length;N++)X[N]===ne&&(Ee.currentHandle=N,Ee.currentTool=De);this._modifying=!0,this._activateModify(ge),le(V)}},{key:"_drawingMouseMoveCallback",value:function(V){var te=V.detail,ne=te.currentPoints,ue=te.element,ge=Object(E.getToolState)(ue,this.name),ve=this.configuration,Ee=ve.currentTool,De=ge.data[Ee],X=ne.canvas;this._getMouseLocation(te),this._checkInvalidHandleLocation(De,te);var N=this._pointNearHandle(ue,De,X),F=De.handles.points;N!==void 0&&!N.hasBoundingBox&&N<F.length-1&&(ve.mouseLocation.handles.start.x=F[N].x,ve.mouseLocation.handles.start.y=F[N].y),v.default.cornerstone.updateImage(ue)}},{key:"_drawingMouseDragCallback",value:function(V){this.options.mouseButtonMask.includes(V.detail.buttons)&&this._drawingDrag(V)}},{key:"_drawingTouchDragCallback",value:function(V){this._drawingDrag(V)}},{key:"_drawingDrag",value:function(V){var te=V.detail,ne=te.element,ue=Object(E.getToolState)(ne,this.name),ge=this.configuration,ve=ge.currentTool,Ee=ue.data[ve];this._getMouseLocation(te),this._checkInvalidHandleLocation(Ee,te),this._addPointPencilMode(te,Ee.handles.points),this._dragging=!0,v.default.cornerstone.updateImage(ne)}},{key:"_drawingMouseUpCallback",value:function(V){var te=V.detail.element;if(this._dragging){this._dragging=!1;var ne=this.configuration,ue=ne.currentTool,ge=Object(E.getToolState)(te,this.name),ve=ge.data[ue];if(!G.end(ve.handles.points)&&ve.canComplete){var Ee=ne.currentHandle;this._endDrawing(te,Ee)}le(V)}}},{key:"_drawingMouseDownCallback",value:function(V){var te=V.detail,ne=te.buttons,ue=te.currentPoints,ge=te.element;if(this.options.mouseButtonMask.includes(ne)){var ve=ue.canvas,Ee=this.configuration,De=Ee.currentTool,X=Object(E.getToolState)(ge,this.name),N=X.data[De],F=this._pointNearHandle(ge,N,ve);if(!G.end(N.handles.points)&&N.canComplete){var q=Ee.currentHandle;this._endDrawing(ge,q)}else F===void 0&&this._addPoint(te);le(V)}}},{key:"_drawingTouchStartCallback",value:function(V){var te=V.detail,ne=te.currentPoints,ue=te.element,ge=ne.canvas,ve=this.configuration,Ee=ve.currentTool,De=Object(E.getToolState)(ue,this.name),X=De.data[Ee],N=this._pointNearHandle(ue,X,ge);if(!G.end(X.handles.points)&&X.canComplete){var F=ve.currentHandle;this._endDrawing(ue,F)}else N===void 0&&this._addPoint(te);le(V)}},{key:"completeDrawing",value:function(V){if(this._drawing){var te=Object(E.getToolState)(V,this.name),ne=this.configuration,ue=te.data[ne.currentTool];if(!G.end(ue.handles.points)&&ue.handles.points.length>=2){var ge=ne.currentHandle;ue.polyBoundingBox={},this._endDrawing(V,ge)}}}},{key:"_drawingMouseDoubleClickCallback",value:function(V){var te=V.detail.element;this.completeDrawing(te),le(V)}},{key:"_drawingDoubleTapClickCallback",value:function(V){var te=V.detail.element;this.completeDrawing(te),le(V)}},{key:"_editMouseDragCallback",value:function(V){var te=V.detail,ne=te.element,ue=te.buttons;if(this.options.mouseButtonMask.includes(ue)){var ge=Object(E.getToolState)(ne,this.name),ve=this.configuration,Ee=ge.data[ve.currentTool],De=ve.currentHandle,X=Ee.handles.points,N=-1;if(this._getMouseLocation(te),Ee.handles.invalidHandlePlacement=G.modify(X,De),Ee.active=!0,Ee.highlight=!0,X[De].x=ve.mouseLocation.handles.start.x,X[De].y=ve.mouseLocation.handles.start.y,N=this._getPrevHandleIndex(De,X),De>=0){var F=X[N].lines.length-1,q=X[N].lines[F];q.x=ve.mouseLocation.handles.start.x,q.y=ve.mouseLocation.handles.start.y}v.default.cornerstone.updateImage(ne)}}},{key:"_editTouchDragCallback",value:function(V){var te=V.detail,ne=te.element,ue=Object(E.getToolState)(ne,this.name),ge=this.configuration,ve=ue.data[ge.currentTool],Ee=ge.currentHandle,De=ve.handles.points,X=-1;if(this._getMouseLocation(te),ve.handles.invalidHandlePlacement=G.modify(De,Ee),ve.active=!0,ve.highlight=!0,De[Ee].x=ge.mouseLocation.handles.start.x,De[Ee].y=ge.mouseLocation.handles.start.y,X=this._getPrevHandleIndex(Ee,De),Ee>=0){var N=De[X].lines.length-1,F=De[X].lines[N];F.x=ge.mouseLocation.handles.start.x,F.y=ge.mouseLocation.handles.start.y}v.default.cornerstone.updateImage(ne)}},{key:"_getPrevHandleIndex",value:function(V,te){return V===0?te.length-1:V-1}},{key:"_editMouseUpCallback",value:function(V){var te=V.detail,ne=te.element,ue=Object(E.getToolState)(ne,this.name);this._deactivateModify(ne),this._dropHandle(te,ue),this._endDrawing(ne),v.default.cornerstone.updateImage(ne)}},{key:"_dropHandle",value:function(V,te){var ne=this.configuration,ue=ne.currentTool,ge=te.data[ue].handles,ve=ge.points;if(ge.invalidHandlePlacement){var Ee=ne.currentHandle,De=ve[Ee],X;if(Ee===0){var N=ve.length-1;X=ve[N]}else X=ve[Ee-1];De.x=ne.dragOrigin.x,De.y=ne.dragOrigin.y,X.lines[0]=De,ge.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(V){var te=V.detail,ne=this.createNewMeasurement(te),ue=te.element,ge=this.configuration,ve;V.type===g.default.MOUSE_DOWN_ACTIVATE?ve="Mouse":V.type===g.default.TOUCH_START_ACTIVE&&(ve="Touch"),this._activateDraw(ue,ve),this._getMouseLocation(te),Object(E.addToolState)(ue,this.name,ne);var Ee=Object(E.getToolState)(ue,this.name);ge.currentTool=Ee.data.length-1,this._activeDrawingToolReference=Ee.data[ge.currentTool]}},{key:"_addPoint",value:function(V){var te=V.currentPoints,ne=V.element,ue=Object(E.getToolState)(ne,this.name),ge=this.configuration,ve=ue.data[ge.currentTool];if(!ve.handles.invalidHandlePlacement){var Ee=new $(te.image);ve.handles.points.length&&ve.handles.points[ge.currentHandle-1].lines.push(te.image),ve.handles.points.push(Ee),ge.currentHandle+=1,v.default.cornerstone.updateImage(ne),this.fireModifiedEvent(ne,ve)}}},{key:"_addPointPencilMode",value:function(V,te){var ne=this,ue=this.configuration,ge=V.element,ve=ue.mouseLocation.handles.start,Ee=function(X){return ne._isDistanceLargerThanSpacing(ge,X,ve)};te.every(Ee)&&this._addPoint(V)}},{key:"_endDrawing",value:function(V,te){var ne=Object(E.getToolState)(V,this.name),ue=this.configuration,ge=ne.data[ue.currentTool];if(ge.active=!1,ge.highlight=!1,ge.handles.invalidHandlePlacement=!1,te!==void 0){var ve=ge.handles.points;ve[ue.currentHandle-1].lines.push(ve[0])}this._modifying&&(this._modifying=!1,ge.invalidated=!0),ue.currentHandle=0,ue.currentTool=-1,ge.canComplete=!1,this._drawing&&this._deactivateDraw(V),v.default.cornerstone.updateImage(V),this.fireModifiedEvent(V,ge),this.fireCompletedEvent(V,ge)}},{key:"_pointNearHandle",value:function(V,te,ne){if(!(te.handles===void 0||te.handles.points===void 0)&&te.visible!==!1){for(var ue=0;ue<te.handles.points.length;ue++){var ge=v.default.cornerstone.pixelToCanvas(V,te.handles.points[ue]);if(v.default.cornerstoneMath.point.distance(ge,ne)<6)return ue}if(te.handles.textBox&&Object(_.default)(te.handles.textBox,ne))return te.handles.textBox}}},{key:"_pointNearHandleAllTools",value:function(V){var te=V.currentPoints,ne=V.element,ue=te.canvas,ge=Object(E.getToolState)(ne,this.name);if(ge){for(var ve,Ee=0;Ee<ge.data.length;Ee++)if(ve=this._pointNearHandle(ne,ge.data[Ee],ue),ve!==void 0)return{handleNearby:ve,toolIndex:Ee}}}},{key:"_getMouseLocation",value:function(V){var te=V.currentPoints,ne=V.image,ue=this.configuration;ue.mouseLocation.handles.start.x=te.image.x,ue.mouseLocation.handles.start.y=te.image.y,Object(H.clipToBox)(ue.mouseLocation.handles.start,ne)}},{key:"_checkInvalidHandleLocation",value:function(V,te){if(V.handles.points.length<2)return!0;var ne;this._dragging?ne=this._checkHandlesPencilMode(V,te):ne=this._checkHandlesPolygonMode(V,te),V.handles.invalidHandlePlacement=ne}},{key:"_checkHandlesPolygonMode",value:function(V,te){var ne=this.configuration,ue=te.element,ge=ne.mouseLocation.handles.start,ve=V.handles.points,Ee=!1;V.canComplete=!1;var De=this._isDistanceSmallerThanCompleteSpacingCanvas(ue,ve[0],ge);return De&&!G.end(ve)&&ve.length>2?(V.canComplete=!0,Ee=!1):Ee=G.newHandle(ge,ve),Ee}},{key:"_checkHandlesPencilMode",value:function(V,te){var ne=this.configuration,ue=ne.mouseLocation.handles.start,ge=V.handles.points,ve=G.newHandle(ue,ge);return ve===!1&&(ve=this._invalidHandlePencilMode(V,te)),ve}},{key:"_invalidHandlePencilMode",value:function(V,te){var ne=this.configuration,ue=te.element,ge=ne.mouseLocation.handles.start,ve=V.handles.points,Ee=this._isDistanceSmallerThanCompleteSpacingCanvas(ue,ve[0],ge);if(Ee)return V.canComplete=!0,!1;V.canComplete=!1;for(var De=1;De<ve.length-1;De++)if(this._isDistanceSmallerThanSpacing(ue,ve[De],ge))return!0;return!1}},{key:"_isDistanceSmallerThanCompleteSpacingCanvas",value:function(V,te,ne){var ue=v.default.cornerstone.pixelToCanvas(V,te),ge=v.default.cornerstone.pixelToCanvas(V,ne),ve;return this._drawingInteractionType==="Mouse"?ve=this.configuration.completeHandleRadius:this._drawingInteractionType==="Touch"&&(ve=this.configuration.completeHandleRadiusTouch),this._compareDistanceToSpacing(V,ue,ge,"<",ve)}},{key:"_isDistanceSmallerThanSpacing",value:function(V,te,ne){return this._compareDistanceToSpacing(V,te,ne,"<")}},{key:"_isDistanceLargerThanSpacing",value:function(V,te,ne){return this._compareDistanceToSpacing(V,te,ne,">")}},{key:"_compareDistanceToSpacing",value:function(V,te,ne){var ue=arguments.length>3&&arguments[3]!==void 0?arguments[3]:">",ge=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.configuration.spacing;return ue===">"?v.default.cornerstoneMath.point.distance(te,ne)>ge:v.default.cornerstoneMath.point.distance(te,ne)<ge}},{key:"_activateDraw",value:function(V){var te=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Mouse";this._drawing=!0,this._drawingInteractionType=te,M.state.isMultiPartToolActive=!0,Object(B.hideToolCursor)(this.element),V.addEventListener(g.default.MOUSE_DOWN,this._drawingMouseDownCallback),V.addEventListener(g.default.MOUSE_MOVE,this._drawingMouseMoveCallback),V.addEventListener(g.default.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),V.addEventListener(g.default.MOUSE_DRAG,this._drawingMouseDragCallback),V.addEventListener(g.default.MOUSE_UP,this._drawingMouseUpCallback),V.addEventListener(g.default.TOUCH_START,this._drawingMouseMoveCallback),V.addEventListener(g.default.TOUCH_START,this._drawingTouchStartCallback),V.addEventListener(g.default.TOUCH_DRAG,this._drawingTouchDragCallback),V.addEventListener(g.default.TOUCH_END,this._drawingMouseUpCallback),V.addEventListener(g.default.DOUBLE_TAP,this._drawingDoubleTapClickCallback),v.default.cornerstone.updateImage(V)}},{key:"_deactivateDraw",value:function(V){this._drawing=!1,M.state.isMultiPartToolActive=!1,this._activeDrawingToolReference=null,this._drawingInteractionType=null,Object(B.setToolCursor)(this.element,this.svgCursor),V.removeEventListener(g.default.MOUSE_DOWN,this._drawingMouseDownCallback),V.removeEventListener(g.default.MOUSE_MOVE,this._drawingMouseMoveCallback),V.removeEventListener(g.default.MOUSE_DOUBLE_CLICK,this._drawingMouseDoubleClickCallback),V.removeEventListener(g.default.MOUSE_DRAG,this._drawingMouseDragCallback),V.removeEventListener(g.default.MOUSE_UP,this._drawingMouseUpCallback),V.removeEventListener(g.default.TOUCH_START,this._drawingTouchStartCallback),V.removeEventListener(g.default.TOUCH_DRAG,this._drawingTouchDragCallback),V.removeEventListener(g.default.TOUCH_START,this._drawingMouseMoveCallback),V.removeEventListener(g.default.TOUCH_END,this._drawingMouseUpCallback),v.default.cornerstone.updateImage(V)}},{key:"_activateModify",value:function(V){M.state.isToolLocked=!0,V.addEventListener(g.default.MOUSE_UP,this._editMouseUpCallback),V.addEventListener(g.default.MOUSE_DRAG,this._editMouseDragCallback),V.addEventListener(g.default.MOUSE_CLICK,this._editMouseUpCallback),V.addEventListener(g.default.TOUCH_END,this._editMouseUpCallback),V.addEventListener(g.default.TOUCH_DRAG,this._editTouchDragCallback),v.default.cornerstone.updateImage(V)}},{key:"_deactivateModify",value:function(V){M.state.isToolLocked=!1,V.removeEventListener(g.default.MOUSE_UP,this._editMouseUpCallback),V.removeEventListener(g.default.MOUSE_DRAG,this._editMouseDragCallback),V.removeEventListener(g.default.MOUSE_CLICK,this._editMouseUpCallback),V.removeEventListener(g.default.TOUCH_END,this._editMouseUpCallback),V.removeEventListener(g.default.TOUCH_DRAG,this._editTouchDragCallback),v.default.cornerstone.updateImage(V)}},{key:"passiveCallback",value:function(V){this._closeToolIfDrawing(V)}},{key:"enabledCallback",value:function(V){this._closeToolIfDrawing(V)}},{key:"disabledCallback",value:function(V){this._closeToolIfDrawing(V)}},{key:"_closeToolIfDrawing",value:function(V){if(this._drawing){var te=this.configuration,ne=te.currentHandle;this._endDrawing(V,ne),v.default.cornerstone.updateImage(V)}}},{key:"fireModifiedEvent",value:function(V,te){var ne=g.default.MEASUREMENT_MODIFIED,ue={toolName:this.name,toolType:this.name,element:V,measurementData:te};Object(P.default)(V,ne,ue)}},{key:"fireCompletedEvent",value:function(V,te){var ne=g.default.MEASUREMENT_COMPLETED,ue={toolName:this.name,toolType:this.name,element:V,measurementData:te};Object(P.default)(V,ne,ue)}},{key:"cancelDrawing",value:function(V){if(this._drawing){var te=Object(E.getToolState)(V,this.name),ne=this.configuration,ue=te.data[ne.currentTool];ue.active=!1,ue.highlight=!1,ue.handles.invalidHandlePlacement=!1,ne.currentHandle=0,ne.currentTool=-1,ue.canComplete=!1,Object(E.removeToolState)(V,this.name,ue),this._deactivateDraw(V),v.default.cornerstone.updateImage(V)}}},{key:"newImageCallback",value:function(V){var te=this.configuration;if(this._drawing&&this._activeDrawingToolReference){var ne=V.detail.element,ue=this._activeDrawingToolReference;ue.active=!1,ue.highlight=!1,ue.handles.invalidHandlePlacement=!1;var ge=ue.handles.points;ge[te.currentHandle-1].lines.push(ge[0]),te.currentHandle=0,te.currentTool=-1,ue.canComplete=!1,this._deactivateDraw(ne),v.default.cornerstone.updateImage(ne)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(V){if(typeof V!="number")throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=V,v.default.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(V){if(typeof V!="number")throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=V,v.default.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(V){if(typeof V!="number")throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=V,v.default.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(V){if(typeof V!="boolean")throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=V,v.default.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(V){this.configuration.invalidColor=V,v.default.cornerstone.updateImage(this.element)}}]),me}(m.default);function re(){return{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:1,activeHandleRadius:3,completeHandleRadius:6,completeHandleRadiusTouch:28,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1,drawHandles:!0,renderDashed:!1}}function le(de){de.stopImmediatePropagation(),de.stopPropagation(),de.preventDefault()}},"./tools/annotation/LengthTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return y});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./tools/base/BaseAnnotationTool.js"),h=e("./stateManagement/toolState.js"),g=e("./stateManagement/toolStyle.js"),v=e("./stateManagement/toolColors.js"),m=e("./drawing/index.js"),E=e("./drawing/drawLinkedTextBox.js"),T=e("./drawing/drawHandles.js"),O=e("./util/lineSegDistance.js"),M=e("./tools/cursors/index.js"),P=e("./util/logger.js"),C=e("./util/getPixelSpacing.js"),_=e("./util/throttle.js"),D=e("./store/index.js"),I=Object(P.getLogger)("tools:annotation:LengthTool"),y=function(b){u()(z,b);function z(){var H,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,z);var p={name:"Length",supportedInteractionTypes:["Mouse","Touch"],svgCursor:M.lengthCursor,configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1,digits:2}};return H=t()(this,s()(z).call(this,B,p)),H.throttledUpdateCachedStats=Object(_.default)(H.updateCachedStats,110),H}return l()(z,[{key:"createNewMeasurement",value:function(B){var p=B&&B.currentPoints&&B.currentPoints.image;if(!p){I.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));return}var A=B.currentPoints.image,j=A.x,x=A.y;return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:j,y:x,highlight:!0,active:!1},end:{x:j,y:x,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(B,p,A){var j=p&&p.handles&&p.handles.start&&p.handles.end,x=j;return x?p.visible===!1?!1:Object(O.default)(B,p.handles.start,p.handles.end,A)<25:(I.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!1)}},{key:"updateCachedStats",value:function(B,p,A){var j=Object(C.default)(B),x=j.rowPixelSpacing,L=j.colPixelSpacing,U=(A.handles.end.x-A.handles.start.x)*(L||1),S=(A.handles.end.y-A.handles.start.y)*(x||1),w=Math.sqrt(U*U+S*S);A.length=w,A.invalidated=!1}},{key:"renderToolData",value:function(B){var p=this,A=B.detail,j=this.configuration,x=j.handleRadius,L=j.drawHandlesOnHover,U=j.hideHandlesIfMoving,S=j.renderDashed,w=j.digits,G=Object(h.getToolState)(B.currentTarget,this.name);if(!G)return;for(var $=Object(m.getNewContext)(A.canvasContext.canvas),Q=A.image,re=A.element,le=Object(C.default)(Q),de=le.rowPixelSpacing,me=le.colPixelSpacing,Y=g.default.getToolWidth(),V=Object(D.getModule)("globalConfiguration").configuration.lineDash,te=function(De){var X=G.data[De];if(X.visible===!1)return"continue";Object(m.draw)($,function(N){Object(m.setShadow)(N,p.configuration);var F=v.default.getColorIfActive(X),q={color:F};S&&(q.lineDash=V),Object(m.drawLine)(N,re,X.handles.start,X.handles.end,q);var oe={color:F,handleRadius:x,drawHandlesIfActive:L,hideHandlesIfMoving:U};if(p.configuration.drawHandles&&Object(T.default)(N,A,X.handles,oe),!X.handles.textBox.hasMoved){var ie={x:Math.max(X.handles.start.x,X.handles.end.x)};ie.x===X.handles.start.x?ie.y=X.handles.start.y:ie.y=X.handles.end.y,X.handles.textBox.x=ie.x,X.handles.textBox.y=ie.y}var he=10;X.invalidated===!0&&(X.length?p.throttledUpdateCachedStats(Q,re,X):p.updateCachedStats(Q,re,X));var pe=ge(X,de,me);Object(E.default)(N,re,X.handles.textBox,pe,X.handles,ve,F,Y,he,!0)})},ne=0;ne<G.data.length;ne++)var ue=te(ne);function ge(Ee,De,X){var N=R(Ee.length);if(!N)return"";var F="mm";return(!De||!X)&&(F="pixels"),Ee.unit=F,"".concat(N.toFixed(w)," ").concat(F)}function ve(Ee){var De={x:(Ee.start.x+Ee.end.x)/2,y:(Ee.start.y+Ee.end.y)/2};return[Ee.start,De,Ee.end]}}}]),z}(c.default);function R(b){var z=Number(b),H=!isNaN(z);return H?z:void 0}},"./tools/annotation/ProbeTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return R});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseAnnotationTool.js"),g=e("./stateManagement/toolState.js"),v=e("./stateManagement/textStyle.js"),m=e("./stateManagement/toolColors.js"),E=e("./drawing/index.js"),T=e("./drawing/drawTextBox.js"),O=e("./drawing/drawHandles.js"),M=e("./util/getRGBPixels.js"),P=e("./util/calculateSUV.js"),C=e("./tools/cursors/index.js"),_=e("./util/logger.js"),D=e("./util/throttle.js"),I=e("./store/index.js"),y=Object(_.getLogger)("tools:annotation:ProbeTool"),R=function(b){u()(z,b);function z(){var H,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,z);var p={name:"Probe",supportedInteractionTypes:["Mouse","Touch"],svgCursor:C.probeCursor,configuration:{drawHandles:!0,renderDashed:!1}};return H=t()(this,s()(z).call(this,B,p)),H.throttledUpdateCachedStats=Object(D.default)(H.updateCachedStats,110),H}return l()(z,[{key:"createNewMeasurement",value:function(B){var p=B&&B.currentPoints&&B.currentPoints.image;if(!p){y.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));return}return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{end:{x:B.currentPoints.image.x,y:B.currentPoints.image.y,highlight:!0,active:!0}}}}},{key:"pointNearTool",value:function(B,p,A){var j=p&&p.handles&&p.handles.end,x=j;if(x||y.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!x||p.visible===!1)return!1;var L=c.default.cornerstone.pixelToCanvas(B,p.handles.end);return c.default.cornerstoneMath.point.distance(L,A)<5}},{key:"updateCachedStats",value:function(B,p,A){var j=Math.round(A.handles.end.x),x=Math.round(A.handles.end.y),L={};j>=0&&x>=0&&j<B.columns&&x<B.rows&&(L.x=j,L.y=x,B.color?L.storedPixels=Object(M.default)(p,j,x,1,1):(L.storedPixels=c.default.cornerstone.getStoredPixels(p,j,x,1,1),L.sp=L.storedPixels[0],L.mo=L.sp*B.slope+B.intercept,L.suv=Object(P.default)(B,L.sp))),A.cachedStats=L,A.invalidated=!1}},{key:"renderToolData",value:function(B){var p=this,A=B.detail,j=this.configuration,x=j.handleRadius,L=j.renderDashed,U=Object(g.getToolState)(B.currentTarget,this.name);if(U)for(var S=Object(E.getNewContext)(A.canvasContext.canvas),w=A.image,G=A.element,$=v.default.getFontSize(),Q=Object(I.getModule)("globalConfiguration").configuration.lineDash,re=function(Y){var V=U.data[Y];if(V.visible===!1)return"continue";Object(E.draw)(S,function(te){var ne=m.default.getColorIfActive(V);if(p.configuration.drawHandles){var ue={handleRadius:x,color:ne};L&&(ue.lineDash=Q),Object(O.default)(te,A,V.handles,ue)}V.invalidated===!0&&(V.cachedStats?p.throttledUpdateCachedStats(w,G,V):p.updateCachedStats(w,G,V));var ge,ve,Ee=V.cachedStats,De=Ee.x,X=Ee.y,N=Ee.storedPixels,F=Ee.sp,q=Ee.mo,oe=Ee.suv;if(De>=0&&X>=0&&De<w.columns&&X<w.rows){ge="".concat(De,", ").concat(X),w.color?ve="R: ".concat(N[0]," G: ").concat(N[1]," B: ").concat(N[2]):(ve="SP: ".concat(F," MO: ").concat(parseFloat(q.toFixed(3))),oe&&(ve+=" SUV: ".concat(parseFloat(oe.toFixed(3)))));var ie={x:V.handles.end.x+3,y:V.handles.end.y-3},he=c.default.cornerstone.pixelToCanvas(A.element,ie);Object(T.default)(te,ve,he.x,he.y+$+5,ne),Object(T.default)(te,ge,he.x,he.y,ne)}})},le=0;le<U.data.length;le++)var de=re(le)}}]),z}(h.default)},"./tools/annotation/RectangleRoiTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return R});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./externalModules.js"),h=e("./tools/base/BaseAnnotationTool.js"),g=e("./stateManagement/toolState.js"),v=e("./stateManagement/toolStyle.js"),m=e("./stateManagement/toolColors.js"),E=e("./drawing/index.js"),T=e("./util/calculateSUV.js"),O=e("./util/getROITextBoxCoords.js"),M=e("./util/numbersWithCommas.js"),P=e("./util/throttle.js"),C=e("./tools/cursors/index.js"),_=e("./util/logger.js"),D=e("./util/getPixelSpacing.js"),I=e("./store/index.js"),y=Object(_.getLogger)("tools:annotation:RectangleRoiTool"),R=function(x){u()(L,x);function L(){var U,S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,L);var w={name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"],configuration:{drawHandles:!0,drawHandlesOnHover:!1,hideHandlesIfMoving:!1,renderDashed:!1},svgCursor:C.rectangleRoiCursor};return U=t()(this,s()(L).call(this,S,w)),U.throttledUpdateCachedStats=Object(P.default)(U.updateCachedStats,110),U}return l()(L,[{key:"createNewMeasurement",value:function(S){var w=S&&S.currentPoints&&S.currentPoints.image;if(!w){y.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"));return}return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:S.currentPoints.image.x,y:S.currentPoints.image.y,highlight:!0,active:!1},end:{x:S.currentPoints.image.x,y:S.currentPoints.image.y,highlight:!0,active:!0},initialRotation:S.viewport.rotation,textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(S,w,G,$){var Q=w&&w.handles&&w.handles.start&&w.handles.end,re=Q;if(re||y.warn("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool")),!re||w.visible===!1)return!1;var le=$==="mouse"?15:25,de=c.default.cornerstone.pixelToCanvas(S,w.handles.start),me=c.default.cornerstone.pixelToCanvas(S,w.handles.end),Y={left:Math.min(de.x,me.x),top:Math.min(de.y,me.y),width:Math.abs(de.x-me.x),height:Math.abs(de.y-me.y)},V=c.default.cornerstoneMath.rect.distanceToPoint(Y,G);return V<le}},{key:"updateCachedStats",value:function(S,w,G){var $=c.default.cornerstone.metaData.get("generalSeriesModule",S.imageId)||{},Q=$.modality,re=Object(D.default)(S),le=z(S,w,G.handles,Q,re);G.cachedStats=le,G.invalidated=!1}},{key:"renderToolData",value:function(S){var w=this,G=Object(g.getToolState)(S.currentTarget,this.name);if(G){var $=S.detail,Q=$.image,re=$.element,le=v.default.getToolWidth(),de=Object(I.getModule)("globalConfiguration").configuration.lineDash,me=this.configuration,Y=me.handleRadius,V=me.drawHandlesOnHover,te=me.hideHandlesIfMoving,ne=me.renderDashed,ue=Object(E.getNewContext)($.canvasContext.canvas),ge=Object(D.default)(Q),ve=ge.rowPixelSpacing,Ee=ge.colPixelSpacing,De=c.default.cornerstone.metaData.get("generalSeriesModule",Q.imageId)||{},X=De.modality,N=ve&&Ee;Object(E.draw)(ue,function(F){for(var q=0;q<G.data.length;q++){var oe=G.data[q];if(oe.visible!==!1){var ie=m.default.getColorIfActive(oe),he={color:ie,handleRadius:Y,drawHandlesIfActive:V,hideHandlesIfMoving:te};Object(E.setShadow)(F,w.configuration);var pe={color:ie};if(ne&&(pe.lineDash=de),Object(E.drawRect)(F,re,oe.handles.start,oe.handles.end,pe,"pixel",oe.handles.initialRotation),w.configuration.drawHandles&&Object(E.drawHandles)(F,$,oe.handles,he),oe.invalidated===!0&&(oe.cachedStats?w.throttledUpdateCachedStats(Q,re,oe):w.updateCachedStats(Q,re,oe)),!oe.handles.textBox.hasMoved){var ye=Object(O.default)($.viewport,oe.handles);Object.assign(oe.handles.textBox,ye)}var Se=function(Le){return B(Le.start,Le.end)},Re=j(F,Q.color,oe.cachedStats,X,N,w.configuration);oe.unit=A(X,w.configuration.showHounsfieldUnits),Object(E.drawLinkedTextBox)(F,re,oe.handles.textBox,Re,oe.handles,Se,ie,le,10,!0)}}})}}}]),L}(h.default);function b(x,L){return{left:Math.min(x.x,L.x),top:Math.min(x.y,L.y),width:Math.abs(x.x-L.x),height:Math.abs(x.y-L.y)}}function z(x,L,U,S,w){var G=b(U.start,U.end),$=c.default.cornerstone.getPixels(L,G.left,G.top,G.width,G.height),Q=H($,G),re;S==="PT"&&(re={mean:Object(T.default)(x,Q.mean,!0)||0,stdDev:Object(T.default)(x,Q.stdDev,!0)||0});var le=G.width*(w.colPixelSpacing||1)*(G.height*(w.rowPixelSpacing||1)),de=G.width*2*(w.colPixelSpacing||1)+G.height*2*(w.rowPixelSpacing||1);return{area:le||0,perimeter:de,count:Q.count||0,mean:Q.mean||0,variance:Q.variance||0,stdDev:Q.stdDev||0,min:Q.min||0,max:Q.max||0,meanStdDevSUV:re}}function H(x,L){for(var U=0,S=0,w=0,G=0,$=x?x[0]:null,Q=x?x[0]:null,re=L.top;re<L.top+L.height;re++)for(var le=L.left;le<L.left+L.width;le++)U+=x[G],S+=x[G]*x[G],$=Math.min($,x[G]),Q=Math.max(Q,x[G]),w++,G++;if(w===0)return{count:w,mean:0,variance:0,stdDev:0,min:0,max:0};var de=U/w,me=S/w-de*de;return{count:w,mean:de,variance:me,stdDev:Math.sqrt(me),min:$,max:Q}}function B(x,L){var U=b(x,L),S=U.left,w=U.top,G=U.width,$=U.height;return[{x:S+G/2,y:w},{x:S,y:w+$/2},{x:S+G/2,y:w+$},{x:S+G,y:w+$/2}]}function p(x,L){var U=L?" mm".concat(""):" px".concat("");return"Area: ".concat(Object(M.default)(x.toFixed(2))).concat(U)}function A(x,L){return x==="CT"&&L!==!1?"HU":""}function j(x,L){var U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},S=U.area,w=S===void 0?0:S,G=U.mean,$=G===void 0?0:G,Q=U.stdDev,re=Q===void 0?0:Q,le=U.min,de=le===void 0?0:le,me=U.max,Y=me===void 0?0:me,V=U.meanStdDevSUV,te=V===void 0?0:V,ne=arguments.length>3?arguments[3]:void 0,ue=arguments.length>4?arguments[4]:void 0,ge=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},ve=ge.showMinMax||!1,Ee=[],De=[];if(!L){var X=te&&te.mean!==0,N=A(ne,ge.showHounsfieldUnits),F="Mean: ".concat(Object(M.default)($.toFixed(2))," ").concat(N),q="Std Dev: ".concat(Object(M.default)(re.toFixed(2))," ").concat(N);if(X){for(var oe=" SUV: ",ie="".concat(oe).concat(Object(M.default)(te.mean.toFixed(2))),he="".concat(oe).concat(Object(M.default)(te.stdDev.toFixed(2))),pe=Math.floor(x.measureText("".concat(q,"     ")).width);x.measureText(F).width<pe;)F+=" ";De.push("".concat(F).concat(ie)),De.push("".concat(q,"     ").concat(he))}else De.push("".concat(F)),De.push("".concat(q));if(ve){for(var ye="Min: ".concat(de," ").concat(N),Se="Max: ".concat(Y," ").concat(N),Re=Math.floor(X?x.measureText("".concat(q,"     ")).width:x.measureText("".concat(F,"     ")).width);x.measureText(ye).width<Re;)ye+=" ";De.push("".concat(ye).concat(Se))}}return Ee.push(p(w,ue)),De.forEach(function(Be){return Ee.push(Be)}),Ee}},"./tools/annotation/TextMarkerTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return C});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./tools/base/BaseAnnotationTool.js"),v=e("./externalModules.js"),m=e("./util/pointInsideBoundingBox.js"),E=e("./stateManagement/toolColors.js"),T=e("./drawing/index.js"),O=e("./drawing/drawTextBox.js"),M=e("./stateManagement/toolState.js"),P=e("./tools/cursors/index.js"),C=function(D){h()(I,D);function I(){var y,R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,I);var b={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:_},svgCursor:P.textMarkerCursor};return y=t()(this,s()(I).call(this,R,b)),y.touchPressCallback=y._changeText.bind(u()(y)),y.doubleClickCallback=y._changeText.bind(u()(y)),y}return l()(I,[{key:"createNewMeasurement",value:function(R){var b=this.configuration;if(b.current){var z={visible:!0,active:!0,text:b.current,color:void 0,handles:{end:{x:R.currentPoints.image.x,y:R.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},H={left:0,top:0,width:R.image.width,height:R.image.height};if(v.default.cornerstoneMath.point.insideRect(z.handles.end,H)){var B=b.markers.indexOf(b.current),p=b.ascending?1:-1;return B+=p,B>=b.markers.length?B=b.loop?0:-1:B<0&&(B=b.loop?b.markers.length:-1),b.current=b.markers[B],z}}}},{key:"pointNearTool",value:function(R,b,z){if(b.visible===!1)return!1;if(b.handles.end.boundingBox){var H=v.default.cornerstoneMath.rect.distanceToPoint(b.handles.end.boundingBox,z),B=Object(m.default)(b.handles.end,z);return H<10||B}}},{key:"updateCachedStats",value:function(){}},{key:"renderToolData",value:function(R){var b=R.detail,z=this.configuration,H=Object(M.getToolState)(b.element,this.name);if(H)for(var B=Object(T.getNewContext)(b.canvasContext.canvas),p=function(L){var U=H.data[L];if(U.visible===!1)return"continue";var S=E.default.getColorIfActive(U);Object(T.draw)(B,function(w){Object(T.setShadow)(w,z);var G=v.default.cornerstone.pixelToCanvas(b.element,U.handles.end),$={centering:{x:!0,y:!0}};U.handles.end.boundingBox=Object(O.default)(w,U.text,G.x,G.y-10,S,$)})},A=0;A<H.data.length;A++)var j=p(A)}},{key:"_changeText",value:function(R){var b=R.detail,z=b.element,H=b.currentPoints,B;function p(U,S,w){w===!0?Object(M.removeToolState)(z,this.name,U):U.text=S,U.active=!1,v.default.cornerstone.updateImage(z)}var A=this.configuration,j=H.canvas,x=Object(M.getToolState)(z,this.name);if(x){for(var L=0;L<x.data.length;L++)if(B=x.data[L],this.pointNearTool(z,B,j)){B.active=!0,v.default.cornerstone.updateImage(z),A.changeTextCallback(B,b,p),R.stopImmediatePropagation(),R.preventDefault(),R.stopPropagation();return}}}}]),I}(g.default),_=function(I,y,R){R(I,prompt("Change your annotation:"))}},"./tools/annotation/bidirectionalTool/addNewMeasurement.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./events.js"),d=e("./manipulators/index.js"),l=e("./manipulators/anyHandlesOutsideImage.js"),o=e("./stateManagement/toolState.js"),t=e("./util/triggerEvent.js"),r=e("./util/getActiveTool.js"),s=e("./tools/annotation/BidirectionalTool.js"),i=e("./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js");n.default=function(c,h){var g=this,v=c.detail,m=v.element,E=v.image,T=v.buttons,O=this.configuration;if(!u(E)){var M=this.createNewMeasurement(v),P=function(){M.active=!1,a.default.cornerstone.updateImage(m)};Object(o.addToolState)(m,this.name,M),a.default.cornerstone.updateImage(m);var C=new Date().getTime(),_=M.handles,D=_.end,I=_.perpendicularStart;Object(d.moveNewHandle)(v,this.name,M,D,{},h,function(y){if(!y){Object(o.removeToolState)(m,g.name,M);return}var R=M.handles,b=M.longestDiameter,z=M.shortestDiameter,H=Object(l.default)(v,R),B=parseFloat(b)||0,p=parseFloat(z)||0,A=B<1||p<1,j=new Date().getTime()-C<150;H||A||j?(M.cancelled=!0,Object(o.removeToolState)(m,g.name,M)):O.getMeasurementLocationCallback(M,v,P),Object(i.default)(v,M),I.locked=!1,M.invalidated=!0,a.default.cornerstone.updateImage(m);var x=Object(r.default)(m,T,h);x instanceof s.default&&x.updateCachedStats(E,m,M);var L={toolName:g.name,toolType:g.name,element:m,measurementData:M};Object(t.default)(m,f.default.MEASUREMENT_MODIFIED,L),Object(t.default)(m,f.default.MEASUREMENT_COMPLETED,L)})}};var u=function(h){var g=a.default.cornerstone.metaData.get("imagePlaneModule",h.imageId),v=h.rowPixelSpacing,m=h.columnPixelSpacing;return g&&(v=g.rowPixelSpacing||g.rowImagePixelSpacing,m=g.columnPixelSpacing||g.colImagePixelSpacing),!v||!m}},"./tools/annotation/bidirectionalTool/createNewMeasurement.js":function(W,n,e){e.r(n);var a=function(d,l,o){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Object.assign({x:d,y:l,index:o,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},t)};n.default=function(f){var d=f.currentPoints.image,l=d.x,o=d.y,t={toolName:this.name,toolType:this.name,isCreating:!0,visible:!0,active:!0,invalidated:!0,handles:{start:a(l,o,0),end:a(l,o,1,{active:!0}),perpendicularStart:a(l,o,2,{locked:!0}),perpendicularEnd:a(l,o,3),textBox:a(l-50,o-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0};return t}},"./tools/annotation/bidirectionalTool/handleSelectedCallback.js":function(W,n,e){e.r(n),n.default=function(a,f,d){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"mouse";l==="touch"?this.handleSelectedTouchCallback(a):this.handleSelectedMouseCallback(a)}},"./tools/annotation/bidirectionalTool/handleSelectedMouseCallback.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/typeof.js"),f=e.n(a),d=e("./externalModules.js"),l=e("./events.js"),o=e("./stateManagement/toolState.js"),t=e("./manipulators/anyHandlesOutsideImage.js"),r=e("./manipulators/getHandleNearImagePoint.js"),s=e("./manipulators/index.js"),i=e("./tools/annotation/bidirectionalTool/moveHandle/moveHandle.js"),u=e("./tools/annotation/bidirectionalTool/invertHandles.js"),c=e("./store/setToolCursor.js"),h=e("./util/getProximityThreshold.js");n.default=function(E){var T=this,O=E.detail,M=O.element,P,C=Object(h.default)("mouse",this.name),_=function(p){P.invalidated=!0,Object(t.default)(O,P.handles)&&Object(o.removeToolState)(M,T.name,P),p&&(p.moving=!1,p.selected=!0),Object(c.setToolCursor)(T.element,T.svgCursor),d.default.cornerstone.updateImage(M),M.addEventListener(l.default.MOUSE_MOVE,T._moveCallback),M.addEventListener(l.default.TOUCH_START,T._moveCallback)},D=O.startPoints.canvas,I=Object(o.getToolState)(E.currentTarget,this.name);if(I){for(var y=function(p){P=I.data[p];var A=[M,P.handles,D,C],j=r.default.apply(void 0,A);if(j)return M.removeEventListener(l.default.MOUSE_MOVE,T._moveCallback),M.removeEventListener(l.default.TOUCH_START,T._moveCallback),P.active=!0,g(P.handles),j.moving=!0,j=Object(u.default)(O,P,j),j.hasBoundingBox||Object(c.hideToolCursor)(T.element),Object(i.default)(O,T.name,P,j,function(){return _(j)}),m(E),{v:!0}},R=0;R<I.data.length;R++){var b=y(R);if(f()(b)==="object")return b.v}for(var z=function(p){return function(){v(p,!1),_()}},R=0;R<I.data.length;R++)if(P=I.data[R],this.pointNearTool(M,P,D,"mouse")){M.removeEventListener(l.default.MOUSE_MOVE,this._moveCallback),M.removeEventListener(l.default.TOUCH_START,this._moveCallback),P.active=!0,g(P.handles),v(P.handles,!0);var H=z(P.handles);return Object(s.moveAllHandles)(O,this.name,P,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"mouse",H),m(E),!0}}};var g=function(T){var O=!1;return Object.keys(T).forEach(function(M){M!=="textBox"&&(T[M].selected=!1,O=T[M].active||O,T[M].active=!1)}),O},v=function(T,O){Object.keys(T).forEach(function(M){M!=="textBox"&&(T[M].moving=O)})},m=function(T){T.stopImmediatePropagation(),T.stopPropagation(),T.preventDefault()}},"./tools/annotation/bidirectionalTool/handleSelectedTouchCallback.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/typeof.js"),f=e.n(a),d=e("./externalModules.js"),l=e("./store/index.js"),o=e("./events.js"),t=e("./stateManagement/toolState.js"),r=e("./manipulators/anyHandlesOutsideImage.js"),s=e("./manipulators/getHandleNearImagePoint.js"),i=e("./manipulators/index.js"),u=e("./tools/annotation/bidirectionalTool/moveHandle/touchMoveHandle.js");n.default=function(v){var m=this,E=v.detail,T=E.element,O,M=l.state.touchProximity,P=function(H){O.invalidated=!0,Object(r.default)(E,O.handles)&&Object(t.removeToolState)(T,m.name,O),H&&(H.moving=!1,H.selected=!0),d.default.cornerstone.updateImage(T),T.addEventListener(o.default.TOUCH_DRAG,m._moveCallback)},C=E.startPoints.canvas,_=Object(t.getToolState)(v.currentTarget,this.name);if(_){for(var D=function(H){O=_.data[H];var B=[T,O.handles,C,M],p=s.default.apply(void 0,B);if(p)return T.removeEventListener(o.default.TOUCH_DRAG,m._moveCallback),O.active=!0,c(O.handles),p.moving=!0,Object(u.default)(E,m.name,O,p,function(){return P(p)}),g(v),{v:!0}},I=0;I<_.data.length;I++){var y=D(I);if(f()(y)==="object")return y.v}for(var R=function(H){return function(){h(H,!1),P()}},I=0;I<_.data.length;I++)if(O=_.data[I],this.pointNearTool(T,O,C,"touch")){T.removeEventListener(o.default.TOUCH_DRAG,this._moveCallback),O.active=!0,c(O.handles),h(O.handles,!0);var b=R(O.handles);return Object(i.moveAllHandles)(E,this.name,O,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},"touch",b),g(v),!0}}};var c=function(m){var E=!1;return Object.keys(m).forEach(function(T){T!=="textBox"&&(m[T].selected=!1,E=m[T].active||E,m[T].active=!1)}),E},h=function(m,E){Object.keys(m).forEach(function(T){T!=="textBox"&&(m[T].moving=E)})},g=function(m){m.stopImmediatePropagation(),m.stopPropagation(),m.preventDefault()}},"./tools/annotation/bidirectionalTool/invertHandles.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return d});var a=function(o,t,r){var s=o[r],i=t[r];o[r]=i,t[r]=s},f=function(o,t){a(o,t,"x"),a(o,t,"y"),a(o,t,"moving"),a(o,t,"hover"),a(o,t,"active"),a(o,t,"selected")};function d(l,o,t){var r=l.image,s=r.rowPixelSpacing,i=r.columnPixelSpacing,u=o.handles,c=u.start,h=u.end,g=u.perpendicularStart,v=u.perpendicularEnd,m=(c.x-h.x)*(i||1),E=(c.y-h.y)*(s||1),T=Math.sqrt(m*m+E*E),O=(g.x-v.x)*(i||1),M=(g.y-v.y)*(s||1),P=Math.sqrt(O*O+M*M)||0;return P>T?(f(c,h),f(c,g),f(h,v),Object.values(u).find(function(C){return C.moving===!0})):t}},"./tools/annotation/bidirectionalTool/mouseMoveCallback.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./stateManagement/toolCoordinates.js"),d=e("./manipulators/getHandleNearImagePoint.js"),l=e("./stateManagement/toolState.js"),o=function(r,s,i){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:6,c=Object(d.default)(r,s,i,u),h=!1;return Object.keys(s).forEach(function(g){if(g!=="textBox"){var v=s[g],m=v===c;v.active!==m&&(h=!0),v.active=m}}),h};n.default=function(t){var r=this,s=t.detail,i=s.element;f.default.setCoords(s);var u=Object(l.getToolState)(i,this.name);if(u){for(var c=!1,h=function(m){var E=s.currentPoints.canvas,T=u.data[m],O=o(i,T.handles,E);Object.keys(T.handles).forEach(function(_){if(_!=="textBox"){var D=T.handles[_];D.hover=D.active}}),O&&(c=!0);var M=r.pointNearTool(i,T,E,"mouse"),P=M&&!T.active,C=!M&&T.active;(P||C)&&(T.active=!T.active,c=!0)},g=0;g<u.data.length;g++)h(g);c===!0&&a.default.cornerstone.updateImage(i)}}},"./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return l});var a=e("./externalModules.js"),f=e("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js");function d(o,t){return{start:o,end:t}}function l(o,t,r){var s=a.default.cornerstoneMath.lineSegment,i=o.handles,u=i.start,c=i.end,h=i.perpendicularStart,g=i.perpendicularEnd,v=t.image,m=v.columnPixelSpacing,E=m===void 0?1:m,T=v.rowPixelSpacing,O=T===void 0?1:T,M=d(u,c),P=d(h,g),C=s.intersectLine(M,P),_=Object(f.default)(E,O,r,C);return{columnPixelSpacing:E,rowPixelSpacing:O,start:u,end:c,perpendicularStart:h,perpendicularEnd:g,longLine:M,intersection:C,distanceToFixed:_,fixedPoint:r}}},"./tools/annotation/bidirectionalTool/moveHandle/moveHandle.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./store/index.js"),d=e("./events.js"),l=e("./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js"),o=e("./util/getActiveTool.js"),t=e("./tools/base/BaseAnnotationTool.js");n.default=function(r,s,i,u,c,h){var g=r.element,v=r.image,m=r.buttons,E={x:u.x-r.currentPoints.image.x,y:u.y-r.currentPoints.image.y},T=function(_){var D=_.detail;u.hasMoved=!0,u.index===void 0||u.index===null?(u.x=D.currentPoints.image.x+E.x,u.y=D.currentPoints.image.y+E.y):Object(l.default)(u,D,i,E),h&&(u.x=Math.max(u.x,0),u.x=Math.min(u.x,D.image.width),u.y=Math.max(u.y,0),u.y=Math.min(u.y,D.image.height)),i.invalidated=!0,a.default.cornerstone.updateImage(g);var I=Object(o.default)(g,m,"mouse");I instanceof t.default&&I.updateCachedStats(v,g,i);var y={toolName:s,toolType:s,element:g,measurementData:i};a.default.cornerstone.triggerEvent(g,d.default.MEASUREMENT_MODIFIED,y)};u.active=!0,u.moving=!0,f.state.isToolLocked=!0,g.addEventListener(d.default.MOUSE_DRAG,T),g.addEventListener(d.default.TOUCH_DRAG,T);var O=a.default.cornerstone.getImage(g),M=function(){var _=a.default.cornerstone.getImage(g);_.imageId!==O.imageId&&P()};g.addEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,M);var P=function C(){u.active=!1,f.state.isToolLocked=!1,g.removeEventListener(a.default.cornerstone.EVENTS.IMAGE_RENDERED,M),g.removeEventListener(d.default.MOUSE_DRAG,T),g.removeEventListener(d.default.MOUSE_UP,C),g.removeEventListener(d.default.MOUSE_CLICK,C),g.removeEventListener(d.default.TOUCH_DRAG,T),g.removeEventListener(d.default.TOUCH_DRAG_END,C),g.removeEventListener(d.default.TAP,C),a.default.cornerstone.updateImage(g),typeof c=="function"&&c()};g.addEventListener(d.default.MOUSE_UP,P),g.addEventListener(d.default.MOUSE_CLICK,P),g.addEventListener(d.default.TOUCH_DRAG_END,P),g.addEventListener(d.default.TAP,P)}},"./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/moveLongLine.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return l});var a=e("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js"),f=e("./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js"),d=e("./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/updatePerpendicularLine.js");function l(o,t,r,s){var i=Object(f.default)(t,r,s),u=i.columnPixelSpacing,c=i.rowPixelSpacing,h=i.distanceToFixed,g=Object(a.default)(u,c,s,o);if(g<=h)return!1;var v=h/g,m={x:s.x+(o.x-s.x)*v,y:s.y+(o.y-s.y)*v},E=Object(d.default)(i,m);return t.handles.perpendicularStart.x=E.start.x,t.handles.perpendicularStart.y=E.start.y,t.handles.perpendicularEnd.x=E.end.x,t.handles.perpendicularEnd.y=E.end.y,!0}},"./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/updatePerpendicularLine.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return d});var a=e("./tools/annotation/bidirectionalTool/utils/getLineVector.js"),f=e("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js");function d(l,o){var t=l.columnPixelSpacing,r=l.rowPixelSpacing,s=l.start,i=l.perpendicularStart,u=l.perpendicularEnd,c=l.intersection,h=l.fixedPoint,g=Object(f.default)(t,r,i,c),v=Object(f.default)(t,r,u,c),m=Object(a.default)(t,r,h,o),E=h===s?1:-1,T=E*r,O=E*t;return{start:{x:o.x+m.y*g*T,y:o.y+m.x*g*O*-1},end:{x:o.x+m.y*v*T*-1,y:o.y+m.x*v*O}}}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js");function f(d,l){return Object(a.default)(d,l)?-1:1}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getHelperLine.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js");function f(d,l,o){var t=d.columnPixelSpacing,r=d.rowPixelSpacing,s=d.perpendicularEnd,i=d.fixedPoint,u=Number.MAX_SAFE_INTEGER,c=Object(a.default)(i,s)*u;return{start:l,end:{x:l.x+o.y*r*c,y:l.y+o.x*t*c*-1}}}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getMovingPoint.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js");function f(d,l,o){return Object(a.default)(d,o)?l:o}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/isPerpendicularEndFixed.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d){return f===d}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/lineHasLength.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js");function f(d,l,o){var t=Object(a.default)(d,l,o.start,o.end);return t!==0}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/movePerpendicularLine.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return r});var a=e("./externalModules.js"),f=e("./tools/annotation/bidirectionalTool/utils/getLineVector.js"),d=e("./tools/annotation/bidirectionalTool/moveHandle/getBaseData.js"),l=e("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/lineHasLength.js"),o=e("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getHelperLine.js"),t=e("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/updatePerpendicularLine.js");function r(s,i,u,c){var h=a.default.cornerstoneMath.lineSegment,g=Object(d.default)(i,u,c),v=g.columnPixelSpacing,m=g.rowPixelSpacing,E=g.start,T=g.longLine,O=g.intersection;if(!Object(l.default)(v,m,T))return!1;var M=Object(f.default)(v,m,E,O),P=Object(o.default)(g,s,M),C=h.intersectLine(T,P);if(!C)return!1;var _=Object(t.default)(g,C,P,M);return i.handles.perpendicularStart.x=_.start.x,i.handles.perpendicularStart.y=_.start.y,i.handles.perpendicularEnd.x=_.end.x,i.handles.perpendicularEnd.y=_.end.y,!0}},"./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/updatePerpendicularLine.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return o});var a=e("../node_modules/@babel/runtime/helpers/defineProperty.js"),f=e.n(a),d=e("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getDirectionMultiplier.js"),l=e("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/getMovingPoint.js");function o(t,r,s,i){var u,c=t.columnPixelSpacing,h=t.rowPixelSpacing,g=t.fixedPoint,v=t.perpendicularStart,m=t.perpendicularEnd,E=t.distanceToFixed,T=Object(d.default)(g,m)*E,O=Object(l.default)(g,v,m),M=O===v,P=M?"start":"end",C=M?"end":"start";return u={},f()(u,P,{x:s.start.x,y:s.start.y}),f()(u,C,{x:r.x+i.y*h*T,y:r.y+i.x*c*T*-1}),u}},"./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./tools/annotation/bidirectionalTool/moveHandle/moveLongLine/moveLongLine.js"),d=e("./tools/annotation/bidirectionalTool/moveHandle/movePerpendicularLine/movePerpendicularLine.js");n.default=function(l,o,t,r){var s,i,u,c,h,g,v={},m={},E={x:o.currentPoints.image.x+r.x,y:o.currentPoints.image.y+r.y};l.index===0?(u=Object(f.default)(E,t,o,t.handles.end),u?(l.x=E.x,l.y=E.y):(o.currentPoints.image.x=l.x,o.currentPoints.image.y=l.y)):l.index===1?(u=Object(f.default)(E,t,o,t.handles.start),u?(l.x=E.x,l.y=E.y):(o.currentPoints.image.x=l.x,o.currentPoints.image.y=l.y)):l.index===2?(i=!1,v.start={x:t.handles.start.x,y:t.handles.start.y},v.end={x:t.handles.end.x,y:t.handles.end.y},m.start={x:t.handles.perpendicularEnd.x,y:t.handles.perpendicularEnd.y},m.end={x:E.x,y:E.y},c=a.default.cornerstoneMath.lineSegment.intersectLine(v,m),c||(m.end={x:t.handles.perpendicularStart.x,y:t.handles.perpendicularStart.y},c=a.default.cornerstoneMath.lineSegment.intersectLine(v,m),h=a.default.cornerstoneMath.point.distance(c,t.handles.start),g=a.default.cornerstoneMath.point.distance(c,t.handles.end),(!c||h<3||g<3)&&(i=!0)),s=!1,i||(s=Object(d.default)(E,t,o,t.handles.perpendicularEnd),s||(o.currentPoints.image.x=t.handles.perpendicularStart.x,o.currentPoints.image.y=t.handles.perpendicularStart.y))):l.index===3&&(i=!1,v.start={x:t.handles.start.x,y:t.handles.start.y},v.end={x:t.handles.end.x,y:t.handles.end.y},m.start={x:t.handles.perpendicularStart.x,y:t.handles.perpendicularStart.y},m.end={x:E.x,y:E.y},c=a.default.cornerstoneMath.lineSegment.intersectLine(v,m),c||(m.end={x:t.handles.perpendicularEnd.x,y:t.handles.perpendicularEnd.y},c=a.default.cornerstoneMath.lineSegment.intersectLine(v,m),h=a.default.cornerstoneMath.point.distance(c,t.handles.start),g=a.default.cornerstoneMath.point.distance(c,t.handles.end),(!c||h<3||g<3)&&(i=!0)),s=!1,i||(s=Object(d.default)(E,t,o,t.handles.perpendicularStart),s||(o.currentPoints.image.x=t.handles.perpendicularEnd.x,o.currentPoints.image.y=t.handles.perpendicularEnd.y)))}},"./tools/annotation/bidirectionalTool/moveHandle/touchMoveHandle.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./store/index.js"),d=e("./events.js"),l=e("./tools/annotation/bidirectionalTool/moveHandle/setHandlesPosition.js"),o=e("./util/getActiveTool.js"),t=e("./tools/base/BaseAnnotationTool.js"),r=[d.default.TOUCH_END,d.default.TOUCH_DRAG_END,d.default.TOUCH_PINCH,d.default.TOUCH_PRESS,d.default.TAP];n.default=function(s,i,u,c,h,g){var v=s.element,m=s.image,E=s.buttons,T={x:c.x-s.currentPoints.image.x,y:c.y-s.currentPoints.image.y},O=function(C){var _=C.detail;c.hasMoved=!0,c.index===void 0||c.index===null?(c.x=_.currentPoints.image.x+T.x,c.y=_.currentPoints.image.y+T.y):Object(l.default)(c,_,u,T),g&&(c.x=Math.max(c.x,0),c.x=Math.min(c.x,_.image.width),c.y=Math.max(c.y,0),c.y=Math.min(c.y,_.image.height)),u.invalidated=!0,a.default.cornerstone.updateImage(v);var D=Object(o.default)(v,E,"touch");D instanceof t.default&&D.updateCachedStats(m,v,u);var I={toolName:i,toolType:i,element:v,measurementData:u};a.default.cornerstone.triggerEvent(v,d.default.MEASUREMENT_MODIFIED,I)};c.active=!0,f.state.isToolLocked=!0,v.addEventListener(d.default.TOUCH_DRAG,O);var M=function P(){c.active=!1,f.state.isToolLocked=!1,v.removeEventListener(d.default.TOUCH_DRAG,O),r.forEach(function(C){v.removeEventListener(C,P)}),a.default.cornerstone.updateImage(v),typeof h=="function"&&h()};r.forEach(function(P){v.addEventListener(P,M)})}},"./tools/annotation/bidirectionalTool/pointNearTool.js":function(W,n,e){e.r(n);var a=e("./util/getProximityThreshold.js"),f=e("./externalModules.js"),d=e("./util/pointInsideBoundingBox.js"),l=function(t,r,s,i){var u=f.default.cornerstone,c=f.default.cornerstoneMath,h={start:u.pixelToCanvas(t,r.perpendicularStart),end:u.pixelToCanvas(t,r.perpendicularEnd)},g=c.lineSegment.distanceToPoint(h,s);return g<i};n.default=function(o,t,r){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"mouse",i=f.default.cornerstone,u=f.default.cornerstoneMath,c=t.handles,h={start:i.pixelToCanvas(o,c.start),end:i.pixelToCanvas(o,c.end)},g=u.lineSegment.distanceToPoint(h,r);if(Object(d.default)(c.textBox,r))return!0;var v=Object(a.default)(s,"Bidirectional");return l(o,c,r,v)?!0:g<v}},"./tools/annotation/bidirectionalTool/renderToolData.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a),d=e("./drawing/drawHandles.js"),l=e("./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js"),o=e("./store/index.js"),t=e("./stateManagement/toolStyle.js"),r=e("./stateManagement/toolColors.js"),s=e("./stateManagement/toolState.js"),i=e("./drawing/index.js"),u=e("./drawing/drawLinkedTextBox.js"),c=e("./util/getPixelSpacing.js");n.default=function(g){var v=this,m=g.detail,E=m.element,T=m.canvasContext,O=m.image,M=this.configuration,P=M.handleRadius,C=M.drawHandlesOnHover,_=M.hideHandlesIfMoving,D=M.renderDashed,I=Object(o.getModule)("globalConfiguration").configuration.lineDash,y=Object(s.getToolState)(E,this.name);if(y){var R=Object(c.default)(O),b=R.rowPixelSpacing,z=R.colPixelSpacing;if(!(!b||!z))for(var H=Object(i.getNewContext)(T.canvas),B,p=t.default.getToolWidth(),A=function(U){var S=y.data[U];if(S.visible===!1)return"continue";B=r.default.getColorIfActive(S),S.invalidated===!0&&(S.longestDiameter&&S.shortestDiameter?v.throttledUpdateCachedStats(O,E,S):v.updateCachedStats(O,E,S)),Object(i.draw)(H,function(w){Object(i.setShadow)(w,v.configuration);var G=S.handles,$=G.start,Q=G.end,re=G.perpendicularStart,le=G.perpendicularEnd,de=G.textBox,me={color:B},Y={color:B,strokeWidth:V};D&&(me.lineDash=I,Y.lineDash=I),Object(i.drawLine)(w,E,$,Q,me);var V=p;Object(l.default)(m,S),Object(i.drawLine)(w,E,re,le,Y);var te={color:B,handleRadius:P,drawHandlesIfActive:C,hideHandlesIfMoving:_};v.configuration.drawHandles&&Object(d.default)(w,m,S.handles,te);var ne=10,ue=function(Ee){return[Ee.start,Ee.end,Ee.perpendicularStart,Ee.perpendicularEnd]},ge=h(S,b,z);Object(u.default)(w,E,de,ge,S.handles,ue,B,p,ne,!0)})},j=0;j<y.data.length;j++)var x=A(j)}};var h=function(v,m,E){var T=" mm";(!m||!E)&&(T=" pixels");var O=" L ".concat(v.longestDiameter).concat(T),M=" W ".concat(v.shortestDiameter).concat(T),P=v.labels;return P&&Array.isArray(P)?[].concat(f()(P),[O,M]):[O,M]}},"./tools/annotation/bidirectionalTool/utils/calculateLongestAndShortestDiameters.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d){var l=d.rowPixelSpacing,o=d.colPixelSpacing,t=f.handles,r=t.start,s=t.end,i=t.perpendicularStart,u=t.perpendicularEnd,c=(r.x-s.x)*(o||1),h=(r.y-s.y)*(l||1),g=Math.sqrt(c*c+h*h),v=(i.x-u.x)*(o||1),m=(i.y-u.y)*(l||1),E=Math.sqrt(v*v+m*m);if(E||(E=0),E>g){var T=E,O=g;g=T,E=O}return{longestDiameter:g.toFixed(1),shortestDiameter:E.toFixed(1)}}},"./tools/annotation/bidirectionalTool/utils/getDistanceWithPixelSpacing.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d,l,o){var t=(l.x-o.x)/d,r=(l.y-o.y)/f;return Math.sqrt(t*t+r*r)}},"./tools/annotation/bidirectionalTool/utils/getLineVector.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d,l,o){var t=(l.x-o.x)*f,r=(l.y-o.y)*d,s=Math.sqrt(t*t+r*r),i=t/s,u=r/s;return{x:i,y:u,length:s}}},"./tools/annotation/bidirectionalTool/utils/updatePerpendicularLineHandles.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./tools/annotation/bidirectionalTool/utils/getLineVector.js");function f(d,l){if(!l.handles.perpendicularStart.locked)return!1;var o,t,r,s,i=l.handles,u=i.start,c=i.end,h=d.image,g=h.columnPixelSpacing,v=g===void 0?1:g,m=h.rowPixelSpacing,E=m===void 0?1:m;if(u.x===c.x&&u.y===c.y)o=u.x,t=u.y,r=c.x,s=c.y;else{var T={x:(u.x+c.x)/2,y:(u.y+c.y)/2},O=Object(a.default)(v,E,u,c),M=O.length/2,P=M/(2*E),C=M/(2*v);o=T.x+C*O.y,t=T.y-P*O.x,r=T.x-C*O.y,s=T.y+P*O.x}return l.handles.perpendicularStart.x=o,l.handles.perpendicularStart.y=t,l.handles.perpendicularEnd.x=r,l.handles.perpendicularEnd.y=s,!0}},"./tools/annotation/index.js":function(W,n,e){e.r(n);var a=e("./tools/annotation/AngleTool.js"),f=e("./tools/annotation/ArrowAnnotateTool.js"),d=e("./tools/annotation/BidirectionalTool.js"),l=e("./tools/annotation/CircleRoiTool.js"),o=e("./tools/annotation/CobbAngleTool.js"),t=e("./tools/annotation/EllipticalRoiTool.js"),r=e("./tools/annotation/FreehandRoiTool.js"),s=e("./tools/annotation/LengthTool.js"),i=e("./tools/annotation/ProbeTool.js"),u=e("./tools/annotation/RectangleRoiTool.js"),c=e("./tools/annotation/TextMarkerTool.js");e.d(n,"AngleTool",function(){return a.default}),e.d(n,"ArrowAnnotateTool",function(){return f.default}),e.d(n,"BidirectionalTool",function(){return d.default}),e.d(n,"CircleRoiTool",function(){return l.default}),e.d(n,"CobbAngleTool",function(){return o.default}),e.d(n,"EllipticalRoiTool",function(){return t.default}),e.d(n,"FreehandRoiTool",function(){return r.default}),e.d(n,"LengthTool",function(){return s.default}),e.d(n,"ProbeTool",function(){return i.default}),e.d(n,"RectangleRoiTool",function(){return u.default}),e.d(n,"TextMarkerTool",function(){return c.default}),n.default={AngleTool:a.default,ArrowAnnotateTool:f.default,BidirectionalTool:d.default,CircleRoiTool:l.default,CobbAngleTool:o.default,EllipticalRoiTool:t.default,FreehandRoiTool:r.default,LengthTool:s.default,ProbeTool:i.default,RectangleRoiTool:u.default,TextMarkerTool:c.default}},"./tools/base/BaseAnnotationTool.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/inherits.js"),u=e.n(i),c=e("./tools/base/BaseTool.js"),h=e("./stateManagement/toolState.js"),g=e("./manipulators/handleActivator.js"),v=e("./util/findAndMoveHelpers.js"),m=e("./util/logger.js"),E=Object(m.getLogger)("baseAnnotationTool"),T=function(O){u()(M,O);function M(){return f()(this,M),t()(this,s()(M).apply(this,arguments))}return l()(M,[{key:"createNewMeasurement",value:function(C){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(C,_,D){throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(C,_,D){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(C){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(C){for(var _=C.detail,D=_.element,I=_.currentPoints,y=I.canvas,R=Object(h.getToolState)(D,this.name),b=!1,z=0;z<R.data.length;z++){var H=R.data[z];Object(g.default)(D,H.handles,y)===!0&&(b=!0);var B=this.pointNearTool(D,H,y,"mouse")&&!H.active,p=!this.pointNearTool(D,H,y,"mouse")&&H.active;(B||p)&&(H.active=!H.active,b=!0)}return b}},{key:"handleSelectedCallback",value:function(C,_,D){var I=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"mouse";Object(v.moveHandleNearImagePoint)(C,this,_,D,I)}},{key:"toolSelectedCallback",value:function(C,_){var D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"mouse";Object(v.moveAnnotation)(C,this,_,D)}},{key:"updateCachedStats",value:function(C,_,D){E.warn("updateCachedStats not implemented for ".concat(this.name,"."))}}]),M}(c.default);n.default=T},"./tools/base/BaseBrushTool.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./tools/base/BaseTool.js"),v=e("./events.js"),m=e("./externalModules.js"),E=e("./store/isToolActiveForElement.js"),T=e("./store/index.js"),O=e("./util/segmentation/index.js"),M=Object(T.getModule)("segmentation"),P=function(C){h()(_,C);function _(D){var I,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return f()(this,_),y.configuration||(y.configuration={alwaysEraseOnClick:!1}),I=t()(this,s()(_).call(this,D,y)),I.updateOnMouseMove=!0,I.hideDefaultCursor=!0,I._drawing=!1,I._drawingMouseUpCallback=I._drawingMouseUpCallback.bind(u()(I)),I}return l()(_,[{key:"renderBrush",value:function(I){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(I){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(I){var y=I.detail.currentPoints;this._lastImageCoords=y.image,this._drawing&&this._paint(I)}},{key:"preMouseDownCallback",value:function(I){var y=I.detail,R=y.element,b=y.currentPoints;return this._startPainting(I),this._lastImageCoords=b.image,this._drawing=!0,this._startListeningForMouseUp(R),this._paint(I),!0}},{key:"_startPainting",value:function(I){var y=I.detail,R=y.element,b=M.configuration,z=M.getters,H=z.labelmap2D(R),B=H.labelmap2D,p=H.labelmap3D,A=H.currentImageIdIndex,j=H.activeLabelmapIndex,x=this._isCtrlDown(y)||this.configuration.alwaysEraseOnClick;if(this.paintEventData={labelmap2D:B,labelmap3D:p,currentImageIdIndex:A,activeLabelmapIndex:j,shouldErase:x},b.storeHistory){var L=B.pixelData.slice();this.paintEventData.previousPixelData=L}}},{key:"_endPainting",value:function(I){for(var y=M.configuration,R=M.setters,b=this.paintEventData,z=b.labelmap2D,H=b.currentImageIdIndex,B=new Set(z.pixelData),p=B.values(),A=[],j=!1;!j;){var x=p.next();j=x.done,j||A.push(x.value)}if(z.segmentsOnLabelmap=A,y.storeHistory){var L=this.paintEventData.previousPixelData,U=z.pixelData,S={imageIdIndex:H,diff:Object(O.getDiffBetweenPixelData)(L,U)};R.pushState(this.element,[S])}Object(O.triggerLabelmapModifiedEvent)(this.element)}},{key:"mouseMoveCallback",value:function(I){var y=I.detail.currentPoints;this._lastImageCoords=y.image}},{key:"renderToolData",value:function(I){var y=I.detail,R=y.element;Object(E.default)(R,this.name)&&this.renderBrush(I)}},{key:"passiveCallback",value:function(I){try{m.default.cornerstone.updateImage(this.element)}catch{return}}},{key:"_drawingMouseUpCallback",value:function(I){var y=I.detail,R=y.element;this._endPainting(I),this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(R)}},{key:"newImageCallback",value:function(I){this._drawing&&(this._endPainting(I),this._startPainting(I))}},{key:"_startListeningForMouseUp",value:function(I){I.removeEventListener(v.default.MOUSE_UP,this._drawingMouseUpCallback),I.removeEventListener(v.default.MOUSE_CLICK,this._drawingMouseUpCallback),I.addEventListener(v.default.MOUSE_UP,this._drawingMouseUpCallback),I.addEventListener(v.default.MOUSE_CLICK,this._drawingMouseUpCallback),m.default.cornerstone.updateImage(I)}},{key:"_stopListeningForMouseUp",value:function(I){I.removeEventListener(v.default.MOUSE_UP,this._drawingMouseUpCallback),I.removeEventListener(v.default.MOUSE_CLICK,this._drawingMouseUpCallback),m.default.cornerstone.updateImage(I)}},{key:"increaseBrushSize",value:function(){var I=M.configuration,y=M.setters,R=I.radius,b=Math.floor(R*1.2);b===R&&(b+=1),y.radius(b)}},{key:"decreaseBrushSize",value:function(){var I=M.configuration,y=M.setters,R=I.radius,b=Math.floor(R*.8);y.radius(b)}},{key:"_isCtrlDown",value:function(I){return I.event&&I.event.ctrlKey||I.ctrlKey}}]),_}(g.default);n.default=P},"./tools/base/BaseTool.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/typeof.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/createClass.js"),t=e.n(o),r=e("./mixins/index.js"),s=e("./util/logger.js"),i=e("./util/deepmerge.js"),u=e("./store/setToolCursor.js"),c=e("./store/index.js"),h=Object(s.getLogger)("tools:base:BaseTool"),g=Object(c.getModule)("globalConfiguration"),v=function(){function m(E,T){l()(this,m),this.initialConfiguration=Object(i.default)(T,E);var O=this.initialConfiguration,M=O.name,P=O.strategies,C=O.defaultStrategy,_=O.configuration,D=O.supportedInteractionTypes,I=O.mixins,y=O.svgCursor;this.name=M,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=D||[],this.strategies=P||{},this.defaultStrategy=C||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,y&&(this.svgCursor=y),this._options={},this._configuration=Object.assign({},_),this.updateOnMouseMove=!1,this.hideDefaultCursor=!1,I&&I.length&&this._applyMixins(I),this._cursors=Object.assign({},this.initialConfiguration.cursors);var R=this.defaultStrategy&&this._cursors[this.activeStrategy];R&&(this.svgCursor=R)}return t()(m,[{key:"mergeOptions",value:function(T){this._options=Object.assign({},this._options,T)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(T,O){return this.strategies[this.activeStrategy].call(this,T,O)}},{key:"_applyMixins",value:function(T){for(var O=0;O<T.length;O++){var M=r.default["".concat(T[O])];f()(M)==="object"?(Object.assign(this,M),typeof this.initializeMixin=="function"&&this.initializeMixin()):h.warn("".concat(this.name,": mixin ").concat(r.default[O]," does not exist."))}this.initializeMixin==="function"&&delete this.initializeMixin}},{key:"setActiveStrategy",value:function(T){this.activeStrategy=T,g.configuration.showSVGCursors&&this.changeCursor(this.element,T)}},{key:"changeCursor",value:function(T,O){if(T){var M=this._cursors[O];M&&(this.svgCursor=M,this.mode==="active"&&Object(u.setToolCursor)(T,M))}}},{key:"configuration",get:function(){return this._configuration},set:function(T){this._configuration=T}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),m}();n.default=v},"./tools/base/index.js":function(W,n,e){e.r(n);var a=e("./tools/base/BaseAnnotationTool.js"),f=e("./tools/base/BaseTool.js"),d=e("./tools/base/BaseBrushTool.js");e.d(n,"BaseAnnotationTool",function(){return a.default}),e.d(n,"BaseBrushTool",function(){return d.default}),e.d(n,"BaseTool",function(){return f.default}),n.default={BaseAnnotationTool:a.default,BaseBrushTool:d.default,BaseTool:f.default}},"./tools/cursors/MouseCursor.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return s});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("./stateManagement/toolColors.js"),t=e("./store/index.js"),r=t.modules.cursor,s=function(){function i(u,c){f()(this,i),this.iconGroupString=u,this.options=Object.assign({},r.getters.defaultOptions(),c)}return l()(i,[{key:"getIconSVG",value:function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=this._generateIconSVGString(c);return new Blob([h],{type:"image/svg+xml"})}},{key:"getIconSVGString",value:function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._generateIconSVGString(c)}},{key:"getIconWithPointerSVG",value:function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=this._generateIconWithPointerSVGString(c);return new Blob([h],{type:"image/svg+xml"})}},{key:"getIconWithPointerString",value:function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._generateIconWithPointerSVGString(c)}},{key:"_generateIconWithPointerSVGString",value:function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=Object.assign({},this.options,c),g=h.mousePointerGroupString,v=h.iconSize,m=h.viewBox,E=v/Math.max(m.x,m.y),T=16+v,O=`
        <svg
        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
        width="`.concat(T,'" height="').concat(T,'" viewBox="0 0 ').concat(T," ").concat(T,`"
      >
        <g>
          `).concat(g,`
        </g>
        <g transform="translate(16, 16) scale(`).concat(E,`)">
          `).concat(this.iconGroupString,`
        </g>
      </svg>`);return this._injectColors(O,h)}},{key:"_generateIconSVGString",value:function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=Object.assign({},this.options,c),g=h.iconSize,v=h.viewBox,m=`
      <svg
        data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"
        width="`.concat(g,'" height="').concat(g,`" viewBox="0 0
        `).concat(v.x," ").concat(v.y,`"
      >
        `).concat(this.iconGroupString,`
      </svg>`);return this._injectColors(m,h)}},{key:"_injectColors",value:function(c){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=h.activeColor||o.default.getActiveColor(),v=h.toolColor||o.default.getToolColor(),m=h.fillColor||o.default.getFillColor();return c.replace(/ACTIVE_COLOR/g,"".concat(g)).replace(/TOOL_COLOR/g,"".concat(v)).replace(/FILL_COLOR/g,"".concat(m))}},{key:"mousePoint",get:function(){var c=this.options.mousePoint;return"".concat(c.x," ").concat(c.y)}}]),i}()},"./tools/cursors/index.js":function(W,n,e){e.r(n),e.d(n,"angleCursor",function(){return f}),e.d(n,"arrowAnnotateCursor",function(){return d}),e.d(n,"bidirectionalCursor",function(){return l}),e.d(n,"cobbAngleCursor",function(){return o}),e.d(n,"circleRoiCursor",function(){return t}),e.d(n,"ellipticalRoiCursor",function(){return r}),e.d(n,"freehandRoiCursor",function(){return s}),e.d(n,"freehandRoiSculptorCursor",function(){return i}),e.d(n,"lengthCursor",function(){return u}),e.d(n,"probeCursor",function(){return c}),e.d(n,"rectangleRoiCursor",function(){return h}),e.d(n,"textMarkerCursor",function(){return g}),e.d(n,"crosshairsCursor",function(){return v}),e.d(n,"eraserCursor",function(){return m}),e.d(n,"magnifyCursor",function(){return E}),e.d(n,"panCursor",function(){return T}),e.d(n,"rotateCursor",function(){return O}),e.d(n,"stackScrollCursor",function(){return M}),e.d(n,"wwwcRegionCursor",function(){return P}),e.d(n,"wwwcCursor",function(){return C}),e.d(n,"zoomCursor",function(){return _}),e.d(n,"freehandEraseInsideCursor",function(){return H}),e.d(n,"freehandFillInsideCursor",function(){return B}),e.d(n,"freehandEraseOutsideCursor",function(){return p}),e.d(n,"freehandFillOutsideCursor",function(){return A}),e.d(n,"segRectangleEraseInsideCursor",function(){return j}),e.d(n,"segRectangleFillInsideCursor",function(){return x}),e.d(n,"segRectangleEraseOutsideCursor",function(){return L}),e.d(n,"segRectangleFillOutsideCursor",function(){return U}),e.d(n,"segCircleEraseInsideCursor",function(){return S}),e.d(n,"segCircleFillInsideCursor",function(){return w}),e.d(n,"segCircleEraseOutsideCursor",function(){return G}),e.d(n,"segCircleFillOutsideCursor",function(){return $});var a=e("./tools/cursors/MouseCursor.js"),f=new a.default(`<path fill="ACTIVE_COLOR" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50
        50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23
        10l50 50q10 10 10 23z"
      />`,{viewBox:{x:1792,y:1792}}),d=new a.default(`<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">
    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />
  </g>`,{viewBox:{x:24,y:24}}),l=new a.default(`<g fill="ACTIVE_COLOR" stroke-width="3" stroke="ACTIVE_COLOR">
    <path d="M27.63 3.21L3.12 28.81"></path>
    <path d="M27.63 15.75L15.27 4.43"></path>
    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>
    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>
    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>
    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>
  </g>`,{viewBox:{x:48,y:48}}),o=new a.default(`<g stroke="ACTIVE_COLOR" stroke-width="3">
    <path d="M28.59 2.34L3.82 12.32"></path>
    <path d="M28.59 29.66L3.82 19.68"></path>
    <path stroke-dasharray="2" fill-opacity="0" d="M12.37
      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15
      9.33C13.11 9.24 13.02 9 12.88 8.63">
    </path>
  </g>`,{viewBox:{x:32,y:32}}),t=new a.default('<circle stroke="ACTIVE_COLOR" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',{viewBox:{x:32,y:32}}),r=new a.default(`<path stroke="ACTIVE_COLOR" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16
    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14
    6.3 30.74 10.54 30.74 15.76Z"
    />`,{viewBox:{x:32,y:32}}),s=new a.default(`
  <g fill="ACTIVE_COLOR" stroke="ACTIVE_COLOR" stroke-width="2">
    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>
    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>
    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>
    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>
    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>
    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>
    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>
    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>
    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>
    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>
    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>
    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>
    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>
    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>
    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>
    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>
    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>
    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>
    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>
    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>
    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>
    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>
    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>
    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>
    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>
    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>
    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>
    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>
    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>
    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>
  </g>`,{viewBox:{x:18,y:18}}),i=new a.default(`<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">
      <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>
      <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>
      <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>
      <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>
      <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>
      <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>
      <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>
      <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>
      <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>
      <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>
      <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>
      <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>
      <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>
      <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>
      <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>
      <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>
      <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>
      <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>
      <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>
      <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>
      <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>
      <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>
      <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>
      <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>
      <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>
      <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>
      <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>
      <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>
      <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>
      <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>
      <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>
      <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>
    </g>`,{viewBox:{x:18,y:18}}),u=new a.default(`<g id="length-group" fill="none" stroke-width="1" stroke="ACTIVE_COLOR" stroke-linecap="round" stroke-linejoin="round">
    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />
  </g>`,{viewBox:{x:24,y:24}}),c=new a.default(`<path fill="ACTIVE_COLOR" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75
    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73
    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5
    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5
    385.5-103 385.5 103 279.5 279.5 103 385.5z"
  />`,{viewBox:{x:1792,y:1792}}),h=new a.default(`<path fill="ACTIVE_COLOR" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47
    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0
    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119
    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z"
  />`,{viewBox:{x:1792,y:1792}}),g=new a.default(`<path fill="ACTIVE_COLOR" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0
    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29
    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15
    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5
    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0
    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11
    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0
    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58
    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z"
  />`,{viewBox:{x:1792,y:1792}}),v=new a.default(`<path fill="ACTIVE_COLOR" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26
    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45
    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26
    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5
    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32
    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5
    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26
    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26
    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161
    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161
    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z"
  />`,{viewBox:{x:1792,y:1792}}),m=new a.default(`<path transform="translate(0,1792) scale(1,-1)" fill="ACTIVE_COLOR" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15
      34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38
      0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38
      0 69.5 20.5t47.5 54.5z"
    />`,{viewBox:{x:2048,y:1792}}),E=new a.default(`<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
      32s176 78.7 176 176-78.7 176-176 176z"
    />`,{viewBox:{x:512,y:512}}),T=new a.default(`<path fill="ACTIVE_COLOR" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17
      39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355
      355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59
      39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12
      0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144
      144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19
      45v448q0 42-39 59-13 5-25 5-26 0-45-19z"
    />`,{viewBox:{x:1792,y:1792}}),O=new a.default(`<path fill="ACTIVE_COLOR" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39
      14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5
      163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0
      225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109
      132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298
      164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14
      39 17 39 59z"
    />`,{viewBox:{x:1792,y:1792}}),M=new a.default(`<path fill="ACTIVE_COLOR" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547
      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0
      0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547
      0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547
      0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"
      />`,{viewBox:{x:24,y:28}}),P=new a.default(`<path fill="ACTIVE_COLOR" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119
    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5
    84.5t84.5 203.5z"
  />`,{viewBox:{x:1792,y:1792}}),C=new a.default(`<path fill="ACTIVE_COLOR" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />
    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="ACTIVE_COLOR" />`,{viewBox:{x:18,y:18}}),_=new a.default(`<path fill="ACTIVE_COLOR" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395
      312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5
      0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17
      0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208
      32s176 78.7 176 176-78.7 176-176 176z"
    />
    <path fill="ACTIVE_COLOR" transform="scale(0.22,0.22) translate(1400,0)" d="M1216
      320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19
      19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26
      0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z"
    />`,{viewBox:{x:640,y:512}}),D={x:127,y:60},I=function(){var re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(re,'" x="80.19" y="25.03" width="47.14" height="15.85"/>')},y=function(){var re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"ACTIVE_COLOR";return'<rect fill="'.concat(re,`" x="80.19" y="25.03" width="47.14" height="15.85"/>
      <rect fill="`).concat(re,'" x="95.84" y="9.38" width="15.85" height="47.14"/>')},R='<path fill="ACTIVE_COLOR" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',b='<path fill="ACTIVE_COLOR" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',z='<path fill="ACTIVE_COLOR" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',H=new a.default("".concat(R," ").concat(I()),{viewBox:D}),B=new a.default("".concat(R," ").concat(y()),{viewBox:D}),p=new a.default("".concat(R," ").concat(I()),{viewBox:D}),A=new a.default("".concat(R," ").concat(y()),{viewBox:D}),j=new a.default("".concat(b," ").concat(I()),{viewBox:D}),x=new a.default("".concat(b," ").concat(y()),{viewBox:D}),L=new a.default("".concat(b," ").concat(I()),{viewBox:D}),U=new a.default("".concat(b," ").concat(y()),{viewBox:D}),S=new a.default("".concat(z," ").concat(I()),{viewBox:D}),w=new a.default("".concat(z," ").concat(y()),{viewBox:D}),G=new a.default("".concat(z," ").concat(I()),{viewBox:D}),$=new a.default("".concat(z," ").concat(y()),{viewBox:D})},"./tools/index.js":function(W,n,e){e.r(n);var a=e("./tools/CrosshairsTool.js");e.d(n,"CrosshairsTool",function(){return a.default});var f=e("./tools/DoubleTapFitToWindowTool.js");e.d(n,"DoubleTapFitToWindowTool",function(){return f.default});var d=e("./tools/DragProbeTool.js");e.d(n,"DragProbeTool",function(){return d.default});var l=e("./tools/EraserTool.js");e.d(n,"EraserTool",function(){return l.default});var o=e("./tools/FreehandRoiSculptorTool.js");e.d(n,"FreehandRoiSculptorTool",function(){return o.default});var t=e("./tools/MagnifyTool.js");e.d(n,"MagnifyTool",function(){return t.default});var r=e("./tools/OverlayTool.js");e.d(n,"OverlayTool",function(){return r.default});var s=e("./tools/OrientationMarkersTool.js");e.d(n,"OrientationMarkersTool",function(){return s.default});var i=e("./tools/PanMultiTouchTool.js");e.d(n,"PanMultiTouchTool",function(){return i.default});var u=e("./tools/PanTool.js");e.d(n,"PanTool",function(){return u.default});var c=e("./tools/ReferenceLinesTool.js");e.d(n,"ReferenceLinesTool",function(){return c.default});var h=e("./tools/RotateTool.js");e.d(n,"RotateTool",function(){return h.default});var g=e("./tools/RotateTouchTool.js");e.d(n,"RotateTouchTool",function(){return g.default});var v=e("./tools/ScaleOverlayTool.js");e.d(n,"ScaleOverlayTool",function(){return v.default});var m=e("./tools/StackScrollMouseWheelTool.js");e.d(n,"StackScrollMouseWheelTool",function(){return m.default});var E=e("./tools/StackScrollMultiTouchTool.js");e.d(n,"StackScrollMultiTouchTool",function(){return E.default});var T=e("./tools/StackScrollTool.js");e.d(n,"StackScrollTool",function(){return T.default});var O=e("./tools/WwwcRegionTool.js");e.d(n,"WwwcRegionTool",function(){return O.default});var M=e("./tools/WwwcTool.js");e.d(n,"WwwcTool",function(){return M.default});var P=e("./tools/ZoomMouseWheelTool.js");e.d(n,"ZoomMouseWheelTool",function(){return P.default});var C=e("./tools/ZoomTool.js");e.d(n,"ZoomTool",function(){return C.default});var _=e("./tools/ZoomTouchPinchTool.js");e.d(n,"ZoomTouchPinchTool",function(){return _.default}),n.default={CrosshairsTool:a.default,DoubleTapFitToWindowTool:f.default,DragProbeTool:d.default,EraserTool:l.default,FreehandRoiSculptorTool:o.default,MagnifyTool:t.default,OverlayTool:r.default,OrientationMarkersTool:s.default,PanMultiTouchTool:i.default,PanTool:u.default,ReferenceLinesTool:c.default,RotateTool:h.default,RotateTouchTool:g.default,ScaleOverlayTool:v.default,StackScrollMouseWheelTool:m.default,StackScrollMultiTouchTool:E.default,StackScrollTool:T.default,WwwcRegionTool:O.default,WwwcTool:M.default,ZoomMouseWheelTool:P.default,ZoomTool:C.default,ZoomTouchPinchTool:_.default}},"./tools/referenceLines/calculateReferenceLine.js":function(W,n,e){e.r(n);var a=e("./util/pointProjector.js");n.default=function(f,d){var l=Object(a.planePlaneIntersection)(f,d);if(l)return{start:Object(a.projectPatientPointToImagePlane)(l.start,f),end:Object(a.projectPatientPointToImagePlane)(l.end,f)}}},"./tools/referenceLines/renderActiveReferenceLine.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=e("./tools/referenceLines/calculateReferenceLine.js"),d=e("./stateManagement/toolColors.js"),l=e("./util/convertToVector3.js"),o=e("./drawing/index.js");n.default=function(t,r,s,i){var u=a.default.cornerstone,c=u.getEnabledElement(s).image,h=u.getEnabledElement(i).image;if(!(!c||!h)){var g=u.metaData.get("imagePlaneModule",c.imageId),v=u.metaData.get("imagePlaneModule",h.imageId);if(!(!g||!v||!g.rowCosines||!g.columnCosines||!g.imagePositionPatient||!v.rowCosines||!v.columnCosines||!v.imagePositionPatient)&&g.frameOfReferenceUID===v.frameOfReferenceUID){g.rowCosines=Object(l.default)(g.rowCosines),g.columnCosines=Object(l.default)(g.columnCosines),g.imagePositionPatient=Object(l.default)(g.imagePositionPatient),v.rowCosines=Object(l.default)(v.rowCosines),v.columnCosines=Object(l.default)(v.columnCosines),v.imagePositionPatient=Object(l.default)(v.imagePositionPatient);var m=g.rowCosines.clone().cross(g.columnCosines),E=v.rowCosines.clone().cross(v.columnCosines),T=m.angleTo(E);if(T=Math.abs(T),!(T<.5)){var O=Object(f.default)(g,v);if(O){var M=d.default.getActiveColor();t.setTransform(1,0,0,1,0,0),Object(o.draw)(t,function(P){Object(o.drawLine)(P,r.element,O.start,O.end,{color:M})})}}}}}},"./tools/segmentation/BrushTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return M});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./externalModules.js"),v=e("./tools/base/index.js"),m=e("./store/index.js"),E=e("./util/segmentation/index.js"),T=e("./util/logger.js");Object(T.getLogger)("tools:BrushTool");var O=Object(m.getModule)("segmentation"),M=function(P){h()(C,P);function C(){var _,D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,C);var I={name:"Brush",supportedInteractionTypes:["Mouse","Touch"],configuration:{},mixins:["renderBrushMixin"]};return _=t()(this,s()(C).call(this,D,I)),_.touchDragCallback=_._paint.bind(u()(_)),_}return l()(C,[{key:"_paint",value:function(D){var I=O.configuration,y=D.detail;y.element;var R=y.image,b=R.rows,z=R.columns,H=y.currentPoints.image,B=H.x,p=H.y;if(!(B<0||B>z||p<0||p>b)){var A=I.radius,j=Object(E.getCircle)(A,b,z,B,p),x=this.paintEventData,L=x.labelmap2D,U=x.labelmap3D,S=x.shouldErase;Object(E.drawBrushPixels)(j,L.pixelData,U.activeSegmentIndex,z,S),g.default.cornerstone.updateImage(D.detail.element)}}}]),C}(v.BaseBrushTool)},"./tools/segmentation/CircleScissorsTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return h});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/inherits.js"),s=e.n(r),i=e("./tools/base/index.js"),u=e("./tools/segmentation/strategies/index.js"),c=e("./tools/cursors/index.js"),h=function(g){s()(v,g);function v(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,v);var E={name:"CircleScissors",strategies:{FILL_INSIDE:u.fillInsideCircle,FILL_OUTSIDE:u.fillOutsideCircle,ERASE_OUTSIDE:u.eraseOutsideCircle,ERASE_INSIDE:u.eraseInsideCircle},cursors:{FILL_INSIDE:c.segCircleFillInsideCursor,FILL_OUTSIDE:c.segCircleFillOutsideCursor,ERASE_OUTSIDE:c.segCircleEraseOutsideCursor,ERASE_INSIDE:c.segCircleEraseInsideCursor},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:c.segCircleFillInsideCursor,mixins:["circleSegmentationMixin"]};return l()(this,t()(v).call(this,m,E))}return v}(i.BaseTool)},"./tools/segmentation/CorrectionScissorsTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return h});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/inherits.js"),s=e.n(r),i=e("./tools/base/index.js"),u=e("./tools/cursors/index.js"),c=e("./tools/segmentation/strategies/index.js"),h=function(g){s()(v,g);function v(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,v);var E={name:"CorrectionScissors",strategies:{CORRECTION:c.correction},cursors:{CORRECTION:u.freehandFillInsideCursor},defaultStrategy:"CORRECTION",supportedInteractionTypes:["Mouse","Touch"],svgCursor:u.freehandFillInsideCursor,mixins:["polylineSegmentationMixin"]};return l()(this,t()(v).call(this,m,E))}return v}(i.BaseTool)},"./tools/segmentation/FreehandScissorsTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return h});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/inherits.js"),s=e.n(r),i=e("./tools/cursors/index.js"),u=e("./tools/segmentation/strategies/index.js"),c=e("./tools/base/index.js"),h=function(g){s()(v,g);function v(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,v);var E={name:"FreehandScissors",strategies:{FILL_INSIDE:u.fillInsideFreehand,FILL_OUTSIDE:u.fillOutsideFreehand,ERASE_OUTSIDE:u.eraseOutsideFreehand,ERASE_INSIDE:u.eraseInsideFreehand},cursors:{FILL_INSIDE:i.freehandFillInsideCursor,FILL_OUTSIDE:i.freehandFillOutsideCursor,ERASE_OUTSIDE:i.freehandEraseOutsideCursor,ERASE_INSIDE:i.freehandEraseInsideCursor},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],svgCursor:i.freehandFillInsideCursor,mixins:["freehandSegmentationMixin"]};return l()(this,t()(v).call(this,m,E))}return v}(c.BaseTool)},"./tools/segmentation/RectangleScissorsTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return h});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/inherits.js"),s=e.n(r),i=e("./tools/base/index.js"),u=e("./tools/segmentation/strategies/index.js"),c=e("./tools/cursors/index.js"),h=function(g){s()(v,g);function v(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,v);var E={name:"RectangleScissors",strategies:{FILL_INSIDE:u.fillInsideRectangle,FILL_OUTSIDE:u.fillOutsideRectangle,ERASE_OUTSIDE:u.eraseOutsideRectangle,ERASE_INSIDE:u.eraseInsideRectangle},cursors:{FILL_INSIDE:c.segRectangleFillInsideCursor,FILL_OUTSIDE:c.segRectangleFillOutsideCursor,ERASE_OUTSIDE:c.segRectangleEraseOutsideCursor,ERASE_INSIDE:c.segRectangleEraseInsideCursor},defaultStrategy:"FILL_INSIDE",supportedInteractionTypes:["Mouse","Touch"],mixins:["rectangleSegmentationMixin"]};return l()(this,t()(v).call(this,m,E))}return v}(i.BaseTool)},"./tools/segmentation/SphericalBrushTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return C});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),t=e.n(o),r=e("../node_modules/@babel/runtime/helpers/getPrototypeOf.js"),s=e.n(r),i=e("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),u=e.n(i),c=e("../node_modules/@babel/runtime/helpers/inherits.js"),h=e.n(c),g=e("./externalModules.js"),v=e("./tools/base/BaseBrushTool.js"),m=e("./store/index.js"),E=e("./util/segmentation/index.js"),T=e("./stateManagement/toolState.js"),O=e("./util/logger.js"),M=Object(O.getLogger)("tools:SphericalBrushTool"),P=Object(m.getModule)("segmentation"),C=function(_){h()(D,_);function D(){var I,y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};f()(this,D);var R={name:"SphericalBrush",supportedInteractionTypes:["Mouse","Touch"],configuration:{alwaysEraseOnClick:!1},mixins:["renderBrushMixin"]};return I=t()(this,s()(D).call(this,y,R)),I.touchDragCallback=I._paint.bind(u()(I)),I}return l()(D,[{key:"_startPainting",value:function(y){var R=P.configuration,b=P.getters,z=y.detail,H=z.element,B=z.image,p=g.default.cornerstone,A=R.radius,j=B.rows,x=B.columns,L=Math.max(B.rowPixelSpacing,B.columnPixelSpacing),U=Object(T.getToolState)(H,"stack"),S=U.data[0],w=S.imageIds,G=b.labelmap2D(H),$=G.labelmap2D,Q=G.labelmap3D,re=G.currentImageIdIndex,le=G.activeLabelmapIndex,de=this._isCtrlDown(z)||this.configuration.alwaysEraseOnClick,me=p.metaData.get("imagePlaneModule",B.imageId),Y;if(me){var V=me.imagePositionPatient;Y=this._getImagesInRange(re,V,w,A,L)}else M.warn("No imagePlane metadata found for image, defaulting to circle brush application."),Y=[{imageIdIndex:re,radiusOnImage:A}];if(this.paintEventData={labelmap2D:$,labelmap3D:Q,currentImageIdIndex:re,activeLabelmapIndex:le,shouldErase:de,imagesInRange:Y},R.storeHistory){for(var te=[],ne=0;ne<Y.length;ne++){var ue=Y[ne].imageIdIndex,ge=b.labelmap2DByImageIdIndex(Q,ue,j,x),ve=ge.pixelData.slice();te.push(ve)}this.paintEventData.previousPixeldataForImagesInRange=te}}},{key:"_paint",value:function(y){var R=P.getters,b=y.detail;b.element;var z=b.image,H=z.rows,B=z.columns,p=b.currentPoints.image,A=p.x,j=p.y;if(!(A<0||A>B||j<0||j>H)){for(var x=this.paintEventData,L=x.labelmap3D,U=x.imagesInRange,S=x.shouldErase,w=0;w<U.length;w++){var G=U[w],$=G.imageIdIndex,Q=G.radiusOnImage,re=Object(E.getCircle)(Q,H,B,A,j),le=R.labelmap2DByImageIdIndex(L,$,H,B);Object(E.drawBrushPixels)(re,le.pixelData,L.activeSegmentIndex,B,S)}g.default.cornerstone.updateImage(y.detail.element)}}},{key:"_getImagesInRange",value:function(y,R,b,z,H){for(var B=z*H,p=[{imageIdIndex:y,radiusOnImage:z}],A=y+1;A<b.length;A++){var j=this._getRadiusOnImage(b[A],R,B,H);if(!j)break;p.push({imageIdIndex:A,radiusOnImage:j})}for(var x=y-1;x>=0;x--){var L=this._getRadiusOnImage(b[x],R,B,H);if(!L)break;p.push({imageIdIndex:x,radiusOnImage:L})}return p}},{key:"_getRadiusOnImage",value:function(y,R,b,z){var H=g.default.cornerstone.metaData.get("imagePlaneModule",y);if(!H){M.warn("Can't find imagePlane metadata for image, cancelling spherical brushing on: ".concat(y,","));return}var B=H.imagePositionPatient,p=Math.sqrt(Math.pow(B[0]-R[0],2)+Math.pow(B[1]-R[1],2)+Math.pow(B[2]-R[2],2));if(!(p>b))return Math.floor(Math.sqrt(Math.pow(b,2)-Math.pow(p,2))/z)}},{key:"_endPainting",value:function(y){for(var R=this.paintEventData,b=R.labelmap3D,z=R.imagesInRange,H=[],B=P.configuration,p=P.setters,A=0;A<z.length;A++){for(var j=z[A].imageIdIndex,x=b.labelmaps2D[j],L=new Set(x.pixelData),U=L.values(),S=[],w=!1;!w;){var G=U.next();w=G.done,w||S.push(G.value)}if(x.segmentsOnLabelmap=S,B.storeHistory){var $=this.paintEventData.previousPixeldataForImagesInRange,Q=$[A],re=b.labelmaps2D[j],le=re.pixelData;H.push({imageIdIndex:j,diff:Object(E.getDiffBetweenPixelData)(Q,le)})}}B.storeHistory&&p.pushState(this.element,H),Object(E.triggerLabelmapModifiedEvent)(this.element)}}]),D}(v.default)},"./tools/segmentation/index.js":function(W,n,e){e.r(n);var a=e("./tools/segmentation/BrushTool.js"),f=e("./tools/segmentation/SphericalBrushTool.js"),d=e("./tools/segmentation/FreehandScissorsTool.js"),l=e("./tools/segmentation/RectangleScissorsTool.js"),o=e("./tools/segmentation/CircleScissorsTool.js"),t=e("./tools/segmentation/CorrectionScissorsTool.js");e.d(n,"BrushTool",function(){return a.default}),e.d(n,"SphericalBrushTool",function(){return f.default}),e.d(n,"FreehandScissorsTool",function(){return d.default}),e.d(n,"RectangleScissorsTool",function(){return l.default}),e.d(n,"CircleScissorsTool",function(){return o.default}),e.d(n,"CorrectionScissorsTool",function(){return t.default}),n.default={BrushTool:a.default,SphericalBrushTool:f.default,CircleScissorsTool:o.default,CorrectionScissorsTool:t.default,FreehandScissorsTool:d.default,RectangleScissorsTool:l.default}},"./tools/segmentation/strategies/correction.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return i});var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a),d=e("./tools/segmentation/strategies/index.js"),l=e("./util/segmentation/index.js"),o=e("./util/clip.js"),t=e("./util/isPointInImage.js"),r=e("./util/logger.js"),s=Object(r.getLogger)("util:segmentation:operations:correction");function i(M,P){var C=P.pixelData,_=P.segmentIndex,D=P.segmentationMixinType;if(D!=="freehandSegmentationMixin"){s.error("correction operation requires freehandSegmentationMixin operationData, recieved ".concat(D));return}var I=u(M,P),y=c(I,_);if(y.isScissorOperation){y.operation==="fillInsideFreehand"?(s.warn("The line never intersects a segment."),Object(d.fillInsideFreehand)(M,P)):y.operation==="eraseInsideFreehand"&&(s.warn("The line is only ever inside the segment."),Object(d.eraseInsideFreehand)(M,P));return}var R=new Uint8Array(C.length),b=O(I,_);b.forEach(function(z){h(z,C,R,_,M)})}function u(M,P){for(var C=P.pixelData,_=P.points,D=M.detail.image,I=D.width,y=D.height,R=[],b=0;b<_.length;b++){var z=_[b],H=Math.floor(z.x),B=Math.floor(z.y);H=Object(o.default)(H,0,I-1),B=Object(o.default)(B,0,y-1);var p=R[R.length-1];p&&H===p.x&&B===p.y||R.push({x:H,y:B,segment:C[B*I+H]})}return R}function c(M,P){for(var C=!0,_=!0,D=0;D<M.length;D++){var I=M[D];if(I.segment===P?_=!1:C=!1,!C&&!_)break}return _?{isScissorOperation:!0,operation:"fillInsideFreehand"}:C?{isScissorOperation:!0,operation:"eraseInsideFreehand"}:{isScissorOperation:!1}}function h(M,P,C,_,D){var I=D.detail.image,y=I.width,R=I.height,b=M.nodes,z=M.additive,H=z?0:1,B=function(he){return he.y*y+he.x},p=function(he){return{x:he%y,y:Math.floor(he/y)}};z?s.warn("additive operation..."):s.warn("subtractive operation...");for(var A=E(b),j=A.pixelPath,x=A.leftPath,L=A.rightPath,U=j[0],S={xMin:U.x,xMax:U.x,yMin:U.y,yMax:U.y},w=0;w<C.length;w++)if(P[w]===_){var G=p(w);g(S,G),C[w]=1}else C[w]=0;for(var $=0;$<j.length;$++){var Q=j[$];C[B(Q)]=2,g(S,Q)}v(S,R,y);var re=S.xMin,le=S.xMax,de=S.yMin,me=S.yMax;function Y(ie,he){if(!(ie>=le||ie<re||he>=me||he<de))return C[he*y+ie]}for(var V=0,te=0,ne=0;ne<x.length;ne++){var ue=x[ne],ge=C[B(ue)];ge===H&&Object(t.default)(ue,R,y)&&(V+=m(ue,3,C,Y,y));var ve=L[ne],Ee=C[B(ve)];Ee===H&&Object(t.default)(ve,R,y)&&(te+=m(ve,4,C,Y,y))}if(!(V===0||te===0)){for(var De=z?_:0,X=V<te?3:4,N=0;N<C.length;N++)C[N]===X&&(P[N]=De);if(De===_)for(var F=0;F<j.length;F++)P[B(j[F])]=_;else for(var q=0;q<j.length;q++){var oe=B(j[q]);P[oe]===_&&(P[oe]=0)}}}function g(M,P){var C=P.x,_=P.y;C<M.xMin&&(M.xMin=C),C>M.xMax&&(M.xMax=C),_<M.yMin&&(M.yMin=_),_>M.yMax&&(M.yMax=_)}function v(M,P,C){var _=2;M.xMax=Math.min(M.xMax+_,C),M.xMin=Math.max(M.xMin-_,0),M.yMax=Math.min(M.yMax+_,P),M.yMin=Math.max(M.yMin-_,0)}function m(M,P,C,_,D){for(var I=Object(l.floodFill)(_,[M.x,M.y]),y=I.flooded,R=0;R<y.length;R++){var b=y[R];C[b[1]*D+b[0]]=P}return y.length}function E(M){for(var P=[],C=0;C<M.length-1;C++)P.push(M[C]),P.push.apply(P,f()(Object(l.getPixelPathBetweenPixels)(M[C],M[C+1])));P.push[M[M.length-1]];for(var _=[],D=[],I=0;I<P.length-1;I++){var y=T(P[I],P[I+1]),R=y.left,b=y.right;_.push(R),D.push(b)}return{pixelPath:P,leftPath:_,rightPath:D}}function T(M,P){var C={x:P.x-M.x,y:P.y-M.y};if(C.x===-1&&C.y===1)return{left:{x:M.x-1,y:M.y-1},right:{x:M.x+1,y:M.y+1}};if(C.x===0&&C.y===1)return{left:{x:M.x-1,y:M.y},right:{x:M.x+1,y:M.y}};if(C.x===1&&C.y===1)return{left:{x:M.x-1,y:M.y+1},right:{x:M.x+1,y:M.y-1}};if(C.x===1&&C.y===0)return{left:{x:M.x,y:M.y+1},right:{x:M.x,y:M.y-1}};if(C.x===1&&C.y===-1)return{left:{x:M.x+1,y:M.y+1},right:{x:M.x-1,y:M.y-1}};if(C.x===0&&C.y===-1)return{left:{x:M.x+1,y:M.y},right:{x:M.x-1,y:M.y}};if(C.x===-1&&C.y===-1)return{left:{x:M.x+1,y:M.y-1},right:{x:M.x-1,y:M.y+1}};if(C.x===-1&&C.y===0)return{left:{x:M.x,y:M.y-1},right:{x:M.x,y:M.y+1}};s.error("Unable to find left and right paths for flood fill ",M,P,C)}function O(M,P){var C=M[0].segment===P,_=[];_.push({additive:!C,nodes:[]});for(var D=0,I=0;I<M.length;I++){var y=M[I];C?(_[D].nodes.push(y),y.segment!==P&&(D++,C=!C,_.push({additive:!0,nodes:[]}),_[D].nodes.push(M[I-1]),_[D].nodes.push(y))):(_[D].nodes.push(y),y.segment===P&&(D++,C=!C,_.push({additive:!1,nodes:[]}),_[D].nodes.push(M[I-1]),_[D].nodes.push(y)))}return _.pop(),_.shift(),_}},"./tools/segmentation/strategies/eraseCircle.js":function(W,n,e){e.r(n),e.d(n,"eraseInsideCircle",function(){return i}),e.d(n,"eraseOutsideCircle",function(){return u});var a=e("../node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(a),d=e("./util/ellipse/index.js"),l=e("./util/logger.js"),o=e("./util/segmentation/index.js"),t=e("./util/getCircleCoords.js"),r=Object(l.getLogger)("util:segmentation:operations:eraseInsideCircle");function s(c,h){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,v=h.segmentationMixinType;if(v!=="circleSegmentationMixin"){r.error("eraseInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(v));return}var m=c.detail,E=Object(o.getBoundingBoxAroundCircle)(c),T=f()(E,2),O=T[0],M=T[1],P=Object(t.default)(m.handles.start,m.handles.end);g?Object(o.eraseInsideShape)(c,h,function(C){return Object(d.pointInEllipse)(P,C)},O,M):Object(o.eraseOutsideShape)(c,h,function(C){return Object(d.pointInEllipse)(P,C)},O,M)}function i(c,h){s(c,h,!0)}function u(c,h){s(c,h,!1)}},"./tools/segmentation/strategies/eraseFreehand.js":function(W,n,e){e.r(n),e.d(n,"eraseInsideFreehand",function(){return s}),e.d(n,"eraseOutsideFreehand",function(){return i});var a=e("../node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(a),d=e("./util/segmentation/index.js"),l=e("./util/isPointInPolygon.js"),o=e("./util/logger.js"),t=Object(o.getLogger)("util:segmentation:operations:eraseInsideFreehand");function r(u,c){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,g=c.points,v=c.segmentationMixinType;if(v!=="freehandSegmentationMixin"){t.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(v));return}var m=u.detail.image,E=g.map(function(C){return[C.x,C.y]}),T=Object(d.getBoundingBoxAroundPolygon)(E,m),O=f()(T,2),M=O[0],P=O[1];h?Object(d.eraseInsideShape)(u,c,function(C){return Object(l.default)([C.x,C.y],E)},M,P):Object(d.eraseOutsideShape)(u,c,function(C){return Object(l.default)([C.x,C.y],E)},M,P)}function s(u,c){r(u,c,!0)}function i(u,c){r(u,c,!1)}},"./tools/segmentation/strategies/eraseRectangle.js":function(W,n,e){e.r(n),e.d(n,"eraseInsideRectangle",function(){return r}),e.d(n,"eraseOutsideRectangle",function(){return s});var a=e("../node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(a),d=e("./util/logger.js"),l=e("./util/segmentation/index.js"),o=Object(d.getLogger)("util:segmentation:operations:eraseInsideRectangle");function t(i,u){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,h=u.points,g=u.segmentationMixinType;if(g!=="rectangleSegmentationMixin"){o.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(g));return}var v=i.detail,m=v.image,E=h.map(function(C){return[C.x,C.y]}),T=Object(l.getBoundingBoxAroundPolygon)(E,m),O=f()(T,2),M=O[0],P=O[1];c?Object(l.eraseInsideShape)(i,u,function(){return!0},M,P):Object(l.eraseOutsideBoundingBox)(i,u,M,P)}function r(i,u){t(i,u,!0)}function s(i,u){t(i,u,!1)}},"./tools/segmentation/strategies/fillCircle.js":function(W,n,e){e.r(n),e.d(n,"fillInsideCircle",function(){return i}),e.d(n,"fillOutsideCircle",function(){return u});var a=e("../node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(a),d=e("./util/segmentation/index.js"),l=e("./util/ellipse/index.js"),o=e("./util/getCircleCoords.js"),t=e("./util/logger.js"),r=Object(t.getLogger)("util:segmentation:operations:fillCircle");function s(c,h){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,v=h.segmentationMixinType;if(v!=="circleSegmentationMixin"){r.error("fillInsideCircle operation requires circleSegmentationMixin operationData, recieved ".concat(v));return}var m=c.detail,E=Object(d.getBoundingBoxAroundCircle)(c),T=f()(E,2),O=T[0],M=T[1],P=Object(o.default)(m.handles.start,m.handles.end);g?Object(d.fillInsideShape)(c,h,function(C){return Object(l.pointInEllipse)(P,C)},O,M):Object(d.fillOutsideShape)(c,h,function(C){return Object(l.pointInEllipse)(P,C)},O,M)}function i(c,h){s(c,h,!0)}function u(c,h){s(c,h,!1)}},"./tools/segmentation/strategies/fillFreehand.js":function(W,n,e){e.r(n),e.d(n,"fillInsideFreehand",function(){return s}),e.d(n,"fillOutsideFreehand",function(){return i});var a=e("../node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(a),d=e("./util/segmentation/index.js"),l=e("./util/isPointInPolygon.js"),o=e("./util/logger.js"),t=Object(o.getLogger)("util:segmentation:operations:fillInsideFreehand");function r(u,c){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,g=c.points,v=c.segmentationMixinType;if(v!=="freehandSegmentationMixin"){t.error("eraseInsideFreehand operation requires freehandSegmentationMixin operationData, recieved ".concat(v));return}var m=u.detail.image,E=g.map(function(C){return[C.x,C.y]}),T=Object(d.getBoundingBoxAroundPolygon)(E,m),O=f()(T,2),M=O[0],P=O[1];h?Object(d.fillInsideShape)(u,c,function(C){return Object(l.default)([C.x,C.y],E)},M,P):Object(d.fillOutsideShape)(u,c,function(C){return Object(l.default)([C.x,C.y],E)},M,P)}function s(u,c){r(u,c,!0)}function i(u,c){r(u,c,!1)}},"./tools/segmentation/strategies/fillRectangle.js":function(W,n,e){e.r(n),e.d(n,"fillInsideRectangle",function(){return r}),e.d(n,"fillOutsideRectangle",function(){return s});var a=e("../node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(a),d=e("./util/segmentation/index.js"),l=e("./util/logger.js"),o=Object(l.getLogger)("util:segmentation:operations:fillInsideRectangle");function t(i,u){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,h=u.points,g=u.segmentationMixinType;if(g!=="rectangleSegmentationMixin"){o.error("eraseInsideRectangle operation requires rectangleSegmentationMixin operationData, recieved ".concat(g));return}var v=i.detail.image,m=h.map(function(P){return[P.x,P.y]}),E=Object(d.getBoundingBoxAroundPolygon)(m,v),T=f()(E,2),O=T[0],M=T[1];c?Object(d.fillInsideShape)(i,u,function(){return!0},O,M):Object(d.fillOutsideBoundingBox)(i,u,O,M)}function r(i,u){t(i,u,!0)}function s(i,u){t(i,u,!1)}},"./tools/segmentation/strategies/index.js":function(W,n,e){e.r(n);var a=e("./tools/segmentation/strategies/correction.js");e.d(n,"correction",function(){return a.default});var f=e("./tools/segmentation/strategies/eraseFreehand.js");e.d(n,"eraseInsideFreehand",function(){return f.eraseInsideFreehand}),e.d(n,"eraseOutsideFreehand",function(){return f.eraseOutsideFreehand});var d=e("./tools/segmentation/strategies/eraseRectangle.js");e.d(n,"eraseInsideRectangle",function(){return d.eraseInsideRectangle}),e.d(n,"eraseOutsideRectangle",function(){return d.eraseOutsideRectangle});var l=e("./tools/segmentation/strategies/fillFreehand.js");e.d(n,"fillInsideFreehand",function(){return l.fillInsideFreehand}),e.d(n,"fillOutsideFreehand",function(){return l.fillOutsideFreehand});var o=e("./tools/segmentation/strategies/fillRectangle.js");e.d(n,"fillInsideRectangle",function(){return o.fillInsideRectangle}),e.d(n,"fillOutsideRectangle",function(){return o.fillOutsideRectangle});var t=e("./tools/segmentation/strategies/fillCircle.js");e.d(n,"fillInsideCircle",function(){return t.fillInsideCircle}),e.d(n,"fillOutsideCircle",function(){return t.fillOutsideCircle});var r=e("./tools/segmentation/strategies/eraseCircle.js");e.d(n,"eraseInsideCircle",function(){return r.eraseInsideCircle}),e.d(n,"eraseOutsideCircle",function(){return r.eraseOutsideCircle})},"./util/SaveAs.js":function(W,n,e){e.r(n),n.default=function(a,f){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"image/png",l=a.querySelector("canvas");if(l.msToBlob){var o=l.msToBlob();return window.navigator.msSaveBlob(o,f)}var t=document.createElement("a");if(t.download=f,t.href=l.toDataURL(d,1),document.createEvent){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}else t.fireEvent&&t.fireEvent("onclick")}},"./util/angleBetweenPoints.js":function(W,n,e){e.r(n),n.default=function(a,f,d){var l=Math.sqrt(Math.pow(a.x-f.x,2)+Math.pow(a.y-f.y,2)),o=Math.sqrt(Math.pow(a.x-d.x,2)+Math.pow(a.y-d.y,2)),t=Math.sqrt(Math.pow(f.x-d.x,2)+Math.pow(f.y-d.y,2)),r=Math.acos((Math.pow(l,2)+Math.pow(o,2)-Math.pow(t,2))/(2*l*o))*180/Math.PI,s=(f.x-a.x)*(d.y-a.y)-(f.y-a.y)*(d.x-a.x);return{angle:r,direction:s}}},"./util/calculateSUV.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(d,l){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,t=a.default.cornerstone,r=t.metaData.get("patientStudyModule",d.imageId),s=t.metaData.get("generalSeriesModule",d.imageId);if(!(!r||!s)){var i=s.modality;if(i==="PT"){var u=o?l:l*d.slope+d.intercept,c=r.patientWeight;if(c){var h=t.metaData.get("petIsotopeModule",d.imageId);if(h){var g=h.radiopharmaceuticalInfo,v=g.radiopharmaceuticalStartTime,m=g.radionuclideTotalDose,E=g.radionuclideHalfLife,T=s.seriesTime;if(!(!v||!m||!E||!T)){var O=f(T.fractionalSeconds||0)+T.seconds+T.minutes*60+T.hours*60*60,M=f(v.fractionalSeconds||0)+v.seconds+v.minutes*60+v.hours*60*60,P=O-M,C=m*Math.exp(-P*Math.log(2)/E),_=u*c/C*1e3;return _}}}}}};function f(d){return parseFloat(".".concat(d))}},"./util/clip.js":function(W,n,e){e.r(n),e.d(n,"clip",function(){return l}),e.d(n,"clipToBox",function(){return o}),e.d(n,"clipBoxToDisplayedArea",function(){return s});var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a),d=e("./externalModules.js");function l(i,u,c){return Math.min(Math.max(u,i),c)}function o(i,u){var c=u.left||0,h=u.top||0;i.x=l(i.x,c,c+u.width),i.y=l(i.y,h,h+u.height)}var t=function(u,c){var h=function(y){return d.default.cornerstone.canvasToPixel(u,y)},g=c.top,v=c.left,m=c.width,E=c.height,T=h({x:v,y:g}),O=h({x:v+m,y:g}),M=h({x:v,y:g+E}),P=h({x:v+m,y:g+E}),C=[T,O,M,P],_=C.map(function(I){return I.x}),D=C.map(function(I){return I.y});return{minX:Math.min.apply(Math,f()(_)),minY:Math.min.apply(Math,f()(D)),maxX:Math.max.apply(Math,f()(_)),maxY:Math.max.apply(Math,f()(D))}},r=function(u,c,h,g,v,m){m-v<g-h?(u[c]+=v-h,u[c]+=(m-v)/2,u[c]-=(g-h)/2):h<v?u[c]+=v-h:g>m&&(u[c]-=g-m)};function s(i,u){var c=d.default.cornerstone,h=c.pixelToCanvas,g=c.canvasToPixel,v=c.getViewport,m=c.getEnabledElement,E=c.getDisplayedArea,T=g(i,{x:u.left,y:u.top}),O=t(i,u),M=O.minX,P=O.minY,C=O.maxX,_=O.maxY,D=v(i),I=m(i),y=E(I.image,D),R=D.displayedArea?D.displayedArea:y,b=R.tlhc,z=R.brhc,H=b.y-1,B=b.x-1,p=z.y,A=z.x;r(T,"y",P,_,H,p),r(T,"x",M,C,B,A);var j=h(i,T);u.top=j.y,u.left=j.x}n.default=l},"./util/convertToVector3.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./externalModules.js");function f(d){var l=a.default.cornerstoneMath;if(d instanceof l.Vector3)return d;var o=Object.keys(d);return o.includes("x")&&o.includes("y")&&o.includes("z")?new l.Vector3(d.x,d.y,d.z):new l.Vector3(d[0],d[1],d[2])}},"./util/copyPoints.js":function(W,n,e){e.r(n),n.default=function(f){var d=a(f.page),l=a(f.image),o=a(f.client),t=a(f.canvas);return{page:d,image:l,client:o,canvas:t}};function a(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=f.x,l=f.y;return{x:d,y:l}}},"./util/debounce.js":function(W,n,e){e.r(n);var a=e("./util/isObject.js");function f(d,l,o){var t,r,s,i,u,c,h=0,g=!1,v=!1,m=!0,E=!l&&l!==0&&typeof window.requestAnimationFrame=="function";if(typeof d!="function")throw new TypeError("Expected a function");l=Number(l)||0,Object(a.default)(o)&&(g=!!o.leading,v="maxWait"in o,s=v?Math.max(Number(o.maxWait)||0,l):s,m="trailing"in o?!!o.trailing:m);function T(H){var B=t,p=r;return t=r=void 0,h=H,i=d.apply(p,B),i}function O(H,B){return E?window.requestAnimationFrame(H):setTimeout(H,B)}function M(H){if(E)return window.cancelAnimationFrame(H);clearTimeout(H)}function P(H){return h=H,u=O(D,l),g?T(H):i}function C(H){var B=H-c,p=H-h,A=l-B;return v?Math.min(A,s-p):A}function _(H){var B=H-c,p=H-h;return c===void 0||B>=l||B<0||v&&p>=s}function D(){var H=Date.now();if(_(H))return I(H);u=O(D,C(H))}function I(H){return u=void 0,m&&t?T(H):(t=r=void 0,i)}function y(){u!==void 0&&M(u),h=0,t=c=r=u=void 0}function R(){return u===void 0?i:I(Date.now())}function b(){return u!==void 0}function z(){for(var H=Date.now(),B=_(H),p=arguments.length,A=new Array(p),j=0;j<p;j++)A[j]=arguments[j];if(t=A,r=this,c=H,B){if(u===void 0)return P(c);if(v)return u=O(D,l),T(c)}return u===void 0&&(u=O(D,l)),i}return z.cancel=y,z.flush=R,z.pending=b,z}n.default=f},"./util/debugLib/common.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a);function d(l){t.debug=t,t.default=t,t.coerce=g,t.disable=u,t.enable=i,t.enabled=c,t.humanize=e("../node_modules/ms/index.js"),Object.keys(l).forEach(function(v){t[v]=l[v]}),t.instances=[],t.names=[],t.skips=[],t.formatters={};function o(v){for(var m=0,E=0;E<v.length;E++)m=(m<<5)-m+v.charCodeAt(E),m|=0;return t.colors[Math.abs(m)%t.colors.length]}t.selectColor=o;function t(v){var m;function E(){for(var T=arguments.length,O=new Array(T),M=0;M<T;M++)O[M]=arguments[M];if(E.enabled){var P=E,C=Number(new Date),_=C-(m||C);P.diff=_,P.prev=m,P.curr=C,m=C,O[0]=t.coerce(O[0]),typeof O[0]!="string"&&O.unshift("%O");var D=0;O[0]=O[0].replace(/%([a-zA-Z%])/g,function(y,R){if(y==="%%")return y;D++;var b=t.formatters[R];if(typeof b=="function"){var z=O[D];y=b.call(P,z),O.splice(D,1),D--}return y}),t.formatArgs.call(P,O);var I=P.log||t.log;I.apply(P,O)}}return E.namespace=v,E.enabled=t.enabled(v),E.useColors=t.useColors(),E.color=o(v),E.destroy=r,E.extend=s,typeof t.init=="function"&&t.init(E),t.instances.push(E),E}function r(){var v=t.instances.indexOf(this);return v!==-1?(t.instances.splice(v,1),!0):!1}function s(v,m){var E=t(this.namespace+(typeof m>"u"?":":m)+v);return E.log=this.log,E}function i(v){t.save(v),t.names=[],t.skips=[];var m,E=(typeof v=="string"?v:"").split(/[\s,]+/),T=E.length;for(m=0;m<T;m++)E[m]&&(v=E[m].replace(/\*/g,".*?"),v[0]==="-"?t.skips.push(new RegExp("^".concat(v.substr(1),"$"))):t.names.push(new RegExp("^".concat(v,"$"))));for(m=0;m<t.instances.length;m++){var O=t.instances[m];O.enabled=t.enabled(O.namespace)}}function u(){var v=[].concat(f()(t.names.map(h)),f()(t.skips.map(h).map(function(m){return"-".concat(m)}))).join(",");return t.enable(""),v}function c(v){if(v[v.length-1]==="*")return!0;var m,E;for(m=0,E=t.skips.length;m<E;m++)if(t.skips[m].test(v))return!1;for(m=0,E=t.names.length;m<E;m++)if(t.names[m].test(v))return!0;return!1}function h(v){return v.toString().substring(2,v.toString().length-2).replace(/\.\*\?$/,"*")}function g(v){return v instanceof Error?v.stack||v.message:v}return t.enable(t.load()),t}n.default=d},"./util/debugLib/index.js":function(W,n,e){e.r(n),(function(a){var f=e("./util/debugLib/common.js"),d=i(),l={formatArgs:t,save:r,load:s,useColors:o,storage:d};l.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function o(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function t(h){if(h[0]="".concat((this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" "),"+").concat(u.humanize(this.diff)),!!this.useColors){var g="color: ".concat(this.color);h.splice(1,0,g,"color: inherit");var v=0,m=0;h[0].replace(/%[a-zA-Z%]/g,function(E){E!=="%%"&&(v++,E==="%c"&&(m=v))}),h.splice(m,0,g)}}l.log=console.debug||console.log||function(){};function r(h){try{h?l.storage.setItem("debug",h):l.storage.removeItem("debug")}catch{}}function s(){var h;try{h=l.storage.getItem("debug")}catch{}return!h&&typeof a<"u"&&"env"in a&&(h=a.env.DEBUG),h}function i(){try{return localStorage}catch{}}var u=Object(f.default)(l),c=u.formatters;c.j=function(h){try{return JSON.stringify(h)}catch(g){return"[UnexpectedJSONParseError]: ".concat(g.message)}},n.default=u}).call(this,e("../node_modules/process/browser.js"))},"./util/deepmerge.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/typeof.js"),f=e.n(a),d=function(u){var c=u&&f()(u)==="object";return c&&Object.prototype.toString.call(u)!=="[object RegExp]"&&Object.prototype.toString.call(u)!=="[object Date]"},l=function(u){var c=Array.isArray(u)?[]:{};return c},o=function(u,c){var h=c&&c.clone===!0;return h&&d(u)?s(l(u),u,c):u},t=function(u,c,h){var g=u.slice();return c.forEach(function(v,m){typeof g[m]>"u"?g[m]=o(v,h):d(v)?g[m]=s(u[m],v,h):u.indexOf(v)===-1&&g.push(o(v,h))}),g},r=function(u,c,h){var g={};return d(u)&&Object.keys(u).forEach(function(v){g[v]=o(u[v],h)}),Object.keys(c).forEach(function(v){!d(c[v])||!u[v]?g[v]=o(c[v],h):g[v]=s(u[v],c[v],h)}),g},s=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0,g=Array.isArray(c),v=h||{arrayMerge:t},m=v.arrayMerge||t;if(g)return Array.isArray(u)?m(u,c,h):o(c,h);var E=r(u,c,h);return Object.getPrototypeOf(u)!==Object.prototype&&Object.setPrototypeOf(E,Object.getPrototypeOf(u)),E};n.default=s},"./util/ellipse/calculateEllipseStatistics.js":function(W,n,e){e.r(n);var a=e("./util/ellipse/pointInEllipse.js");n.default=function(f,d){for(var l=0,o=0,t=0,r=0,s=null,i=null,u=d.top;u<d.top+d.height;u++)for(var c=d.left;c<d.left+d.width;c++){var h={x:c,y:u};Object(a.default)(d,h)&&(s===null&&(s=f[r],i=f[r]),l+=f[r],o+=f[r]*f[r],s=Math.min(s,f[r]),i=Math.max(i,f[r]),t++),r++}if(t===0)return{count:t,mean:0,variance:0,stdDev:0,min:0,max:0};var g=l/t,v=o/t-g*g;return{count:t,mean:g,variance:v,stdDev:Math.sqrt(v),min:s,max:i}}},"./util/ellipse/index.js":function(W,n,e){e.r(n);var a=e("./util/ellipse/calculateEllipseStatistics.js");e.d(n,"calculateEllipseStatistics",function(){return a.default});var f=e("./util/ellipse/pointInEllipse.js");e.d(n,"pointInEllipse",function(){return f.default}),n.default={calculateEllipseStatistics:a.default,pointInEllipse:f.default}},"./util/ellipse/pointInEllipse.js":function(W,n,e){e.r(n),n.default=function(a,f){var d=a.width/2,l=a.height/2;if(d<=0||l<=0)return!1;var o={x:a.left+d,y:a.top+l},t={x:f.x-o.x,y:f.y-o.y},r=t.x*t.x/(d*d)+t.y*t.y/(l*l)<=1;return r}},"./util/findAndMoveHelpers.js":function(W,n,e){e.r(n),e.d(n,"moveHandleNearImagePoint",function(){return c}),e.d(n,"findHandleDataNearImagePoint",function(){return h}),e.d(n,"moveAnnotation",function(){return g});var a=e("../node_modules/@babel/runtime/helpers/defineProperty.js"),f=e.n(a),d=e("./store/index.js"),l=e("./manipulators/getHandleNearImagePoint.js"),o=e("./manipulators/index.js"),t=e("./util/getProximityThreshold.js"),r=e("./events.js"),s=e("./util/triggerEvent.js");function i(v,m){var E=Object.keys(v);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(v);m&&(T=T.filter(function(O){return Object.getOwnPropertyDescriptor(v,O).enumerable})),E.push.apply(E,T)}return E}function u(v){for(var m=1;m<arguments.length;m++){var E=arguments[m]!=null?arguments[m]:{};m%2?i(E,!0).forEach(function(T){f()(v,T,E[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(E)):i(E).forEach(function(T){Object.defineProperty(v,T,Object.getOwnPropertyDescriptor(E,T))})}return v}var c=function(m,E,T,O,M){T.active=!0,d.state.isToolLocked=!0;var P=function(_){var D=m.detail.element,I=T.toolType||T.toolName,y={toolName:I,toolType:I,element:D,measurementData:u({},T,{active:!1})};Object(s.default)(D,r.default.MEASUREMENT_COMPLETED,y)};Object(o.moveHandle)(m.detail,E.name,T,O,E.options,M,P),m.stopImmediatePropagation(),m.stopPropagation(),m.preventDefault()},h=function(m,E,T,O){for(var M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"mouse",P=0;P<E.data.length;P++){var C=E.data[P],_=Object(l.default)(m,C.handles,O,Object(t.default)(M,T));if(_)return{handle:_,data:C}}},g=function(m,E,T){var O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"mouse";T.active=!0,d.state.isToolLocked=!0,Object(o.moveAllHandles)(m.detail,E.name,T,null,E.options,O,function(){T.active=!1,d.state.isToolLocked=!1}),m.stopImmediatePropagation(),m.stopPropagation(),m.preventDefault()}},"./util/freehand/ClickedLineData.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return d});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=function l(o,t){f()(this,l),this.toolIndex=o,this.handleIndexArray=t}},"./util/freehand/FreehandHandleData.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return d});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=function l(o){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;f()(this,l),this.x=o.x,this.y=o.y,this.highlight=t,this.active=r,this.lines=[]}},"./util/freehand/FreehandLineFinder.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return i});var a=e("../node_modules/@babel/runtime/helpers/classCallCheck.js"),f=e.n(a),d=e("../node_modules/@babel/runtime/helpers/createClass.js"),l=e.n(d),o=e("./stateManagement/toolState.js"),t=e("./externalModules.js"),r=e("./util/freehand/ClickedLineData.js"),s=10,i=function(){function u(c,h){f()(this,u),this._eventData=c,this._toolName=h}return l()(u,[{key:"findLine",value:function(){var h=this.findTool();if(h===null)return null;var g=this._getCloseLinesInTool(h);if(g){var v=this._findCorrectLine(h,g);return v}return null}},{key:"findTool",value:function(){if(this._toolData=Object(o.getToolState)(this._eventData.element,this._toolName),this._mousePoint=this._eventData.currentPoints.canvas,!this._toolData)return null;var h=this._nearestHandleToPointAllTools();return h.toolIndex}},{key:"_nearestHandleToPointAllTools",value:function(){for(var h=this._toolData,g={toolIndex:null,handleIndex:null,distance:1/0},v=0;v<h.data.length;v++){var m=this._nearestHandleToPoint(v);m!==null&&m.distance<g.distance&&(g=m)}return g}},{key:"_nearestHandleToPoint",value:function(h){var g=this._eventData,v=this._toolData,m=v.data[h],E=m.handles.points;if(E===void 0||m.visible===!1)return null;for(var T={toolIndex:h,handleIndex:null,distance:1/0},O=0;O<E.length;O++){var M=t.default.cornerstone.pixelToCanvas(g.element,E[O]),P=t.default.cornerstoneMath.point.distance(M,this._mousePoint);P<T.distance&&(T.handleIndex=O,T.distance=P)}return T}},{key:"_getCloseLinesInTool",value:function(h){for(var g=this._toolData,v=g.data[h].handles.points,m=[],E=0;E<v.length;E++){var T=u.getNextHandleIndex(E,v.length),O=this._distanceOfPointfromLine(v[E],v[T]);O<s&&m.push([E,T])}return m}},{key:"_findCorrectLine",value:function(h,g){for(var v=0;v<g.length;v++)if(this._pointProjectsToLineSegment(h,g[v]))return new r.default(h,g[v]);return null}},{key:"_pointProjectsToLineSegment",value:function(h,g){var v=this._eventData,m=this._toolData,E=m.data[h],T=E.handles.points;if(E.handles.points!==void 0){if(E.visible===!1)return!1;var O=T[g[0]],M=T[g[1]],P=u.getCanvasPointsFromHandles(O,M,v.element),C=u.getLineAsVector(P),_=this._getLineOriginToMouseAsVector(P),D=(_[0]*C[0]+_[1]*C[1])/C.magnitude;return D>0&&D<C.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(h){var g=[this._mousePoint.x-h[0].x,this._mousePoint.y-h[0].y];return g}},{key:"_distanceOfPointfromLine",value:function(h,g){var v=this._eventData,m=t.default.cornerstone.pixelToCanvas(v.element,h),E=t.default.cornerstone.pixelToCanvas(v.element,g),T=this._mousePoint,O=Math.abs((E.y-m.y)*T.x-(E.x-m.x)*T.y+E.x*m.y-E.y*m.x),M=t.default.cornerstoneMath.point.distance(m,E),P=O/M;return P}}],[{key:"getCanvasPointsFromHandles",value:function(h,g,v){var m=[];return h.x<g.x?(m.push(t.default.cornerstone.pixelToCanvas(v,h)),m.push(t.default.cornerstone.pixelToCanvas(v,g))):(m.push(t.default.cornerstone.pixelToCanvas(v,g)),m.push(t.default.cornerstone.pixelToCanvas(v,h))),m}},{key:"getLineAsVector",value:function(h){var g=[h[1].x-h[0].x,h[1].y-h[0].y];return g.magnitude=t.default.cornerstoneMath.point.distance(h[0],h[1]),g}},{key:"getNextHandleIndex",value:function(h,g){var v;return h<g-1?v=h+1:v=0,v}}]),u}()},"./util/freehand/addLine.js":function(W,n,e){e.r(n),n.default=function(a,f){f===a.length-1?a[f].lines.push(a[0]):a[f].lines.push(a[f+1])}},"./util/freehand/calculateFreehandStatistics.js":function(W,n,e){e.r(n);var a=e("./util/freehand/pointInFreehand.js");n.default=function(l,o,t){var r={count:0,mean:0,variance:0,stdDev:0},s=f(l,o,t);return s.count===0||(r.count=s.count,r.mean=s.value/s.count,r.variance=s.squared/s.count-r.mean*r.mean,r.stdDev=Math.sqrt(r.variance)),r};function f(l,o,t){for(var r={value:0,squared:0,count:0},s=0,i=o.top;i<o.top+o.height;i++)for(var u=o.left;u<o.left+o.width;u++){var c={x:u,y:i};d(t,c,r,l[s]),s++}return r}function d(l,o,t,r){Object(a.default)(l,o)&&(t.value+=r,t.squared+=r*r,t.count++)}},"./util/freehand/freehandArea.js":function(W,n,e){e.r(n),n.default=function(a,f){var d=0,l=a.length-1;f=f||1;for(var o=0;o<a.length;o++)d+=(a[l].x+a[o].x)*(a[l].y-a[o].y),l=o;return Math.abs(d*f/2)}},"./util/freehand/freehandIntersect.js":function(W,n,e){e.r(n);function a(i,u){var c=u.length-1,h=t(u[c]),g=t(i);return l(u,h,g,[c])}function f(i){var u=i.length-1,c=t(i[u]),h=t(i[0]);return l(i,c,h,[u,0])}function d(i,u){var c=t(i[u]),h=u-1;u===0&&(h=i.length-1);var g=t(i[h]);return l(i,c,g,[u,h])?!0:(u===i.length-1?h=0:h=u+1,g=t(i[h]),l(i,c,g,[u,h]))}function l(i,u,c,h){for(var g=i.length-1,v=0;v<i.length;v++){if(h.indexOf(v)!==-1||h.indexOf(g)!==-1){g=v;continue}var m=t(i[g]),E=t(i[v]);if(o(u,c,m,E))return!0;g=v}return!1}function o(i,u,c,h){var g=!1,v=[r(i,u,c),r(i,u,h),r(c,h,i),r(c,h,u)];return v[0]!==v[1]&&v[2]!==v[3]?!0:((v[0]===0&&s(i,c,u)||v[1]===0&&s(i,h,u)||v[2]===0&&s(c,i,h)||v[3]===0&&s(c,u,h))&&(g=!0),g)}function t(i){return{x:i.x,y:i.y}}function r(i,u,c){var h=(u.y-i.y)*(c.x-u.x)-(u.x-i.x)*(c.y-u.y);return h===0?0:h>0?1:2}function s(i,u,c){return u.x<=Math.max(i.x,c.x)&&u.x>=Math.min(i.x,c.x)&&u.y<=Math.max(i.y,c.y)&&u.y>=Math.min(i.y,c.y)}n.default={newHandle:a,end:f,modify:d}},"./util/freehand/index.js":function(W,n,e){e.r(n);var a=e("./util/freehand/calculateFreehandStatistics.js"),f=e("./util/freehand/ClickedLineData.js"),d=e("./util/freehand/freehandArea.js"),l=e("./util/freehand/FreehandHandleData.js"),o=e("./util/freehand/freehandIntersect.js"),t=e("./util/freehand/FreehandLineFinder.js"),r=e("./util/freehand/insertOrDelete.js"),s=e("./util/freehand/pointInFreehand.js"),i=e("./util/freehand/addLine.js");n.default={calculateFreehandStatistics:a.default,ClickedLineData:f.default,freehandArea:d.default,FreehandHandleData:l.default,freehandIntersect:o.default,FreehandLineFinder:t.default,insertOrDelete:r.default,pointInFreehand:s.default,addLine:i.default}},"./util/freehand/insertOrDelete.js":function(W,n,e){e.r(n);var a=e("./util/freehand/FreehandLineFinder.js"),f=e("./util/freehand/FreehandHandleData.js"),d=e("./stateManagement/toolState.js"),l=e("./externalModules.js"),o=e("./util/freehand/addLine.js");n.default=function(i,u){var c=i.detail;if(u&&u.handleNearby!==null){var h={toolIndex:u.toolIndex,handleIndex:u.handleNearby};t.call(this,c,h)}else{var g=new a.default(c,this.name),v=g.findLine();v&&r.call(this,c,v)}};function t(i,u){var c=Object(d.getToolState)(i.element,this.name);if(c!==void 0){var h=u.handleIndex,g=u.toolIndex,v=c.data[g],m=v.handles.points;m.length<=3||(h===m.length-1?(m[h-1].lines.pop(),m[h-1].lines.push(m[0])):h===0?(m[m.length-1].lines.pop(),m[m.length-1].lines.push(m[h+1])):(m[h-1].lines.pop(),m[h-1].lines.push(m[h+1])),m.splice(h,1),v.invalidated=!0,v.active=!0,v.highlight=!0,l.default.cornerstone.updateImage(i.element))}}function r(i,u){var c=Object(d.getToolState)(i.element,this.name);if(c!==void 0){var h=c.data[u.toolIndex],g=s(u);if(g!==1/0){var v=new f.default(i.currentPoints.image),m=h.handles.points;m.splice(g,0,v),m[g-1].lines.pop(),m[g-1].lines.push(i.currentPoints.image),Object(o.default)(m,g),h.active=!0,h.highlight=!0,h.invalidated=!0,l.default.cornerstone.updateImage(i.element)}}}function s(i){for(var u=i.handleIndexArray,c=1/0,h=u.includes(0),g=0;g<u.length;g++){var v=u[g];v!==0&&v<c&&(c=v)}return h&&c===1&&(c=0),c++,c}},"./util/freehand/pointInFreehand.js":function(W,n,e){e.r(n),n.default=function(o,t){for(var r=!1,s=o.length-1,i=0;i<o.length;i++)l(t,o[i],o[s])&&(r=!r),s=i;return r};function a(o,t,r){return t<o&&o<r||r<o&&o<t}function f(o,t,r){if(t.x>o.x&&r.x>o.x)return!0;if(t.x===r.x)return o.x<t.x;if(t.x>r.x){var s=t;t=r,r=s}var i=d(o,t,r);return Math.sign(i.gradient)*o.y>Math.sign(i.gradient)*i.value}function d(o,t,r){var s=(r.y-t.y)/(r.x-t.x),i={value:t.y+s*(o.x-t.x),gradient:s};return i}function l(o,t,r){return!!(a(o.y,t.y,r.y)&&f(o,t,r))}},"./util/getActiveTool.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return l});var a=e("./store/index.js"),f=e("./store/getActiveToolsForElement.js"),d=e("./store/filterToolsUsableWithMultiPartTools.js");function l(o,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"mouse",s;if(r==="touch"?(s=Object(f.default)(o,a.getters.touchTools()),s=s.filter(function(i){return i.options.isTouchActive})):(s=Object(f.default)(o,a.getters.mouseTools()),s=s.filter(function(i){return Array.isArray(i.options.mouseButtonMask)&&t&&i.options.mouseButtonMask.includes(t)&&i.options.isMouseActive}),a.state.isMultiPartToolActive&&(s=Object(d.default)(s))),s.length!==0)return s[0]}},"./util/getCircleCoords.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./externalModules.js");function f(d,l){var o=a.default.cornerstoneMath.point.distance,t=o(d,l);return{left:Math.floor(Math.min(d.x-t,l.x)),top:Math.floor(Math.min(d.y-t,l.y)),width:t*2,height:t*2}}},"./util/getDefault.js":function(W,n,e){e.r(n),n.default=function(a,f){return a===void 0?f:a}},"./util/getKeyPressData.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return d});var a=e("./store/index.js"),f=e("./externalModules.js");function d(l){var o=f.default.cornerstone,t=l.currentTarget,r=o.getEnabledElement(t);if(!(!r||!r.image)){var s=a.default.state.mousePositionImage;return{event:window.event||l,element:t,viewport:o.getViewport(t),image:r.image,currentPoints:{image:s,canvas:o.pixelToCanvas(t,s)},keyCode:l.keyCode,which:l.which}}}},"./util/getLuminance.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(f,d,l,o,t){if(!f)throw new Error("getLuminance: parameter element must not be undefined");d=Math.round(d),l=Math.round(l);var r=a.default.cornerstone.getEnabledElement(f),s=r.image,i=[],u=0,c=s.getPixelData(),h,g,v;if(s.color)for(g=0;g<t;g++)for(v=0;v<o;v++){h=((g+l)*s.columns+(v+d))*4;var m=c[h],E=c[h+1],T=c[h+2];i[u++]=.2126*m+.7152*E+.0722*T}else for(g=0;g<t;g++)for(v=0;v<o;v++)h=(g+l)*s.columns+(v+d),i[u++]=c[h]*s.slope+s.intercept;return i}},"./util/getMaxSimultaneousRequests.js":function(W,n,e){e.r(n),e.d(n,"getDefaultSimultaneousRequests",function(){return t}),e.d(n,"getMaxSimultaneousRequests",function(){return o}),e.d(n,"setMaxSimultaneousRequests",function(){return l}),e.d(n,"getBrowserInfo",function(){return d}),e.d(n,"isMobileDevice",function(){return r});var a,f={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function d(){var s=navigator.userAgent,i=s.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],u;return/trident/i.test(i[1])?(u=/\brv[ :]+(\d+)/g.exec(s)||[],"IE ".concat(u[1]||"")):i[1]==="Chrome"&&(u=s.match(/\b(OPR|Edge)\/(\d+)/),u!==null)?u.slice(1).join(" ").replace("OPR","Opera"):(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],(u=s.match(/version\/(\d+)/i))!==null&&i.splice(1,1,u[1]),i.join(" "))}function l(s){a=s}function o(){return a||t()}function t(){var s=d(),i=s.split(" "),u=i[0],c=i[1],h=f[u];return h?h[c]?h[c]:h.default:f.default}function r(){var s=new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini");return s.test(navigator.userAgent)}},"./util/getPixelSpacing.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./externalModules.js");function f(d){var l=a.default.cornerstone.metaData.get("imagePlaneModule",d.imageId);return l?{rowPixelSpacing:l.rowPixelSpacing||l.rowImagePixelSpacing,colPixelSpacing:l.columnPixelSpacing||l.colImagePixelSpacing}:{rowPixelSpacing:d.rowPixelSpacing,colPixelSpacing:d.columnPixelSpacing}}},"./util/getProximityThreshold.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./store/index.js");function f(d,l){var o=a.state.clickProximity,t=a.state.touchProximity,r=a.state.tools.find(function(s){var i=s.name;return i===l});return r&&r.configuration&&(o=r.configuration.clickProximity||o,t=r.configuration.touchProximity||t),d==="mouse"?o:t}},"./util/getRGBPixels.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(f,d,l,o,t){if(!f)throw new Error("getRGBPixels: parameter element must not be undefined");d=Math.round(d),l=Math.round(l);var r=a.default.cornerstone.getEnabledElement(f),s=[],i=0,u=r.image.getPixelData(),c,h,g;if(r.image.color)for(h=0;h<t;h++)for(g=0;g<o;g++){c=((h+l)*r.image.columns+(g+d))*4;var v=u[c],m=u[c+1],E=u[c+2],T=u[c+3];s[i++]=v,s[i++]=m,s[i++]=E,s[i++]=T}return s}},"./util/getROITextBoxCoords.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(d,l){var o=f(l),t=(o.left.x+o.right.x)/2,r=(o.top.y+o.bottom.y)/2,s={};return d.rotation>=0&&d.rotation<90&&(s.x=d.hflip?o.left.x:o.right.x,s.y=r),d.rotation>=90&&d.rotation<180&&(s.x=t,s.y=d.vflip?o.bottom.y:o.top.y),d.rotation>=180&&d.rotation<270&&(s.x=d.hflip?o.right.x:o.left.x,s.y=r),d.rotation>=270&&d.rotation<360&&(s.x=t,s.y=d.vflip?o.top.y:o.bottom.y),s}function f(d){var l=[d.start,d.end].sort(u),o=[d.start,d.end].sort(c),t=l[0],r=l[l.length-1],s=o[0],i=o[o.length-1];return{top:s,left:t,bottom:i,right:r};function u(h,g){return h.x<g.x?-1:1}function c(h,g){return h.y<g.y?-1:1}}},"./util/isEmptyObject.js":function(W,n,e){e.r(n);var a=function(d){return Object.keys(d).length===0&&d.constructor===Object};n.default=a},"./util/isObject.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/typeof.js"),f=e.n(a);function d(l){var o=f()(l);return l!==null&&(o==="object"||o==="function")}n.default=d},"./util/isPointInImage.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d,l){var o=f.x,t=f.y;return o<l&&o>=0&&t<d&&t>=0}},"./util/isPointInPolygon.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d){for(var l=f[0],o=f[1],t=!1,r=0,s=d.length-1;r<d.length;s=r++){var i=d[r][0],u=d[r][1],c=d[s][0],h=d[s][1],g=u>o!=h>o&&l<(c-i)*(o-u)/(h-u)+i;g&&(t=!t)}return t}},"./util/lineSegDistance.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(f,d,l,o){var t=a.default.cornerstone,r={start:t.pixelToCanvas(f,d),end:t.pixelToCanvas(f,l)};return a.default.cornerstoneMath.lineSegment.distanceToPoint(r,o)}},"./util/logger.js":function(W,n,e){e.r(n),e.d(n,"getLogger",function(){return l}),e.d(n,"enable",function(){return o}),e.d(n,"disable",function(){return t});var a=e("./util/debugLib/index.js"),f="cornerstoneTools",d=Object(a.default)(f);d.enabled;var l=function(s){var i=d.extend(s);return{log:i,warn:(()=>{}).bind(console),error:(()=>{}).bind(console)}},o=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"".concat(f,":*");return a.default.enable(s)},t=function(){return a.default.disable()}},"./util/makeUnselectable.js":function(W,n,e){e.r(n),n.default=function(a,f){a.style.webkitUserSelect="none",a.style.webkitTouchCallout="none",a.style.mozUserSelect="none",a.style.msUserSelect="none",a.style.oUserSelect="none",a.style.khtmlUserSelect="none",a.style.userSelect="none",a.unselectable="on",a.oncontextmenu=function(){return!1},f===!0&&(a.style.pointerEvents="none")}},"./util/numbersWithCommas.js":function(W,n,e){e.r(n),n.default=function(a){var f=a.toString().split(".");return f[0]=f[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),f.join(".")}},"./util/pointInsideBoundingBox.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(f,d){if(f.boundingBox)return a.default.cornerstoneMath.point.insideRect(d,f.boundingBox)}},"./util/pointProjector.js":function(W,n,e){e.r(n),e.d(n,"projectPatientPointToImagePlane",function(){return d}),e.d(n,"imagePointToPatientPoint",function(){return l}),e.d(n,"planePlaneIntersection",function(){return r}),e.d(n,"rotatePoint",function(){return s});var a=e("./externalModules.js"),f=e("./util/convertToVector3.js");function d(i,u){var c=Object(f.default)(u.rowCosines),h=Object(f.default)(u.columnCosines),g=Object(f.default)(u.imagePositionPatient),v=i.clone().sub(g),m=c.dot(v)/u.columnPixelSpacing,E=h.dot(v)/u.rowPixelSpacing;return{x:m,y:E}}function l(i,u){var c=Object(f.default)(u.rowCosines),h=Object(f.default)(u.columnCosines),g=Object(f.default)(u.imagePositionPatient),v=c.clone().multiplyScalar(i.x);v.multiplyScalar(u.columnPixelSpacing);var m=h.clone().multiplyScalar(i.y);m.multiplyScalar(u.rowPixelSpacing);var E=v.add(m);return E.add(g),E}function o(i){var u=l({x:0,y:0},i),c=l({x:i.columns,y:0},i),h=l({x:0,y:i.rows},i),g=l({x:i.columns,y:i.rows},i),v={top:new a.default.cornerstoneMath.Line3(u,c),left:new a.default.cornerstoneMath.Line3(u,h),right:new a.default.cornerstoneMath.Line3(c,g),bottom:new a.default.cornerstoneMath.Line3(h,g)};return v}function t(i,u){var c=[];return Object.keys(u).forEach(function(h){var g=u[h],v=i.intersectLine(g);v&&c.push(v)}),c}function r(i,u){var c=Object(f.default)(i.rowCosines),h=Object(f.default)(i.columnCosines),g=Object(f.default)(i.imagePositionPatient),v=Object(f.default)(u.rowCosines),m=Object(f.default)(u.columnCosines),E=Object(f.default)(u.imagePositionPatient),T=c.clone().cross(h),O=new a.default.cornerstoneMath.Plane;O.setFromNormalAndCoplanarPoint(T,g);var M=v.clone().cross(m),P=new a.default.cornerstoneMath.Plane;P.setFromNormalAndCoplanarPoint(M,E);var C=P.clone().intersectPlane(O),_=C.origin,D=C.direction,I=l({x:u.columns,y:u.rows},u),y=E.distanceTo(I),R=new a.default.cornerstoneMath.Line3;R.start=_,R.end=_.clone().add(D.multiplyScalar(y));var b=o(u),z=t(R,b);if(z.length===2)return{start:z[0],end:z[1]}}function s(i,u,c){var h=c*(Math.PI/180),g=Math.cos(h)*(i.x-u.x)-Math.sin(h)*(i.y-u.y)+u.x,v=Math.sin(h)*(i.x-u.x)+Math.cos(h)*(i.y-u.y)+u.y;return{x:g,y:v}}},"./util/roundToDecimal.js":function(W,n,e){e.r(n),n.default=function(a,f){var d=Math.pow(10,f);return Math.round(a*d)/d}},"./util/scroll.js":function(W,n,e){e.r(n);var a=e("./util/scrollToIndex.js"),f=e("./stateManagement/toolState.js"),d=e("./util/clip.js"),l=e("./externalModules.js");n.default=function(t,r){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,u=Object(f.getToolState)(t,"stack");if(!(!u||!u.data||!u.data.length)){var c=u.data[0];c.pending||(c.pending=[]);var h=c.currentImageIdIndex+r;if(s){var g=c.imageIds.length;h%=g}else h=Object(d.default)(h,0,c.imageIds.length-1);if(i)Object(a.default)(t,h);else{var v={index:h};c.pending.push(v),o(c,v,t)}}};function o(t,r,s){if(t.pending[0]===r){if(t.currentImageIdIndex===r.index){t.pending.splice(t.pending.indexOf(r),1),t.pending.length>0&&o(t,t.pending[0],s);return}var i=function u(c){var h=t.imageIds.indexOf(c.detail.image.imageId);h===r.index&&(t.pending.splice(t.pending.indexOf(r),1),s.removeEventListener(l.default.cornerstone.EVENTS.NEW_IMAGE,u),t.pending.length>0&&o(t,t.pending[0],s))};s.addEventListener(l.default.cornerstone.EVENTS.NEW_IMAGE,i),Object(a.default)(s,r.index)}}},"./util/scrollToIndex.js":function(W,n,e){e.r(n);var a=e("./events.js"),f=e("./externalModules.js"),d=e("./stateManagement/toolState.js"),l=e("./stateManagement/loadHandlerManager.js"),o=e("./util/triggerEvent.js");n.default=function(t,r){var s=Object(d.getToolState)(t,"stack");if(!s||!s.data||!s.data.length)return;var i=f.default.cornerstone,u;if(s.data.length>1){var c=Object(d.getToolState)(t,"stackRenderer");c&&c.data&&c.data.length&&(u=c.data[0])}var h=s.data[0];r<0&&(r+=h.imageIds.length);var g=l.default.getStartLoadHandler(t),v=l.default.getEndLoadHandler(t),m=l.default.getErrorLoadingHandler(t);function E(_){if(h.currentImageIdIndex===r){try{i.getEnabledElement(t)}catch{return}u?(u.currentImageIdIndex=r,u.render(t,s.data)):i.displayImage(t,_),v&&v(t,_)}}function T(_){var D=h.imageIds[r];m&&m(t,D,_)}if(r!==h.currentImageIdIndex){g&&g(t);var O={newImageIdIndex:r,direction:r-h.currentImageIdIndex};h.currentImageIdIndex=r;var M=h.imageIds[r],P=!!h.preventCache,C;P?C=i.loadImage(M):C=i.loadAndCacheImage(M),C.then(E,T),Object(o.default)(t,a.default.STACK_SCROLL,O)}}},"./util/segmentation/drawBrush.js":function(W,n,e){e.r(n),e.d(n,"drawBrushPixels",function(){return l});var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a),d=e("./util/segmentation/eraseIfSegmentIndex.js");function l(o,t,r,s){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,u=function(h,g){return g*s+h};o.forEach(function(c){var h=u.apply(void 0,f()(c));i?Object(d.default)(h,t,r):t[h]=r})}},"./util/segmentation/eraseIfSegmentIndex.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d,l){d[f]===l&&(d[f]=0)}},"./util/segmentation/eraseOutsideBoundingBox.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./util/segmentation/eraseIfSegmentIndex.js");function f(d,l,o,t){for(var r=d.detail,s=l.pixelData,i=l.segmentIndex,u=r.image,c=u.width,h=u.height,g=0;g<c;g++)for(var v=0;v<o[1];v++)Object(a.default)(v*c+g,s,i);for(var m=0;m<o[0];m++)for(var E=o[1];E<t[1];E++)Object(a.default)(E*c+m,s,i);for(var T=t[0];T<c;T++)for(var O=o[1];O<t[1];O++)Object(a.default)(O*c+T,s,i);for(var M=0;M<c;M++)for(var P=t[1];P<h;P++)Object(a.default)(P*c+M,s,i)}},"./util/segmentation/eraseShape.js":function(W,n,e){e.r(n),e.d(n,"eraseInsideShape",function(){return r}),e.d(n,"eraseOutsideShape",function(){return s});var a=e("../node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(a),d=e("./util/segmentation/eraseOutsideBoundingBox.js"),l=e("./util/segmentation/isSameSegment.js"),o=e("./util/logger.js");Object(o.getLogger)("util:segmentation:operations:eraseOutsideCircle");function t(i,u,c,h,g){var v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"inside",m=i.detail.image.width,E=u.pixelData,T=u.segmentIndex,O=f()(h,2),M=O[0],P=O[1],C=f()(g,2),_=C[0],D=C[1];v==="outside"&&Object(d.default)(i,u,h,g);for(var I=M;I<_;I++)for(var y=P;y<D;y++){var R=y*m+I;Object(l.default)(R,E,T)&&c({x:I,y})&&(E[R]=0)}}function r(i,u,c,h,g){t(i,u,c,h,g,"inside")}function s(i,u,c,h,g){t(i,u,function(v){return!c(v)},h,g,"outside")}},"./util/segmentation/fillOutsideBoundingBox.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d,l,o){for(var t=d.pixelData,r=d.segmentIndex,s=f.detail.image,i=s.width,u=s.height,c=0;c<i;c++)for(var h=0;h<l[1];h++)t[h*i+c]=r;for(var g=0;g<l[0];g++)for(var v=l[1];v<o[1];v++)t[v*i+g]=r;for(var m=o[0];m<i;m++)for(var E=l[1];E<o[1];E++)t[E*i+m]=r;for(var T=0;T<i;T++)for(var O=o[1];O<u;O++)t[O*i+T]=r}},"./util/segmentation/fillShape.js":function(W,n,e){e.r(n),e.d(n,"fillInsideShape",function(){return r}),e.d(n,"fillOutsideShape",function(){return s});var a=e("../node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(a),d=e("./util/segmentation/fillOutsideBoundingBox.js"),l=e("./util/logger.js"),o=Object(l.getLogger)("util:segmentation:operations:helpers:fillShape");function t(i,u,c,h,g){var v=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"inside",m=u.pixelData,E=u.segmentIndex;if(m===void 0||E===void 0){o.error("fillInsideShape requires operationData to contain pixelData and segmentIndex");return}var T=i.detail.image.width,O=f()(h,2),M=O[0],P=O[1],C=f()(g,2),_=C[0],D=C[1];v==="outside"&&Object(d.default)(i,u,h,g);for(var I=M;I<_;I++)for(var y=P;y<D;y++){var R=y*T+I;c({x:I,y})&&(m[R]=E)}}function r(i,u,c,h,g){t(i,u,c,h,g,"inside")}function s(i,u,c,h,g){t(i,u,function(v){return!c(v)},h,g,"outside")}},"./util/segmentation/floodFill.js":function(W,n,e){e.r(n);var a=e("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=e.n(a);n.default=function(t,r){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=s.onFlood||function(){},u=s.onBoundary||function(){},c=s.equals||d,h=s.diagonals||!1,g=R(r),v=z(),m=[],E=[],T={},O={};for(m.push({currentArgs:r});m.length>0;)M(m.pop());return{flooded:E,boundaries:B()};function M(p){var A=p.currentArgs,j=p.previousArgs;P(A)||(C(A),_(A)?(D(A),y(A)):I(j))}function P(p){return T[p]===!0}function C(p){T[p]=!0}function _(p){var A=b(R,[p]);return b(c,[A,g])}function D(p){E.push(p),i.apply(void 0,f()(p))}function I(p){O[p]=p,u.apply(void 0,f()(p))}function y(p){for(var A=0;A<v.length;A+=1){for(var j=v[A],x=p.slice(0),L=0;L<p.length;L+=1)x[L]+=j[L];m.push({currentArgs:x,previousArgs:p})}}function R(p){return t.apply(void 0,f()(p))}function b(p,A){try{return p.apply(void 0,f()(A))}catch{return}}function z(){var p=H(r.length);return p.filter(function(A){var j=l(A);return j!==0&&(j===1||h)})}function H(p){for(var A=[],j=function(S){return S.split("").map(function(w){return parseInt(w,10)-1})},x=0;x<Math.pow(3,p);x+=1){var L=o(x.toString(3),"0",p);A.push(j(L))}return A}function B(){var p=[];for(var A in O)O.hasOwnProperty(A)&&p.unshift(O[A]);return p}};function d(t,r){return t===r}function l(t){for(var r=0,s=0;s<t.length;s+=1)t[s]!==0&&(r+=1);return r}function o(t,r,s){var i=new Array(s+1),u=i.join(r);return(u+t).slice(-s)}},"./util/segmentation/getBoundingBoxAroundCircle.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return f});var a=e("./util/getCircleCoords.js");function f(d){var l=d.detail.handles,o=d.detail.image,t=o.width,r=o.height,s=Object(a.default)(l.start,l.end),i=s.width+s.left,u=s.left,c=s.top+s.height,h=s.top;return u=Math.floor(u),h=Math.floor(h),i=Math.floor(i),c=Math.floor(c),i=Math.min(t,i),u=Math.max(0,u),c=Math.min(r,c),h=Math.max(0,h),[[u,h],[i,c]]}},"./util/segmentation/getBoundingBoxAroundPolygon.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d){var l=1/0,o=0,t=1/0,r=0,s=d.width,i=d.height;return f.forEach(function(u){l=Math.min(u[0],l),o=Math.max(u[0],o),t=Math.min(u[1],t),r=Math.max(u[1],r)}),l=Math.floor(l),t=Math.floor(t),o=Math.floor(o),r=Math.floor(r),o=Math.min(s,o),l=Math.max(0,l),r=Math.min(i,r),t=Math.max(0,t),[[l,t],[o,r]]}},"./util/segmentation/getCircle.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d,l){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,t=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,r=Math.floor(o),s=Math.floor(t);if(f===1)return[[r,s]];for(var i=[],u=0,c=-f;c<=f;c++){var h=s+c;if(!(h>d||h<0))for(var g=-f;g<=f;g++){var v=r+g;v>=l||v<0||g*g+c*c<f*f&&(i[u++]=[r+g,s+c])}}return i}},"./util/segmentation/getDiffBetweenPixelData.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d){for(var l=[],o=0;o<f.length;o++)f[o]!==d[o]&&l.push([o,f[o],d[o]]);return l}},"./util/segmentation/getPixelPathBetweenPixels.js":function(W,n,e){e.r(n);var a=e("./externalModules.js"),f=1/Math.sqrt(2),d={up:{x:0,y:1},upRight:{x:f,y:f},right:{x:1,y:0},downRight:{x:f,y:-f},down:{x:0,y:1},downLeft:{x:-f,y:-f},left:{x:-1,y:0},upLeft:{x:-f,y:f}};n.default=function(c,h){for(var g={x:c.x,y:c.y},v=[];h.x!==g.x||h.y!==g.y;)h.x===g.x?h.y>g.y?g.y++:g.y--:h.y===g.y?h.x>g.x?g.x++:g.x--:h.y>g.y?h.x>g.x?l(g,h):o(g,h):h.x>g.x?t(g,h):r(g,h),v.push({x:g.x,y:g.y});return v.pop(),v};function l(c,h){var g=s(c,h),v=[i(g,d.up),i(g,d.right),i(g,d.upRight)],m=u(v);switch(m){case 0:c.y++;break;case 1:c.x++;break;case 2:c.y++,c.x++}}function o(c,h){var g=s(c,h),v=[i(g,d.up),i(g,d.left),i(g,d.upLeft)],m=u(v);switch(m){case 0:c.y++;break;case 1:c.x--;break;case 2:c.y++,c.x--}}function t(c,h){var g=s(c,h),v=[i(g,d.down),i(g,d.right),i(g,d.downRight)],m=u(v);switch(m){case 0:c.y--;break;case 1:c.x++;break;case 2:c.y--,c.x++}}function r(c,h){var g=s(c,h),v=[i(g,d.down),i(g,d.left),i(g,d.downLeft)],m=u(v);switch(m){case 0:c.y--;break;case 1:c.x--;break;case 2:c.y--,c.x--}}function s(c,h){var g=a.default.cornerstoneMath.point.distance(c,h);return{x:(h.x-c.x)/g,y:(h.y-c.y)/g}}function i(c,h){return c.x*h.x+c.y*h.y}function u(c){var h=c[0]>c[1]?0:1;return c[2]>c[h]&&(h=2),h}},"./util/segmentation/index.js":function(W,n,e){e.r(n);var a=e("./util/segmentation/drawBrush.js");e.d(n,"drawBrushPixels",function(){return a.drawBrushPixels});var f=e("./util/segmentation/eraseIfSegmentIndex.js");e.d(n,"eraseIfSegmentIndex",function(){return f.default});var d=e("./util/segmentation/eraseOutsideBoundingBox.js");e.d(n,"eraseOutsideBoundingBox",function(){return d.default});var l=e("./util/segmentation/eraseShape.js");e.d(n,"eraseInsideShape",function(){return l.eraseInsideShape}),e.d(n,"eraseOutsideShape",function(){return l.eraseOutsideShape});var o=e("./util/segmentation/fillOutsideBoundingBox.js");e.d(n,"fillOutsideBoundingBox",function(){return o.default});var t=e("./util/segmentation/fillShape.js");e.d(n,"fillInsideShape",function(){return t.fillInsideShape}),e.d(n,"fillOutsideShape",function(){return t.fillOutsideShape});var r=e("./util/segmentation/floodFill.js");e.d(n,"floodFill",function(){return r.default});var s=e("./util/segmentation/getBoundingBoxAroundCircle.js");e.d(n,"getBoundingBoxAroundCircle",function(){return s.default});var i=e("./util/segmentation/getBoundingBoxAroundPolygon.js");e.d(n,"getBoundingBoxAroundPolygon",function(){return i.default});var u=e("./util/segmentation/getCircle.js");e.d(n,"getCircle",function(){return u.default});var c=e("./util/segmentation/getPixelPathBetweenPixels.js");e.d(n,"getPixelPathBetweenPixels",function(){return c.default});var h=e("./util/segmentation/isSameSegment.js");e.d(n,"isSameSegment",function(){return h.default});var g=e("./util/segmentation/triggerLabelmapModifiedEvent.js");e.d(n,"triggerLabelmapModifiedEvent",function(){return g.default});var v=e("./util/segmentation/getDiffBetweenPixelData.js");e.d(n,"getDiffBetweenPixelData",function(){return v.default})},"./util/segmentation/isSameSegment.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d,l){return d[f]===l}},"./util/segmentation/triggerLabelmapModifiedEvent.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return l});var a=e("./externalModules.js"),f=e("./events.js"),d=e("./store/index.js");function l(o,t){var r=Object(d.getModule)("segmentation"),s=r.getters;t=t===void 0?s.activeLabelmapIndex(o):t,a.default.cornerstone.triggerEvent(o,f.default.LABELMAP_MODIFIED,{labelmapIndex:t})}},"./util/setContextToDisplayFontSize.js":function(W,n,e){e.r(n);var a=e("./externalModules.js");n.default=function(f,d,l){var o=.1;a.default.cornerstone.setToPixelCoordinateSystem(f,d,o);var t=l/f.viewport.scale/o,r=l/f.viewport.scale/o;return{fontSize:t,lineHeight:r,fontScale:o}}},"./util/throttle.js":function(W,n,e){e.r(n);var a=e("./util/debounce.js"),f=e("./util/isObject.js");function d(l,o,t){var r=!0,s=!0;if(typeof l!="function")throw new TypeError("Expected a function");return Object(f.default)(t)&&(r="leading"in t?!!t.leading:r,s="trailing"in t?!!t.trailing:s),Object(a.default)(l,o,{leading:r,trailing:s,maxWait:o})}n.default=d},"./util/triggerEvent.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(f,d){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,o;return typeof window.CustomEvent=="function"?o=new CustomEvent(d,{detail:l,cancelable:!0}):(o=document.createEvent("CustomEvent"),o.initCustomEvent(d,!0,!0,l)),f.dispatchEvent(o)}},"./util/uuidv4.js":function(W,n,e){e.r(n),e.d(n,"default",function(){return a});function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var d=Math.random()*16|0,l=f==="x"?d:d&3|8;return l.toString(16)})}},"./util/wait.js":function(W,n,e){e.r(n),e.d(n,"wait",function(){return f}),e.d(n,"waitForEnabledElementImageToLoad",function(){return d});var a=e("./externalModules.js"),f=function(o){return new Promise(function(t){return setTimeout(t,o)})};function d(l){try{var o=a.default.cornerstone.getEnabledElement(l);return o.image?o:f(250).then(function(){return d(l)})}catch{return null}}n.default=f},"./util/zoom/changeViewportScale.js":function(W,n,e){e.r(n),n.default=function(a,f,d){var l=d.maxScale,o=d.minScale,t=1.7,r=Math.log(a.scale)/Math.log(t),s=r+f,i=Math.pow(t,s);return l&&i>l?a.scale=l:o&&i<o?a.scale=o:a.scale=i,a}},"./util/zoom/correctShift.js":function(W,n,e){e.r(n),n.default=function(a,f){var d=f.hflip,l=f.vflip,o=f.rotation;if(a.x*=d?-1:1,a.y*=l?-1:1,o!==0){var t=o*Math.PI/180,r=Math.cos(t),s=Math.sin(t),i=a.x*r-a.y*s,u=a.x*s+a.y*r;a.x=i,a.y=u}return a}},"./util/zoom/index.js":function(W,n,e){e.r(n);var a=e("./util/zoom/changeViewportScale.js");e.d(n,"changeViewportScale",function(){return a.default});var f=e("./util/zoom/correctShift.js");e.d(n,"correctShift",function(){return f.default}),n.default={changeViewportScale:a.default,correctShift:f.default}},"./version.js":function(W,n,e){e.r(n),n.default="6.0.10"}})})}(Nt)),Nt.exports}var Ye=Pn();const Dn=It(Ye),Cn=yt({__proto__:null,default:Dn},[Ye]);var _t={exports:{}};/*! cornerstone-nifti-image-loader - 1.0.0 - 2018-11-11 | (c) 2018 Flywheel Exchange, LLC | https://github.com/flywheel-io/cornerstone-nifti-image-loader */var _n=_t.exports,kt;function In(){return kt||(kt=1,function(et,ze){(function(n,e){et.exports=e()})(typeof self<"u"?self:_n,function(){return function(W){var n={};function e(a){if(n[a])return n[a].exports;var f=n[a]={i:a,l:!1,exports:{}};return W[a].call(f.exports,f,f.exports,e),f.l=!0,f.exports}return e.m=W,e.c=n,e.d=function(a,f,d){e.o(a,f)||Object.defineProperty(a,f,{configurable:!1,enumerable:!0,get:d})},e.n=function(a){var f=a&&a.__esModule?function(){return a.default}:function(){return a};return e.d(f,"a",f),f},e.o=function(a,f){return Object.prototype.hasOwnProperty.call(a,f)},e.p="",function(){if(!(typeof window>"u")){var a="webpack-livereload-plugin-script";if(!document.getElementById(a)){var f=document.createElement("script");f.id=a,f.async=!0,f.src="//"+location.hostname+":45001/livereload.js",document.getElementsByTagName("head")[0].appendChild(f)}}}(),e(e.s=41)}([function(W,n){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(e=window)}W.exports=e},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.external=void 0;var a=e(44),f=o(a),d=e(54),l=o(d);function o(i){return i&&i.__esModule?i:{default:i}}var t=window.cornerstone,r=f.default,s={set cornerstone(i){t=i,(0,l.default)(t)},get cornerstone(){return t},set niftiReader(i){r=i},get niftiReader(){return r}};n.external=s},function(W,n,e){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function f(o,t){return Object.prototype.hasOwnProperty.call(o,t)}n.assign=function(o){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(var s in r)f(r,s)&&(o[s]=r[s])}}return o},n.shrinkBuf=function(o,t){return o.length===t?o:o.subarray?o.subarray(0,t):(o.length=t,o)};var d={arraySet:function(o,t,r,s,i){if(t.subarray&&o.subarray){o.set(t.subarray(r,r+s),i);return}for(var u=0;u<s;u++)o[i+u]=t[r+u]},flattenChunks:function(o){var t,r,s,i,u,c;for(s=0,t=0,r=o.length;t<r;t++)s+=o[t].length;for(c=new Uint8Array(s),i=0,t=0,r=o.length;t<r;t++)u=o[t],c.set(u,i),i+=u.length;return c}},l={arraySet:function(o,t,r,s,i){for(var u=0;u<s;u++)o[i+u]=t[r+u]},flattenChunks:function(o){return[].concat.apply([],o)}};n.setTyped=function(o){o?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,d)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,l))},n.setTyped(a)},function(W,n){typeof Object.create=="function"?W.exports=function(a,f){a.super_=f,a.prototype=Object.create(f.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:W.exports=function(a,f){a.super_=f;var d=function(){};d.prototype=f.prototype,a.prototype=new d,a.prototype.constructor=a}},function(W,n){var e=W.exports={},a,f;function d(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?a=setTimeout:a=d}catch{a=d}try{typeof clearTimeout=="function"?f=clearTimeout:f=l}catch{f=l}})();function o(m){if(a===setTimeout)return setTimeout(m,0);if((a===d||!a)&&setTimeout)return a=setTimeout,setTimeout(m,0);try{return a(m,0)}catch{try{return a.call(null,m,0)}catch{return a.call(this,m,0)}}}function t(m){if(f===clearTimeout)return clearTimeout(m);if((f===l||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(m);try{return f(m)}catch{try{return f.call(null,m)}catch{return f.call(this,m)}}}var r=[],s=!1,i,u=-1;function c(){!s||!i||(s=!1,i.length?r=i.concat(r):u=-1,r.length&&h())}function h(){if(!s){var m=o(c);s=!0;for(var E=r.length;E;){for(i=r,r=[];++u<E;)i&&i[u].run();u=-1,E=r.length}i=null,s=!1,t(m)}}e.nextTick=function(m){var E=new Array(arguments.length-1);if(arguments.length>1)for(var T=1;T<arguments.length;T++)E[T-1]=arguments[T];r.push(new g(m,E)),r.length===1&&!s&&o(h)};function g(m,E){this.fun=m,this.array=E}g.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={};function v(){}e.on=v,e.addListener=v,e.once=v,e.off=v,e.removeListener=v,e.removeAllListeners=v,e.emit=v,e.prependListener=v,e.prependOnceListener=v,e.listeners=function(m){return[]},e.binding=function(m){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(m){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(W,n,e){var a=e(10),f=Object.keys||function(h){var g=[];for(var v in h)g.push(v);return g};W.exports=i;var d=e(7);d.inherits=e(3);var l=e(34),o=e(38);d.inherits(i,l);for(var t=f(o.prototype),r=0;r<t.length;r++){var s=t[r];i.prototype[s]||(i.prototype[s]=o.prototype[s])}function i(h){if(!(this instanceof i))return new i(h);l.call(this,h),o.call(this,h),h&&h.readable===!1&&(this.readable=!1),h&&h.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,h&&h.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",u)}function u(){this.allowHalfOpen||this._writableState.ended||a(c,this)}function c(h){h.end()}Object.defineProperty(i.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(h){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=h,this._writableState.destroyed=h)}}),i.prototype._destroy=function(h,g){this.push(null),this.end(),a(g,h)}},function(W,n,e){(function(a){/*!
* The buffer module from node.js, for the browser.
*
* @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
* @license  MIT
*/var f=e(71),d=e(72),l=e(30);n.Buffer=s,n.SlowBuffer=O,n.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=a.TYPED_ARRAY_SUPPORT!==void 0?a.TYPED_ARRAY_SUPPORT:o(),n.kMaxLength=t();function o(){try{var X=new Uint8Array(1);return X.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},X.foo()===42&&typeof X.subarray=="function"&&X.subarray(1,1).byteLength===0}catch{return!1}}function t(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function r(X,N){if(t()<N)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(X=new Uint8Array(N),X.__proto__=s.prototype):(X===null&&(X=new s(N)),X.length=N),X}function s(X,N,F){if(!s.TYPED_ARRAY_SUPPORT&&!(this instanceof s))return new s(X,N,F);if(typeof X=="number"){if(typeof N=="string")throw new Error("If encoding is specified then the first argument must be a string");return h(this,X)}return i(this,X,N,F)}s.poolSize=8192,s._augment=function(X){return X.__proto__=s.prototype,X};function i(X,N,F,q){if(typeof N=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&N instanceof ArrayBuffer?m(X,N,F,q):typeof N=="string"?g(X,N,F):E(X,N)}s.from=function(X,N,F){return i(null,X,N,F)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0}));function u(X){if(typeof X!="number")throw new TypeError('"size" argument must be a number');if(X<0)throw new RangeError('"size" argument must not be negative')}function c(X,N,F,q){return u(N),N<=0?r(X,N):F!==void 0?typeof q=="string"?r(X,N).fill(F,q):r(X,N).fill(F):r(X,N)}s.alloc=function(X,N,F){return c(null,X,N,F)};function h(X,N){if(u(N),X=r(X,N<0?0:T(N)|0),!s.TYPED_ARRAY_SUPPORT)for(var F=0;F<N;++F)X[F]=0;return X}s.allocUnsafe=function(X){return h(null,X)},s.allocUnsafeSlow=function(X){return h(null,X)};function g(X,N,F){if((typeof F!="string"||F==="")&&(F="utf8"),!s.isEncoding(F))throw new TypeError('"encoding" must be a valid string encoding');var q=M(N,F)|0;X=r(X,q);var oe=X.write(N,F);return oe!==q&&(X=X.slice(0,oe)),X}function v(X,N){var F=N.length<0?0:T(N.length)|0;X=r(X,F);for(var q=0;q<F;q+=1)X[q]=N[q]&255;return X}function m(X,N,F,q){if(N.byteLength,F<0||N.byteLength<F)throw new RangeError("'offset' is out of bounds");if(N.byteLength<F+(q||0))throw new RangeError("'length' is out of bounds");return F===void 0&&q===void 0?N=new Uint8Array(N):q===void 0?N=new Uint8Array(N,F):N=new Uint8Array(N,F,q),s.TYPED_ARRAY_SUPPORT?(X=N,X.__proto__=s.prototype):X=v(X,N),X}function E(X,N){if(s.isBuffer(N)){var F=T(N.length)|0;return X=r(X,F),X.length===0||N.copy(X,0,0,F),X}if(N){if(typeof ArrayBuffer<"u"&&N.buffer instanceof ArrayBuffer||"length"in N)return typeof N.length!="number"||De(N.length)?r(X,0):v(X,N);if(N.type==="Buffer"&&l(N.data))return v(X,N.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function T(X){if(X>=t())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t().toString(16)+" bytes");return X|0}function O(X){return+X!=X&&(X=0),s.alloc(+X)}s.isBuffer=function(N){return!!(N!=null&&N._isBuffer)},s.compare=function(N,F){if(!s.isBuffer(N)||!s.isBuffer(F))throw new TypeError("Arguments must be Buffers");if(N===F)return 0;for(var q=N.length,oe=F.length,ie=0,he=Math.min(q,oe);ie<he;++ie)if(N[ie]!==F[ie]){q=N[ie],oe=F[ie];break}return q<oe?-1:oe<q?1:0},s.isEncoding=function(N){switch(String(N).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(N,F){if(!l(N))throw new TypeError('"list" argument must be an Array of Buffers');if(N.length===0)return s.alloc(0);var q;if(F===void 0)for(F=0,q=0;q<N.length;++q)F+=N[q].length;var oe=s.allocUnsafe(F),ie=0;for(q=0;q<N.length;++q){var he=N[q];if(!s.isBuffer(he))throw new TypeError('"list" argument must be an Array of Buffers');he.copy(oe,ie),ie+=he.length}return oe};function M(X,N){if(s.isBuffer(X))return X.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(X)||X instanceof ArrayBuffer))return X.byteLength;typeof X!="string"&&(X=""+X);var F=X.length;if(F===0)return 0;for(var q=!1;;)switch(N){case"ascii":case"latin1":case"binary":return F;case"utf8":case"utf-8":case void 0:return ne(X).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F*2;case"hex":return F>>>1;case"base64":return ve(X).length;default:if(q)return ne(X).length;N=(""+N).toLowerCase(),q=!0}}s.byteLength=M;function P(X,N,F){var q=!1;if((N===void 0||N<0)&&(N=0),N>this.length||((F===void 0||F>this.length)&&(F=this.length),F<=0)||(F>>>=0,N>>>=0,F<=N))return"";for(X||(X="utf8");;)switch(X){case"hex":return U(this,N,F);case"utf8":case"utf-8":return p(this,N,F);case"ascii":return x(this,N,F);case"latin1":case"binary":return L(this,N,F);case"base64":return B(this,N,F);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,N,F);default:if(q)throw new TypeError("Unknown encoding: "+X);X=(X+"").toLowerCase(),q=!0}}s.prototype._isBuffer=!0;function C(X,N,F){var q=X[N];X[N]=X[F],X[F]=q}s.prototype.swap16=function(){var N=this.length;if(N%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var F=0;F<N;F+=2)C(this,F,F+1);return this},s.prototype.swap32=function(){var N=this.length;if(N%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var F=0;F<N;F+=4)C(this,F,F+3),C(this,F+1,F+2);return this},s.prototype.swap64=function(){var N=this.length;if(N%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var F=0;F<N;F+=8)C(this,F,F+7),C(this,F+1,F+6),C(this,F+2,F+5),C(this,F+3,F+4);return this},s.prototype.toString=function(){var N=this.length|0;return N===0?"":arguments.length===0?p(this,0,N):P.apply(this,arguments)},s.prototype.equals=function(N){if(!s.isBuffer(N))throw new TypeError("Argument must be a Buffer");return this===N?!0:s.compare(this,N)===0},s.prototype.inspect=function(){var N="",F=n.INSPECT_MAX_BYTES;return this.length>0&&(N=this.toString("hex",0,F).match(/.{2}/g).join(" "),this.length>F&&(N+=" ... ")),"<Buffer "+N+">"},s.prototype.compare=function(N,F,q,oe,ie){if(!s.isBuffer(N))throw new TypeError("Argument must be a Buffer");if(F===void 0&&(F=0),q===void 0&&(q=N?N.length:0),oe===void 0&&(oe=0),ie===void 0&&(ie=this.length),F<0||q>N.length||oe<0||ie>this.length)throw new RangeError("out of range index");if(oe>=ie&&F>=q)return 0;if(oe>=ie)return-1;if(F>=q)return 1;if(F>>>=0,q>>>=0,oe>>>=0,ie>>>=0,this===N)return 0;for(var he=ie-oe,pe=q-F,ye=Math.min(he,pe),Se=this.slice(oe,ie),Re=N.slice(F,q),Be=0;Be<ye;++Be)if(Se[Be]!==Re[Be]){he=Se[Be],pe=Re[Be];break}return he<pe?-1:pe<he?1:0};function _(X,N,F,q,oe){if(X.length===0)return-1;if(typeof F=="string"?(q=F,F=0):F>2147483647?F=2147483647:F<-2147483648&&(F=-2147483648),F=+F,isNaN(F)&&(F=oe?0:X.length-1),F<0&&(F=X.length+F),F>=X.length){if(oe)return-1;F=X.length-1}else if(F<0)if(oe)F=0;else return-1;if(typeof N=="string"&&(N=s.from(N,q)),s.isBuffer(N))return N.length===0?-1:D(X,N,F,q,oe);if(typeof N=="number")return N=N&255,s.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?oe?Uint8Array.prototype.indexOf.call(X,N,F):Uint8Array.prototype.lastIndexOf.call(X,N,F):D(X,[N],F,q,oe);throw new TypeError("val must be string, number or Buffer")}function D(X,N,F,q,oe){var ie=1,he=X.length,pe=N.length;if(q!==void 0&&(q=String(q).toLowerCase(),q==="ucs2"||q==="ucs-2"||q==="utf16le"||q==="utf-16le")){if(X.length<2||N.length<2)return-1;ie=2,he/=2,pe/=2,F/=2}function ye(J,Pe){return ie===1?J[Pe]:J.readUInt16BE(Pe*ie)}var Se;if(oe){var Re=-1;for(Se=F;Se<he;Se++)if(ye(X,Se)===ye(N,Re===-1?0:Se-Re)){if(Re===-1&&(Re=Se),Se-Re+1===pe)return Re*ie}else Re!==-1&&(Se-=Se-Re),Re=-1}else for(F+pe>he&&(F=he-pe),Se=F;Se>=0;Se--){for(var Be=!0,Le=0;Le<pe;Le++)if(ye(X,Se+Le)!==ye(N,Le)){Be=!1;break}if(Be)return Se}return-1}s.prototype.includes=function(N,F,q){return this.indexOf(N,F,q)!==-1},s.prototype.indexOf=function(N,F,q){return _(this,N,F,q,!0)},s.prototype.lastIndexOf=function(N,F,q){return _(this,N,F,q,!1)};function I(X,N,F,q){F=Number(F)||0;var oe=X.length-F;q?(q=Number(q),q>oe&&(q=oe)):q=oe;var ie=N.length;if(ie%2!==0)throw new TypeError("Invalid hex string");q>ie/2&&(q=ie/2);for(var he=0;he<q;++he){var pe=parseInt(N.substr(he*2,2),16);if(isNaN(pe))return he;X[F+he]=pe}return he}function y(X,N,F,q){return Ee(ne(N,X.length-F),X,F,q)}function R(X,N,F,q){return Ee(ue(N),X,F,q)}function b(X,N,F,q){return R(X,N,F,q)}function z(X,N,F,q){return Ee(ve(N),X,F,q)}function H(X,N,F,q){return Ee(ge(N,X.length-F),X,F,q)}s.prototype.write=function(N,F,q,oe){if(F===void 0)oe="utf8",q=this.length,F=0;else if(q===void 0&&typeof F=="string")oe=F,q=this.length,F=0;else if(isFinite(F))F=F|0,isFinite(q)?(q=q|0,oe===void 0&&(oe="utf8")):(oe=q,q=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var ie=this.length-F;if((q===void 0||q>ie)&&(q=ie),N.length>0&&(q<0||F<0)||F>this.length)throw new RangeError("Attempt to write outside buffer bounds");oe||(oe="utf8");for(var he=!1;;)switch(oe){case"hex":return I(this,N,F,q);case"utf8":case"utf-8":return y(this,N,F,q);case"ascii":return R(this,N,F,q);case"latin1":case"binary":return b(this,N,F,q);case"base64":return z(this,N,F,q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,N,F,q);default:if(he)throw new TypeError("Unknown encoding: "+oe);oe=(""+oe).toLowerCase(),he=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function B(X,N,F){return N===0&&F===X.length?f.fromByteArray(X):f.fromByteArray(X.slice(N,F))}function p(X,N,F){F=Math.min(X.length,F);for(var q=[],oe=N;oe<F;){var ie=X[oe],he=null,pe=ie>239?4:ie>223?3:ie>191?2:1;if(oe+pe<=F){var ye,Se,Re,Be;switch(pe){case 1:ie<128&&(he=ie);break;case 2:ye=X[oe+1],(ye&192)===128&&(Be=(ie&31)<<6|ye&63,Be>127&&(he=Be));break;case 3:ye=X[oe+1],Se=X[oe+2],(ye&192)===128&&(Se&192)===128&&(Be=(ie&15)<<12|(ye&63)<<6|Se&63,Be>2047&&(Be<55296||Be>57343)&&(he=Be));break;case 4:ye=X[oe+1],Se=X[oe+2],Re=X[oe+3],(ye&192)===128&&(Se&192)===128&&(Re&192)===128&&(Be=(ie&15)<<18|(ye&63)<<12|(Se&63)<<6|Re&63,Be>65535&&Be<1114112&&(he=Be))}}he===null?(he=65533,pe=1):he>65535&&(he-=65536,q.push(he>>>10&1023|55296),he=56320|he&1023),q.push(he),oe+=pe}return j(q)}var A=4096;function j(X){var N=X.length;if(N<=A)return String.fromCharCode.apply(String,X);for(var F="",q=0;q<N;)F+=String.fromCharCode.apply(String,X.slice(q,q+=A));return F}function x(X,N,F){var q="";F=Math.min(X.length,F);for(var oe=N;oe<F;++oe)q+=String.fromCharCode(X[oe]&127);return q}function L(X,N,F){var q="";F=Math.min(X.length,F);for(var oe=N;oe<F;++oe)q+=String.fromCharCode(X[oe]);return q}function U(X,N,F){var q=X.length;(!N||N<0)&&(N=0),(!F||F<0||F>q)&&(F=q);for(var oe="",ie=N;ie<F;++ie)oe+=te(X[ie]);return oe}function S(X,N,F){for(var q=X.slice(N,F),oe="",ie=0;ie<q.length;ie+=2)oe+=String.fromCharCode(q[ie]+q[ie+1]*256);return oe}s.prototype.slice=function(N,F){var q=this.length;N=~~N,F=F===void 0?q:~~F,N<0?(N+=q,N<0&&(N=0)):N>q&&(N=q),F<0?(F+=q,F<0&&(F=0)):F>q&&(F=q),F<N&&(F=N);var oe;if(s.TYPED_ARRAY_SUPPORT)oe=this.subarray(N,F),oe.__proto__=s.prototype;else{var ie=F-N;oe=new s(ie,void 0);for(var he=0;he<ie;++he)oe[he]=this[he+N]}return oe};function w(X,N,F){if(X%1!==0||X<0)throw new RangeError("offset is not uint");if(X+N>F)throw new RangeError("Trying to access beyond buffer length")}s.prototype.readUIntLE=function(N,F,q){N=N|0,F=F|0,q||w(N,F,this.length);for(var oe=this[N],ie=1,he=0;++he<F&&(ie*=256);)oe+=this[N+he]*ie;return oe},s.prototype.readUIntBE=function(N,F,q){N=N|0,F=F|0,q||w(N,F,this.length);for(var oe=this[N+--F],ie=1;F>0&&(ie*=256);)oe+=this[N+--F]*ie;return oe},s.prototype.readUInt8=function(N,F){return F||w(N,1,this.length),this[N]},s.prototype.readUInt16LE=function(N,F){return F||w(N,2,this.length),this[N]|this[N+1]<<8},s.prototype.readUInt16BE=function(N,F){return F||w(N,2,this.length),this[N]<<8|this[N+1]},s.prototype.readUInt32LE=function(N,F){return F||w(N,4,this.length),(this[N]|this[N+1]<<8|this[N+2]<<16)+this[N+3]*16777216},s.prototype.readUInt32BE=function(N,F){return F||w(N,4,this.length),this[N]*16777216+(this[N+1]<<16|this[N+2]<<8|this[N+3])},s.prototype.readIntLE=function(N,F,q){N=N|0,F=F|0,q||w(N,F,this.length);for(var oe=this[N],ie=1,he=0;++he<F&&(ie*=256);)oe+=this[N+he]*ie;return ie*=128,oe>=ie&&(oe-=Math.pow(2,8*F)),oe},s.prototype.readIntBE=function(N,F,q){N=N|0,F=F|0,q||w(N,F,this.length);for(var oe=F,ie=1,he=this[N+--oe];oe>0&&(ie*=256);)he+=this[N+--oe]*ie;return ie*=128,he>=ie&&(he-=Math.pow(2,8*F)),he},s.prototype.readInt8=function(N,F){return F||w(N,1,this.length),this[N]&128?(255-this[N]+1)*-1:this[N]},s.prototype.readInt16LE=function(N,F){F||w(N,2,this.length);var q=this[N]|this[N+1]<<8;return q&32768?q|4294901760:q},s.prototype.readInt16BE=function(N,F){F||w(N,2,this.length);var q=this[N+1]|this[N]<<8;return q&32768?q|4294901760:q},s.prototype.readInt32LE=function(N,F){return F||w(N,4,this.length),this[N]|this[N+1]<<8|this[N+2]<<16|this[N+3]<<24},s.prototype.readInt32BE=function(N,F){return F||w(N,4,this.length),this[N]<<24|this[N+1]<<16|this[N+2]<<8|this[N+3]},s.prototype.readFloatLE=function(N,F){return F||w(N,4,this.length),d.read(this,N,!0,23,4)},s.prototype.readFloatBE=function(N,F){return F||w(N,4,this.length),d.read(this,N,!1,23,4)},s.prototype.readDoubleLE=function(N,F){return F||w(N,8,this.length),d.read(this,N,!0,52,8)},s.prototype.readDoubleBE=function(N,F){return F||w(N,8,this.length),d.read(this,N,!1,52,8)};function G(X,N,F,q,oe,ie){if(!s.isBuffer(X))throw new TypeError('"buffer" argument must be a Buffer instance');if(N>oe||N<ie)throw new RangeError('"value" argument is out of bounds');if(F+q>X.length)throw new RangeError("Index out of range")}s.prototype.writeUIntLE=function(N,F,q,oe){if(N=+N,F=F|0,q=q|0,!oe){var ie=Math.pow(2,8*q)-1;G(this,N,F,q,ie,0)}var he=1,pe=0;for(this[F]=N&255;++pe<q&&(he*=256);)this[F+pe]=N/he&255;return F+q},s.prototype.writeUIntBE=function(N,F,q,oe){if(N=+N,F=F|0,q=q|0,!oe){var ie=Math.pow(2,8*q)-1;G(this,N,F,q,ie,0)}var he=q-1,pe=1;for(this[F+he]=N&255;--he>=0&&(pe*=256);)this[F+he]=N/pe&255;return F+q},s.prototype.writeUInt8=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,1,255,0),s.TYPED_ARRAY_SUPPORT||(N=Math.floor(N)),this[F]=N&255,F+1};function $(X,N,F,q){N<0&&(N=65535+N+1);for(var oe=0,ie=Math.min(X.length-F,2);oe<ie;++oe)X[F+oe]=(N&255<<8*(q?oe:1-oe))>>>(q?oe:1-oe)*8}s.prototype.writeUInt16LE=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[F]=N&255,this[F+1]=N>>>8):$(this,N,F,!0),F+2},s.prototype.writeUInt16BE=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[F]=N>>>8,this[F+1]=N&255):$(this,N,F,!1),F+2};function Q(X,N,F,q){N<0&&(N=4294967295+N+1);for(var oe=0,ie=Math.min(X.length-F,4);oe<ie;++oe)X[F+oe]=N>>>(q?oe:3-oe)*8&255}s.prototype.writeUInt32LE=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[F+3]=N>>>24,this[F+2]=N>>>16,this[F+1]=N>>>8,this[F]=N&255):Q(this,N,F,!0),F+4},s.prototype.writeUInt32BE=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[F]=N>>>24,this[F+1]=N>>>16,this[F+2]=N>>>8,this[F+3]=N&255):Q(this,N,F,!1),F+4},s.prototype.writeIntLE=function(N,F,q,oe){if(N=+N,F=F|0,!oe){var ie=Math.pow(2,8*q-1);G(this,N,F,q,ie-1,-ie)}var he=0,pe=1,ye=0;for(this[F]=N&255;++he<q&&(pe*=256);)N<0&&ye===0&&this[F+he-1]!==0&&(ye=1),this[F+he]=(N/pe>>0)-ye&255;return F+q},s.prototype.writeIntBE=function(N,F,q,oe){if(N=+N,F=F|0,!oe){var ie=Math.pow(2,8*q-1);G(this,N,F,q,ie-1,-ie)}var he=q-1,pe=1,ye=0;for(this[F+he]=N&255;--he>=0&&(pe*=256);)N<0&&ye===0&&this[F+he+1]!==0&&(ye=1),this[F+he]=(N/pe>>0)-ye&255;return F+q},s.prototype.writeInt8=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,1,127,-128),s.TYPED_ARRAY_SUPPORT||(N=Math.floor(N)),N<0&&(N=255+N+1),this[F]=N&255,F+1},s.prototype.writeInt16LE=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[F]=N&255,this[F+1]=N>>>8):$(this,N,F,!0),F+2},s.prototype.writeInt16BE=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[F]=N>>>8,this[F+1]=N&255):$(this,N,F,!1),F+2},s.prototype.writeInt32LE=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[F]=N&255,this[F+1]=N>>>8,this[F+2]=N>>>16,this[F+3]=N>>>24):Q(this,N,F,!0),F+4},s.prototype.writeInt32BE=function(N,F,q){return N=+N,F=F|0,q||G(this,N,F,4,2147483647,-2147483648),N<0&&(N=4294967295+N+1),s.TYPED_ARRAY_SUPPORT?(this[F]=N>>>24,this[F+1]=N>>>16,this[F+2]=N>>>8,this[F+3]=N&255):Q(this,N,F,!1),F+4};function re(X,N,F,q,oe,ie){if(F+q>X.length)throw new RangeError("Index out of range");if(F<0)throw new RangeError("Index out of range")}function le(X,N,F,q,oe){return oe||re(X,N,F,4),d.write(X,N,F,q,23,4),F+4}s.prototype.writeFloatLE=function(N,F,q){return le(this,N,F,!0,q)},s.prototype.writeFloatBE=function(N,F,q){return le(this,N,F,!1,q)};function de(X,N,F,q,oe){return oe||re(X,N,F,8),d.write(X,N,F,q,52,8),F+8}s.prototype.writeDoubleLE=function(N,F,q){return de(this,N,F,!0,q)},s.prototype.writeDoubleBE=function(N,F,q){return de(this,N,F,!1,q)},s.prototype.copy=function(N,F,q,oe){if(q||(q=0),!oe&&oe!==0&&(oe=this.length),F>=N.length&&(F=N.length),F||(F=0),oe>0&&oe<q&&(oe=q),oe===q||N.length===0||this.length===0)return 0;if(F<0)throw new RangeError("targetStart out of bounds");if(q<0||q>=this.length)throw new RangeError("sourceStart out of bounds");if(oe<0)throw new RangeError("sourceEnd out of bounds");oe>this.length&&(oe=this.length),N.length-F<oe-q&&(oe=N.length-F+q);var ie=oe-q,he;if(this===N&&q<F&&F<oe)for(he=ie-1;he>=0;--he)N[he+F]=this[he+q];else if(ie<1e3||!s.TYPED_ARRAY_SUPPORT)for(he=0;he<ie;++he)N[he+F]=this[he+q];else Uint8Array.prototype.set.call(N,this.subarray(q,q+ie),F);return ie},s.prototype.fill=function(N,F,q,oe){if(typeof N=="string"){if(typeof F=="string"?(oe=F,F=0,q=this.length):typeof q=="string"&&(oe=q,q=this.length),N.length===1){var ie=N.charCodeAt(0);ie<256&&(N=ie)}if(oe!==void 0&&typeof oe!="string")throw new TypeError("encoding must be a string");if(typeof oe=="string"&&!s.isEncoding(oe))throw new TypeError("Unknown encoding: "+oe)}else typeof N=="number"&&(N=N&255);if(F<0||this.length<F||this.length<q)throw new RangeError("Out of range index");if(q<=F)return this;F=F>>>0,q=q===void 0?this.length:q>>>0,N||(N=0);var he;if(typeof N=="number")for(he=F;he<q;++he)this[he]=N;else{var pe=s.isBuffer(N)?N:ne(new s(N,oe).toString()),ye=pe.length;for(he=0;he<q-F;++he)this[he+F]=pe[he%ye]}return this};var me=/[^+\/0-9A-Za-z-_]/g;function Y(X){if(X=V(X).replace(me,""),X.length<2)return"";for(;X.length%4!==0;)X=X+"=";return X}function V(X){return X.trim?X.trim():X.replace(/^\s+|\s+$/g,"")}function te(X){return X<16?"0"+X.toString(16):X.toString(16)}function ne(X,N){N=N||1/0;for(var F,q=X.length,oe=null,ie=[],he=0;he<q;++he){if(F=X.charCodeAt(he),F>55295&&F<57344){if(!oe){if(F>56319){(N-=3)>-1&&ie.push(239,191,189);continue}else if(he+1===q){(N-=3)>-1&&ie.push(239,191,189);continue}oe=F;continue}if(F<56320){(N-=3)>-1&&ie.push(239,191,189),oe=F;continue}F=(oe-55296<<10|F-56320)+65536}else oe&&(N-=3)>-1&&ie.push(239,191,189);if(oe=null,F<128){if((N-=1)<0)break;ie.push(F)}else if(F<2048){if((N-=2)<0)break;ie.push(F>>6|192,F&63|128)}else if(F<65536){if((N-=3)<0)break;ie.push(F>>12|224,F>>6&63|128,F&63|128)}else if(F<1114112){if((N-=4)<0)break;ie.push(F>>18|240,F>>12&63|128,F>>6&63|128,F&63|128)}else throw new Error("Invalid code point")}return ie}function ue(X){for(var N=[],F=0;F<X.length;++F)N.push(X.charCodeAt(F)&255);return N}function ge(X,N){for(var F,q,oe,ie=[],he=0;he<X.length&&!((N-=2)<0);++he)F=X.charCodeAt(he),q=F>>8,oe=F%256,ie.push(oe),ie.push(q);return ie}function ve(X){return f.toByteArray(Y(X))}function Ee(X,N,F,q){for(var oe=0;oe<q&&!(oe+F>=N.length||oe>=X.length);++oe)N[oe+F]=X[oe];return oe}function De(X){return X!==X}}).call(n,e(0))},function(W,n,e){(function(a){function f(T){return Array.isArray?Array.isArray(T):E(T)==="[object Array]"}n.isArray=f;function d(T){return typeof T=="boolean"}n.isBoolean=d;function l(T){return T===null}n.isNull=l;function o(T){return T==null}n.isNullOrUndefined=o;function t(T){return typeof T=="number"}n.isNumber=t;function r(T){return typeof T=="string"}n.isString=r;function s(T){return typeof T=="symbol"}n.isSymbol=s;function i(T){return T===void 0}n.isUndefined=i;function u(T){return E(T)==="[object RegExp]"}n.isRegExp=u;function c(T){return typeof T=="object"&&T!==null}n.isObject=c;function h(T){return E(T)==="[object Date]"}n.isDate=h;function g(T){return E(T)==="[object Error]"||T instanceof Error}n.isError=g;function v(T){return typeof T=="function"}n.isFunction=v;function m(T){return T===null||typeof T=="boolean"||typeof T=="number"||typeof T=="string"||typeof T=="symbol"||typeof T>"u"}n.isPrimitive=m,n.isBuffer=a.isBuffer;function E(T){return Object.prototype.toString.call(T)}}).call(n,e(6).Buffer)},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function o(t,r){for(var s=0;s<r.length;s++){var i=r[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,r,s){return r&&o(t.prototype,r),s&&o(t,s),t}}();function f(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}var d=function(){function o(t,r,s){var i=r.dimension,u=r.index;f(this,o),this.filePath=t,this.slice={dimension:i,index:u},this.timePoint=s}return a(o,[{key:"url",get:function(){var r="nifti:"+this.filePath;return(l(this.slice.dimension)||l(this.slice.index))&&(r+="#"),l(this.slice.dimension)&&(r+=this.slice.dimension,l(this.slice.index)&&(r+="-")),l(this.slice.index)&&(r+=this.slice.index),l(this.timePoint)&&(r+=",t-"+this.timePoint),r}}],[{key:"fromURL",value:function(r){var s=/^nifti:([^#]+)(?:#(?:(?=[xyz])(?:([xyz])(?:(?=-[\d]+)-([\d]+))?(?:,t-(\d+))?)|(?![xyz])([\d]+)))?$/,i=s.exec(r);if(!i)throw new Error("Not in a valid imageId format: "+r);var u=i&&i[1],c=i&&i[2]||"z",h=i&&parseInt(i[3]||i[5],0)||0,g=i&&i[4]&&parseInt(i[4],0)||0;return new o(u,{dimension:c,index:h},g)}}]),o}();n.default=d;function l(o){return typeof o<"u"}},function(W,n,e){var a=e(61),f=e(62),d=typeof Float64Array<"u";function l(u,c){return u[0]-c[0]}function o(){var u=this.stride,c=new Array(u.length),h;for(h=0;h<c.length;++h)c[h]=[Math.abs(u[h]),h];c.sort(l);var g=new Array(c.length);for(h=0;h<g.length;++h)g[h]=c[h][1];return g}function t(u,c){var h=["View",c,"d",u].join("");c<0&&(h="View_Nil"+u);var g=u==="generic";if(c===-1){var v="function "+h+"(a){this.data=a;};var proto="+h+".prototype;proto.dtype='"+u+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+h+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+h+"(a){return new "+h+"(a);}",y=new Function(v);return y()}else if(c===0){var v="function "+h+"(a,d) {this.data = a;this.offset = d};var proto="+h+".prototype;proto.dtype='"+u+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+h+"_copy() {return new "+h+"(this.data,this.offset)};proto.pick=function "+h+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+h+"_get(){return "+(g?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+h+"_set(v){return "+(g?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+h+"(a,b,c,d){return new "+h+"(a,d)}",y=new Function("TrivialArray",v);return y(s[u][0])}var v=["'use strict'"],m=a(c),E=m.map(function(R){return"i"+R}),T="this.offset+"+m.map(function(R){return"this.stride["+R+"]*i"+R}).join("+"),O=m.map(function(R){return"b"+R}).join(","),M=m.map(function(R){return"c"+R}).join(",");v.push("function "+h+"(a,"+O+","+M+",d){this.data=a","this.shape=["+O+"]","this.stride=["+M+"]","this.offset=d|0}","var proto="+h+".prototype","proto.dtype='"+u+"'","proto.dimension="+c),v.push("Object.defineProperty(proto,'size',{get:function "+h+"_size(){return "+m.map(function(R){return"this.shape["+R+"]"}).join("*"),"}})"),c===1?v.push("proto.order=[0]"):(v.push("Object.defineProperty(proto,'order',{get:"),c<4?(v.push("function "+h+"_order(){"),c===2?v.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):c===3&&v.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):v.push("ORDER})")),v.push("proto.set=function "+h+"_set("+E.join(",")+",v){"),g?v.push("return this.data.set("+T+",v)}"):v.push("return this.data["+T+"]=v}"),v.push("proto.get=function "+h+"_get("+E.join(",")+"){"),g?v.push("return this.data.get("+T+")}"):v.push("return this.data["+T+"]}"),v.push("proto.index=function "+h+"_index(",E.join(),"){return "+T+"}"),v.push("proto.hi=function "+h+"_hi("+E.join(",")+"){return new "+h+"(this.data,"+m.map(function(R){return["(typeof i",R,"!=='number'||i",R,"<0)?this.shape[",R,"]:i",R,"|0"].join("")}).join(",")+","+m.map(function(R){return"this.stride["+R+"]"}).join(",")+",this.offset)}");var P=m.map(function(R){return"a"+R+"=this.shape["+R+"]"}),C=m.map(function(R){return"c"+R+"=this.stride["+R+"]"});v.push("proto.lo=function "+h+"_lo("+E.join(",")+"){var b=this.offset,d=0,"+P.join(",")+","+C.join(","));for(var _=0;_<c;++_)v.push("if(typeof i"+_+"==='number'&&i"+_+">=0){d=i"+_+"|0;b+=c"+_+"*d;a"+_+"-=d}");v.push("return new "+h+"(this.data,"+m.map(function(R){return"a"+R}).join(",")+","+m.map(function(R){return"c"+R}).join(",")+",b)}"),v.push("proto.step=function "+h+"_step("+E.join(",")+"){var "+m.map(function(R){return"a"+R+"=this.shape["+R+"]"}).join(",")+","+m.map(function(R){return"b"+R+"=this.stride["+R+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var _=0;_<c;++_)v.push("if(typeof i"+_+"==='number'){d=i"+_+"|0;if(d<0){c+=b"+_+"*(a"+_+"-1);a"+_+"=ceil(-a"+_+"/d)}else{a"+_+"=ceil(a"+_+"/d)}b"+_+"*=d}");v.push("return new "+h+"(this.data,"+m.map(function(R){return"a"+R}).join(",")+","+m.map(function(R){return"b"+R}).join(",")+",c)}");for(var D=new Array(c),I=new Array(c),_=0;_<c;++_)D[_]="a[i"+_+"]",I[_]="b[i"+_+"]";v.push("proto.transpose=function "+h+"_transpose("+E+"){"+E.map(function(R,b){return R+"=("+R+"===undefined?"+b+":"+R+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+h+"(this.data,"+D.join(",")+","+I.join(",")+",this.offset)}"),v.push("proto.pick=function "+h+"_pick("+E+"){var a=[],b=[],c=this.offset");for(var _=0;_<c;++_)v.push("if(typeof i"+_+"==='number'&&i"+_+">=0){c=(c+this.stride["+_+"]*i"+_+")|0}else{a.push(this.shape["+_+"]);b.push(this.stride["+_+"])}");v.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),v.push("return function construct_"+h+"(data,shape,stride,offset){return new "+h+"(data,"+m.map(function(R){return"shape["+R+"]"}).join(",")+","+m.map(function(R){return"stride["+R+"]"}).join(",")+",offset)}");var y=new Function("CTOR_LIST","ORDER",v.join(`
`));return y(s[u],o)}function r(u){if(f(u))return"buffer";if(d)switch(Object.prototype.toString.call(u)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(u)?"array":"generic"}var s={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};function i(u,c,h,g){if(u===void 0){var M=s.array[0];return M([])}else typeof u=="number"&&(u=[u]);c===void 0&&(c=[u.length]);var v=c.length;if(h===void 0){h=new Array(v);for(var m=v-1,E=1;m>=0;--m)h[m]=E,E*=c[m]}if(g===void 0){g=0;for(var m=0;m<v;++m)h[m]<0&&(g-=(c[m]-1)*h[m])}for(var T=r(u),O=s[T];O.length<=v+1;)O.push(t(T,O.length-1));var M=O[v+1];return M(u,c,h,g)}W.exports=i},function(W,n,e){(function(a){!a.version||a.version.indexOf("v0.")===0||a.version.indexOf("v1.")===0&&a.version.indexOf("v1.8.")!==0?W.exports=f:W.exports=a.nextTick;function f(d,l,o,t){if(typeof d!="function")throw new TypeError('"callback" argument must be a function');var r=arguments.length,s,i;switch(r){case 0:case 1:return a.nextTick(d);case 2:return a.nextTick(function(){d.call(null,l)});case 3:return a.nextTick(function(){d.call(null,l,o)});case 4:return a.nextTick(function(){d.call(null,l,o,t)});default:for(s=new Array(r-1),i=0;i<s.length;)s[i++]=arguments[i];return a.nextTick(function(){d.apply(null,s)})}}}).call(n,e(4))},function(W,n,e){var a=e(6),f=a.Buffer;function d(o,t){for(var r in o)t[r]=o[r]}f.from&&f.alloc&&f.allocUnsafe&&f.allocUnsafeSlow?W.exports=a:(d(a,n),n.Buffer=l);function l(o,t,r){return f(o,t,r)}d(f,l),l.from=function(o,t,r){if(typeof o=="number")throw new TypeError("Argument must not be a number");return f(o,t,r)},l.alloc=function(o,t,r){if(typeof o!="number")throw new TypeError("Argument must be a number");var s=f(o);return t!==void 0?typeof r=="string"?s.fill(t,r):s.fill(t):s.fill(0),s},l.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return f(o)},l.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return a.SlowBuffer(o)}},function(W,n,e){var a=a||{};a.Utils=a.Utils||{},a.Utils.crcTable=null,a.Utils.GUNZIP_MAGIC_COOKIE1=31,a.Utils.GUNZIP_MAGIC_COOKIE2=139,a.Utils.getStringAt=function(d,l,o){var t="",r,s;for(r=l;r<o;r+=1)s=d.getUint8(r),s!==0&&(t+=String.fromCharCode(s));return t},a.Utils.getByteAt=function(d,l){return d.getInt8(l)},a.Utils.getShortAt=function(d,l,o){return d.getInt16(l,o)},a.Utils.getIntAt=function(d,l,o){return d.getInt32(l,o)},a.Utils.getFloatAt=function(d,l,o){return d.getFloat32(l,o)},a.Utils.getDoubleAt=function(d,l,o){return d.getFloat64(l,o)},a.Utils.getLongAt=function(d,l,o){var t,r=[],s=0;for(t=0;t<8;t+=1)r[t]=a.Utils.getByteAt(d,l+t,o);for(t=r.length-1;t>=0;t--)s=s*256+r[t];return s},a.Utils.toArrayBuffer=function(d){var l,o,t;for(l=new ArrayBuffer(d.length),o=new Uint8Array(l),t=0;t<d.length;t+=1)o[t]=d[t];return l},a.Utils.isString=function(d){return typeof d=="string"||d instanceof String},a.Utils.formatNumber=function(d,l){var o=0;return a.Utils.isString(d)?o=Number(d):o=d,l?o=o.toPrecision(5):o=o.toPrecision(7),parseFloat(o)},a.Utils.makeCRCTable=function(){for(var d,l=[],o=0;o<256;o++){d=o;for(var t=0;t<8;t++)d=d&1?3988292384^d>>>1:d>>>1;l[o]=d}return l},a.Utils.crc32=function(d){for(var l=a.Utils.crcTable||(a.Utils.crcTable=a.Utils.makeCRCTable()),o=-1,t=0;t<d.byteLength;t++)o=o>>>8^l[(o^d.getUint8(t))&255];return(o^-1)>>>0};var f=typeof W;f!=="undefined"&&W.exports&&(W.exports=a.Utils)},function(W,n,e){W.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=e(1);function f(d){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o={detail:l},t=new CustomEvent(d,o);a.external.cornerstone.events.dispatchEvent(t)}n.default={imageLoadProgress:function(l){return f("cornerstoneimageloadprogress",l)},imageLoadStart:function(l){return f("cornerstoneimageloadstart",l)},imageLoadEnd:function(l){return f("cornerstoneimageloadend",l)}}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.parseNiftiHeader=t,n.parseNiftiFile=r;var a=e(1),f=e(65),d=l(f);function l(v){return v&&v.__esModule?v:{default:v}}function o(v,m,E){return m in v?Object.defineProperty(v,m,{value:E,enumerable:!0,configurable:!0,writable:!0}):v[m]=E,v}function t(v){var m=a.external.niftiReader,E=m.readHeader(v);s(m,E);var T=E.scl_inter,O=E.scl_slope===0?1:E.scl_slope,M=E.cal_max-E.cal_min,P=M===0,C=P?void 0:E.cal_min,_=P?void 0:E.cal_max,D=E.dims.slice(1,4),I=E.dims[0]>3?E.dims[4]:1,y={TypedArrayConstructor:u(m,E.datatypeCode),samplesPerPixel:g(E.dims),isDataInFloat:c(m,E.datatypeCode),isDataInColors:h(m,E.dims,E.datatypeCode)},R=E.pixDims.slice(1,4),b=i(E),z=E.convertNiftiSFormToNEMA(b);return{slope:O,intercept:T,windowMinimumValue:C,windowMaximumValue:_,isWindowInfoAbsent:P,voxelLength:D,timeSlices:I,dataType:y,pixelSpacing:R,orientationMatrix:b,orientationString:z,header:E}}function r(v,m){var E=a.external.niftiReader;m||(m=t(v));var T=m.dataType.TypedArrayConstructor,O=E.readImage(m.header,v),M=new T(O);return m.header.littleEndian||(M=(0,d.default)(m.header.datatypeCode,M)),{metaData:m,imageData:M}}function s(v,m){var E=7,T=void 0;switch(m.xyzt_units&E){case v.NIFTI1.UNITS_METER:T=1e3;break;case v.NIFTI1.UNITS_MICRON:T=1/1e3;break;case v.NIFTI1.UNITS_MM:default:T=1;break}m.pixDims=m.pixDims.map(function(O,M){return M>0&&M<=m.dims[0]?O*T:O}),m.affine&&(m.affine=m.affine.map(function(O){return O.map(function(M){return M*T})})),(m.quatern_b||m.quatern_c||m.quatern_d)&&(m.quatern_b*=T,m.quatern_c*=T,m.quatern_d*=T),(m.qoffset_x||m.qoffset_y||m.qoffset_z)&&(m.qoffset_x*=T,m.qoffset_y*=T,m.qoffset_z*=T)}function i(v){if(v.affine&&v.sform_code>0)return v.affine;if(v.qform_code>0)return v.convertNiftiQFormToNiftiSForm(v.quatern_b,v.quatern_c,v.quatern_d,v.qoffset_x,v.qoffset_y,v.qoffset_z,v.pixDims[1],v.pixDims[2],v.pixDims[3],v.pixDims[0]);var m={x:v.pixDims[1],y:v.pixDims[2],z:v.pixDims[3]},E={x:-(m.x*v.dims[1])/2,y:-(m.y*v.dims[2])/2,z:-(m.z*v.dims[3])/2};return[[m.x,0,0,E.x],[0,m.y,0,E.y],[0,0,m.z,E.z],[0,0,0,1]]}function u(v,m){var E,T=(E={},o(E,v.NIFTI1.TYPE_UINT8,Uint8Array),o(E,v.NIFTI1.TYPE_UINT16,Uint16Array),o(E,v.NIFTI1.TYPE_UINT32,Uint32Array),o(E,v.NIFTI1.TYPE_INT8,Int8Array),o(E,v.NIFTI1.TYPE_INT16,Int16Array),o(E,v.NIFTI1.TYPE_INT32,Int32Array),o(E,v.NIFTI1.TYPE_FLOAT32,Float32Array),o(E,v.NIFTI1.TYPE_FLOAT64,Float64Array),o(E,v.NIFTI1.TYPE_RGB,Uint8Array),o(E,v.NIFTI1.TYPE_RGBA,Uint8Array),E);return T[m]}function c(v,m){var E,T=(E={},o(E,v.NIFTI1.TYPE_UINT8,!1),o(E,v.NIFTI1.TYPE_UINT16,!1),o(E,v.NIFTI1.TYPE_UINT32,!1),o(E,v.NIFTI1.TYPE_INT8,!1),o(E,v.NIFTI1.TYPE_INT16,!1),o(E,v.NIFTI1.TYPE_INT32,!1),o(E,v.NIFTI1.TYPE_FLOAT32,!0),o(E,v.NIFTI1.TYPE_FLOAT64,!0),o(E,v.NIFTI1.TYPE_RGB,!1),o(E,v.NIFTI1.TYPE_RGBA,!1),E);return T[m]}function h(v,m,E){var T,O=g(m),M=(T={},o(T,v.NIFTI1.TYPE_UINT8,!1),o(T,v.NIFTI1.TYPE_UINT16,!1),o(T,v.NIFTI1.TYPE_UINT32,!1),o(T,v.NIFTI1.TYPE_INT8,!1),o(T,v.NIFTI1.TYPE_INT16,!1),o(T,v.NIFTI1.TYPE_INT32,!1),o(T,v.NIFTI1.TYPE_FLOAT32,!1),o(T,v.NIFTI1.TYPE_FLOAT64,!1),o(T,v.NIFTI1.TYPE_RGB,O===3),o(T,v.NIFTI1.TYPE_RGBA,O===4),T);return M[E]}function g(v){return v[0]>=5?v[5]:1}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=e(17),f=v(a),d=e(42),l=e(55),o=v(l),t=e(66),r=v(t),s=e(8),i=v(s),u=e(89),c=v(u),h=e(14),g=v(h);function v(T){return T&&T.__esModule?T:{default:T}}var m={headers:{}},E={loadImage:function(O){var M=void 0;try{var P=i.default.fromURL(O),C=o.default.getInstance(m.headers);g.default.imageLoadStart(P),M=C.acquire(P).then(function(_){return _.slice(P)}).then(function(_){return f.default.add(P.url,_.compoundMetaData),g.default.imageLoadEnd(P),_.cornerstoneImageObject})}catch(_){M=Promise.reject(_)}return M=(0,c.default)(M),M.promise=M,M},loadVolumeTimepoint:function(O){var M=void 0;try{var P=i.default.fromURL(O),C=r.default.getInstance(m.headers);g.default.imageLoadStart(P),M=C.acquireTimepoint(P).then(function(_){return _.slice(P)}).then(function(_){return f.default.add(P.url,_.compoundMetaData),g.default.imageLoadEnd(P),_.cornerstoneImageObject})}catch(_){M=Promise.reject(_)}return M=(0,c.default)(M),M.promise=M,M},loadHeader:function(O){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,P=void 0;try{var C=i.default.fromURL(O),_=r.default.getInstance(m.headers);P=_.acquireHeaderOnly(C,M).then(function(D){return D.slice(C)}).then(function(D){return f.default.add(C.url,D.compoundMetaData),D.compoundMetaData})}catch(D){P=Promise.reject(D)}return P=(0,c.default)(P),P.promise=P,P},ImageId:i.default,streamingMode:!1,cornerstoneLoader:function(O){return this.streamingMode?this.loadVolumeTimepoint(O):this.loadImage(O)},register:function(O){var M=this;O.registerImageLoader("nifti",function(P){return M.cornerstoneLoader(P,M)}),O.metaData.addProvider(d.metaDataProvider)},configure:function(O){Object.assign(m,O)}};n.default=E},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=[];function f(t,r){a[t]=r}function d(t){return a[t]}function l(t){a[t]=void 0}function o(){a=[]}n.default={add:f,get:d,remove:l,purge:o}},function(W,n,e){var a=a||{};a.Utils=a.Utils||e(12),a.NIFTI1=a.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},a.NIFTI1.TYPE_NONE=0,a.NIFTI1.TYPE_BINARY=1,a.NIFTI1.TYPE_UINT8=2,a.NIFTI1.TYPE_INT16=4,a.NIFTI1.TYPE_INT32=8,a.NIFTI1.TYPE_FLOAT32=16,a.NIFTI1.TYPE_COMPLEX64=32,a.NIFTI1.TYPE_FLOAT64=64,a.NIFTI1.TYPE_RGB24=128,a.NIFTI1.TYPE_INT8=256,a.NIFTI1.TYPE_UINT16=512,a.NIFTI1.TYPE_UINT32=768,a.NIFTI1.TYPE_INT64=1024,a.NIFTI1.TYPE_UINT64=1280,a.NIFTI1.TYPE_FLOAT128=1536,a.NIFTI1.TYPE_COMPLEX128=1792,a.NIFTI1.TYPE_COMPLEX256=2048,a.NIFTI1.XFORM_UNKNOWN=0,a.NIFTI1.XFORM_SCANNER_ANAT=1,a.NIFTI1.XFORM_ALIGNED_ANAT=2,a.NIFTI1.XFORM_TALAIRACH=3,a.NIFTI1.XFORM_MNI_152=4,a.NIFTI1.SPATIAL_UNITS_MASK=7,a.NIFTI1.TEMPORAL_UNITS_MASK=56,a.NIFTI1.UNITS_UNKNOWN=0,a.NIFTI1.UNITS_METER=1,a.NIFTI1.UNITS_MM=2,a.NIFTI1.UNITS_MICRON=3,a.NIFTI1.UNITS_SEC=8,a.NIFTI1.UNITS_MSEC=16,a.NIFTI1.UNITS_USEC=24,a.NIFTI1.UNITS_HZ=32,a.NIFTI1.UNITS_PPM=40,a.NIFTI1.UNITS_RADS=48,a.NIFTI1.MAGIC_COOKIE=348,a.NIFTI1.STANDARD_HEADER_SIZE=348,a.NIFTI1.MAGIC_NUMBER_LOCATION=344,a.NIFTI1.MAGIC_NUMBER=[110,43,49],a.NIFTI1.MAGIC_NUMBER2=[110,105,49],a.NIFTI1.EXTENSION_HEADER_SIZE=8,a.NIFTI1.prototype.readHeader=function(d){var l=new DataView(d),o=a.Utils.getIntAt(l,0,this.littleEndian),t,r,s,i;if(o!==a.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,o=a.Utils.getIntAt(l,0,this.littleEndian)),o!==a.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=a.Utils.getByteAt(l,39),t=0;t<8;t+=1)i=40+t*2,this.dims[t]=a.Utils.getShortAt(l,i,this.littleEndian);for(this.intent_p1=a.Utils.getFloatAt(l,56,this.littleEndian),this.intent_p2=a.Utils.getFloatAt(l,60,this.littleEndian),this.intent_p3=a.Utils.getFloatAt(l,64,this.littleEndian),this.intent_code=a.Utils.getShortAt(l,68,this.littleEndian),this.datatypeCode=a.Utils.getShortAt(l,70,this.littleEndian),this.numBitsPerVoxel=a.Utils.getShortAt(l,72,this.littleEndian),this.slice_start=a.Utils.getShortAt(l,74,this.littleEndian),t=0;t<8;t+=1)i=76+t*4,this.pixDims[t]=a.Utils.getFloatAt(l,i,this.littleEndian);for(this.vox_offset=a.Utils.getFloatAt(l,108,this.littleEndian),this.scl_slope=a.Utils.getFloatAt(l,112,this.littleEndian),this.scl_inter=a.Utils.getFloatAt(l,116,this.littleEndian),this.slice_end=a.Utils.getShortAt(l,120,this.littleEndian),this.slice_code=a.Utils.getByteAt(l,122),this.xyzt_units=a.Utils.getByteAt(l,123),this.cal_max=a.Utils.getFloatAt(l,124,this.littleEndian),this.cal_min=a.Utils.getFloatAt(l,128,this.littleEndian),this.slice_duration=a.Utils.getFloatAt(l,132,this.littleEndian),this.toffset=a.Utils.getFloatAt(l,136,this.littleEndian),this.description=a.Utils.getStringAt(l,148,228),this.aux_file=a.Utils.getStringAt(l,228,252),this.qform_code=a.Utils.getShortAt(l,252,this.littleEndian),this.sform_code=a.Utils.getShortAt(l,254,this.littleEndian),this.quatern_b=a.Utils.getFloatAt(l,256,this.littleEndian),this.quatern_c=a.Utils.getFloatAt(l,260,this.littleEndian),this.quatern_d=a.Utils.getFloatAt(l,264,this.littleEndian),this.qoffset_x=a.Utils.getFloatAt(l,268,this.littleEndian),this.qoffset_y=a.Utils.getFloatAt(l,272,this.littleEndian),this.qoffset_z=a.Utils.getFloatAt(l,276,this.littleEndian),r=0;r<3;r+=1)for(s=0;s<4;s+=1)i=280+(r*4+s)*4,this.affine[r][s]=a.Utils.getFloatAt(l,i,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=a.Utils.getStringAt(l,328,344),this.magic=a.Utils.getStringAt(l,344,348),this.isHDR=this.magic===a.NIFTI1.MAGIC_NUMBER2,l.byteLength>a.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=a.Utils.getByteAt(l,348),this.extensionFlag[1]=a.Utils.getByteAt(l,349),this.extensionFlag[2]=a.Utils.getByteAt(l,350),this.extensionFlag[3]=a.Utils.getByteAt(l,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(l),this.extensionCode=this.getExtensionCode(l)))},a.NIFTI1.prototype.toFormattedString=function(){var d=a.Utils.formatNumber,l="";return l+="Dim Info = "+this.dim_info+`
`,l+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+`
`,l+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+`
`,l+="Intent Code = "+this.intent_code+`
`,l+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+`)
`,l+="Bits Per Voxel = "+this.numBitsPerVoxel+`
`,l+="Slice Start = "+this.slice_start+`
`,l+="Voxel Dimensions (1-8): "+d(this.pixDims[0])+", "+d(this.pixDims[1])+", "+d(this.pixDims[2])+", "+d(this.pixDims[3])+", "+d(this.pixDims[4])+", "+d(this.pixDims[5])+", "+d(this.pixDims[6])+", "+d(this.pixDims[7])+`
`,l+="Image Offset = "+this.vox_offset+`
`,l+="Data Scale:  Slope = "+d(this.scl_slope)+"  Intercept = "+d(this.scl_inter)+`
`,l+="Slice End = "+this.slice_end+`
`,l+="Slice Code = "+this.slice_code+`
`,l+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(a.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(a.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+`)
`,l+="Display Range:  Max = "+d(this.cal_max)+"  Min = "+d(this.cal_min)+`
`,l+="Slice Duration = "+this.slice_duration+`
`,l+="Time Axis Shift = "+this.toffset+`
`,l+='Description: "'+this.description+`"
`,l+='Auxiliary File: "'+this.aux_file+`"
`,l+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+`)
`,l+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+`)
`,l+="Quaternion Parameters:  b = "+d(this.quatern_b)+"  c = "+d(this.quatern_c)+"  d = "+d(this.quatern_d)+`
`,l+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+`
`,l+="S-Form Parameters X: "+d(this.affine[0][0])+", "+d(this.affine[0][1])+", "+d(this.affine[0][2])+", "+d(this.affine[0][3])+`
`,l+="S-Form Parameters Y: "+d(this.affine[1][0])+", "+d(this.affine[1][1])+", "+d(this.affine[1][2])+", "+d(this.affine[1][3])+`
`,l+="S-Form Parameters Z: "+d(this.affine[2][0])+", "+d(this.affine[2][1])+", "+d(this.affine[2][2])+", "+d(this.affine[2][3])+`
`,l+='Intent Name: "'+this.intent_name+`"
`,this.extensionFlag[0]&&(l+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+`
`),l},a.NIFTI1.prototype.getDatatypeCodeString=function(d){return d===a.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":d===a.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":d===a.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":d===a.NIFTI1.TYPE_FLOAT32?"4-Byte Float":d===a.NIFTI1.TYPE_FLOAT64?"8-Byte Float":d===a.NIFTI1.TYPE_RGB24?"RGB":d===a.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":d===a.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":d===a.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":d===a.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":d===a.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},a.NIFTI1.prototype.getTransformCodeString=function(d){return d===a.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":d===a.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":d===a.NIFTI1.XFORM_TALAIRACH?"Talairach":d===a.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},a.NIFTI1.prototype.getUnitsCodeString=function(d){return d===a.NIFTI1.UNITS_METER?"Meters":d===a.NIFTI1.UNITS_MM?"Millimeters":d===a.NIFTI1.UNITS_MICRON?"Microns":d===a.NIFTI1.UNITS_SEC?"Seconds":d===a.NIFTI1.UNITS_MSEC?"Milliseconds":d===a.NIFTI1.UNITS_USEC?"Microseconds":d===a.NIFTI1.UNITS_HZ?"Hz":d===a.NIFTI1.UNITS_PPM?"PPM":d===a.NIFTI1.UNITS_RADS?"Rads":"Unknown"},a.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},a.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(d,l,o,t,r,s,i,u,c,h){var g=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],v,m=d,E=l,T=o,O,M,P;return g[3][0]=g[3][1]=g[3][2]=0,g[3][3]=1,v=1-(m*m+E*E+T*T),v<1e-7?(v=1/Math.sqrt(m*m+E*E+T*T),m*=v,E*=v,T*=v,v=0):v=Math.sqrt(v),O=i>0?i:1,M=u>0?u:1,P=c>0?c:1,h<0&&(P=-P),g[0][0]=(v*v+m*m-E*E-T*T)*O,g[0][1]=2*(m*E-v*T)*M,g[0][2]=2*(m*T+v*E)*P,g[1][0]=2*(m*E+v*T)*O,g[1][1]=(v*v+E*E-m*m-T*T)*M,g[1][2]=2*(E*T-v*m)*P,g[2][0]=2*(m*T-v*E)*O,g[2][1]=2*(E*T+v*m)*M,g[2][2]=(v*v+T*T-E*E-m*m)*P,g[0][3]=t,g[1][3]=r,g[2][3]=s,g},a.NIFTI1.prototype.convertNiftiSFormToNEMA=function(d){var l,o,t,r,s,i,u,c,h,g,v,m,E,T,O,M,P,C,_,D,I,y,R,b,z,H,B,p,A,j,x,L,U,S;if(O=0,B=[[0,0,0],[0,0,0],[0,0,0]],p=[[0,0,0],[0,0,0],[0,0,0]],l=d[0][0],o=d[0][1],t=d[0][2],r=d[1][0],s=d[1][1],i=d[1][2],u=d[2][0],c=d[2][1],h=d[2][2],g=Math.sqrt(l*l+r*r+u*u),g===0||(l/=g,r/=g,u/=g,g=Math.sqrt(o*o+s*s+c*c),g===0))return null;if(o/=g,s/=g,c/=g,g=l*o+r*s+u*c,Math.abs(g)>1e-4){if(o-=g*l,s-=g*r,c-=g*u,g=Math.sqrt(o*o+s*s+c*c),g===0)return null;o/=g,s/=g,c/=g}if(g=Math.sqrt(t*t+i*i+h*h),g===0?(t=r*c-u*s,i=u*o-c*l,h=l*s-r*o):(t/=g,i/=g,h/=g),g=l*t+r*i+u*h,Math.abs(g)>1e-4){if(t-=g*l,i-=g*r,h-=g*u,g=Math.sqrt(t*t+i*i+h*h),g===0)return null;t/=g,i/=g,h/=g}if(g=o*t+s*i+c*h,Math.abs(g)>1e-4){if(t-=g*o,i-=g*s,h-=g*c,g=Math.sqrt(t*t+i*i+h*h),g===0)return null;t/=g,i/=g,h/=g}if(B[0][0]=l,B[0][1]=o,B[0][2]=t,B[1][0]=r,B[1][1]=s,B[1][2]=i,B[2][0]=u,B[2][1]=c,B[2][2]=h,v=this.nifti_mat33_determ(B),v===0)return null;for(H=-666,_=y=R=b=1,D=2,I=3,E=1;E<=3;E+=1)for(T=1;T<=3;T+=1)if(E!==T){for(O=1;O<=3;O+=1)if(!(E===O||T===O))for(p[0][0]=p[0][1]=p[0][2]=p[1][0]=p[1][1]=p[1][2]=p[2][0]=p[2][1]=p[2][2]=0,M=-1;M<=1;M+=2)for(P=-1;P<=1;P+=2)for(C=-1;C<=1;C+=2)p[0][E-1]=M,p[1][T-1]=P,p[2][O-1]=C,m=this.nifti_mat33_determ(p),m*v>0&&(z=this.nifti_mat33_mul(p,B),g=z[0][0]+z[1][1]+z[2][2],g>H&&(H=g,_=E,D=T,I=O,y=M,R=P,b=C))}switch(A=j=x=L=U=S=0,_*y){case 1:A="X",L="+";break;case-1:A="X",L="-";break;case 2:A="Y",L="+";break;case-2:A="Y",L="-";break;case 3:A="Z",L="+";break;case-3:A="Z",L="-";break}switch(D*R){case 1:j="X",U="+";break;case-1:j="X",U="-";break;case 2:j="Y",U="+";break;case-2:j="Y",U="-";break;case 3:j="Z",U="+";break;case-3:j="Z",U="-";break}switch(I*b){case 1:x="X",S="+";break;case-1:x="X",S="-";break;case 2:x="Y",S="+";break;case-2:x="Y",S="-";break;case 3:x="Z",S="+";break;case-3:x="Z",S="-";break}return A+j+x+L+U+S},a.NIFTI1.prototype.nifti_mat33_mul=function(d,l){var o=[[0,0,0],[0,0,0],[0,0,0]],t,r;for(t=0;t<3;t+=1)for(r=0;r<3;r+=1)o[t][r]=d[t][0]*l[0][r]+d[t][1]*l[1][r]+d[t][2]*l[2][r];return o},a.NIFTI1.prototype.nifti_mat33_determ=function(d){var l,o,t,r,s,i,u,c,h;return l=d[0][0],o=d[0][1],t=d[0][2],r=d[1][0],s=d[1][1],i=d[1][2],u=d[2][0],c=d[2][1],h=d[2][2],l*s*h-l*c*i-r*o*h+r*c*t+u*o*i-u*s*t},a.NIFTI1.prototype.getExtensionLocation=function(){return a.NIFTI1.MAGIC_COOKIE+4},a.NIFTI1.prototype.getExtensionSize=function(d){return a.Utils.getIntAt(d,this.getExtensionLocation(),this.littleEndian)},a.NIFTI1.prototype.getExtensionCode=function(d){return a.Utils.getIntAt(d,this.getExtensionLocation()+4,this.littleEndian)};var f=typeof W;f!=="undefined"&&W.exports&&(W.exports=a.NIFTI1)},function(W,n,e){var a=e(2).assign,f=e(46),d=e(49),l=e(24),o={};a(o,f,d,l),W.exports=o},function(W,n,e){function a(f,d,l,o){for(var t=f&65535|0,r=f>>>16&65535|0,s=0;l!==0;){s=l>2e3?2e3:l,l-=s;do t=t+d[o++]|0,r=r+t|0;while(--s);t%=65521,r%=65521}return t|r<<16|0}W.exports=a},function(W,n,e){function a(){for(var l,o=[],t=0;t<256;t++){l=t;for(var r=0;r<8;r++)l=l&1?3988292384^l>>>1:l>>>1;o[t]=l}return o}var f=a();function d(l,o,t,r){var s=f,i=r+t;l^=-1;for(var u=r;u<i;u++)l=l>>>8^s[(l^o[u])&255];return l^-1}W.exports=d},function(W,n,e){var a=e(2),f=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var l=new a.Buf8(256),o=0;o<256;o++)l[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;l[254]=l[254]=1,n.string2buf=function(r){var s,i,u,c,h,g=r.length,v=0;for(c=0;c<g;c++)i=r.charCodeAt(c),(i&64512)===55296&&c+1<g&&(u=r.charCodeAt(c+1),(u&64512)===56320&&(i=65536+(i-55296<<10)+(u-56320),c++)),v+=i<128?1:i<2048?2:i<65536?3:4;for(s=new a.Buf8(v),h=0,c=0;h<v;c++)i=r.charCodeAt(c),(i&64512)===55296&&c+1<g&&(u=r.charCodeAt(c+1),(u&64512)===56320&&(i=65536+(i-55296<<10)+(u-56320),c++)),i<128?s[h++]=i:i<2048?(s[h++]=192|i>>>6,s[h++]=128|i&63):i<65536?(s[h++]=224|i>>>12,s[h++]=128|i>>>6&63,s[h++]=128|i&63):(s[h++]=240|i>>>18,s[h++]=128|i>>>12&63,s[h++]=128|i>>>6&63,s[h++]=128|i&63);return s};function t(r,s){if(s<65537&&(r.subarray&&d||!r.subarray&&f))return String.fromCharCode.apply(null,a.shrinkBuf(r,s));for(var i="",u=0;u<s;u++)i+=String.fromCharCode(r[u]);return i}n.buf2binstring=function(r){return t(r,r.length)},n.binstring2buf=function(r){for(var s=new a.Buf8(r.length),i=0,u=s.length;i<u;i++)s[i]=r.charCodeAt(i);return s},n.buf2string=function(r,s){var i,u,c,h,g=s||r.length,v=new Array(g*2);for(u=0,i=0;i<g;){if(c=r[i++],c<128){v[u++]=c;continue}if(h=l[c],h>4){v[u++]=65533,i+=h-1;continue}for(c&=h===2?31:h===3?15:7;h>1&&i<g;)c=c<<6|r[i++]&63,h--;if(h>1){v[u++]=65533;continue}c<65536?v[u++]=c:(c-=65536,v[u++]=55296|c>>10&1023,v[u++]=56320|c&1023)}return t(v,u)},n.utf8border=function(r,s){var i;for(s=s||r.length,s>r.length&&(s=r.length),i=s-1;i>=0&&(r[i]&192)===128;)i--;return i<0||i===0?s:i+l[r[i]]>s?i:s}},function(W,n,e){function a(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}W.exports=a},function(W,n,e){W.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function m(E,T){var O=[],M=!0,P=!1,C=void 0;try{for(var _=E[Symbol.iterator](),D;!(M=(D=_.next()).done)&&(O.push(D.value),!(T&&O.length===T));M=!0);}catch(I){P=!0,C=I}finally{try{!M&&_.return&&_.return()}finally{if(P)throw C}}return O}return function(E,T){if(Array.isArray(E))return E;if(Symbol.iterator in Object(E))return m(E,T);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=function(){function m(E,T){for(var O=0;O<T.length;O++){var M=T[O];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(E,M.key,M)}}return function(E,T,O){return T&&m(E.prototype,T),O&&m(E,O),E}}(),d=e(56),l=r(d),o=e(9),t=r(o);function r(m){return m&&m.__esModule?m:{default:m}}function s(m){if(Array.isArray(m)){for(var E=0,T=Array(m.length);E<m.length;E++)T[E]=m[E];return T}else return Array.from(m)}function i(m,E){if(!(m instanceof E))throw new TypeError("Cannot call a class as a function")}var u=Symbol("convertToNeurologicalView"),c=Symbol("ensureVoxelStorageInXYZ"),h=Symbol("changeVoxelStorageOrder"),g=Symbol("convertRAStoLPS"),v=function(){function m(E,T,O,M){var P=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;i(this,m),this.imageIdObject=E,this.metaData=T,this.imageDataNDarray=O,this.floatImageDataNDarray=M,this.isSingleTimepoint=P,this[c](),this[u](),this[g]()}return f(m,[{key:c,value:function(){var T=this.metaData.orientationString,O=T.slice(0,3);switch(O){case"XYZ":break;case"XZY":this[h]([0,2,1]);break;case"YZX":this[h]([2,0,1]);break;default:}}},{key:h,value:function(T){var O,M=a(T,3),P=M[0],C=M[1],_=M[2];this.hasImageData&&(this.imageDataNDarray=this.imageDataNDarray.transpose(P,C,_,3),this.floatImageDataNDarray&&(this.floatImageDataNDarray=this.floatImageDataNDarray.transpose(P,C,_,3))),this.metaData.voxelLength=[this.metaData.voxelLength[P],this.metaData.voxelLength[C],this.metaData.voxelLength[_]];var D=this.metaData.orientationMatrix,I=JSON.parse(JSON.stringify(D)),y=(0,t.default)((O=[]).concat.apply(O,s(I)),[4,4]).transpose(1,0),R=[y.pick(0,null),y.pick(1,null),y.pick(2,null),y.pick(3,null)];D[0]=[R[P].get(0),R[P].get(1),R[P].get(2),R[3].get(P)],D[1]=[R[C].get(0),R[C].get(1),R[C].get(2),-R[3].get(C)],D[2]=[R[_].get(0),R[_].get(1),R[_].get(2),-R[3].get(_)];var b=[this.metaData.pixelSpacing[P],this.metaData.pixelSpacing[C],this.metaData.pixelSpacing[_]];this.metaData.pixelSpacing=b.slice(0);var z=this.metaData.orientationString,H=z.slice(3,6);H=[H[P],H[C],H[_]].join(""),this.metaData.orientationString="XYZ"+H}},{key:u,value:function(){var T=this.metaData.orientationMatrix,O=this.metaData.orientationString.slice(3,6),M=[1,1,1];if(this.metaData.orientationString.slice(0,3)==="XYZ"&&(O[0]==="-"&&(T[0][0]*=-1,T[0][1]*=-1,T[0][2]*=-1,T[0][3]*=-1,M[0]=-1),O[1]==="+"&&(T[1][0]*=-1,T[1][1]*=-1,T[1][2]*=-1,T[1][3]*=-1,M[1]=-1),O[2]==="+"&&(T[2][0]*=-1,T[2][1]*=-1,T[2][2]*=-1,T[2][3]*=-1,M[2]=-1)),this.hasImageData){var P;if(this.imageDataNDarray=(P=this.imageDataNDarray).step.apply(P,M.concat([1])),this.floatImageDataNDarray){var C;this.floatImageDataNDarray=(C=this.floatImageDataNDarray).step.apply(C,M.concat([1]))}}}},{key:g,value:function(){var T=this.metaData.orientationMatrix;T[0][0]*=-1,T[0][1]*=-1,T[0][2]*=-1,T[0][3]*=-1,T[1][0]*=-1,T[1][1]*=-1,T[1][2]*=-1,T[1][3]*=-1}},{key:"slice",value:function(T){return new l.default(this,T,this.isSingleTimepoint)}},{key:"hasImageData",get:function(){return this.imageDataNDarray&&this.imageDataNDarray.data&&this.imageDataNDarray.data.byteLength>0}},{key:"sizeInBytes",get:function(){var T=this.imageDataNDarray?this.imageDataNDarray.data.byteLength:0,O=this.floatImageDataView?this.floatImageDataView.data.byteLength:0;return T+O}}]),m}();n.default=v},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function o(t,r){for(var s=0;s<r.length;s++){var i=r[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,r,s){return r&&o(t.prototype,r),s&&o(t,s),t}}();function f(o,t){if(!(o instanceof t))throw new TypeError("Cannot call a class as a function")}var d=function(){function o(){f(this,o),this.volumeEntries={},this.cacheUses=0}return a(o,[{key:"add",value:function(r,s){var i=r.filePath;this.volumeEntries[i]=new l(s)}},{key:"addTimepoint",value:function(r,s,i){var u=r.filePath+"-t"+s;this.volumeEntries[u]=new l(i)}},{key:"get",value:function(r){var s=r.filePath,i=this.volumeEntries[s];if(i)return i.lastUseIndex=this.cacheUses++,i.volume}},{key:"getTimepoint",value:function(r,s){var i=r.filePath+"-t"+s,u=this.volumeEntries[i];if(u)return u.lastUseIndex=this.cacheUses++,u.volume}}]),o}();n.default=d;var l=function o(t){f(this,o),this.volume=t,this.sizeInBytes=t.sizeInBytes,this.lastUseIndex=-1}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=o;var a=e(9),f=d(a);function d(t){return t&&t.__esModule?t:{default:t}}function l(t,r,s){return(t-s)/r}function o(t,r){for(var s=Math.pow(2,16)-1,i=r.minPixelValue,u=r.maxPixelValue,c=u-i,h=c===0?1:c/s,g=i,v=(0,f.default)(new Uint16Array(t.data.length),t.shape,t.stride,t.offset),m=0;m<t.shape[3];m++)for(var E=0;E<t.shape[2];E++)for(var T=0;T<t.shape[1];T++)for(var O=0;O<t.shape[0];O++){var M=t.get(O,T,E,m);M=l(M,h,g),v.set(O,T,E,m,Math.floor(M))}return{convertedImageDataView:v,floatImageDataView:t,metaData:{slope:h,intercept:g,minPixelValue:Math.floor(l(r.minPixelValue,h,g)),maxPixelValue:Math.floor(l(r.maxPixelValue,h,g)),dataType:{TypedArrayConstructor:Uint16Array,OriginalTypedArrayConstructor:r.dataType.TypedArrayConstructor,isDataInFloat:!0,isDataInColors:r.dataType.isDataInColors}}}}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});function a(f){for(var d=f.get(0,0,0,0),l=d,o=0;o<f.shape[3];o++)for(var t=0;t<f.shape[2];t++)for(var r=0;r<f.shape[1];r++)for(var s=0;s<f.shape[0];s++){var i=f.get(s,r,t,o);i<d?d=i:i>l&&(l=i)}return{min:d,max:l}}n.default=a},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=a;function a(f,d){var l=f.length,o=new Uint8Array(l+d.length);return o.set(f),o.set(d,l),o}},function(W,n){var e={}.toString;W.exports=Array.isArray||function(a){return e.call(a)=="[object Array]"}},function(W,n,e){(function(a){n.fetch=r(a.fetch)&&r(a.ReadableStream),n.writableStream=r(a.WritableStream),n.abortController=r(a.AbortController),n.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),n.blobConstructor=!0}catch{}var f;function d(){if(f!==void 0)return f;if(a.XMLHttpRequest){f=new a.XMLHttpRequest;try{f.open("GET",a.XDomainRequest?"/":"https://example.com")}catch{f=null}}else f=null;return f}function l(s){var i=d();if(!i)return!1;try{return i.responseType=s,i.responseType===s}catch{}return!1}var o=typeof a.ArrayBuffer<"u",t=o&&r(a.ArrayBuffer.prototype.slice);n.arraybuffer=n.fetch||o&&l("arraybuffer"),n.msstream=!n.fetch&&t&&l("ms-stream"),n.mozchunkedarraybuffer=!n.fetch&&o&&l("moz-chunked-arraybuffer"),n.overrideMimeType=n.fetch||(d()?r(d().overrideMimeType):!1),n.vbArray=r(a.VBArray);function r(s){return typeof s=="function"}f=null}).call(n,e(0))},function(W,n,e){(function(a,f,d){var l=e(31),o=e(3),t=e(33),r=n.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},s=n.IncomingMessage=function(i,u,c){var h=this;if(t.Readable.call(h),h._mode=c,h.headers={},h.rawHeaders=[],h.trailers={},h.rawTrailers=[],h.on("end",function(){a.nextTick(function(){h.emit("close")})}),c==="fetch"){let O=function(){v.read().then(function(M){if(!h._destroyed){if(M.done){h.push(null);return}h.push(new f(M.value)),O()}}).catch(function(M){h._destroyed||h.emit("error",M)})};if(h._fetchResponse=u,h.url=u.url,h.statusCode=u.status,h.statusMessage=u.statusText,u.headers.forEach(function(M,P){h.headers[P.toLowerCase()]=M,h.rawHeaders.push(P,M)}),l.writableStream){var g=new WritableStream({write:function(M){return new Promise(function(P,C){h._destroyed||(h.push(new f(M))?P():h._resumeFetch=P)})},close:function(){h._destroyed||h.push(null)},abort:function(M){h._destroyed||h.emit("error",M)}});try{u.body.pipeTo(g);return}catch{}}var v=u.body.getReader();O()}else{h._xhr=i,h._pos=0,h.url=i.responseURL,h.statusCode=i.status,h.statusMessage=i.statusText;var m=i.getAllResponseHeaders().split(/\r?\n/);if(m.forEach(function(O){var M=O.match(/^([^:]+):\s*(.*)/);if(M){var P=M[1].toLowerCase();P==="set-cookie"?(h.headers[P]===void 0&&(h.headers[P]=[]),h.headers[P].push(M[2])):h.headers[P]!==void 0?h.headers[P]+=", "+M[2]:h.headers[P]=M[2],h.rawHeaders.push(M[1],M[2])}}),h._charset="x-user-defined",!l.overrideMimeType){var E=h.rawHeaders["mime-type"];if(E){var T=E.match(/;\s*charset=([^;])(;|$)/);T&&(h._charset=T[1].toLowerCase())}h._charset||(h._charset="utf-8")}}};o(s,t.Readable),s.prototype._read=function(){var i=this,u=i._resumeFetch;u&&(i._resumeFetch=null,u())},s.prototype._onXHRProgress=function(){var i=this,u=i._xhr,c=null;switch(i._mode){case"text:vbarray":if(u.readyState!==r.DONE)break;try{c=new d.VBArray(u.responseBody).toArray()}catch{}if(c!==null){i.push(new f(c));break}case"text":try{c=u.responseText}catch{i._mode="text:vbarray";break}if(c.length>i._pos){var h=c.substr(i._pos);if(i._charset==="x-user-defined"){for(var g=new f(h.length),v=0;v<h.length;v++)g[v]=h.charCodeAt(v)&255;i.push(g)}else i.push(h,i._charset);i._pos=c.length}break;case"arraybuffer":if(u.readyState!==r.DONE||!u.response)break;c=u.response,i.push(new f(new Uint8Array(c)));break;case"moz-chunked-arraybuffer":if(c=u.response,u.readyState!==r.LOADING||!c)break;i.push(new f(new Uint8Array(c)));break;case"ms-stream":if(c=u.response,u.readyState!==r.LOADING)break;var m=new d.MSStreamReader;m.onprogress=function(){m.result.byteLength>i._pos&&(i.push(new f(new Uint8Array(m.result.slice(i._pos)))),i._pos=m.result.byteLength)},m.onload=function(){i.push(null)},m.readAsArrayBuffer(c);break}i._xhr.readyState===r.DONE&&i._mode!=="ms-stream"&&i.push(null)}}).call(n,e(4),e(6).Buffer,e(0))},function(W,n,e){n=W.exports=e(34),n.Stream=n,n.Readable=n,n.Writable=e(38),n.Duplex=e(5),n.Transform=e(40),n.PassThrough=e(78)},function(W,n,e){(function(a,f){var d=e(10);W.exports=C;var l=e(30),o;C.ReadableState=P,e(35).EventEmitter;var t=function(Y,V){return Y.listeners(V).length},r=e(36),s=e(11).Buffer,i=a.Uint8Array||function(){};function u(Y){return s.from(Y)}function c(Y){return s.isBuffer(Y)||Y instanceof i}var h=e(7);h.inherits=e(3);var g=e(73),v=void 0;g&&g.debuglog?v=g.debuglog("stream"):v=function(){};var m=e(74),E=e(37),T;h.inherits(C,r);var O=["error","close","destroy","pause","resume"];function M(Y,V,te){if(typeof Y.prependListener=="function")return Y.prependListener(V,te);!Y._events||!Y._events[V]?Y.on(V,te):l(Y._events[V])?Y._events[V].unshift(te):Y._events[V]=[te,Y._events[V]]}function P(Y,V){o=o||e(5),Y=Y||{},this.objectMode=!!Y.objectMode,V instanceof o&&(this.objectMode=this.objectMode||!!Y.readableObjectMode);var te=Y.highWaterMark,ne=this.objectMode?16:16*1024;this.highWaterMark=te||te===0?te:ne,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=Y.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Y.encoding&&(T||(T=e(39).StringDecoder),this.decoder=new T(Y.encoding),this.encoding=Y.encoding)}function C(Y){if(o=o||e(5),!(this instanceof C))return new C(Y);this._readableState=new P(Y,this),this.readable=!0,Y&&(typeof Y.read=="function"&&(this._read=Y.read),typeof Y.destroy=="function"&&(this._destroy=Y.destroy)),r.call(this)}Object.defineProperty(C.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(Y){this._readableState&&(this._readableState.destroyed=Y)}}),C.prototype.destroy=E.destroy,C.prototype._undestroy=E.undestroy,C.prototype._destroy=function(Y,V){this.push(null),V(Y)},C.prototype.push=function(Y,V){var te=this._readableState,ne;return te.objectMode?ne=!0:typeof Y=="string"&&(V=V||te.defaultEncoding,V!==te.encoding&&(Y=s.from(Y,V),V=""),ne=!0),_(this,Y,V,!1,ne)},C.prototype.unshift=function(Y){return _(this,Y,null,!0,!1)};function _(Y,V,te,ne,ue){var ge=Y._readableState;if(V===null)ge.reading=!1,H(Y,ge);else{var ve;ue||(ve=I(ge,V)),ve?Y.emit("error",ve):ge.objectMode||V&&V.length>0?(typeof V!="string"&&!ge.objectMode&&Object.getPrototypeOf(V)!==s.prototype&&(V=u(V)),ne?ge.endEmitted?Y.emit("error",new Error("stream.unshift() after end event")):D(Y,ge,V,!0):ge.ended?Y.emit("error",new Error("stream.push() after EOF")):(ge.reading=!1,ge.decoder&&!te?(V=ge.decoder.write(V),ge.objectMode||V.length!==0?D(Y,ge,V,!1):A(Y,ge)):D(Y,ge,V,!1))):ne||(ge.reading=!1)}return y(ge)}function D(Y,V,te,ne){V.flowing&&V.length===0&&!V.sync?(Y.emit("data",te),Y.read(0)):(V.length+=V.objectMode?1:te.length,ne?V.buffer.unshift(te):V.buffer.push(te),V.needReadable&&B(Y)),A(Y,V)}function I(Y,V){var te;return!c(V)&&typeof V!="string"&&V!==void 0&&!Y.objectMode&&(te=new TypeError("Invalid non-string/buffer chunk")),te}function y(Y){return!Y.ended&&(Y.needReadable||Y.length<Y.highWaterMark||Y.length===0)}C.prototype.isPaused=function(){return this._readableState.flowing===!1},C.prototype.setEncoding=function(Y){return T||(T=e(39).StringDecoder),this._readableState.decoder=new T(Y),this._readableState.encoding=Y,this};var R=8388608;function b(Y){return Y>=R?Y=R:(Y--,Y|=Y>>>1,Y|=Y>>>2,Y|=Y>>>4,Y|=Y>>>8,Y|=Y>>>16,Y++),Y}function z(Y,V){return Y<=0||V.length===0&&V.ended?0:V.objectMode?1:Y!==Y?V.flowing&&V.length?V.buffer.head.data.length:V.length:(Y>V.highWaterMark&&(V.highWaterMark=b(Y)),Y<=V.length?Y:V.ended?V.length:(V.needReadable=!0,0))}C.prototype.read=function(Y){v("read",Y),Y=parseInt(Y,10);var V=this._readableState,te=Y;if(Y!==0&&(V.emittedReadable=!1),Y===0&&V.needReadable&&(V.length>=V.highWaterMark||V.ended))return v("read: emitReadable",V.length,V.ended),V.length===0&&V.ended?le(this):B(this),null;if(Y=z(Y,V),Y===0&&V.ended)return V.length===0&&le(this),null;var ne=V.needReadable;v("need readable",ne),(V.length===0||V.length-Y<V.highWaterMark)&&(ne=!0,v("length less than watermark",ne)),V.ended||V.reading?(ne=!1,v("reading or ended",ne)):ne&&(v("do read"),V.reading=!0,V.sync=!0,V.length===0&&(V.needReadable=!0),this._read(V.highWaterMark),V.sync=!1,V.reading||(Y=z(te,V)));var ue;return Y>0?ue=G(Y,V):ue=null,ue===null?(V.needReadable=!0,Y=0):V.length-=Y,V.length===0&&(V.ended||(V.needReadable=!0),te!==Y&&V.ended&&le(this)),ue!==null&&this.emit("data",ue),ue};function H(Y,V){if(!V.ended){if(V.decoder){var te=V.decoder.end();te&&te.length&&(V.buffer.push(te),V.length+=V.objectMode?1:te.length)}V.ended=!0,B(Y)}}function B(Y){var V=Y._readableState;V.needReadable=!1,V.emittedReadable||(v("emitReadable",V.flowing),V.emittedReadable=!0,V.sync?d(p,Y):p(Y))}function p(Y){v("emit readable"),Y.emit("readable"),w(Y)}function A(Y,V){V.readingMore||(V.readingMore=!0,d(j,Y,V))}function j(Y,V){for(var te=V.length;!V.reading&&!V.flowing&&!V.ended&&V.length<V.highWaterMark&&(v("maybeReadMore read 0"),Y.read(0),te!==V.length);)te=V.length;V.readingMore=!1}C.prototype._read=function(Y){this.emit("error",new Error("_read() is not implemented"))},C.prototype.pipe=function(Y,V){var te=this,ne=this._readableState;switch(ne.pipesCount){case 0:ne.pipes=Y;break;case 1:ne.pipes=[ne.pipes,Y];break;default:ne.pipes.push(Y);break}ne.pipesCount+=1,v("pipe count=%d opts=%j",ne.pipesCount,V);var ue=(!V||V.end!==!1)&&Y!==f.stdout&&Y!==f.stderr,ge=ue?Ee:pe;ne.endEmitted?d(ge):te.once("end",ge),Y.on("unpipe",ve);function ve(ye,Se){v("onunpipe"),ye===te&&Se&&Se.hasUnpiped===!1&&(Se.hasUnpiped=!0,N())}function Ee(){v("onend"),Y.end()}var De=x(te);Y.on("drain",De);var X=!1;function N(){v("cleanup"),Y.removeListener("close",ie),Y.removeListener("finish",he),Y.removeListener("drain",De),Y.removeListener("error",oe),Y.removeListener("unpipe",ve),te.removeListener("end",Ee),te.removeListener("end",pe),te.removeListener("data",q),X=!0,ne.awaitDrain&&(!Y._writableState||Y._writableState.needDrain)&&De()}var F=!1;te.on("data",q);function q(ye){v("ondata"),F=!1;var Se=Y.write(ye);Se===!1&&!F&&((ne.pipesCount===1&&ne.pipes===Y||ne.pipesCount>1&&me(ne.pipes,Y)!==-1)&&!X&&(v("false write response, pause",te._readableState.awaitDrain),te._readableState.awaitDrain++,F=!0),te.pause())}function oe(ye){v("onerror",ye),pe(),Y.removeListener("error",oe),t(Y,"error")===0&&Y.emit("error",ye)}M(Y,"error",oe);function ie(){Y.removeListener("finish",he),pe()}Y.once("close",ie);function he(){v("onfinish"),Y.removeListener("close",ie),pe()}Y.once("finish",he);function pe(){v("unpipe"),te.unpipe(Y)}return Y.emit("pipe",te),ne.flowing||(v("pipe resume"),te.resume()),Y};function x(Y){return function(){var V=Y._readableState;v("pipeOnDrain",V.awaitDrain),V.awaitDrain&&V.awaitDrain--,V.awaitDrain===0&&t(Y,"data")&&(V.flowing=!0,w(Y))}}C.prototype.unpipe=function(Y){var V=this._readableState,te={hasUnpiped:!1};if(V.pipesCount===0)return this;if(V.pipesCount===1)return Y&&Y!==V.pipes?this:(Y||(Y=V.pipes),V.pipes=null,V.pipesCount=0,V.flowing=!1,Y&&Y.emit("unpipe",this,te),this);if(!Y){var ne=V.pipes,ue=V.pipesCount;V.pipes=null,V.pipesCount=0,V.flowing=!1;for(var ge=0;ge<ue;ge++)ne[ge].emit("unpipe",this,te);return this}var ve=me(V.pipes,Y);return ve===-1?this:(V.pipes.splice(ve,1),V.pipesCount-=1,V.pipesCount===1&&(V.pipes=V.pipes[0]),Y.emit("unpipe",this,te),this)},C.prototype.on=function(Y,V){var te=r.prototype.on.call(this,Y,V);if(Y==="data")this._readableState.flowing!==!1&&this.resume();else if(Y==="readable"){var ne=this._readableState;!ne.endEmitted&&!ne.readableListening&&(ne.readableListening=ne.needReadable=!0,ne.emittedReadable=!1,ne.reading?ne.length&&B(this):d(L,this))}return te},C.prototype.addListener=C.prototype.on;function L(Y){v("readable nexttick read 0"),Y.read(0)}C.prototype.resume=function(){var Y=this._readableState;return Y.flowing||(v("resume"),Y.flowing=!0,U(this,Y)),this};function U(Y,V){V.resumeScheduled||(V.resumeScheduled=!0,d(S,Y,V))}function S(Y,V){V.reading||(v("resume read 0"),Y.read(0)),V.resumeScheduled=!1,V.awaitDrain=0,Y.emit("resume"),w(Y),V.flowing&&!V.reading&&Y.read(0)}C.prototype.pause=function(){return v("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(v("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function w(Y){var V=Y._readableState;for(v("flow",V.flowing);V.flowing&&Y.read()!==null;);}C.prototype.wrap=function(Y){var V=this._readableState,te=!1,ne=this;Y.on("end",function(){if(v("wrapped end"),V.decoder&&!V.ended){var ve=V.decoder.end();ve&&ve.length&&ne.push(ve)}ne.push(null)}),Y.on("data",function(ve){if(v("wrapped data"),V.decoder&&(ve=V.decoder.write(ve)),!(V.objectMode&&ve==null)&&!(!V.objectMode&&(!ve||!ve.length))){var Ee=ne.push(ve);Ee||(te=!0,Y.pause())}});for(var ue in Y)this[ue]===void 0&&typeof Y[ue]=="function"&&(this[ue]=function(ve){return function(){return Y[ve].apply(Y,arguments)}}(ue));for(var ge=0;ge<O.length;ge++)Y.on(O[ge],ne.emit.bind(ne,O[ge]));return ne._read=function(ve){v("wrapped _read",ve),te&&(te=!1,Y.resume())},ne},C._fromList=G;function G(Y,V){if(V.length===0)return null;var te;return V.objectMode?te=V.buffer.shift():!Y||Y>=V.length?(V.decoder?te=V.buffer.join(""):V.buffer.length===1?te=V.buffer.head.data:te=V.buffer.concat(V.length),V.buffer.clear()):te=$(Y,V.buffer,V.decoder),te}function $(Y,V,te){var ne;return Y<V.head.data.length?(ne=V.head.data.slice(0,Y),V.head.data=V.head.data.slice(Y)):Y===V.head.data.length?ne=V.shift():ne=te?Q(Y,V):re(Y,V),ne}function Q(Y,V){var te=V.head,ne=1,ue=te.data;for(Y-=ue.length;te=te.next;){var ge=te.data,ve=Y>ge.length?ge.length:Y;if(ve===ge.length?ue+=ge:ue+=ge.slice(0,Y),Y-=ve,Y===0){ve===ge.length?(++ne,te.next?V.head=te.next:V.head=V.tail=null):(V.head=te,te.data=ge.slice(ve));break}++ne}return V.length-=ne,ue}function re(Y,V){var te=s.allocUnsafe(Y),ne=V.head,ue=1;for(ne.data.copy(te),Y-=ne.data.length;ne=ne.next;){var ge=ne.data,ve=Y>ge.length?ge.length:Y;if(ge.copy(te,te.length-Y,0,ve),Y-=ve,Y===0){ve===ge.length?(++ue,ne.next?V.head=ne.next:V.head=V.tail=null):(V.head=ne,ne.data=ge.slice(ve));break}++ue}return V.length-=ue,te}function le(Y){var V=Y._readableState;if(V.length>0)throw new Error('"endReadable()" called on non-empty stream');V.endEmitted||(V.ended=!0,d(de,V,Y))}function de(Y,V){!Y.endEmitted&&Y.length===0&&(Y.endEmitted=!0,V.readable=!1,V.emit("end"))}function me(Y,V){for(var te=0,ne=Y.length;te<ne;te++)if(Y[te]===V)return te;return-1}}).call(n,e(0),e(4))},function(W,n){function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}W.exports=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(o){if(!f(o)||o<0||isNaN(o))throw TypeError("n must be a positive number");return this._maxListeners=o,this},e.prototype.emit=function(o){var t,r,s,i,u,c;if(this._events||(this._events={}),o==="error"&&(!this._events.error||d(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(r=this._events[o],l(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),r.apply(this,i)}else if(d(r))for(i=Array.prototype.slice.call(arguments,1),c=r.slice(),s=c.length,u=0;u<s;u++)c[u].apply(this,i);return!0},e.prototype.addListener=function(o,t){var r;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",o,a(t.listener)?t.listener:t),this._events[o]?d(this._events[o])?this._events[o].push(t):this._events[o]=[this._events[o],t]:this._events[o]=t,d(this._events[o])&&!this._events[o].warned&&(l(this._maxListeners)?r=e.defaultMaxListeners:r=this._maxListeners,r&&r>0&&this._events[o].length>r&&(this._events[o].warned=!0)),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(o,t){if(!a(t))throw TypeError("listener must be a function");var r=!1;function s(){this.removeListener(o,s),r||(r=!0,t.apply(this,arguments))}return s.listener=t,this.on(o,s),this},e.prototype.removeListener=function(o,t){var r,s,i,u;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[o])return this;if(r=this._events[o],i=r.length,s=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[o],this._events.removeListener&&this.emit("removeListener",o,t);else if(d(r)){for(u=i;u-- >0;)if(r[u]===t||r[u].listener&&r[u].listener===t){s=u;break}if(s<0)return this;r.length===1?(r.length=0,delete this._events[o]):r.splice(s,1),this._events.removeListener&&this.emit("removeListener",o,t)}return this},e.prototype.removeAllListeners=function(o){var t,r;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[o]&&delete this._events[o],this;if(arguments.length===0){for(t in this._events)t!=="removeListener"&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[o],a(r))this.removeListener(o,r);else if(r)for(;r.length;)this.removeListener(o,r[r.length-1]);return delete this._events[o],this},e.prototype.listeners=function(o){var t;return!this._events||!this._events[o]?t=[]:a(this._events[o])?t=[this._events[o]]:t=this._events[o].slice(),t},e.prototype.listenerCount=function(o){if(this._events){var t=this._events[o];if(a(t))return 1;if(t)return t.length}return 0},e.listenerCount=function(o,t){return o.listenerCount(t)};function a(o){return typeof o=="function"}function f(o){return typeof o=="number"}function d(o){return typeof o=="object"&&o!==null}function l(o){return o===void 0}},function(W,n,e){W.exports=e(35).EventEmitter},function(W,n,e){var a=e(10);function f(o,t){var r=this,s=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;if(s||i){t?t(o):o&&(!this._writableState||!this._writableState.errorEmitted)&&a(l,this,o);return}this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(o||null,function(u){!t&&u?(a(l,r,u),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(u)})}function d(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function l(o,t){o.emit("error",t)}W.exports={destroy:f,undestroy:d}},function(W,n,e){(function(a,f,d){var l=e(10);W.exports=M;function o(S){var w=this;this.next=null,this.entry=null,this.finish=function(){U(w,S)}}var t=!a.browser&&["v0.10","v0.9."].indexOf(a.version.slice(0,5))>-1?f:l,r;M.WritableState=T;var s=e(7);s.inherits=e(3);var i={deprecate:e(77)},u=e(36),c=e(11).Buffer,h=d.Uint8Array||function(){};function g(S){return c.from(S)}function v(S){return c.isBuffer(S)||S instanceof h}var m=e(37);s.inherits(M,u);function E(){}function T(S,w){r=r||e(5),S=S||{},this.objectMode=!!S.objectMode,w instanceof r&&(this.objectMode=this.objectMode||!!S.writableObjectMode);var G=S.highWaterMark,$=this.objectMode?16:16*1024;this.highWaterMark=G||G===0?G:$,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Q=S.decodeStrings===!1;this.decodeStrings=!Q,this.defaultEncoding=S.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(re){b(w,re)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}T.prototype.getBuffer=function(){for(var w=this.bufferedRequest,G=[];w;)G.push(w),w=w.next;return G},function(){try{Object.defineProperty(T.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var O;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(O=Function.prototype[Symbol.hasInstance],Object.defineProperty(M,Symbol.hasInstance,{value:function(S){return O.call(this,S)?!0:S&&S._writableState instanceof T}})):O=function(S){return S instanceof this};function M(S){if(r=r||e(5),!O.call(M,this)&&!(this instanceof r))return new M(S);this._writableState=new T(S,this),this.writable=!0,S&&(typeof S.write=="function"&&(this._write=S.write),typeof S.writev=="function"&&(this._writev=S.writev),typeof S.destroy=="function"&&(this._destroy=S.destroy),typeof S.final=="function"&&(this._final=S.final)),u.call(this)}M.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function P(S,w){var G=new Error("write after end");S.emit("error",G),l(w,G)}function C(S,w,G,$){var Q=!0,re=!1;return G===null?re=new TypeError("May not write null values to stream"):typeof G!="string"&&G!==void 0&&!w.objectMode&&(re=new TypeError("Invalid non-string/buffer chunk")),re&&(S.emit("error",re),l($,re),Q=!1),Q}M.prototype.write=function(S,w,G){var $=this._writableState,Q=!1,re=v(S)&&!$.objectMode;return re&&!c.isBuffer(S)&&(S=g(S)),typeof w=="function"&&(G=w,w=null),re?w="buffer":w||(w=$.defaultEncoding),typeof G!="function"&&(G=E),$.ended?P(this,G):(re||C(this,$,S,G))&&($.pendingcb++,Q=D(this,$,re,S,w,G)),Q},M.prototype.cork=function(){var S=this._writableState;S.corked++},M.prototype.uncork=function(){var S=this._writableState;S.corked&&(S.corked--,!S.writing&&!S.corked&&!S.finished&&!S.bufferProcessing&&S.bufferedRequest&&B(this,S))},M.prototype.setDefaultEncoding=function(w){if(typeof w=="string"&&(w=w.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((w+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+w);return this._writableState.defaultEncoding=w,this};function _(S,w,G){return!S.objectMode&&S.decodeStrings!==!1&&typeof w=="string"&&(w=c.from(w,G)),w}function D(S,w,G,$,Q,re){if(!G){var le=_(w,$,Q);$!==le&&(G=!0,Q="buffer",$=le)}var de=w.objectMode?1:$.length;w.length+=de;var me=w.length<w.highWaterMark;if(me||(w.needDrain=!0),w.writing||w.corked){var Y=w.lastBufferedRequest;w.lastBufferedRequest={chunk:$,encoding:Q,isBuf:G,callback:re,next:null},Y?Y.next=w.lastBufferedRequest:w.bufferedRequest=w.lastBufferedRequest,w.bufferedRequestCount+=1}else I(S,w,!1,de,$,Q,re);return me}function I(S,w,G,$,Q,re,le){w.writelen=$,w.writecb=le,w.writing=!0,w.sync=!0,G?S._writev(Q,w.onwrite):S._write(Q,re,w.onwrite),w.sync=!1}function y(S,w,G,$,Q){--w.pendingcb,G?(l(Q,$),l(x,S,w),S._writableState.errorEmitted=!0,S.emit("error",$)):(Q($),S._writableState.errorEmitted=!0,S.emit("error",$),x(S,w))}function R(S){S.writing=!1,S.writecb=null,S.length-=S.writelen,S.writelen=0}function b(S,w){var G=S._writableState,$=G.sync,Q=G.writecb;if(R(G),w)y(S,G,$,w,Q);else{var re=p(G);!re&&!G.corked&&!G.bufferProcessing&&G.bufferedRequest&&B(S,G),$?t(z,S,G,re,Q):z(S,G,re,Q)}}function z(S,w,G,$){G||H(S,w),w.pendingcb--,$(),x(S,w)}function H(S,w){w.length===0&&w.needDrain&&(w.needDrain=!1,S.emit("drain"))}function B(S,w){w.bufferProcessing=!0;var G=w.bufferedRequest;if(S._writev&&G&&G.next){var $=w.bufferedRequestCount,Q=new Array($),re=w.corkedRequestsFree;re.entry=G;for(var le=0,de=!0;G;)Q[le]=G,G.isBuf||(de=!1),G=G.next,le+=1;Q.allBuffers=de,I(S,w,!0,w.length,Q,"",re.finish),w.pendingcb++,w.lastBufferedRequest=null,re.next?(w.corkedRequestsFree=re.next,re.next=null):w.corkedRequestsFree=new o(w)}else{for(;G;){var me=G.chunk,Y=G.encoding,V=G.callback,te=w.objectMode?1:me.length;if(I(S,w,!1,te,me,Y,V),G=G.next,w.writing)break}G===null&&(w.lastBufferedRequest=null)}w.bufferedRequestCount=0,w.bufferedRequest=G,w.bufferProcessing=!1}M.prototype._write=function(S,w,G){G(new Error("_write() is not implemented"))},M.prototype._writev=null,M.prototype.end=function(S,w,G){var $=this._writableState;typeof S=="function"?(G=S,S=null,w=null):typeof w=="function"&&(G=w,w=null),S!=null&&this.write(S,w),$.corked&&($.corked=1,this.uncork()),!$.ending&&!$.finished&&L(this,$,G)};function p(S){return S.ending&&S.length===0&&S.bufferedRequest===null&&!S.finished&&!S.writing}function A(S,w){S._final(function(G){w.pendingcb--,G&&S.emit("error",G),w.prefinished=!0,S.emit("prefinish"),x(S,w)})}function j(S,w){!w.prefinished&&!w.finalCalled&&(typeof S._final=="function"?(w.pendingcb++,w.finalCalled=!0,l(A,S,w)):(w.prefinished=!0,S.emit("prefinish")))}function x(S,w){var G=p(w);return G&&(j(S,w),w.pendingcb===0&&(w.finished=!0,S.emit("finish"))),G}function L(S,w,G){w.ending=!0,x(S,w),G&&(w.finished?l(G):S.once("finish",G)),w.ended=!0,S.writable=!1}function U(S,w,G){var $=S.entry;for(S.entry=null;$;){var Q=$.callback;w.pendingcb--,Q(G),$=$.next}w.corkedRequestsFree?w.corkedRequestsFree.next=S:w.corkedRequestsFree=S}Object.defineProperty(M.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(S){this._writableState&&(this._writableState.destroyed=S)}}),M.prototype.destroy=m.destroy,M.prototype._undestroy=m.undestroy,M.prototype._destroy=function(S,w){this.end(),w(S)}}).call(n,e(4),e(75).setImmediate,e(0))},function(W,n,e){var a=e(11).Buffer,f=a.isEncoding||function(O){switch(O=""+O,O&&O.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function d(O){if(!O)return"utf8";for(var M;;)switch(O){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return O;default:if(M)return;O=(""+O).toLowerCase(),M=!0}}function l(O){var M=d(O);if(typeof M!="string"&&(a.isEncoding===f||!f(O)))throw new Error("Unknown encoding: "+O);return M||O}n.StringDecoder=o;function o(O){this.encoding=l(O);var M;switch(this.encoding){case"utf16le":this.text=h,this.end=g,M=4;break;case"utf8":this.fillLast=i,M=4;break;case"base64":this.text=v,this.end=m,M=3;break;default:this.write=E,this.end=T;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=a.allocUnsafe(M)}o.prototype.write=function(O){if(O.length===0)return"";var M,P;if(this.lastNeed){if(M=this.fillLast(O),M===void 0)return"";P=this.lastNeed,this.lastNeed=0}else P=0;return P<O.length?M?M+this.text(O,P):this.text(O,P):M||""},o.prototype.end=c,o.prototype.text=u,o.prototype.fillLast=function(O){if(this.lastNeed<=O.length)return O.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);O.copy(this.lastChar,this.lastTotal-this.lastNeed,0,O.length),this.lastNeed-=O.length};function t(O){return O<=127?0:O>>5===6?2:O>>4===14?3:O>>3===30?4:-1}function r(O,M,P){var C=M.length-1;if(C<P)return 0;var _=t(M[C]);return _>=0?(_>0&&(O.lastNeed=_-1),_):--C<P?0:(_=t(M[C]),_>=0?(_>0&&(O.lastNeed=_-2),_):--C<P?0:(_=t(M[C]),_>=0?(_>0&&(_===2?_=0:O.lastNeed=_-3),_):0))}function s(O,M,P){if((M[0]&192)!==128)return O.lastNeed=0,"".repeat(P);if(O.lastNeed>1&&M.length>1){if((M[1]&192)!==128)return O.lastNeed=1,"".repeat(P+1);if(O.lastNeed>2&&M.length>2&&(M[2]&192)!==128)return O.lastNeed=2,"".repeat(P+2)}}function i(O){var M=this.lastTotal-this.lastNeed,P=s(this,O,M);if(P!==void 0)return P;if(this.lastNeed<=O.length)return O.copy(this.lastChar,M,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);O.copy(this.lastChar,M,0,O.length),this.lastNeed-=O.length}function u(O,M){var P=r(this,O,M);if(!this.lastNeed)return O.toString("utf8",M);this.lastTotal=P;var C=O.length-(P-this.lastNeed);return O.copy(this.lastChar,0,C),O.toString("utf8",M,C)}function c(O){var M=O&&O.length?this.write(O):"";return this.lastNeed?M+"".repeat(this.lastTotal-this.lastNeed):M}function h(O,M){if((O.length-M)%2===0){var P=O.toString("utf16le",M);if(P){var C=P.charCodeAt(P.length-1);if(C>=55296&&C<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=O[O.length-2],this.lastChar[1]=O[O.length-1],P.slice(0,-1)}return P}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=O[O.length-1],O.toString("utf16le",M,O.length-1)}function g(O){var M=O&&O.length?this.write(O):"";if(this.lastNeed){var P=this.lastTotal-this.lastNeed;return M+this.lastChar.toString("utf16le",0,P)}return M}function v(O,M){var P=(O.length-M)%3;return P===0?O.toString("base64",M):(this.lastNeed=3-P,this.lastTotal=3,P===1?this.lastChar[0]=O[O.length-1]:(this.lastChar[0]=O[O.length-2],this.lastChar[1]=O[O.length-1]),O.toString("base64",M,O.length-P))}function m(O){var M=O&&O.length?this.write(O):"";return this.lastNeed?M+this.lastChar.toString("base64",0,3-this.lastNeed):M}function E(O){return O.toString(this.encoding)}function T(O){return O&&O.length?this.write(O):""}},function(W,n,e){W.exports=o;var a=e(5),f=e(7);f.inherits=e(3),f.inherits(o,a);function d(r){this.afterTransform=function(s,i){return l(r,s,i)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function l(r,s,i){var u=r._transformState;u.transforming=!1;var c=u.writecb;if(!c)return r.emit("error",new Error("write callback called multiple times"));u.writechunk=null,u.writecb=null,i!=null&&r.push(i),c(s);var h=r._readableState;h.reading=!1,(h.needReadable||h.length<h.highWaterMark)&&r._read(h.highWaterMark)}function o(r){if(!(this instanceof o))return new o(r);a.call(this,r),this._transformState=new d(this);var s=this;this._readableState.needReadable=!0,this._readableState.sync=!1,r&&(typeof r.transform=="function"&&(this._transform=r.transform),typeof r.flush=="function"&&(this._flush=r.flush)),this.once("prefinish",function(){typeof this._flush=="function"?this._flush(function(i,u){t(s,i,u)}):t(s)})}o.prototype.push=function(r,s){return this._transformState.needTransform=!1,a.prototype.push.call(this,r,s)},o.prototype._transform=function(r,s,i){throw new Error("_transform() is not implemented")},o.prototype._write=function(r,s,i){var u=this._transformState;if(u.writecb=i,u.writechunk=r,u.writeencoding=s,!u.transforming){var c=this._readableState;(u.needTransform||c.needReadable||c.length<c.highWaterMark)&&this._read(c.highWaterMark)}},o.prototype._read=function(r){var s=this._transformState;s.writechunk!==null&&s.writecb&&!s.transforming?(s.transforming=!0,this._transform(s.writechunk,s.writeencoding,s.afterTransform)):s.needTransform=!0},o.prototype._destroy=function(r,s){var i=this;a.prototype._destroy.call(this,r,function(u){s(u),i.emit("close")})};function t(r,s,i){if(s)return r.emit("error",s);i!=null&&r.push(i);var u=r._writableState,c=r._transformState;if(u.length)throw new Error("Calling transform done when ws.length != 0");if(c.transforming)throw new Error("Calling transform done when still transforming");return r.push(null)}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=e(16);Object.defineProperty(n,"nifti",{enumerable:!0,get:function(){return d(a).default}});var f=e(1);Object.defineProperty(n,"external",{enumerable:!0,get:function(){return f.external}});function d(l){return l&&l.__esModule?l:{default:l}}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.metaDataProvider=i,n.metaDataProviderBuilder=m;var a=e(17),f=r(a),d=e(43),l=e(1),o=e(8),t=r(o);function r(E){return E&&E.__esModule?E:{default:E}}var s={metaDataManager:f.default,decimalToFraction:d.decimalToFraction,niftiReader:l.external.niftiReader};function i(E,T){var O=s.niftiReader,M=s.metaDataManager,P=M.get(T);if(P){var C=t.default.fromURL(T);switch(E){case"functional":return{frameOfReferenceUID:C.filePath,timeSlices:P.timeSlices};case"imagePlane":case"imagePlaneModule":{var _=C.filePath;return{frameOfReferenceUID:_,columns:P.columns,rows:P.rows,imageOrientationPatient:P.imageOrientationPatient,columnCosines:P.columnCosines,rowCosines:P.rowCosines,imagePositionPatient:P.imagePositionPatient,sliceThickness:P.slicePixelSpacing,columnPixelSpacing:P.columnPixelSpacing,rowPixelSpacing:P.rowPixelSpacing}}case"imagePixel":case"imagePixelModule":return{samplesPerPixel:u(P),photometricInterpretation:c(P,O),rows:P.rows,columns:P.columns,bitsAllocated:P.header.numBitsPerVoxel,bitsStored:P.header.numBitsPerVoxel,highBit:P.header.numBitsPerVoxel-1,pixelRepresentation:h(P,O),planarConfiguration:g(P),pixelAspectRatio:v(P),smallestPixelValue:P.minPixelValue,largestPixelValue:P.maxPixelValue};case"modalityLut":case"modalityLutModule":return{rescaleIntercept:P.intercept,rescaleSlope:P.slope,rescaleType:"US",modalityLutSequence:void 0};case"voiLut":case"voiLutModule":return{windowCenter:P.windowCenter,windowWidth:P.windowWidth,voiLutSequence:void 0};case"multiFrame":case"multiFrameModule":return{numberOfFrames:P.numberOfFrames,frameIncrementPointer:void 0,stereoPairsPresent:"NO"};default:return}}}function u(E){var T=E.header.dims[0]>=5,O=T&&E.header.dims[5]>1;return O?E.header.dims[5]:1}function c(E,T){var O=E.header.datatypeCode,M=u(E),P=O===T.NIFTI1.TYPE_RGB&&M===3,C=O===T.NIFTI1.TYPE_RGBA&&M===4;return P||C?"RGB":"MONOCHROME2"}function h(E,T){var O=E.header.datatypeCode;switch(O){case T.NIFTI1.TYPE_UINT8:case T.NIFTI1.TYPE_UINT16:case T.NIFTI1.TYPE_UINT32:case T.NIFTI1.TYPE_UINT64:return"0000H";case T.NIFTI1.TYPE_INT8:case T.NIFTI1.TYPE_INT16:case T.NIFTI1.TYPE_INT32:case T.NIFTI1.TYPE_INT64:return"0001H";case T.NIFTI1.TYPE_FLOAT32:case T.NIFTI1.TYPE_FLOAT64:case T.NIFTI1.TYPE_RGB:case T.NIFTI1.TYPE_RGBA:return"0000H"}}function g(E){var T=u(E);return T>1?0:void 0}function v(E){var T=s.decimalToFraction,O=E.header.pixDims[1],M=E.header.pixDims[2],P=T(M/O);return P.numerator+"/"+P.denominator}function m(E){var T=E.metaDataManager,O=E.decimalToFraction,M=E.niftiReader;return s.metaDataManager=T,s.decimalToFraction=O,s.niftiReader=M,i}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});function a(r,s){if(!(r instanceof s))throw new TypeError("Cannot call a class as a function")}var f=function r(s,i){a(this,r),this.numerator=s,this.denominator=i};function d(r){if(typeof r!="number"||r instanceof Number)throw new Error("The provided argument ("+r+") is not a number.");var s=new f(r,1);if(l(r)){var i=o(r,9),u=Math.pow(10,i.toString().split(".")[1].length);s.numerator=Math.round(s.numerator*u),s.denominator*=u}var c=t(s.numerator,s.denominator);return s.numerator/=c,s.denominator/=c,s}function l(r){var s=r,i=s%1>0&&s%1<1,u=s%-1<0&&s%-1>-1;return s>0&&i||s<0&&u}function o(r,s){var i=Math.pow(10,s);return Math.round(r*i)/i}function t(r,s){if(!(typeof r=="number"||r instanceof Number)||!(typeof s=="number"||s instanceof Number))throw new Error("Greatest common factor requires 2 numbers to compute. What was provided: "+r+" and "+s+".");r=Math.abs(r),s=Math.abs(s);for(var i=void 0;s;)i=r%s,r=s,s=i;return r}n.decimalToFraction=d,n.hasDecimalPoint=l,n.roundToPlaces=o,n.gcf=t},function(W,n,e){var a=a||{};a.NIFTI1=a.NIFTI1||e(18),a.NIFTI2=a.NIFTI2||e(45),a.Utils=a.Utils||e(12);var f=f||e(19);a.isNIFTI1=function(l){var o,t,r,s;return l.byteLength<a.NIFTI1.STANDARD_HEADER_SIZE?!1:(o=new DataView(l),o&&(t=o.getUint8(a.NIFTI1.MAGIC_NUMBER_LOCATION)),r=o.getUint8(a.NIFTI1.MAGIC_NUMBER_LOCATION+1),s=o.getUint8(a.NIFTI1.MAGIC_NUMBER_LOCATION+2),t===a.NIFTI1.MAGIC_NUMBER[0]&&r===a.NIFTI1.MAGIC_NUMBER[1]&&s===a.NIFTI1.MAGIC_NUMBER[2])},a.isNIFTI2=function(l){var o,t,r,s;return l.byteLength<a.NIFTI1.STANDARD_HEADER_SIZE?!1:(o=new DataView(l),t=o.getUint8(a.NIFTI2.MAGIC_NUMBER_LOCATION),r=o.getUint8(a.NIFTI2.MAGIC_NUMBER_LOCATION+1),s=o.getUint8(a.NIFTI2.MAGIC_NUMBER_LOCATION+2),t===a.NIFTI2.MAGIC_NUMBER[0]&&r===a.NIFTI2.MAGIC_NUMBER[1]&&s===a.NIFTI2.MAGIC_NUMBER[2])},a.isNIFTI=function(l){return a.isNIFTI1(l)||a.isNIFTI2(l)},a.isCompressed=function(l){var o,t,r;return!!(l&&(o=new DataView(l),t=o.getUint8(0),r=o.getUint8(1),t===a.Utils.GUNZIP_MAGIC_COOKIE1||r===a.Utils.GUNZIP_MAGIC_COOKIE2))},a.decompress=function(l){return f.inflate(l).buffer},a.readHeader=function(l){var o=null;return a.isCompressed(l)&&(l=a.decompress(l)),a.isNIFTI1(l)?o=new a.NIFTI1:a.isNIFTI2(l)&&(o=new a.NIFTI2),o&&o.readHeader(l),o},a.hasExtension=function(l){return l.extensionFlag[0]!=0},a.readImage=function(l,o){var t=l.vox_offset,r=1,s=1;l.dims[4]&&(r=l.dims[4]),l.dims[5]&&(s=l.dims[5]);var i=l.dims[1]*l.dims[2]*l.dims[3]*r*s*(l.numBitsPerVoxel/8);return o.slice(t,t+i)},a.readExtension=function(l,o){var t=l.getExtensionLocation(),r=l.extensionSize;return o.slice(t,t+r)},a.readExtensionData=function(l,o){var t=l.getExtensionLocation(),r=l.extensionSize;return o.slice(t+8,t+r-8)};var d=typeof W;d!=="undefined"&&W.exports&&(W.exports=a)},function(W,n,e){var a=a||{};a.Utils=a.Utils||e(12),a.NIFTI1=a.NIFTI1||e(18),a.NIFTI2=a.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},a.NIFTI2.MAGIC_COOKIE=540,a.NIFTI2.MAGIC_NUMBER_LOCATION=4,a.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],a.NIFTI2.prototype.readHeader=function(d){var l=new DataView(d),o=a.Utils.getIntAt(l,0,this.littleEndian),t,r,s,i;if(o!==a.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,o=a.Utils.getIntAt(l,0,this.littleEndian)),o!==a.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=a.Utils.getShortAt(l,12,this.littleEndian),this.numBitsPerVoxel=a.Utils.getShortAt(l,14,this.littleEndian),t=0;t<8;t+=1)i=16+t*8,this.dims[t]=a.Utils.getLongAt(l,i,this.littleEndian);for(this.intent_p1=a.Utils.getDoubleAt(l,80,this.littleEndian),this.intent_p2=a.Utils.getDoubleAt(l,88,this.littleEndian),this.intent_p3=a.Utils.getDoubleAt(l,96,this.littleEndian),t=0;t<8;t+=1)i=104+t*8,this.pixDims[t]=a.Utils.getDoubleAt(l,i,this.littleEndian);for(this.vox_offset=a.Utils.getLongAt(l,168,this.littleEndian),this.scl_slope=a.Utils.getDoubleAt(l,176,this.littleEndian),this.scl_inter=a.Utils.getDoubleAt(l,184,this.littleEndian),this.cal_max=a.Utils.getDoubleAt(l,192,this.littleEndian),this.cal_min=a.Utils.getDoubleAt(l,200,this.littleEndian),this.slice_duration=a.Utils.getDoubleAt(l,208,this.littleEndian),this.toffset=a.Utils.getDoubleAt(l,216,this.littleEndian),this.slice_start=a.Utils.getLongAt(l,224,this.littleEndian),this.slice_end=a.Utils.getLongAt(l,232,this.littleEndian),this.description=a.Utils.getStringAt(l,240,320),this.aux_file=a.Utils.getStringAt(l,320,344),this.qform_code=a.Utils.getIntAt(l,344,this.littleEndian),this.sform_code=a.Utils.getIntAt(l,348,this.littleEndian),this.quatern_b=a.Utils.getDoubleAt(l,352,this.littleEndian),this.quatern_c=a.Utils.getDoubleAt(l,360,this.littleEndian),this.quatern_d=a.Utils.getDoubleAt(l,368,this.littleEndian),this.qoffset_x=a.Utils.getDoubleAt(l,376,this.littleEndian),this.qoffset_y=a.Utils.getDoubleAt(l,384,this.littleEndian),this.qoffset_z=a.Utils.getDoubleAt(l,392,this.littleEndian),r=0;r<3;r+=1)for(s=0;s<4;s+=1)i=400+(r*4+s)*8,this.affine[r][s]=a.Utils.getDoubleAt(l,i,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=a.Utils.getIntAt(l,496,this.littleEndian),this.xyzt_units=a.Utils.getIntAt(l,500,this.littleEndian),this.intent_code=a.Utils.getIntAt(l,504,this.littleEndian),this.intent_name=a.Utils.getStringAt(l,508,524),this.dim_info=a.Utils.getByteAt(l,524),l.byteLength>a.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=a.Utils.getByteAt(l,540),this.extensionFlag[1]=a.Utils.getByteAt(l,541),this.extensionFlag[2]=a.Utils.getByteAt(l,542),this.extensionFlag[3]=a.Utils.getByteAt(l,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(l),this.extensionCode=this.getExtensionCode(l)))},a.NIFTI2.prototype.toFormattedString=function(){var d=a.Utils.formatNumber,l="";return l+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+`)
`,l+="Bits Per Voxel =  = "+this.numBitsPerVoxel+`
`,l+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+`
`,l+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+`
`,l+="Voxel Dimensions (1-8): "+d(this.pixDims[0])+", "+d(this.pixDims[1])+", "+d(this.pixDims[2])+", "+d(this.pixDims[3])+", "+d(this.pixDims[4])+", "+d(this.pixDims[5])+", "+d(this.pixDims[6])+", "+d(this.pixDims[7])+`
`,l+="Image Offset = "+this.vox_offset+`
`,l+="Data Scale:  Slope = "+d(this.scl_slope)+"  Intercept = "+d(this.scl_inter)+`
`,l+="Display Range:  Max = "+d(this.cal_max)+"  Min = "+d(this.cal_min)+`
`,l+="Slice Duration = "+this.slice_duration+`
`,l+="Time Axis Shift = "+this.toffset+`
`,l+="Slice Start = "+this.slice_start+`
`,l+="Slice End = "+this.slice_end+`
`,l+='Description: "'+this.description+`"
`,l+='Auxiliary File: "'+this.aux_file+`"
`,l+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+`)
`,l+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+`)
`,l+="Quaternion Parameters:  b = "+d(this.quatern_b)+"  c = "+d(this.quatern_c)+"  d = "+d(this.quatern_d)+`
`,l+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+`
`,l+="S-Form Parameters X: "+d(this.affine[0][0])+", "+d(this.affine[0][1])+", "+d(this.affine[0][2])+", "+d(this.affine[0][3])+`
`,l+="S-Form Parameters Y: "+d(this.affine[1][0])+", "+d(this.affine[1][1])+", "+d(this.affine[1][2])+", "+d(this.affine[1][3])+`
`,l+="S-Form Parameters Z: "+d(this.affine[2][0])+", "+d(this.affine[2][1])+", "+d(this.affine[2][2])+", "+d(this.affine[2][3])+`
`,l+="Slice Code = "+this.slice_code+`
`,l+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(a.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(a.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+`)
`,l+="Intent Code = "+this.intent_code+`
`,l+='Intent Name: "'+this.intent_name+`"
`,l+="Dim Info = "+this.dim_info+`
`,l},a.NIFTI2.prototype.getExtensionLocation=function(){return a.NIFTI2.MAGIC_COOKIE+4},a.NIFTI2.prototype.getExtensionSize=a.NIFTI1.prototype.getExtensionSize,a.NIFTI2.prototype.getExtensionCode=a.NIFTI1.prototype.getExtensionCode,a.NIFTI2.prototype.getDatatypeCodeString=a.NIFTI1.prototype.getDatatypeCodeString,a.NIFTI2.prototype.getTransformCodeString=a.NIFTI1.prototype.getTransformCodeString,a.NIFTI2.prototype.getUnitsCodeString=a.NIFTI1.prototype.getUnitsCodeString,a.NIFTI2.prototype.getQformMat=a.NIFTI1.prototype.getQformMat,a.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=a.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,a.NIFTI2.prototype.convertNiftiSFormToNEMA=a.NIFTI1.prototype.convertNiftiSFormToNEMA,a.NIFTI2.prototype.nifti_mat33_mul=a.NIFTI1.prototype.nifti_mat33_mul,a.NIFTI2.prototype.nifti_mat33_determ=a.NIFTI1.prototype.nifti_mat33_determ;var f=typeof W;f!=="undefined"&&W.exports&&(W.exports=a.NIFTI2)},function(W,n,e){var a=e(47),f=e(2),d=e(22),l=e(13),o=e(23),t=Object.prototype.toString,r=0,s=4,i=0,u=1,c=2,h=-1,g=0,v=8;function m(M){if(!(this instanceof m))return new m(M);this.options=f.assign({level:h,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},M||{});var P=this.options;P.raw&&P.windowBits>0?P.windowBits=-P.windowBits:P.gzip&&P.windowBits>0&&P.windowBits<16&&(P.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var C=a.deflateInit2(this.strm,P.level,P.method,P.windowBits,P.memLevel,P.strategy);if(C!==i)throw new Error(l[C]);if(P.header&&a.deflateSetHeader(this.strm,P.header),P.dictionary){var _;if(typeof P.dictionary=="string"?_=d.string2buf(P.dictionary):t.call(P.dictionary)==="[object ArrayBuffer]"?_=new Uint8Array(P.dictionary):_=P.dictionary,C=a.deflateSetDictionary(this.strm,_),C!==i)throw new Error(l[C]);this._dict_set=!0}}m.prototype.push=function(M,P){var C=this.strm,_=this.options.chunkSize,D,I;if(this.ended)return!1;I=P===~~P?P:P===!0?s:r,typeof M=="string"?C.input=d.string2buf(M):t.call(M)==="[object ArrayBuffer]"?C.input=new Uint8Array(M):C.input=M,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new f.Buf8(_),C.next_out=0,C.avail_out=_),D=a.deflate(C,I),D!==u&&D!==i)return this.onEnd(D),this.ended=!0,!1;(C.avail_out===0||C.avail_in===0&&(I===s||I===c))&&(this.options.to==="string"?this.onData(d.buf2binstring(f.shrinkBuf(C.output,C.next_out))):this.onData(f.shrinkBuf(C.output,C.next_out)))}while((C.avail_in>0||C.avail_out===0)&&D!==u);return I===s?(D=a.deflateEnd(this.strm),this.onEnd(D),this.ended=!0,D===i):(I===c&&(this.onEnd(i),C.avail_out=0),!0)},m.prototype.onData=function(M){this.chunks.push(M)},m.prototype.onEnd=function(M){M===i&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.msg=this.strm.msg};function E(M,P){var C=new m(P);if(C.push(M,!0),C.err)throw C.msg||l[C.err];return C.result}function T(M,P){return P=P||{},P.raw=!0,E(M,P)}function O(M,P){return P=P||{},P.gzip=!0,E(M,P)}n.Deflate=m,n.deflate=E,n.deflateRaw=T,n.gzip=O},function(W,n,e){var a=e(2),f=e(48),d=e(20),l=e(21),o=e(13),t=0,r=1,s=3,i=4,u=5,c=0,h=1,g=-2,v=-3,m=-5,E=-1,T=1,O=2,M=3,P=4,C=0,_=2,D=8,I=9,y=15,R=8,b=29,z=256,H=z+1+b,B=30,p=19,A=2*H+1,j=15,x=3,L=258,U=L+x+1,S=32,w=42,G=69,$=73,Q=91,re=103,le=113,de=666,me=1,Y=2,V=3,te=4,ne=3;function ue(K,Oe){return K.msg=o[Oe],Oe}function ge(K){return(K<<1)-(K>4?9:0)}function ve(K){for(var Oe=K.length;--Oe>=0;)K[Oe]=0}function Ee(K){var Oe=K.state,Ce=Oe.pending;Ce>K.avail_out&&(Ce=K.avail_out),Ce!==0&&(a.arraySet(K.output,Oe.pending_buf,Oe.pending_out,Ce,K.next_out),K.next_out+=Ce,Oe.pending_out+=Ce,K.total_out+=Ce,K.avail_out-=Ce,Oe.pending-=Ce,Oe.pending===0&&(Oe.pending_out=0))}function De(K,Oe){f._tr_flush_block(K,K.block_start>=0?K.block_start:-1,K.strstart-K.block_start,Oe),K.block_start=K.strstart,Ee(K.strm)}function X(K,Oe){K.pending_buf[K.pending++]=Oe}function N(K,Oe){K.pending_buf[K.pending++]=Oe>>>8&255,K.pending_buf[K.pending++]=Oe&255}function F(K,Oe,Ce,ee){var fe=K.avail_in;return fe>ee&&(fe=ee),fe===0?0:(K.avail_in-=fe,a.arraySet(Oe,K.input,K.next_in,fe,Ce),K.state.wrap===1?K.adler=d(K.adler,Oe,fe,Ce):K.state.wrap===2&&(K.adler=l(K.adler,Oe,fe,Ce)),K.next_in+=fe,K.total_in+=fe,fe)}function q(K,Oe){var Ce=K.max_chain_length,ee=K.strstart,fe,Me,Ke=K.prev_length,be=K.nice_match,Ue=K.strstart>K.w_size-U?K.strstart-(K.w_size-U):0,Ne=K.window,rt=K.w_mask,Ve=K.prev,we=K.strstart+L,Ze=Ne[ee+Ke-1],Je=Ne[ee+Ke];K.prev_length>=K.good_match&&(Ce>>=2),be>K.lookahead&&(be=K.lookahead);do if(fe=Oe,!(Ne[fe+Ke]!==Je||Ne[fe+Ke-1]!==Ze||Ne[fe]!==Ne[ee]||Ne[++fe]!==Ne[ee+1])){ee+=2,fe++;do;while(Ne[++ee]===Ne[++fe]&&Ne[++ee]===Ne[++fe]&&Ne[++ee]===Ne[++fe]&&Ne[++ee]===Ne[++fe]&&Ne[++ee]===Ne[++fe]&&Ne[++ee]===Ne[++fe]&&Ne[++ee]===Ne[++fe]&&Ne[++ee]===Ne[++fe]&&ee<we);if(Me=L-(we-ee),ee=we-L,Me>Ke){if(K.match_start=Oe,Ke=Me,Me>=be)break;Ze=Ne[ee+Ke-1],Je=Ne[ee+Ke]}}while((Oe=Ve[Oe&rt])>Ue&&--Ce!==0);return Ke<=K.lookahead?Ke:K.lookahead}function oe(K){var Oe=K.w_size,Ce,ee,fe,Me,Ke;do{if(Me=K.window_size-K.lookahead-K.strstart,K.strstart>=Oe+(Oe-U)){a.arraySet(K.window,K.window,Oe,Oe,0),K.match_start-=Oe,K.strstart-=Oe,K.block_start-=Oe,ee=K.hash_size,Ce=ee;do fe=K.head[--Ce],K.head[Ce]=fe>=Oe?fe-Oe:0;while(--ee);ee=Oe,Ce=ee;do fe=K.prev[--Ce],K.prev[Ce]=fe>=Oe?fe-Oe:0;while(--ee);Me+=Oe}if(K.strm.avail_in===0)break;if(ee=F(K.strm,K.window,K.strstart+K.lookahead,Me),K.lookahead+=ee,K.lookahead+K.insert>=x)for(Ke=K.strstart-K.insert,K.ins_h=K.window[Ke],K.ins_h=(K.ins_h<<K.hash_shift^K.window[Ke+1])&K.hash_mask;K.insert&&(K.ins_h=(K.ins_h<<K.hash_shift^K.window[Ke+x-1])&K.hash_mask,K.prev[Ke&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=Ke,Ke++,K.insert--,!(K.lookahead+K.insert<x)););}while(K.lookahead<U&&K.strm.avail_in!==0)}function ie(K,Oe){var Ce=65535;for(Ce>K.pending_buf_size-5&&(Ce=K.pending_buf_size-5);;){if(K.lookahead<=1){if(oe(K),K.lookahead===0&&Oe===t)return me;if(K.lookahead===0)break}K.strstart+=K.lookahead,K.lookahead=0;var ee=K.block_start+Ce;if((K.strstart===0||K.strstart>=ee)&&(K.lookahead=K.strstart-ee,K.strstart=ee,De(K,!1),K.strm.avail_out===0)||K.strstart-K.block_start>=K.w_size-U&&(De(K,!1),K.strm.avail_out===0))return me}return K.insert=0,Oe===i?(De(K,!0),K.strm.avail_out===0?V:te):(K.strstart>K.block_start&&(De(K,!1),K.strm.avail_out===0),me)}function he(K,Oe){for(var Ce,ee;;){if(K.lookahead<U){if(oe(K),K.lookahead<U&&Oe===t)return me;if(K.lookahead===0)break}if(Ce=0,K.lookahead>=x&&(K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+x-1])&K.hash_mask,Ce=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),Ce!==0&&K.strstart-Ce<=K.w_size-U&&(K.match_length=q(K,Ce)),K.match_length>=x)if(ee=f._tr_tally(K,K.strstart-K.match_start,K.match_length-x),K.lookahead-=K.match_length,K.match_length<=K.max_lazy_match&&K.lookahead>=x){K.match_length--;do K.strstart++,K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+x-1])&K.hash_mask,Ce=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart;while(--K.match_length!==0);K.strstart++}else K.strstart+=K.match_length,K.match_length=0,K.ins_h=K.window[K.strstart],K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+1])&K.hash_mask;else ee=f._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++;if(ee&&(De(K,!1),K.strm.avail_out===0))return me}return K.insert=K.strstart<x-1?K.strstart:x-1,Oe===i?(De(K,!0),K.strm.avail_out===0?V:te):K.last_lit&&(De(K,!1),K.strm.avail_out===0)?me:Y}function pe(K,Oe){for(var Ce,ee,fe;;){if(K.lookahead<U){if(oe(K),K.lookahead<U&&Oe===t)return me;if(K.lookahead===0)break}if(Ce=0,K.lookahead>=x&&(K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+x-1])&K.hash_mask,Ce=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),K.prev_length=K.match_length,K.prev_match=K.match_start,K.match_length=x-1,Ce!==0&&K.prev_length<K.max_lazy_match&&K.strstart-Ce<=K.w_size-U&&(K.match_length=q(K,Ce),K.match_length<=5&&(K.strategy===T||K.match_length===x&&K.strstart-K.match_start>4096)&&(K.match_length=x-1)),K.prev_length>=x&&K.match_length<=K.prev_length){fe=K.strstart+K.lookahead-x,ee=f._tr_tally(K,K.strstart-1-K.prev_match,K.prev_length-x),K.lookahead-=K.prev_length-1,K.prev_length-=2;do++K.strstart<=fe&&(K.ins_h=(K.ins_h<<K.hash_shift^K.window[K.strstart+x-1])&K.hash_mask,Ce=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart);while(--K.prev_length!==0);if(K.match_available=0,K.match_length=x-1,K.strstart++,ee&&(De(K,!1),K.strm.avail_out===0))return me}else if(K.match_available){if(ee=f._tr_tally(K,0,K.window[K.strstart-1]),ee&&De(K,!1),K.strstart++,K.lookahead--,K.strm.avail_out===0)return me}else K.match_available=1,K.strstart++,K.lookahead--}return K.match_available&&(ee=f._tr_tally(K,0,K.window[K.strstart-1]),K.match_available=0),K.insert=K.strstart<x-1?K.strstart:x-1,Oe===i?(De(K,!0),K.strm.avail_out===0?V:te):K.last_lit&&(De(K,!1),K.strm.avail_out===0)?me:Y}function ye(K,Oe){for(var Ce,ee,fe,Me,Ke=K.window;;){if(K.lookahead<=L){if(oe(K),K.lookahead<=L&&Oe===t)return me;if(K.lookahead===0)break}if(K.match_length=0,K.lookahead>=x&&K.strstart>0&&(fe=K.strstart-1,ee=Ke[fe],ee===Ke[++fe]&&ee===Ke[++fe]&&ee===Ke[++fe])){Me=K.strstart+L;do;while(ee===Ke[++fe]&&ee===Ke[++fe]&&ee===Ke[++fe]&&ee===Ke[++fe]&&ee===Ke[++fe]&&ee===Ke[++fe]&&ee===Ke[++fe]&&ee===Ke[++fe]&&fe<Me);K.match_length=L-(Me-fe),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=x?(Ce=f._tr_tally(K,1,K.match_length-x),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(Ce=f._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),Ce&&(De(K,!1),K.strm.avail_out===0))return me}return K.insert=0,Oe===i?(De(K,!0),K.strm.avail_out===0?V:te):K.last_lit&&(De(K,!1),K.strm.avail_out===0)?me:Y}function Se(K,Oe){for(var Ce;;){if(K.lookahead===0&&(oe(K),K.lookahead===0)){if(Oe===t)return me;break}if(K.match_length=0,Ce=f._tr_tally(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,Ce&&(De(K,!1),K.strm.avail_out===0))return me}return K.insert=0,Oe===i?(De(K,!0),K.strm.avail_out===0?V:te):K.last_lit&&(De(K,!1),K.strm.avail_out===0)?me:Y}function Re(K,Oe,Ce,ee,fe){this.good_length=K,this.max_lazy=Oe,this.nice_length=Ce,this.max_chain=ee,this.func=fe}var Be;Be=[new Re(0,0,0,0,ie),new Re(4,4,8,4,he),new Re(4,5,16,8,he),new Re(4,6,32,32,he),new Re(4,4,16,16,pe),new Re(8,16,32,32,pe),new Re(8,16,128,128,pe),new Re(8,32,128,256,pe),new Re(32,128,258,1024,pe),new Re(32,258,258,4096,pe)];function Le(K){K.window_size=2*K.w_size,ve(K.head),K.max_lazy_match=Be[K.level].max_lazy,K.good_match=Be[K.level].good_length,K.nice_match=Be[K.level].nice_length,K.max_chain_length=Be[K.level].max_chain,K.strstart=0,K.block_start=0,K.lookahead=0,K.insert=0,K.match_length=K.prev_length=x-1,K.match_available=0,K.ins_h=0}function J(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=D,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(A*2),this.dyn_dtree=new a.Buf16((2*B+1)*2),this.bl_tree=new a.Buf16((2*p+1)*2),ve(this.dyn_ltree),ve(this.dyn_dtree),ve(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(j+1),this.heap=new a.Buf16(2*H+1),ve(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*H+1),ve(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Pe(K){var Oe;return!K||!K.state?ue(K,g):(K.total_in=K.total_out=0,K.data_type=_,Oe=K.state,Oe.pending=0,Oe.pending_out=0,Oe.wrap<0&&(Oe.wrap=-Oe.wrap),Oe.status=Oe.wrap?w:le,K.adler=Oe.wrap===2?0:1,Oe.last_flush=t,f._tr_init(Oe),c)}function Ie(K){var Oe=Pe(K);return Oe===c&&Le(K.state),Oe}function xe(K,Oe){return!K||!K.state||K.state.wrap!==2?g:(K.state.gzhead=Oe,c)}function ce(K,Oe,Ce,ee,fe,Me){if(!K)return g;var Ke=1;if(Oe===E&&(Oe=6),ee<0?(Ke=0,ee=-ee):ee>15&&(Ke=2,ee-=16),fe<1||fe>I||Ce!==D||ee<8||ee>15||Oe<0||Oe>9||Me<0||Me>P)return ue(K,g);ee===8&&(ee=9);var be=new J;return K.state=be,be.strm=K,be.wrap=Ke,be.gzhead=null,be.w_bits=ee,be.w_size=1<<be.w_bits,be.w_mask=be.w_size-1,be.hash_bits=fe+7,be.hash_size=1<<be.hash_bits,be.hash_mask=be.hash_size-1,be.hash_shift=~~((be.hash_bits+x-1)/x),be.window=new a.Buf8(be.w_size*2),be.head=new a.Buf16(be.hash_size),be.prev=new a.Buf16(be.w_size),be.lit_bufsize=1<<fe+6,be.pending_buf_size=be.lit_bufsize*4,be.pending_buf=new a.Buf8(be.pending_buf_size),be.d_buf=1*be.lit_bufsize,be.l_buf=3*be.lit_bufsize,be.level=Oe,be.strategy=Me,be.method=Ce,Ie(K)}function _e(K,Oe){return ce(K,Oe,D,y,R,C)}function Z(K,Oe){var Ce,ee,fe,Me;if(!K||!K.state||Oe>u||Oe<0)return K?ue(K,g):g;if(ee=K.state,!K.output||!K.input&&K.avail_in!==0||ee.status===de&&Oe!==i)return ue(K,K.avail_out===0?m:g);if(ee.strm=K,Ce=ee.last_flush,ee.last_flush=Oe,ee.status===w)if(ee.wrap===2)K.adler=0,X(ee,31),X(ee,139),X(ee,8),ee.gzhead?(X(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),X(ee,ee.gzhead.time&255),X(ee,ee.gzhead.time>>8&255),X(ee,ee.gzhead.time>>16&255),X(ee,ee.gzhead.time>>24&255),X(ee,ee.level===9?2:ee.strategy>=O||ee.level<2?4:0),X(ee,ee.gzhead.os&255),ee.gzhead.extra&&ee.gzhead.extra.length&&(X(ee,ee.gzhead.extra.length&255),X(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(K.adler=l(K.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=G):(X(ee,0),X(ee,0),X(ee,0),X(ee,0),X(ee,0),X(ee,ee.level===9?2:ee.strategy>=O||ee.level<2?4:0),X(ee,ne),ee.status=le);else{var Ke=D+(ee.w_bits-8<<4)<<8,be=-1;ee.strategy>=O||ee.level<2?be=0:ee.level<6?be=1:ee.level===6?be=2:be=3,Ke|=be<<6,ee.strstart!==0&&(Ke|=S),Ke+=31-Ke%31,ee.status=le,N(ee,Ke),ee.strstart!==0&&(N(ee,K.adler>>>16),N(ee,K.adler&65535)),K.adler=1}if(ee.status===G)if(ee.gzhead.extra){for(fe=ee.pending;ee.gzindex<(ee.gzhead.extra.length&65535)&&!(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>fe&&(K.adler=l(K.adler,ee.pending_buf,ee.pending-fe,fe)),Ee(K),fe=ee.pending,ee.pending===ee.pending_buf_size));)X(ee,ee.gzhead.extra[ee.gzindex]&255),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>fe&&(K.adler=l(K.adler,ee.pending_buf,ee.pending-fe,fe)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=$)}else ee.status=$;if(ee.status===$)if(ee.gzhead.name){fe=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>fe&&(K.adler=l(K.adler,ee.pending_buf,ee.pending-fe,fe)),Ee(K),fe=ee.pending,ee.pending===ee.pending_buf_size)){Me=1;break}ee.gzindex<ee.gzhead.name.length?Me=ee.gzhead.name.charCodeAt(ee.gzindex++)&255:Me=0,X(ee,Me)}while(Me!==0);ee.gzhead.hcrc&&ee.pending>fe&&(K.adler=l(K.adler,ee.pending_buf,ee.pending-fe,fe)),Me===0&&(ee.gzindex=0,ee.status=Q)}else ee.status=Q;if(ee.status===Q)if(ee.gzhead.comment){fe=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>fe&&(K.adler=l(K.adler,ee.pending_buf,ee.pending-fe,fe)),Ee(K),fe=ee.pending,ee.pending===ee.pending_buf_size)){Me=1;break}ee.gzindex<ee.gzhead.comment.length?Me=ee.gzhead.comment.charCodeAt(ee.gzindex++)&255:Me=0,X(ee,Me)}while(Me!==0);ee.gzhead.hcrc&&ee.pending>fe&&(K.adler=l(K.adler,ee.pending_buf,ee.pending-fe,fe)),Me===0&&(ee.status=re)}else ee.status=re;if(ee.status===re&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&Ee(K),ee.pending+2<=ee.pending_buf_size&&(X(ee,K.adler&255),X(ee,K.adler>>8&255),K.adler=0,ee.status=le)):ee.status=le),ee.pending!==0){if(Ee(K),K.avail_out===0)return ee.last_flush=-1,c}else if(K.avail_in===0&&ge(Oe)<=ge(Ce)&&Oe!==i)return ue(K,m);if(ee.status===de&&K.avail_in!==0)return ue(K,m);if(K.avail_in!==0||ee.lookahead!==0||Oe!==t&&ee.status!==de){var Ue=ee.strategy===O?Se(ee,Oe):ee.strategy===M?ye(ee,Oe):Be[ee.level].func(ee,Oe);if((Ue===V||Ue===te)&&(ee.status=de),Ue===me||Ue===V)return K.avail_out===0&&(ee.last_flush=-1),c;if(Ue===Y&&(Oe===r?f._tr_align(ee):Oe!==u&&(f._tr_stored_block(ee,0,0,!1),Oe===s&&(ve(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),Ee(K),K.avail_out===0))return ee.last_flush=-1,c}return Oe!==i?c:ee.wrap<=0?h:(ee.wrap===2?(X(ee,K.adler&255),X(ee,K.adler>>8&255),X(ee,K.adler>>16&255),X(ee,K.adler>>24&255),X(ee,K.total_in&255),X(ee,K.total_in>>8&255),X(ee,K.total_in>>16&255),X(ee,K.total_in>>24&255)):(N(ee,K.adler>>>16),N(ee,K.adler&65535)),Ee(K),ee.wrap>0&&(ee.wrap=-ee.wrap),ee.pending!==0?c:h)}function je(K){var Oe;return!K||!K.state?g:(Oe=K.state.status,Oe!==w&&Oe!==G&&Oe!==$&&Oe!==Q&&Oe!==re&&Oe!==le&&Oe!==de?ue(K,g):(K.state=null,Oe===le?ue(K,v):c))}function Fe(K,Oe){var Ce=Oe.length,ee,fe,Me,Ke,be,Ue,Ne,rt;if(!K||!K.state||(ee=K.state,Ke=ee.wrap,Ke===2||Ke===1&&ee.status!==w||ee.lookahead))return g;for(Ke===1&&(K.adler=d(K.adler,Oe,Ce,0)),ee.wrap=0,Ce>=ee.w_size&&(Ke===0&&(ve(ee.head),ee.strstart=0,ee.block_start=0,ee.insert=0),rt=new a.Buf8(ee.w_size),a.arraySet(rt,Oe,Ce-ee.w_size,ee.w_size,0),Oe=rt,Ce=ee.w_size),be=K.avail_in,Ue=K.next_in,Ne=K.input,K.avail_in=Ce,K.next_in=0,K.input=Oe,oe(ee);ee.lookahead>=x;){fe=ee.strstart,Me=ee.lookahead-(x-1);do ee.ins_h=(ee.ins_h<<ee.hash_shift^ee.window[fe+x-1])&ee.hash_mask,ee.prev[fe&ee.w_mask]=ee.head[ee.ins_h],ee.head[ee.ins_h]=fe,fe++;while(--Me);ee.strstart=fe,ee.lookahead=x-1,oe(ee)}return ee.strstart+=ee.lookahead,ee.block_start=ee.strstart,ee.insert=ee.lookahead,ee.lookahead=0,ee.match_length=ee.prev_length=x-1,ee.match_available=0,K.next_in=Ue,K.input=Ne,K.avail_in=be,ee.wrap=Ke,c}n.deflateInit=_e,n.deflateInit2=ce,n.deflateReset=Ie,n.deflateResetKeep=Pe,n.deflateSetHeader=xe,n.deflate=Z,n.deflateEnd=je,n.deflateSetDictionary=Fe,n.deflateInfo="pako deflate (from Nodeca project)"},function(W,n,e){var a=e(2),f=4,d=0,l=1,o=2;function t(J){for(var Pe=J.length;--Pe>=0;)J[Pe]=0}var r=0,s=1,i=2,u=3,c=258,h=29,g=256,v=g+1+h,m=30,E=19,T=2*v+1,O=15,M=16,P=7,C=256,_=16,D=17,I=18,y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=512,B=new Array((v+2)*2);t(B);var p=new Array(m*2);t(p);var A=new Array(H);t(A);var j=new Array(c-u+1);t(j);var x=new Array(h);t(x);var L=new Array(m);t(L);function U(J,Pe,Ie,xe,ce){this.static_tree=J,this.extra_bits=Pe,this.extra_base=Ie,this.elems=xe,this.max_length=ce,this.has_stree=J&&J.length}var S,w,G;function $(J,Pe){this.dyn_tree=J,this.max_code=0,this.stat_desc=Pe}function Q(J){return J<256?A[J]:A[256+(J>>>7)]}function re(J,Pe){J.pending_buf[J.pending++]=Pe&255,J.pending_buf[J.pending++]=Pe>>>8&255}function le(J,Pe,Ie){J.bi_valid>M-Ie?(J.bi_buf|=Pe<<J.bi_valid&65535,re(J,J.bi_buf),J.bi_buf=Pe>>M-J.bi_valid,J.bi_valid+=Ie-M):(J.bi_buf|=Pe<<J.bi_valid&65535,J.bi_valid+=Ie)}function de(J,Pe,Ie){le(J,Ie[Pe*2],Ie[Pe*2+1])}function me(J,Pe){var Ie=0;do Ie|=J&1,J>>>=1,Ie<<=1;while(--Pe>0);return Ie>>>1}function Y(J){J.bi_valid===16?(re(J,J.bi_buf),J.bi_buf=0,J.bi_valid=0):J.bi_valid>=8&&(J.pending_buf[J.pending++]=J.bi_buf&255,J.bi_buf>>=8,J.bi_valid-=8)}function V(J,Pe){var Ie=Pe.dyn_tree,xe=Pe.max_code,ce=Pe.stat_desc.static_tree,_e=Pe.stat_desc.has_stree,Z=Pe.stat_desc.extra_bits,je=Pe.stat_desc.extra_base,Fe=Pe.stat_desc.max_length,K,Oe,Ce,ee,fe,Me,Ke=0;for(ee=0;ee<=O;ee++)J.bl_count[ee]=0;for(Ie[J.heap[J.heap_max]*2+1]=0,K=J.heap_max+1;K<T;K++)Oe=J.heap[K],ee=Ie[Ie[Oe*2+1]*2+1]+1,ee>Fe&&(ee=Fe,Ke++),Ie[Oe*2+1]=ee,!(Oe>xe)&&(J.bl_count[ee]++,fe=0,Oe>=je&&(fe=Z[Oe-je]),Me=Ie[Oe*2],J.opt_len+=Me*(ee+fe),_e&&(J.static_len+=Me*(ce[Oe*2+1]+fe)));if(Ke!==0){do{for(ee=Fe-1;J.bl_count[ee]===0;)ee--;J.bl_count[ee]--,J.bl_count[ee+1]+=2,J.bl_count[Fe]--,Ke-=2}while(Ke>0);for(ee=Fe;ee!==0;ee--)for(Oe=J.bl_count[ee];Oe!==0;)Ce=J.heap[--K],!(Ce>xe)&&(Ie[Ce*2+1]!==ee&&(J.opt_len+=(ee-Ie[Ce*2+1])*Ie[Ce*2],Ie[Ce*2+1]=ee),Oe--)}}function te(J,Pe,Ie){var xe=new Array(O+1),ce=0,_e,Z;for(_e=1;_e<=O;_e++)xe[_e]=ce=ce+Ie[_e-1]<<1;for(Z=0;Z<=Pe;Z++){var je=J[Z*2+1];je!==0&&(J[Z*2]=me(xe[je]++,je))}}function ne(){var J,Pe,Ie,xe,ce,_e=new Array(O+1);for(Ie=0,xe=0;xe<h-1;xe++)for(x[xe]=Ie,J=0;J<1<<y[xe];J++)j[Ie++]=xe;for(j[Ie-1]=xe,ce=0,xe=0;xe<16;xe++)for(L[xe]=ce,J=0;J<1<<R[xe];J++)A[ce++]=xe;for(ce>>=7;xe<m;xe++)for(L[xe]=ce<<7,J=0;J<1<<R[xe]-7;J++)A[256+ce++]=xe;for(Pe=0;Pe<=O;Pe++)_e[Pe]=0;for(J=0;J<=143;)B[J*2+1]=8,J++,_e[8]++;for(;J<=255;)B[J*2+1]=9,J++,_e[9]++;for(;J<=279;)B[J*2+1]=7,J++,_e[7]++;for(;J<=287;)B[J*2+1]=8,J++,_e[8]++;for(te(B,v+1,_e),J=0;J<m;J++)p[J*2+1]=5,p[J*2]=me(J,5);S=new U(B,y,g+1,v,O),w=new U(p,R,0,m,O),G=new U(new Array(0),b,0,E,P)}function ue(J){var Pe;for(Pe=0;Pe<v;Pe++)J.dyn_ltree[Pe*2]=0;for(Pe=0;Pe<m;Pe++)J.dyn_dtree[Pe*2]=0;for(Pe=0;Pe<E;Pe++)J.bl_tree[Pe*2]=0;J.dyn_ltree[C*2]=1,J.opt_len=J.static_len=0,J.last_lit=J.matches=0}function ge(J){J.bi_valid>8?re(J,J.bi_buf):J.bi_valid>0&&(J.pending_buf[J.pending++]=J.bi_buf),J.bi_buf=0,J.bi_valid=0}function ve(J,Pe,Ie,xe){ge(J),re(J,Ie),re(J,~Ie),a.arraySet(J.pending_buf,J.window,Pe,Ie,J.pending),J.pending+=Ie}function Ee(J,Pe,Ie,xe){var ce=Pe*2,_e=Ie*2;return J[ce]<J[_e]||J[ce]===J[_e]&&xe[Pe]<=xe[Ie]}function De(J,Pe,Ie){for(var xe=J.heap[Ie],ce=Ie<<1;ce<=J.heap_len&&(ce<J.heap_len&&Ee(Pe,J.heap[ce+1],J.heap[ce],J.depth)&&ce++,!Ee(Pe,xe,J.heap[ce],J.depth));)J.heap[Ie]=J.heap[ce],Ie=ce,ce<<=1;J.heap[Ie]=xe}function X(J,Pe,Ie){var xe,ce,_e=0,Z,je;if(J.last_lit!==0)do xe=J.pending_buf[J.d_buf+_e*2]<<8|J.pending_buf[J.d_buf+_e*2+1],ce=J.pending_buf[J.l_buf+_e],_e++,xe===0?de(J,ce,Pe):(Z=j[ce],de(J,Z+g+1,Pe),je=y[Z],je!==0&&(ce-=x[Z],le(J,ce,je)),xe--,Z=Q(xe),de(J,Z,Ie),je=R[Z],je!==0&&(xe-=L[Z],le(J,xe,je)));while(_e<J.last_lit);de(J,C,Pe)}function N(J,Pe){var Ie=Pe.dyn_tree,xe=Pe.stat_desc.static_tree,ce=Pe.stat_desc.has_stree,_e=Pe.stat_desc.elems,Z,je,Fe=-1,K;for(J.heap_len=0,J.heap_max=T,Z=0;Z<_e;Z++)Ie[Z*2]!==0?(J.heap[++J.heap_len]=Fe=Z,J.depth[Z]=0):Ie[Z*2+1]=0;for(;J.heap_len<2;)K=J.heap[++J.heap_len]=Fe<2?++Fe:0,Ie[K*2]=1,J.depth[K]=0,J.opt_len--,ce&&(J.static_len-=xe[K*2+1]);for(Pe.max_code=Fe,Z=J.heap_len>>1;Z>=1;Z--)De(J,Ie,Z);K=_e;do Z=J.heap[1],J.heap[1]=J.heap[J.heap_len--],De(J,Ie,1),je=J.heap[1],J.heap[--J.heap_max]=Z,J.heap[--J.heap_max]=je,Ie[K*2]=Ie[Z*2]+Ie[je*2],J.depth[K]=(J.depth[Z]>=J.depth[je]?J.depth[Z]:J.depth[je])+1,Ie[Z*2+1]=Ie[je*2+1]=K,J.heap[1]=K++,De(J,Ie,1);while(J.heap_len>=2);J.heap[--J.heap_max]=J.heap[1],V(J,Pe),te(Ie,Fe,J.bl_count)}function F(J,Pe,Ie){var xe,ce=-1,_e,Z=Pe[0*2+1],je=0,Fe=7,K=4;for(Z===0&&(Fe=138,K=3),Pe[(Ie+1)*2+1]=65535,xe=0;xe<=Ie;xe++)_e=Z,Z=Pe[(xe+1)*2+1],!(++je<Fe&&_e===Z)&&(je<K?J.bl_tree[_e*2]+=je:_e!==0?(_e!==ce&&J.bl_tree[_e*2]++,J.bl_tree[_*2]++):je<=10?J.bl_tree[D*2]++:J.bl_tree[I*2]++,je=0,ce=_e,Z===0?(Fe=138,K=3):_e===Z?(Fe=6,K=3):(Fe=7,K=4))}function q(J,Pe,Ie){var xe,ce=-1,_e,Z=Pe[0*2+1],je=0,Fe=7,K=4;for(Z===0&&(Fe=138,K=3),xe=0;xe<=Ie;xe++)if(_e=Z,Z=Pe[(xe+1)*2+1],!(++je<Fe&&_e===Z)){if(je<K)do de(J,_e,J.bl_tree);while(--je!==0);else _e!==0?(_e!==ce&&(de(J,_e,J.bl_tree),je--),de(J,_,J.bl_tree),le(J,je-3,2)):je<=10?(de(J,D,J.bl_tree),le(J,je-3,3)):(de(J,I,J.bl_tree),le(J,je-11,7));je=0,ce=_e,Z===0?(Fe=138,K=3):_e===Z?(Fe=6,K=3):(Fe=7,K=4)}}function oe(J){var Pe;for(F(J,J.dyn_ltree,J.l_desc.max_code),F(J,J.dyn_dtree,J.d_desc.max_code),N(J,J.bl_desc),Pe=E-1;Pe>=3&&J.bl_tree[z[Pe]*2+1]===0;Pe--);return J.opt_len+=3*(Pe+1)+5+5+4,Pe}function ie(J,Pe,Ie,xe){var ce;for(le(J,Pe-257,5),le(J,Ie-1,5),le(J,xe-4,4),ce=0;ce<xe;ce++)le(J,J.bl_tree[z[ce]*2+1],3);q(J,J.dyn_ltree,Pe-1),q(J,J.dyn_dtree,Ie-1)}function he(J){var Pe=4093624447,Ie;for(Ie=0;Ie<=31;Ie++,Pe>>>=1)if(Pe&1&&J.dyn_ltree[Ie*2]!==0)return d;if(J.dyn_ltree[9*2]!==0||J.dyn_ltree[10*2]!==0||J.dyn_ltree[13*2]!==0)return l;for(Ie=32;Ie<g;Ie++)if(J.dyn_ltree[Ie*2]!==0)return l;return d}var pe=!1;function ye(J){pe||(ne(),pe=!0),J.l_desc=new $(J.dyn_ltree,S),J.d_desc=new $(J.dyn_dtree,w),J.bl_desc=new $(J.bl_tree,G),J.bi_buf=0,J.bi_valid=0,ue(J)}function Se(J,Pe,Ie,xe){le(J,(r<<1)+(xe?1:0),3),ve(J,Pe,Ie)}function Re(J){le(J,s<<1,3),de(J,C,B),Y(J)}function Be(J,Pe,Ie,xe){var ce,_e,Z=0;J.level>0?(J.strm.data_type===o&&(J.strm.data_type=he(J)),N(J,J.l_desc),N(J,J.d_desc),Z=oe(J),ce=J.opt_len+3+7>>>3,_e=J.static_len+3+7>>>3,_e<=ce&&(ce=_e)):ce=_e=Ie+5,Ie+4<=ce&&Pe!==-1?Se(J,Pe,Ie,xe):J.strategy===f||_e===ce?(le(J,(s<<1)+(xe?1:0),3),X(J,B,p)):(le(J,(i<<1)+(xe?1:0),3),ie(J,J.l_desc.max_code+1,J.d_desc.max_code+1,Z+1),X(J,J.dyn_ltree,J.dyn_dtree)),ue(J),xe&&ge(J)}function Le(J,Pe,Ie){return J.pending_buf[J.d_buf+J.last_lit*2]=Pe>>>8&255,J.pending_buf[J.d_buf+J.last_lit*2+1]=Pe&255,J.pending_buf[J.l_buf+J.last_lit]=Ie&255,J.last_lit++,Pe===0?J.dyn_ltree[Ie*2]++:(J.matches++,Pe--,J.dyn_ltree[(j[Ie]+g+1)*2]++,J.dyn_dtree[Q(Pe)*2]++),J.last_lit===J.lit_bufsize-1}n._tr_init=ye,n._tr_stored_block=Se,n._tr_flush_block=Be,n._tr_tally=Le,n._tr_align=Re},function(W,n,e){var a=e(50),f=e(2),d=e(22),l=e(24),o=e(13),t=e(23),r=e(53),s=Object.prototype.toString;function i(h){if(!(this instanceof i))return new i(h);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},h||{});var g=this.options;g.raw&&g.windowBits>=0&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),g.windowBits>=0&&g.windowBits<16&&!(h&&h.windowBits)&&(g.windowBits+=32),g.windowBits>15&&g.windowBits<48&&(g.windowBits&15)===0&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new t,this.strm.avail_out=0;var v=a.inflateInit2(this.strm,g.windowBits);if(v!==l.Z_OK)throw new Error(o[v]);this.header=new r,a.inflateGetHeader(this.strm,this.header)}i.prototype.push=function(h,g){var v=this.strm,m=this.options.chunkSize,E=this.options.dictionary,T,O,M,P,C,_,D=!1;if(this.ended)return!1;O=g===~~g?g:g===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof h=="string"?v.input=d.binstring2buf(h):s.call(h)==="[object ArrayBuffer]"?v.input=new Uint8Array(h):v.input=h,v.next_in=0,v.avail_in=v.input.length;do{if(v.avail_out===0&&(v.output=new f.Buf8(m),v.next_out=0,v.avail_out=m),T=a.inflate(v,l.Z_NO_FLUSH),T===l.Z_NEED_DICT&&E&&(typeof E=="string"?_=d.string2buf(E):s.call(E)==="[object ArrayBuffer]"?_=new Uint8Array(E):_=E,T=a.inflateSetDictionary(this.strm,_)),T===l.Z_BUF_ERROR&&D===!0&&(T=l.Z_OK,D=!1),T!==l.Z_STREAM_END&&T!==l.Z_OK)return this.onEnd(T),this.ended=!0,!1;v.next_out&&(v.avail_out===0||T===l.Z_STREAM_END||v.avail_in===0&&(O===l.Z_FINISH||O===l.Z_SYNC_FLUSH))&&(this.options.to==="string"?(M=d.utf8border(v.output,v.next_out),P=v.next_out-M,C=d.buf2string(v.output,M),v.next_out=P,v.avail_out=m-P,P&&f.arraySet(v.output,v.output,M,P,0),this.onData(C)):this.onData(f.shrinkBuf(v.output,v.next_out))),v.avail_in===0&&v.avail_out===0&&(D=!0)}while((v.avail_in>0||v.avail_out===0)&&T!==l.Z_STREAM_END);return T===l.Z_STREAM_END&&(O=l.Z_FINISH),O===l.Z_FINISH?(T=a.inflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===l.Z_OK):(O===l.Z_SYNC_FLUSH&&(this.onEnd(l.Z_OK),v.avail_out=0),!0)},i.prototype.onData=function(h){this.chunks.push(h)},i.prototype.onEnd=function(h){h===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg};function u(h,g){var v=new i(g);if(v.push(h,!0),v.err)throw v.msg||o[v.err];return v.result}function c(h,g){return g=g||{},g.raw=!0,u(h,g)}n.Inflate=i,n.inflate=u,n.inflateRaw=c,n.ungzip=u},function(W,n,e){var a=e(2),f=e(20),d=e(21),l=e(51),o=e(52),t=0,r=1,s=2,i=4,u=5,c=6,h=0,g=1,v=2,m=-2,E=-3,T=-4,O=-5,M=8,P=1,C=2,_=3,D=4,I=5,y=6,R=7,b=8,z=9,H=10,B=11,p=12,A=13,j=14,x=15,L=16,U=17,S=18,w=19,G=20,$=21,Q=22,re=23,le=24,de=25,me=26,Y=27,V=28,te=29,ne=30,ue=31,ge=32,ve=852,Ee=592,De=15,X=De;function N(ce){return(ce>>>24&255)+(ce>>>8&65280)+((ce&65280)<<8)+((ce&255)<<24)}function F(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function q(ce){var _e;return!ce||!ce.state?m:(_e=ce.state,ce.total_in=ce.total_out=_e.total=0,ce.msg="",_e.wrap&&(ce.adler=_e.wrap&1),_e.mode=P,_e.last=0,_e.havedict=0,_e.dmax=32768,_e.head=null,_e.hold=0,_e.bits=0,_e.lencode=_e.lendyn=new a.Buf32(ve),_e.distcode=_e.distdyn=new a.Buf32(Ee),_e.sane=1,_e.back=-1,h)}function oe(ce){var _e;return!ce||!ce.state?m:(_e=ce.state,_e.wsize=0,_e.whave=0,_e.wnext=0,q(ce))}function ie(ce,_e){var Z,je;return!ce||!ce.state||(je=ce.state,_e<0?(Z=0,_e=-_e):(Z=(_e>>4)+1,_e<48&&(_e&=15)),_e&&(_e<8||_e>15))?m:(je.window!==null&&je.wbits!==_e&&(je.window=null),je.wrap=Z,je.wbits=_e,oe(ce))}function he(ce,_e){var Z,je;return ce?(je=new F,ce.state=je,je.window=null,Z=ie(ce,_e),Z!==h&&(ce.state=null),Z):m}function pe(ce){return he(ce,X)}var ye=!0,Se,Re;function Be(ce){if(ye){var _e;for(Se=new a.Buf32(512),Re=new a.Buf32(32),_e=0;_e<144;)ce.lens[_e++]=8;for(;_e<256;)ce.lens[_e++]=9;for(;_e<280;)ce.lens[_e++]=7;for(;_e<288;)ce.lens[_e++]=8;for(o(r,ce.lens,0,288,Se,0,ce.work,{bits:9}),_e=0;_e<32;)ce.lens[_e++]=5;o(s,ce.lens,0,32,Re,0,ce.work,{bits:5}),ye=!1}ce.lencode=Se,ce.lenbits=9,ce.distcode=Re,ce.distbits=5}function Le(ce,_e,Z,je){var Fe,K=ce.state;return K.window===null&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new a.Buf8(K.wsize)),je>=K.wsize?(a.arraySet(K.window,_e,Z-K.wsize,K.wsize,0),K.wnext=0,K.whave=K.wsize):(Fe=K.wsize-K.wnext,Fe>je&&(Fe=je),a.arraySet(K.window,_e,Z-je,Fe,K.wnext),je-=Fe,je?(a.arraySet(K.window,_e,Z-je,je,0),K.wnext=je,K.whave=K.wsize):(K.wnext+=Fe,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=Fe))),0}function J(ce,_e){var Z,je,Fe,K,Oe,Ce,ee,fe,Me,Ke,be,Ue,Ne,rt,Ve=0,we,Ze,Je,ke,ht,gt,Ge,$e,Xe=new a.Buf8(4),tt,nt,mt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ce||!ce.state||!ce.output||!ce.input&&ce.avail_in!==0)return m;Z=ce.state,Z.mode===p&&(Z.mode=A),Oe=ce.next_out,Fe=ce.output,ee=ce.avail_out,K=ce.next_in,je=ce.input,Ce=ce.avail_in,fe=Z.hold,Me=Z.bits,Ke=Ce,be=ee,$e=h;e:for(;;)switch(Z.mode){case P:if(Z.wrap===0){Z.mode=A;break}for(;Me<16;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if(Z.wrap&2&&fe===35615){Z.check=0,Xe[0]=fe&255,Xe[1]=fe>>>8&255,Z.check=d(Z.check,Xe,2,0),fe=0,Me=0,Z.mode=C;break}if(Z.flags=0,Z.head&&(Z.head.done=!1),!(Z.wrap&1)||(((fe&255)<<8)+(fe>>8))%31){ce.msg="incorrect header check",Z.mode=ne;break}if((fe&15)!==M){ce.msg="unknown compression method",Z.mode=ne;break}if(fe>>>=4,Me-=4,Ge=(fe&15)+8,Z.wbits===0)Z.wbits=Ge;else if(Ge>Z.wbits){ce.msg="invalid window size",Z.mode=ne;break}Z.dmax=1<<Ge,ce.adler=Z.check=1,Z.mode=fe&512?H:p,fe=0,Me=0;break;case C:for(;Me<16;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if(Z.flags=fe,(Z.flags&255)!==M){ce.msg="unknown compression method",Z.mode=ne;break}if(Z.flags&57344){ce.msg="unknown header flags set",Z.mode=ne;break}Z.head&&(Z.head.text=fe>>8&1),Z.flags&512&&(Xe[0]=fe&255,Xe[1]=fe>>>8&255,Z.check=d(Z.check,Xe,2,0)),fe=0,Me=0,Z.mode=_;case _:for(;Me<32;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}Z.head&&(Z.head.time=fe),Z.flags&512&&(Xe[0]=fe&255,Xe[1]=fe>>>8&255,Xe[2]=fe>>>16&255,Xe[3]=fe>>>24&255,Z.check=d(Z.check,Xe,4,0)),fe=0,Me=0,Z.mode=D;case D:for(;Me<16;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}Z.head&&(Z.head.xflags=fe&255,Z.head.os=fe>>8),Z.flags&512&&(Xe[0]=fe&255,Xe[1]=fe>>>8&255,Z.check=d(Z.check,Xe,2,0)),fe=0,Me=0,Z.mode=I;case I:if(Z.flags&1024){for(;Me<16;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}Z.length=fe,Z.head&&(Z.head.extra_len=fe),Z.flags&512&&(Xe[0]=fe&255,Xe[1]=fe>>>8&255,Z.check=d(Z.check,Xe,2,0)),fe=0,Me=0}else Z.head&&(Z.head.extra=null);Z.mode=y;case y:if(Z.flags&1024&&(Ue=Z.length,Ue>Ce&&(Ue=Ce),Ue&&(Z.head&&(Ge=Z.head.extra_len-Z.length,Z.head.extra||(Z.head.extra=new Array(Z.head.extra_len)),a.arraySet(Z.head.extra,je,K,Ue,Ge)),Z.flags&512&&(Z.check=d(Z.check,je,Ue,K)),Ce-=Ue,K+=Ue,Z.length-=Ue),Z.length))break e;Z.length=0,Z.mode=R;case R:if(Z.flags&2048){if(Ce===0)break e;Ue=0;do Ge=je[K+Ue++],Z.head&&Ge&&Z.length<65536&&(Z.head.name+=String.fromCharCode(Ge));while(Ge&&Ue<Ce);if(Z.flags&512&&(Z.check=d(Z.check,je,Ue,K)),Ce-=Ue,K+=Ue,Ge)break e}else Z.head&&(Z.head.name=null);Z.length=0,Z.mode=b;case b:if(Z.flags&4096){if(Ce===0)break e;Ue=0;do Ge=je[K+Ue++],Z.head&&Ge&&Z.length<65536&&(Z.head.comment+=String.fromCharCode(Ge));while(Ge&&Ue<Ce);if(Z.flags&512&&(Z.check=d(Z.check,je,Ue,K)),Ce-=Ue,K+=Ue,Ge)break e}else Z.head&&(Z.head.comment=null);Z.mode=z;case z:if(Z.flags&512){for(;Me<16;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if(fe!==(Z.check&65535)){ce.msg="header crc mismatch",Z.mode=ne;break}fe=0,Me=0}Z.head&&(Z.head.hcrc=Z.flags>>9&1,Z.head.done=!0),ce.adler=Z.check=0,Z.mode=p;break;case H:for(;Me<32;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}ce.adler=Z.check=N(fe),fe=0,Me=0,Z.mode=B;case B:if(Z.havedict===0)return ce.next_out=Oe,ce.avail_out=ee,ce.next_in=K,ce.avail_in=Ce,Z.hold=fe,Z.bits=Me,v;ce.adler=Z.check=1,Z.mode=p;case p:if(_e===u||_e===c)break e;case A:if(Z.last){fe>>>=Me&7,Me-=Me&7,Z.mode=Y;break}for(;Me<3;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}switch(Z.last=fe&1,fe>>>=1,Me-=1,fe&3){case 0:Z.mode=j;break;case 1:if(Be(Z),Z.mode=G,_e===c){fe>>>=2,Me-=2;break e}break;case 2:Z.mode=U;break;case 3:ce.msg="invalid block type",Z.mode=ne}fe>>>=2,Me-=2;break;case j:for(fe>>>=Me&7,Me-=Me&7;Me<32;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if((fe&65535)!==(fe>>>16^65535)){ce.msg="invalid stored block lengths",Z.mode=ne;break}if(Z.length=fe&65535,fe=0,Me=0,Z.mode=x,_e===c)break e;case x:Z.mode=L;case L:if(Ue=Z.length,Ue){if(Ue>Ce&&(Ue=Ce),Ue>ee&&(Ue=ee),Ue===0)break e;a.arraySet(Fe,je,K,Ue,Oe),Ce-=Ue,K+=Ue,ee-=Ue,Oe+=Ue,Z.length-=Ue;break}Z.mode=p;break;case U:for(;Me<14;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if(Z.nlen=(fe&31)+257,fe>>>=5,Me-=5,Z.ndist=(fe&31)+1,fe>>>=5,Me-=5,Z.ncode=(fe&15)+4,fe>>>=4,Me-=4,Z.nlen>286||Z.ndist>30){ce.msg="too many length or distance symbols",Z.mode=ne;break}Z.have=0,Z.mode=S;case S:for(;Z.have<Z.ncode;){for(;Me<3;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}Z.lens[mt[Z.have++]]=fe&7,fe>>>=3,Me-=3}for(;Z.have<19;)Z.lens[mt[Z.have++]]=0;if(Z.lencode=Z.lendyn,Z.lenbits=7,tt={bits:Z.lenbits},$e=o(t,Z.lens,0,19,Z.lencode,0,Z.work,tt),Z.lenbits=tt.bits,$e){ce.msg="invalid code lengths set",Z.mode=ne;break}Z.have=0,Z.mode=w;case w:for(;Z.have<Z.nlen+Z.ndist;){for(;Ve=Z.lencode[fe&(1<<Z.lenbits)-1],we=Ve>>>24,Ze=Ve>>>16&255,Je=Ve&65535,!(we<=Me);){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if(Je<16)fe>>>=we,Me-=we,Z.lens[Z.have++]=Je;else{if(Je===16){for(nt=we+2;Me<nt;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if(fe>>>=we,Me-=we,Z.have===0){ce.msg="invalid bit length repeat",Z.mode=ne;break}Ge=Z.lens[Z.have-1],Ue=3+(fe&3),fe>>>=2,Me-=2}else if(Je===17){for(nt=we+3;Me<nt;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}fe>>>=we,Me-=we,Ge=0,Ue=3+(fe&7),fe>>>=3,Me-=3}else{for(nt=we+7;Me<nt;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}fe>>>=we,Me-=we,Ge=0,Ue=11+(fe&127),fe>>>=7,Me-=7}if(Z.have+Ue>Z.nlen+Z.ndist){ce.msg="invalid bit length repeat",Z.mode=ne;break}for(;Ue--;)Z.lens[Z.have++]=Ge}}if(Z.mode===ne)break;if(Z.lens[256]===0){ce.msg="invalid code -- missing end-of-block",Z.mode=ne;break}if(Z.lenbits=9,tt={bits:Z.lenbits},$e=o(r,Z.lens,0,Z.nlen,Z.lencode,0,Z.work,tt),Z.lenbits=tt.bits,$e){ce.msg="invalid literal/lengths set",Z.mode=ne;break}if(Z.distbits=6,Z.distcode=Z.distdyn,tt={bits:Z.distbits},$e=o(s,Z.lens,Z.nlen,Z.ndist,Z.distcode,0,Z.work,tt),Z.distbits=tt.bits,$e){ce.msg="invalid distances set",Z.mode=ne;break}if(Z.mode=G,_e===c)break e;case G:Z.mode=$;case $:if(Ce>=6&&ee>=258){ce.next_out=Oe,ce.avail_out=ee,ce.next_in=K,ce.avail_in=Ce,Z.hold=fe,Z.bits=Me,l(ce,be),Oe=ce.next_out,Fe=ce.output,ee=ce.avail_out,K=ce.next_in,je=ce.input,Ce=ce.avail_in,fe=Z.hold,Me=Z.bits,Z.mode===p&&(Z.back=-1);break}for(Z.back=0;Ve=Z.lencode[fe&(1<<Z.lenbits)-1],we=Ve>>>24,Ze=Ve>>>16&255,Je=Ve&65535,!(we<=Me);){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if(Ze&&(Ze&240)===0){for(ke=we,ht=Ze,gt=Je;Ve=Z.lencode[gt+((fe&(1<<ke+ht)-1)>>ke)],we=Ve>>>24,Ze=Ve>>>16&255,Je=Ve&65535,!(ke+we<=Me);){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}fe>>>=ke,Me-=ke,Z.back+=ke}if(fe>>>=we,Me-=we,Z.back+=we,Z.length=Je,Ze===0){Z.mode=me;break}if(Ze&32){Z.back=-1,Z.mode=p;break}if(Ze&64){ce.msg="invalid literal/length code",Z.mode=ne;break}Z.extra=Ze&15,Z.mode=Q;case Q:if(Z.extra){for(nt=Z.extra;Me<nt;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}Z.length+=fe&(1<<Z.extra)-1,fe>>>=Z.extra,Me-=Z.extra,Z.back+=Z.extra}Z.was=Z.length,Z.mode=re;case re:for(;Ve=Z.distcode[fe&(1<<Z.distbits)-1],we=Ve>>>24,Ze=Ve>>>16&255,Je=Ve&65535,!(we<=Me);){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if((Ze&240)===0){for(ke=we,ht=Ze,gt=Je;Ve=Z.distcode[gt+((fe&(1<<ke+ht)-1)>>ke)],we=Ve>>>24,Ze=Ve>>>16&255,Je=Ve&65535,!(ke+we<=Me);){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}fe>>>=ke,Me-=ke,Z.back+=ke}if(fe>>>=we,Me-=we,Z.back+=we,Ze&64){ce.msg="invalid distance code",Z.mode=ne;break}Z.offset=Je,Z.extra=Ze&15,Z.mode=le;case le:if(Z.extra){for(nt=Z.extra;Me<nt;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}Z.offset+=fe&(1<<Z.extra)-1,fe>>>=Z.extra,Me-=Z.extra,Z.back+=Z.extra}if(Z.offset>Z.dmax){ce.msg="invalid distance too far back",Z.mode=ne;break}Z.mode=de;case de:if(ee===0)break e;if(Ue=be-ee,Z.offset>Ue){if(Ue=Z.offset-Ue,Ue>Z.whave&&Z.sane){ce.msg="invalid distance too far back",Z.mode=ne;break}Ue>Z.wnext?(Ue-=Z.wnext,Ne=Z.wsize-Ue):Ne=Z.wnext-Ue,Ue>Z.length&&(Ue=Z.length),rt=Z.window}else rt=Fe,Ne=Oe-Z.offset,Ue=Z.length;Ue>ee&&(Ue=ee),ee-=Ue,Z.length-=Ue;do Fe[Oe++]=rt[Ne++];while(--Ue);Z.length===0&&(Z.mode=$);break;case me:if(ee===0)break e;Fe[Oe++]=Z.length,ee--,Z.mode=$;break;case Y:if(Z.wrap){for(;Me<32;){if(Ce===0)break e;Ce--,fe|=je[K++]<<Me,Me+=8}if(be-=ee,ce.total_out+=be,Z.total+=be,be&&(ce.adler=Z.check=Z.flags?d(Z.check,Fe,be,Oe-be):f(Z.check,Fe,be,Oe-be)),be=ee,(Z.flags?fe:N(fe))!==Z.check){ce.msg="incorrect data check",Z.mode=ne;break}fe=0,Me=0}Z.mode=V;case V:if(Z.wrap&&Z.flags){for(;Me<32;){if(Ce===0)break e;Ce--,fe+=je[K++]<<Me,Me+=8}if(fe!==(Z.total&4294967295)){ce.msg="incorrect length check",Z.mode=ne;break}fe=0,Me=0}Z.mode=te;case te:$e=g;break e;case ne:$e=E;break e;case ue:return T;case ge:default:return m}return ce.next_out=Oe,ce.avail_out=ee,ce.next_in=K,ce.avail_in=Ce,Z.hold=fe,Z.bits=Me,(Z.wsize||be!==ce.avail_out&&Z.mode<ne&&(Z.mode<Y||_e!==i))&&Le(ce,ce.output,ce.next_out,be-ce.avail_out),Ke-=ce.avail_in,be-=ce.avail_out,ce.total_in+=Ke,ce.total_out+=be,Z.total+=be,Z.wrap&&be&&(ce.adler=Z.check=Z.flags?d(Z.check,Fe,be,ce.next_out-be):f(Z.check,Fe,be,ce.next_out-be)),ce.data_type=Z.bits+(Z.last?64:0)+(Z.mode===p?128:0)+(Z.mode===G||Z.mode===x?256:0),(Ke===0&&be===0||_e===i)&&$e===h&&($e=O),$e}function Pe(ce){if(!ce||!ce.state)return m;var _e=ce.state;return _e.window&&(_e.window=null),ce.state=null,h}function Ie(ce,_e){var Z;return!ce||!ce.state||(Z=ce.state,(Z.wrap&2)===0)?m:(Z.head=_e,_e.done=!1,h)}function xe(ce,_e){var Z=_e.length,je,Fe,K;return!ce||!ce.state||(je=ce.state,je.wrap!==0&&je.mode!==B)?m:je.mode===B&&(Fe=1,Fe=f(Fe,_e,Z,0),Fe!==je.check)?E:(K=Le(ce,_e,Z,Z),K?(je.mode=ue,T):(je.havedict=1,h))}n.inflateReset=oe,n.inflateReset2=ie,n.inflateResetKeep=q,n.inflateInit=pe,n.inflateInit2=he,n.inflate=J,n.inflateEnd=Pe,n.inflateGetHeader=Ie,n.inflateSetDictionary=xe,n.inflateInfo="pako inflate (from Nodeca project)"},function(W,n,e){var a=30,f=12;W.exports=function(l,o){var t,r,s,i,u,c,h,g,v,m,E,T,O,M,P,C,_,D,I,y,R,b,z,H,B;t=l.state,r=l.next_in,H=l.input,s=r+(l.avail_in-5),i=l.next_out,B=l.output,u=i-(o-l.avail_out),c=i+(l.avail_out-257),h=t.dmax,g=t.wsize,v=t.whave,m=t.wnext,E=t.window,T=t.hold,O=t.bits,M=t.lencode,P=t.distcode,C=(1<<t.lenbits)-1,_=(1<<t.distbits)-1;e:do{O<15&&(T+=H[r++]<<O,O+=8,T+=H[r++]<<O,O+=8),D=M[T&C];t:for(;;){if(I=D>>>24,T>>>=I,O-=I,I=D>>>16&255,I===0)B[i++]=D&65535;else if(I&16){y=D&65535,I&=15,I&&(O<I&&(T+=H[r++]<<O,O+=8),y+=T&(1<<I)-1,T>>>=I,O-=I),O<15&&(T+=H[r++]<<O,O+=8,T+=H[r++]<<O,O+=8),D=P[T&_];n:for(;;){if(I=D>>>24,T>>>=I,O-=I,I=D>>>16&255,I&16){if(R=D&65535,I&=15,O<I&&(T+=H[r++]<<O,O+=8,O<I&&(T+=H[r++]<<O,O+=8)),R+=T&(1<<I)-1,R>h){l.msg="invalid distance too far back",t.mode=a;break e}if(T>>>=I,O-=I,I=i-u,R>I){if(I=R-I,I>v&&t.sane){l.msg="invalid distance too far back",t.mode=a;break e}if(b=0,z=E,m===0){if(b+=g-I,I<y){y-=I;do B[i++]=E[b++];while(--I);b=i-R,z=B}}else if(m<I){if(b+=g+m-I,I-=m,I<y){y-=I;do B[i++]=E[b++];while(--I);if(b=0,m<y){I=m,y-=I;do B[i++]=E[b++];while(--I);b=i-R,z=B}}}else if(b+=m-I,I<y){y-=I;do B[i++]=E[b++];while(--I);b=i-R,z=B}for(;y>2;)B[i++]=z[b++],B[i++]=z[b++],B[i++]=z[b++],y-=3;y&&(B[i++]=z[b++],y>1&&(B[i++]=z[b++]))}else{b=i-R;do B[i++]=B[b++],B[i++]=B[b++],B[i++]=B[b++],y-=3;while(y>2);y&&(B[i++]=B[b++],y>1&&(B[i++]=B[b++]))}}else if((I&64)===0){D=P[(D&65535)+(T&(1<<I)-1)];continue n}else{l.msg="invalid distance code",t.mode=a;break e}break}}else if((I&64)===0){D=M[(D&65535)+(T&(1<<I)-1)];continue t}else if(I&32){t.mode=f;break e}else{l.msg="invalid literal/length code",t.mode=a;break e}break}}while(r<s&&i<c);y=O>>3,r-=y,O-=y<<3,T&=(1<<O)-1,l.next_in=r,l.next_out=i,l.avail_in=r<s?5+(s-r):5-(r-s),l.avail_out=i<c?257+(c-i):257-(i-c),t.hold=T,t.bits=O}},function(W,n,e){var a=e(2),f=15,d=852,l=592,o=0,t=1,r=2,s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];W.exports=function(g,v,m,E,T,O,M,P){var C=P.bits,_=0,D=0,I=0,y=0,R=0,b=0,z=0,H=0,B=0,p=0,A,j,x,L,U,S=null,w=0,G,$=new a.Buf16(f+1),Q=new a.Buf16(f+1),re=null,le=0,de,me,Y;for(_=0;_<=f;_++)$[_]=0;for(D=0;D<E;D++)$[v[m+D]]++;for(R=C,y=f;y>=1&&$[y]===0;y--);if(R>y&&(R=y),y===0)return T[O++]=1<<24|64<<16|0,T[O++]=1<<24|64<<16|0,P.bits=1,0;for(I=1;I<y&&$[I]===0;I++);for(R<I&&(R=I),H=1,_=1;_<=f;_++)if(H<<=1,H-=$[_],H<0)return-1;if(H>0&&(g===o||y!==1))return-1;for(Q[1]=0,_=1;_<f;_++)Q[_+1]=Q[_]+$[_];for(D=0;D<E;D++)v[m+D]!==0&&(M[Q[v[m+D]]++]=D);if(g===o?(S=re=M,G=19):g===t?(S=s,w-=257,re=i,le-=257,G=256):(S=u,re=c,G=-1),p=0,D=0,_=I,U=O,b=R,z=0,x=-1,B=1<<R,L=B-1,g===t&&B>d||g===r&&B>l)return 1;for(;;){de=_-z,M[D]<G?(me=0,Y=M[D]):M[D]>G?(me=re[le+M[D]],Y=S[w+M[D]]):(me=96,Y=0),A=1<<_-z,j=1<<b,I=j;do j-=A,T[U+(p>>z)+j]=de<<24|me<<16|Y|0;while(j!==0);for(A=1<<_-1;p&A;)A>>=1;if(A!==0?(p&=A-1,p+=A):p=0,D++,--$[_]===0){if(_===y)break;_=v[m+M[D]]}if(_>R&&(p&L)!==x){for(z===0&&(z=R),U+=I,b=_-z,H=1<<b;b+z<y&&(H-=$[b+z],!(H<=0));)b++,H<<=1;if(B+=1<<b,g===t&&B>d||g===r&&B>l)return 1;x=p&L,T[x]=R<<24|b<<16|U-O|0}}return p!==0&&(T[U+p]=_-z<<24|64<<16|0),P.bits=R,0}},function(W,n,e){function a(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}W.exports=a},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=e(16),f=d(a);function d(o){return o&&o.__esModule?o:{default:o}}function l(o){f.default.register(o)}n.default=l},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function p(A,j){for(var x=0;x<j.length;x++){var L=j[x];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(A,L.key,L)}}return function(A,j,x){return j&&p(A.prototype,j),x&&p(A,x),A}}(),f=e(25),d=M(f),l=e(26),o=M(l),t=e(63),r=M(t),s=e(64),i=M(s),u=e(15),c=e(27),h=M(c),g=e(8),v=M(g),m=e(28),E=M(m),T=e(9),O=M(T);function M(p){return p&&p.__esModule?p:{default:p}}function P(p){if(Array.isArray(p)){for(var A=0,j=Array(p.length);A<p.length;A++)j[A]=p[A];return j}else return Array.from(p)}function C(p,A){if(!(p instanceof A))throw new TypeError("Cannot call a class as a function")}var _=Symbol("decompress"),D=Symbol("readMetaData"),I=Symbol("readImageData"),y=Symbol("determineImageDependentMetaData"),R=Symbol("transformImageData"),b=Symbol("createVolume"),z=Symbol("cacheVolume"),H=function(){function p(){var A=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};C(this,p),this.volumeCache=new o.default,this.volumePromises={},this.wholeFileFetcher=new r.default({headers:j}),this.headerOnlyFetcher=new r.default({isFirstBytesOnly:!0,headers:j,beforeSend:function(L){return L.setRequestHeader("Range","bytes=0-10240")},onHeadersReceived:function(L,U,S){if(L.status===200){var w=v.default.fromURL(S.imageId),G=A.headerOnlyFetcher.getFetchPromiseFromCache(w);A.wholeFileFetcher.addFetchPromiseToCache(G.promise,w)}}})}return a(p,[{key:"acquire",value:function(j){var x=this,L=this.volumePromises[j.filePath];if(L&&L.wholeFilePromise)return L.wholeFilePromise;var U=new Promise(function(S,w){var G=x.volumeCache.get(j);if(G&&G.hasImageData){S(G);return}var $=x.wholeFileFetcher.fetch(j);$.then(function(Q){return x[_](Q,j)}).then(function(Q){return x[D](Q)}).then(function(Q){return x[I](Q)}).then(function(Q){return x[R](Q)}).then(function(Q){return x[y](Q)}).then(function(Q){return x[b](Q,j)}).then(function(Q){return x[z](Q,j)}).then(function(Q){return S(Q)}).catch(w)});return this.volumePromises[j.filePath]=this.volumePromises[j.filePath]||{},this.volumePromises[j.filePath].wholeFilePromise=U,U}},{key:"acquireHeaderOnly",value:function(j){var x=this,L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,U=this.volumePromises[j.filePath];if(U)return U.headerOnlyPromise||U.wholeFilePromise;var S=new Promise(function(w,G){var $=x.volumeCache.get(j);if($){w($);return}var Q=L?x.headerOnlyFetcher:x.wholeFileFetcher,re=Q.fetch(j);re.then(function(le){return x[_](le,j)}).then(function(le){return x[D](le)}).then(function(le){return x[b](le,j)}).then(function(le){return x[z](le,j)}).then(function(le){return w(le)}).catch(G)});return this.volumePromises[j.filePath]=this.volumePromises[j.filePath]||{},this.volumePromises[j.filePath].headerOnlyPromise=S,S}},{key:_,value:function(j,x){return(0,i.default)(j,x)}},{key:D,value:function(j){return{decompressedFileData:j,metaData:(0,u.parseNiftiHeader)(j)}}},{key:I,value:function(j){var x=j.decompressedFileData,L=j.metaData,U=(0,u.parseNiftiFile)(x,L),S=U.imageData,w=U.metaData;Object.assign(L,w);var G=L.voxelLength,$=L.timeSlices,Q=[1,G[0],G[0]*G[1],G[0]*G[1]*G[2]],re=(0,O.default)(S,[].concat(P(G),[$]),Q),le=(0,E.default)(re);return L.minPixelValue=le.min,L.maxPixelValue=le.max,{metaData:L,imageDataNDarray:re}}},{key:R,value:function(j){var x=j.metaData,L=j.imageDataNDarray;if(x.dataType.isDataInFloat){var U=(0,h.default)(L,x);L=U.convertedImageDataView,Object.assign(x,U.metaData,{floatImageDataNDarray:U.floatImageDataView})}return{metaData:x,imageDataNDarray:L}}},{key:y,value:function(j){var x=j.metaData,L=j.imageDataNDarray;return x.isWindowInfoAbsent?Object.assign(x,B(x.slope,x.intercept,x.minPixelValue,x.maxPixelValue)):Object.assign(x,B(1,0,x.windowMinimumValue,x.windowMaximumValue)),{metaData:x,imageDataNDarray:L}}},{key:b,value:function(j,x){var L=j.metaData,U=j.imageDataNDarray;return new d.default(x,L,U,L.floatImageDataNDarray)}},{key:z,value:function(j,x){return this.volumeCache.add(x,j),j}}],[{key:"getInstance",value:function(j){return p.instance||(p.instance=new p(j)),p.instance}}]),p}();n.default=H;function B(p,A,j,x){var L=x*p+A,U=j*p+A;return{windowCenter:(L+U)/2,windowWidth:L-U}}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function P(C,_){for(var D=0;D<_.length;D++){var I=_[D];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(C,I.key,I)}}return function(C,_,D){return _&&P(C.prototype,_),D&&P(C,D),C}}(),f=e(1),d=e(57),l=c(d),o=e(58),t=c(o),r=e(59),s=c(r),i=e(60),u=c(i);function c(P){return P&&P.__esModule?P:{default:P}}function h(P){if(Array.isArray(P)){for(var C=0,_=Array(P.length);C<P.length;C++)_[C]=P[C];return _}else return Array.from(P)}function g(P,C){if(!(P instanceof C))throw new TypeError("Cannot call a class as a function")}var v=Symbol("determineMetaData"),m=Symbol("determinePixelData"),E=Symbol("getDimensionsIndices"),T=Symbol("getPatientOrientation"),O=Symbol("getPatientPosition"),M=function(){function P(C,_){var D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;g(this,P),this.volume=C,this.imageIdObject=_,this.dimension=_.slice.dimension,this.index=_.slice.index,this.timePoint=D?0:_.timePoint,this.metaData={},this[v](),this.volume.hasImageData&&this[m]()}return a(P,[{key:v,value:function(){var _=this.volume.metaData,D=this[E](this.dimension),I=D.rowsIndex,y=D.columnsIndex,R=D.framesIndex,b=_.voxelLength,z=b[I],H=b[y],B=b[R],p=_.pixelSpacing[I],A=_.pixelSpacing[y],j=_.pixelSpacing[R],x=this[T](_.orientationMatrix,y,I),L=x.rowCosines,U=x.columnCosines,S=this[O](_.orientationMatrix,R);Object.assign(this.metaData,{columns:H,rows:z,numberOfFrames:B,columnsIndex:y,rowsIndex:I,framesIndex:R,columnPixelSpacing:A,rowPixelSpacing:p,slicePixelSpacing:j,columnCosines:U,rowCosines:L,imagePositionPatient:S,imageOrientationPatient:[].concat(h(L),h(U)),frameOfReferenceUID:this.imageIdObject.filePath})}},{key:m,value:function(){var _;this.volume.imageDataNDarray.set(0,0,0,255);var D=(0,t.default)([this.index,null,null],this.metaData.framesIndex),I=this.volume.metaData.dataType.TypedArrayConstructor,y=(_=this.volume.imageDataNDarray).pick.apply(_,h(D).concat([this.timePoint]));this.pixelData=(0,l.default)(y,I);var R=this.volume.metaData.dataType.isDataInFloat;if(R){var b,z=(b=this.volume.imageDataNDarray).pick.apply(b,h(D).concat([this.timePoint]));this.floatPixelData=(0,l.default)(z,this.volume.metaData.dataType.OriginalTypedArrayConstructor)}}},{key:E,value:function(_){var D=void 0,I=void 0,y=void 0;switch(_){case"x":D="xyz".indexOf("z"),I="xyz".indexOf("y"),y="xyz".indexOf("x");break;case"y":D="xyz".indexOf("z"),I="xyz".indexOf("x"),y="xyz".indexOf("y");break;case"z":D="xyz".indexOf("y"),I="xyz".indexOf("x"),y="xyz".indexOf("z");break}return{rowsIndex:D,columnsIndex:I,framesIndex:y}}},{key:T,value:function(_,D,I){var y=[_[0][D],_[1][D],_[2][D]],R=[_[0][I],_[1][I],_[2][I]];return{rowCosines:(0,u.default)(y),columnCosines:(0,u.default)(R)}}},{key:O,value:function(_,D){var I=(0,t.default)([this.index,0,0],D),y=(0,s.default)(_,I);return y.slice(0,3)}},{key:"cornerstoneImageObject",get:function(){var _=this,D=this.volume.metaData,I=this.metaData,y=f.external.cornerstone,R=D.dataType.isDataInColors?y.renderColorImage:y.renderGrayscaleImage;return{imageId:this.imageIdObject.url,color:D.dataType.isDataInColors,columnPixelSpacing:I.columnPixelSpacing,columns:I.columns,height:I.rows,intercept:D.intercept,invert:!1,minPixelValue:D.minPixelValue,maxPixelValue:D.maxPixelValue,rowPixelSpacing:I.rowPixelSpacing,rows:I.rows,sizeInBytes:this.pixelData.byteLength,slope:D.slope,width:I.columns,windowCenter:D.windowCenter,windowWidth:D.windowWidth,floatPixelData:this.floatPixelData,decodeTimeInMS:0,getPixelData:function(){return _.pixelData},render:R}}},{key:"compoundMetaData",get:function(){return Object.assign({},this.volume.metaData,this.metaData)}}]),P}();n.default=M},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=a;function a(f){for(var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Array,l=new d(f.size),o=0,t=0;t<f.shape[1];++t)for(var r=0;r<f.shape[0];++r)l[o++]=f.get(r,t);return l}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=a;function a(f){for(var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;d-- >0;)f.unshift(f.pop());return f}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=a;function a(f,d){var l=f[0][0],o=f[0][1],t=f[0][2],r=f[0][3],s=f[1][0],i=f[1][1],u=f[1][2],c=f[1][3],h=f[2][0],g=f[2][1],v=f[2][2],m=f[2][3],E=f[3][0],T=f[3][1],O=f[3][2],M=f[3][3],P=d[0],C=d[1],_=d[2],D=d[3]||1,I=P*l+C*o+_*t+D*r,y=P*s+C*i+_*u+D*c,R=P*h+C*g+_*v+D*m,b=P*E+C*T+_*O+D*M;return[I,y,R,b]}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=f;function a(d,l){return d+l*l}function f(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=d.reduce(a,0),o=Math.sqrt(l);return o===0&&(o=1),d.map(function(t){return t/o})}},function(W,n,e){function a(f){for(var d=new Array(f),l=0;l<f;++l)d[l]=l;return d}W.exports=a},function(W,n){/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */W.exports=function(f){return f!=null&&(e(f)||a(f)||!!f._isBuffer)};function e(f){return!!f.constructor&&typeof f.constructor.isBuffer=="function"&&f.constructor.isBuffer(f)}function a(f){return typeof f.readFloatLE=="function"&&typeof f.slice=="function"&&e(f.slice(0,0))}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function h(g,v){for(var m=0;m<v.length;m++){var E=v[m];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(g,E.key,E)}}return function(g,v,m){return v&&h(g.prototype,v),m&&h(g,m),g}}(),f=e(14),d=l(f);function l(h){return h&&h.__esModule?h:{default:h}}function o(h,g){if(!(h instanceof g))throw new TypeError("Cannot call a class as a function")}var t=function(){function h(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},v=g.method,m=v===void 0?"GET":v,E=g.responseType,T=E===void 0?"arraybuffer":E,O=g.beforeSend,M=O===void 0?c:O,P=g.headers,C=P===void 0?{}:P,_=g.onHeadersReceived,D=_===void 0?c:_;o(this,h),this.options={method:m,responseType:T,beforeSend:M,headers:C,onHeadersReceived:D},this.promisesCache={}}return a(h,[{key:"fetch",value:function(v){var m=this,E=this.getFetchPromiseFromCache(v),T=void 0;return E?T=E.promise:(T=new Promise(function(O,M){var P=new XMLHttpRequest,C={deferred:{resolve:O,reject:M},url:v.filePath,imageId:v.url};P.open(m.options.method,v.filePath,!0),P.responseType=m.options.responseType,typeof m.options.beforeSend=="function"&&m.options.beforeSend(P,v.url),Object.keys(m.options.headers).forEach(function(_){P.setRequestHeader(_,m.options.headers[_])}),P.addEventListener("readystatechange",i(m.options,C)),P.addEventListener("progress",s(v.filePath,v.url,m.options,C)),P.send()}),this.addFetchPromiseToCache(T,v)),T}},{key:"getFetchPromiseFromCache",value:function(v){var m=this,E=this.promisesCache[v.filePath];return Array.isArray(E)&&E.find(function(T){return T.fetcher===m})}},{key:"addFetchPromiseToCache",value:function(v,m){this.promisesCache[m.filePath]=this.promisesCache[m.filePath]||[],this.promisesCache[m.filePath].unshift(new r(this,m,v))}}]),h}();n.default=t;var r=function h(g,v,m){o(this,h),this.fetcher=g,this.imageIdObject=v,this.promise=m};function s(h,g,v,m){return function(E){var T=E.loaded,O=void 0,M=void 0;E.lengthComputable&&(O=E.total,M=Math.round(T/O*100)),u(v.onprogress,E,m);var P={url:h,imageId:g,loaded:T,total:O,percentComplete:M};d.default.imageLoadProgress(P)}}function i(h,g){var v=2,m=4;return function(E){if(u(h.onreadystatechange,E,g),!h.onreadystatechange&&(this.readyState===v&&h.onHeadersReceived&&h.onHeadersReceived(this,h,g),this.readyState===m))if([200,206].includes(this.status))g.deferred.resolve(this.response);else{var T="Could not fetch the file '"+g.url+"'. Error code was "+this.status+".";g.deferred.reject(new Error(T))}}}function u(h,g,v){h&&h(g,v)}function c(){}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=d;var a=e(1),f={nifti:a.external.niftiReader};function d(l,o){var t=f.nifti,r=l;if(t.isCompressed(l)&&(r=t.decompress(l)),!t.isNIFTI(r))throw new Error("The file '"+o.filePath+"' is not a valid NIFTI file.");return r}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=f;var a=e(1);function f(h,g){var v=a.external.niftiReader;switch(h){case v.NIFTI1.TYPE_INT16:case v.NIFTI1.TYPE_UINT16:g=d(g);break;case v.NIFTI1.TYPE_RGB24:g=g;break;case v.NIFTI1.TYPE_INT32:case v.NIFTI1.TYPE_FLOAT32:case v.NIFTI1.TYPE_UINT32:g=o(g);break;case v.NIFTI1.TYPE_COMPLEX64:case v.NIFTI1.TYPE_FLOAT64:case v.NIFTI1.TYPE_INT64:case v.NIFTI1.TYPE_UINT64:g=t(g);break;case v.NIFTI1.TYPE_FLOAT128:case v.NIFTI1.TYPE_COMPLEX128:g=g;break;case v.NIFTI1.TYPE_COMPLEX256:g=g;break}return g}function d(h){for(var g=0;g<h.length;g++)h[g]=i(h[g]);return h}function l(h){return h}function o(h){for(var g=0;g<h.length;g++)h[g]=u(h[g]);return h}function t(h){for(var g=0;g<h.length;g++)h[g]=c(h[g]);return h}function r(h){return h}function s(h){return h}function i(h){return h>>8&255|h<<8&65280}function u(h){return h>>24&255|h>>8&65280|h<<8&16711680|h<<24&4278190080}function c(h){return h>>56&255|h>>40&65280|h>>24&16711680|h>>8&4278190080|h<<8&0xff00000000|h<<24&0xff0000000000|h<<40&0xff000000000000|h<<56&0xff00000000000000}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function H(B,p){for(var A=0;A<p.length;A++){var j=p[A];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(B,j.key,j)}}return function(B,p,A){return p&&H(B.prototype,p),A&&H(B,A),B}}(),f=e(25),d=M(f),l=e(26),o=M(l),t=e(15),r=e(27),s=M(r),i=e(8),u=M(i),c=e(28),h=M(c),g=e(29),v=M(g),m=e(67),E=M(m),T=e(9),O=M(T);function M(H){return H&&H.__esModule?H:{default:H}}function P(H){if(Array.isArray(H)){for(var B=0,p=Array(H.length);B<H.length;B++)p[B]=H[B];return p}else return Array.from(H)}function C(H,B){if(!(H instanceof B))throw new TypeError("Cannot call a class as a function")}var _=Symbol("readImageData"),D=Symbol("determineImageDependentMetaData"),I=Symbol("transformImageData"),y=Symbol("createVolume"),R=Symbol("cacheVolume"),b=function(){function H(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};C(this,H),this.volumeCache=new o.default,this.volumeFetchers={},this.httpHeaders=B}return a(H,[{key:"acquireTimepoint",value:function(p){var A=this,j=this.volumeCache.getTimepoint(p,p.timePoint);if(j&&j.hasImageData){Promise.resolve(j);return}var x=this.getFetcherData(p);if(x.timePointPromises[p.timePoint])return x.timePointPromises[p.timePoint];var L=new Promise(function(U,S){var w=x.volumeFetcher.fetchTimepoint(p.timePoint);w.then(function(G){return A[_](G)}).then(function(G){return A[I](G)}).then(function(G){return A[D](G)}).then(function(G){return A[y](G,p)}).then(function(G){return A[R](G,p)}).then(function(G){return U(G)}).catch(S)});return x.timePointPromises[p.timePoint]=L,L}},{key:"acquireHeaderOnly",value:function(p){var A=this,j=this.getFetcherData(p);if(j.headerPromise)return j.headerPromise;var x=new Promise(function(L,U){var S=A.volumeCache.getTimepoint(p,p.timePoint);if(S){L(S);return}var w=j.volumeFetcher,G=w.getHeaderPromise();G.then(function($){return A[y]($,p)}).then(function($){return A[R]($,p)}).then(function($){return L($)}).catch(U)});return this.volumeFetchers[p.filePath]=this.volumeFetchers[p.filePath]||{},this.volumeFetchers[p.filePath].headerOnlyPromise=x,x}},{key:_,value:function(p){var A=p.headerData,j=p.metaData,x=p.volumeData,L=(0,v.default)(A,x),U=(0,t.parseNiftiFile)(L.buffer,null),S=U.imageData,w=U.metaData;Object.assign(j,w);var G=j.voxelLength,$=1,Q=[1,G[0],G[0]*G[1],G[0]*G[1]*G[2]],re=(0,O.default)(S,[].concat(P(G),[$]),Q),le=(0,h.default)(re);return j.minPixelValue=le.min,j.maxPixelValue=le.max,{metaData:j,imageDataNDarray:re}}},{key:I,value:function(p){var A=p.metaData,j=p.imageDataNDarray;if(A.dataType.isDataInFloat){var x=(0,s.default)(j,A);j=x.convertedImageDataView,Object.assign(A,x.metaData,{floatImageDataNDarray:x.floatImageDataView})}return{metaData:A,imageDataNDarray:j}}},{key:D,value:function(p){var A=p.metaData,j=p.imageDataNDarray;return A.isWindowInfoAbsent?Object.assign(A,z(A.slope,A.intercept,A.minPixelValue,A.maxPixelValue)):Object.assign(A,z(1,0,A.windowMinimumValue,A.windowMaximumValue)),{metaData:A,imageDataNDarray:j}}},{key:y,value:function(p,A){var j=p.metaData,x=p.imageDataNDarray,L=new u.default(A.filePath,A.slice,0);return new d.default(L,j,x,j.floatImageDataNDarray,!0)}},{key:R,value:function(p,A){return this.volumeCache.add(A,p),p}},{key:"getFetcherData",value:function(p){return this.volumeFetchers[""+p.filePath]=this.volumeFetchers[""+p.filePath]||{headerPromise:null,timePointPromises:[],volumeFetcher:new E.default(p,{headers:this.httpHeaders})},this.volumeFetchers[""+p.filePath]}}],[{key:"getInstance",value:function(p){return H.instance||(H.instance=new H(p)),H.instance}}]),H}();n.default=b;function z(H,B,p,A){var j=A*H+B,x=p*H+B;return{windowCenter:(j+x)/2,windowWidth:j-x}}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function T(O,M){for(var P=0;P<M.length;P++){var C=M[P];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(O,C.key,C)}}return function(O,M,P){return M&&T(O.prototype,M),P&&T(O,P),O}}(),f=e(1),d=e(19),l=u(d),o=e(68),t=u(o),r=e(15),s=e(29),i=u(s);function u(T){return T&&T.__esModule?T:{default:T}}function c(T,O){if(!(T instanceof O))throw new TypeError("Cannot call a class as a function")}var h=f.external.niftiReader,g=352,v=544,m=function(){function T(O){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},P=M.method,C=P===void 0?"GET":P,_=M.responseType,D=_===void 0?"arraybuffer":_,I=M.beforeSend,y=I===void 0?E:I,R=M.headers,b=R===void 0?{}:R,z=M.onHeadersReceived,H=z===void 0?E:z;c(this,T),this.imageId=O,this.options={method:C,responseType:D,beforeSend:y,headers:b,onHeadersReceived:H},this.volumeData=T.createDefaultVolumeData()}return a(T,[{key:"fetchTimepoint",value:function(){var M=this,P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.ensureStreaming(this.imageId);var C=new Promise(function(_,D){try{M.getHeaderPromise().then(function(I){var y=T.getVolumeTimepointDataLength(I),R=M.volumeData.headerOffset+P*y;M.getBufferPromise(R,y).then(function(b){_({headerData:I.headerData,volumeData:b,metaData:I.metaData})}).catch(D)})}catch(I){D(I)}});return C}},{key:"ensureStreaming",value:function(M){var P=this.volumeData;if(!P.streamer){var C=new t.default(this.options);P.streamer=C,T.runStreamer(M,P)}}},{key:"getHeaderPromise",value:function(){this.ensureStreaming(this.imageId);var M=this.volumeData;return M.header?Promise.resolve(M.header):M.headerPromise}},{key:"getBufferPromise",value:function(M,P){var C=this;this.ensureStreaming(this.imageId);var _=new Promise(function(D,I){if(C.volumeData.dataStreamedLength>=P)D(C.volumeData.buffer.slice(M,M+P));else{var y={offset:M,length:P,promise:{resolve:D,reject:I}};C.volumeData.bufferPromiseEntries.push(y)}});return _}}],[{key:"runStreamer",value:function(M,P){P.streamer.stream(M,function(C){if(!P.headerParsed){if(!T.tryParseHeader(P,C))return;P.headerPromiseMethods.resolve(P.header),T.evaluatePromises(P),P.headerParsed=!0;return}P.isCompressed&&(C=T.uncompress(P,C)),T.addToImageDataBuffer(P,C),T.evaluatePromises(P)})}},{key:"evaluatePromises",value:function(M){for(var P=M.bufferPromiseEntries.length-1;P>=0;){var C=M.bufferPromiseEntries[P],_=C.offset+C.length;M.dataStreamedLength>=_&&(M.bufferPromiseEntries.splice(P,1),C.promise.resolve(M.buffer.slice(C.offset,C.offset+C.length))),P--}}},{key:"createDefaultVolumeData",value:function(){var M={},P=new Promise(function(C,_){M.resolve=C,M.reject=_});return{streamer:null,buffer:new Uint8Array(0),bufferPromiseEntries:[],dataStreamedLength:0,isCompressed:!1,tmpBuffer:new Uint8Array(0),headerParsed:!1,inflator:new l.default.Inflate,headerPromise:P,headerPromiseMethods:M,headerOffset:g}}},{key:"parseHeaderData",value:function(M){return{headerData:M,metaData:(0,r.parseNiftiHeader)(M.buffer)}}},{key:"uncompress",value:function(M,P){return P.length===0?P:(M.inflator.push(P,l.default.Z_SYNC_FLUSH),M.inflator.result)}},{key:"addToImageDataBuffer",value:function(M,P){M.dataStreamedLength+P.length>M.buffer.length?M.buffer=(0,i.default)(M.buffer,P):M.buffer.set(P,M.dataStreamedLength),M.dataStreamedLength+=P.length}},{key:"tryParseHeader",value:function(M,P){if(M.isHeaderTypeKnown){M.isCompressed&&(P=T.uncompress(M,P)),T.addToImageDataBuffer(M,P);var C=M.dataStreamedLength>=M.headerOffset;if(C){M.header=T.parseHeaderData(M.buffer.slice(0,M.headerOffset));var _=T.createVolumeBuffer(M);_.set(M.buffer),M.buffer=_}return C}if(M.tmpBuffer.length+P.length<M.headerOffset)return M.tmpBuffer=(0,i.default)(M.tmpBuffer,P),!1;var D=(0,i.default)(M.tmpBuffer,P);if(M.isCompressed=h.isCompressed(D.buffer),M.isCompressed){var I=new l.default.Inflate;I.push(D,l.default.Z_SYNC_FLUSH),D=I.result}return h.isNIFTI2(D.buffer)&&(M.headerOffset=v),M.isHeaderTypeKnown=!0,M.buffer=M.isCompressed?T.uncompress(M,M.tmpBuffer):M.tmpBuffer,M.dataStreamedLength=M.buffer.length,M.tmpBuffer=void 0,T.tryParseHeader(M,P)}},{key:"createVolumeBuffer",value:function(M){var P=T.getVolumeTimepointDataLength(M.header),C=M.headerOffset,_=new ArrayBuffer(C+P*M.header.metaData.timeSlices);return new Uint8Array(_)}},{key:"getVolumeTimepointDataLength",value:function(M){var P=M.metaData.header.dims,C=M.metaData.header.numBitsPerVoxel,_=1,D=1;return P[5]&&(D=P[5]),P[1]*P[2]*P[3]*_*D*(C/8)}}]),T}();n.default=m;function E(){}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function h(g,v){for(var m=0;m<v.length;m++){var E=v[m];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(g,E.key,E)}}return function(g,v,m){return v&&h(g.prototype,v),m&&h(g,m),g}}(),f=e(69),d=r(f),l=e(14),o=t(l);function t(h){return h&&h.__esModule?h:{default:h}}function r(h){if(h&&h.__esModule)return h;var g={};if(h!=null)for(var v in h)Object.prototype.hasOwnProperty.call(h,v)&&(g[v]=h[v]);return g.default=h,g}function s(h,g){if(!(h instanceof g))throw new TypeError("Cannot call a class as a function")}var i=function(){function h(g){s(this,h),this.options={headers:g&&g.headers||{}}}return a(h,[{key:"stream",value:function(v,m){var E=this,T=null;return T=new Promise(function(O,M){var P={promise:{resolve:O,reject:M},url:v.filePath,imageId:v.url},C=d.get({path:v.filePath,headers:E.options.headers},function(_){var D=_.headers["Content-Length"]||_.headers["content-length"]||0,I=u(v.filePath,v.url,E.options,P),y=0;_.on("data",function(R){y+=R.length,I({detail:{loaded:y,total:D}}),m(R,v)}),_.on("end",function(){O()})});C.on("error",function(_){var D="Could not fetch the file '"+v.url+"'. Error description: "+_+".";M(new Error(D))})}),T}}]),h}();n.default=i;function u(h,g,v,m){return function(E){var T=E.detail.loaded,O=E.detail.total,M=Math.round(T/O*100);c(v.onprogress,E,m);var P={url:h,imageId:g,loaded:T,total:O,percentComplete:M};o.default.imageLoadProgress(P)}}function c(h,g,v){h&&h(g,v)}},function(W,n,e){(function(a){var f=e(70),d=e(32),l=e(80),o=e(81),t=e(82),r=n;r.request=function(s,i){typeof s=="string"?s=t.parse(s):s=l(s);var u=a.location.protocol.search(/^https?:$/)===-1?"http:":"",c=s.protocol||u,h=s.hostname||s.host,g=s.port,v=s.path||"/";h&&h.indexOf(":")!==-1&&(h="["+h+"]"),s.url=(h?c+"//"+h:"")+(g?":"+g:"")+v,s.method=(s.method||"GET").toUpperCase(),s.headers=s.headers||{};var m=new f(s);return i&&m.on("response",i),m},r.get=function(i,u){var c=r.request(i,u);return c.end(),c},r.ClientRequest=f,r.IncomingMessage=d,r.Agent=function(){},r.Agent.defaultMaxSockets=4,r.STATUS_CODES=o,r.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(n,e(0))},function(W,n,e){(function(a,f,d){var l=e(31),o=e(3),t=e(32),r=e(33),s=e(79),i=t.IncomingMessage,u=t.readyStates;function c(m,E){return l.fetch&&E?"fetch":l.mozchunkedarraybuffer?"moz-chunked-arraybuffer":l.msstream?"ms-stream":l.arraybuffer&&m?"arraybuffer":l.vbArray&&m?"text:vbarray":"text"}var h=W.exports=function(m){var E=this;r.Writable.call(E),E._opts=m,E._body=[],E._headers={},m.auth&&E.setHeader("Authorization","Basic "+new a(m.auth).toString("base64")),Object.keys(m.headers).forEach(function(M){E.setHeader(M,m.headers[M])});var T,O=!0;if(m.mode==="disable-fetch"||"requestTimeout"in m&&!l.abortController)O=!1,T=!0;else if(m.mode==="prefer-streaming")T=!1;else if(m.mode==="allow-wrong-content-type")T=!l.overrideMimeType;else if(!m.mode||m.mode==="default"||m.mode==="prefer-fast")T=!0;else throw new Error("Invalid value for opts.mode");E._mode=c(T,O),E.on("finish",function(){E._onFinish()})};o(h,r.Writable),h.prototype.setHeader=function(m,E){var T=this,O=m.toLowerCase();v.indexOf(O)===-1&&(T._headers[O]={name:m,value:E})},h.prototype.getHeader=function(m){var E=this._headers[m.toLowerCase()];return E?E.value:null},h.prototype.removeHeader=function(m){var E=this;delete E._headers[m.toLowerCase()]},h.prototype._onFinish=function(){var m=this;if(!m._destroyed){var E=m._opts,T=m._headers,O=null;E.method!=="GET"&&E.method!=="HEAD"&&(l.arraybuffer?O=s(a.concat(m._body)):l.blobConstructor?O=new f.Blob(m._body.map(function(D){return s(D)}),{type:(T["content-type"]||{}).value||""}):O=a.concat(m._body).toString());var M=[];if(Object.keys(T).forEach(function(D){var I=T[D].name,y=T[D].value;Array.isArray(y)?y.forEach(function(R){M.push([I,R])}):M.push([I,y])}),m._mode==="fetch"){var P=null;if(l.abortController){var C=new AbortController;P=C.signal,m._fetchAbortController=C,"requestTimeout"in E&&E.requestTimeout!==0&&f.setTimeout(function(){m.emit("requestTimeout"),m._fetchAbortController&&m._fetchAbortController.abort()},E.requestTimeout)}f.fetch(m._opts.url,{method:m._opts.method,headers:M,body:O||void 0,mode:"cors",credentials:E.withCredentials?"include":"same-origin",signal:P}).then(function(D){m._fetchResponse=D,m._connect()},function(D){m.emit("error",D)})}else{var _=m._xhr=new f.XMLHttpRequest;try{_.open(m._opts.method,m._opts.url,!0)}catch(D){d.nextTick(function(){m.emit("error",D)});return}"responseType"in _&&(_.responseType=m._mode.split(":")[0]),"withCredentials"in _&&(_.withCredentials=!!E.withCredentials),m._mode==="text"&&"overrideMimeType"in _&&_.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in E&&(_.timeout=E.requestTimeout,_.ontimeout=function(){m.emit("requestTimeout")}),M.forEach(function(D){_.setRequestHeader(D[0],D[1])}),m._response=null,_.onreadystatechange=function(){switch(_.readyState){case u.LOADING:case u.DONE:m._onXHRProgress();break}},m._mode==="moz-chunked-arraybuffer"&&(_.onprogress=function(){m._onXHRProgress()}),_.onerror=function(){m._destroyed||m.emit("error",new Error("XHR error"))};try{_.send(O)}catch(D){d.nextTick(function(){m.emit("error",D)});return}}}};function g(m){try{var E=m.status;return E!==null&&E!==0}catch{return!1}}h.prototype._onXHRProgress=function(){var m=this;!g(m._xhr)||m._destroyed||(m._response||m._connect(),m._response._onXHRProgress())},h.prototype._connect=function(){var m=this;m._destroyed||(m._response=new i(m._xhr,m._fetchResponse,m._mode),m._response.on("error",function(E){m.emit("error",E)}),m.emit("response",m._response))},h.prototype._write=function(m,E,T){var O=this;O._body.push(m),T()},h.prototype.abort=h.prototype.destroy=function(){var m=this;m._destroyed=!0,m._response&&(m._response._destroyed=!0),m._xhr?m._xhr.abort():m._fetchAbortController&&m._fetchAbortController.abort()},h.prototype.end=function(m,E,T){var O=this;typeof m=="function"&&(T=m,m=void 0),r.Writable.prototype.end.call(O,m,E,T)},h.prototype.flushHeaders=function(){},h.prototype.setTimeout=function(){},h.prototype.setNoDelay=function(){},h.prototype.setSocketKeepAlive=function(){};var v=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(n,e(6).Buffer,e(0),e(4))},function(W,n,e){n.byteLength=s,n.toByteArray=i,n.fromByteArray=h;for(var a=[],f=[],d=typeof Uint8Array<"u"?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,t=l.length;o<t;++o)a[o]=l[o],f[l.charCodeAt(o)]=o;f[45]=62,f[95]=63;function r(g){var v=g.length;if(v%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return g[v-2]==="="?2:g[v-1]==="="?1:0}function s(g){return g.length*3/4-r(g)}function i(g){var v,m,E,T,O,M=g.length;T=r(g),O=new d(M*3/4-T),m=T>0?M-4:M;var P=0;for(v=0;v<m;v+=4)E=f[g.charCodeAt(v)]<<18|f[g.charCodeAt(v+1)]<<12|f[g.charCodeAt(v+2)]<<6|f[g.charCodeAt(v+3)],O[P++]=E>>16&255,O[P++]=E>>8&255,O[P++]=E&255;return T===2?(E=f[g.charCodeAt(v)]<<2|f[g.charCodeAt(v+1)]>>4,O[P++]=E&255):T===1&&(E=f[g.charCodeAt(v)]<<10|f[g.charCodeAt(v+1)]<<4|f[g.charCodeAt(v+2)]>>2,O[P++]=E>>8&255,O[P++]=E&255),O}function u(g){return a[g>>18&63]+a[g>>12&63]+a[g>>6&63]+a[g&63]}function c(g,v,m){for(var E,T=[],O=v;O<m;O+=3)E=(g[O]<<16)+(g[O+1]<<8)+g[O+2],T.push(u(E));return T.join("")}function h(g){for(var v,m=g.length,E=m%3,T="",O=[],M=16383,P=0,C=m-E;P<C;P+=M)O.push(c(g,P,P+M>C?C:P+M));return E===1?(v=g[m-1],T+=a[v>>2],T+=a[v<<4&63],T+="=="):E===2&&(v=(g[m-2]<<8)+g[m-1],T+=a[v>>10],T+=a[v>>4&63],T+=a[v<<2&63],T+="="),O.push(T),O.join("")}},function(W,n){n.read=function(e,a,f,d,l){var o,t,r=l*8-d-1,s=(1<<r)-1,i=s>>1,u=-7,c=f?l-1:0,h=f?-1:1,g=e[a+c];for(c+=h,o=g&(1<<-u)-1,g>>=-u,u+=r;u>0;o=o*256+e[a+c],c+=h,u-=8);for(t=o&(1<<-u)-1,o>>=-u,u+=d;u>0;t=t*256+e[a+c],c+=h,u-=8);if(o===0)o=1-i;else{if(o===s)return t?NaN:(g?-1:1)*(1/0);t=t+Math.pow(2,d),o=o-i}return(g?-1:1)*t*Math.pow(2,o-d)},n.write=function(e,a,f,d,l,o){var t,r,s,i=o*8-l-1,u=(1<<i)-1,c=u>>1,h=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=d?0:o-1,v=d?1:-1,m=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(r=isNaN(a)?1:0,t=u):(t=Math.floor(Math.log(a)/Math.LN2),a*(s=Math.pow(2,-t))<1&&(t--,s*=2),t+c>=1?a+=h/s:a+=h*Math.pow(2,1-c),a*s>=2&&(t++,s/=2),t+c>=u?(r=0,t=u):t+c>=1?(r=(a*s-1)*Math.pow(2,l),t=t+c):(r=a*Math.pow(2,c-1)*Math.pow(2,l),t=0));l>=8;e[f+g]=r&255,g+=v,r/=256,l-=8);for(t=t<<l|r,i+=l;i>0;e[f+g]=t&255,g+=v,t/=256,i-=8);e[f+g-v]|=m*128}},function(W,n){},function(W,n,e){function a(l,o){if(!(l instanceof o))throw new TypeError("Cannot call a class as a function")}var f=e(11).Buffer;function d(l,o,t){l.copy(o,t)}W.exports=function(){function l(){a(this,l),this.head=null,this.tail=null,this.length=0}return l.prototype.push=function(t){var r={data:t,next:null};this.length>0?this.tail.next=r:this.head=r,this.tail=r,++this.length},l.prototype.unshift=function(t){var r={data:t,next:this.head};this.length===0&&(this.tail=r),this.head=r,++this.length},l.prototype.shift=function(){if(this.length!==0){var t=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},l.prototype.clear=function(){this.head=this.tail=null,this.length=0},l.prototype.join=function(t){if(this.length===0)return"";for(var r=this.head,s=""+r.data;r=r.next;)s+=t+r.data;return s},l.prototype.concat=function(t){if(this.length===0)return f.alloc(0);if(this.length===1)return this.head.data;for(var r=f.allocUnsafe(t>>>0),s=this.head,i=0;s;)d(s.data,r,i),i+=s.data.length,s=s.next;return r},l}()},function(W,n,e){var a=Function.prototype.apply;n.setTimeout=function(){return new f(a.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new f(a.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(d){d&&d.close()};function f(d,l){this._id=d,this._clearFn=l}f.prototype.unref=f.prototype.ref=function(){},f.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(d,l){clearTimeout(d._idleTimeoutId),d._idleTimeout=l},n.unenroll=function(d){clearTimeout(d._idleTimeoutId),d._idleTimeout=-1},n._unrefActive=n.active=function(d){clearTimeout(d._idleTimeoutId);var l=d._idleTimeout;l>=0&&(d._idleTimeoutId=setTimeout(function(){d._onTimeout&&d._onTimeout()},l))},e(76),n.setImmediate=setImmediate,n.clearImmediate=clearImmediate},function(W,n,e){(function(a,f){(function(d,l){if(d.setImmediate)return;var o=1,t={},r=!1,s=d.document,i;function u(C){typeof C!="function"&&(C=new Function(""+C));for(var _=new Array(arguments.length-1),D=0;D<_.length;D++)_[D]=arguments[D+1];var I={callback:C,args:_};return t[o]=I,i(o),o++}function c(C){delete t[C]}function h(C){var _=C.callback,D=C.args;switch(D.length){case 0:_();break;case 1:_(D[0]);break;case 2:_(D[0],D[1]);break;case 3:_(D[0],D[1],D[2]);break;default:_.apply(l,D);break}}function g(C){if(r)setTimeout(g,0,C);else{var _=t[C];if(_){r=!0;try{h(_)}finally{c(C),r=!1}}}}function v(){i=function(C){f.nextTick(function(){g(C)})}}function m(){if(d.postMessage&&!d.importScripts){var C=!0,_=d.onmessage;return d.onmessage=function(){C=!1},d.postMessage("","*"),d.onmessage=_,C}}function E(){var C="setImmediate$"+Math.random()+"$",_=function(D){D.source===d&&typeof D.data=="string"&&D.data.indexOf(C)===0&&g(+D.data.slice(C.length))};d.addEventListener?d.addEventListener("message",_,!1):d.attachEvent("onmessage",_),i=function(D){d.postMessage(C+D,"*")}}function T(){var C=new MessageChannel;C.port1.onmessage=function(_){var D=_.data;g(D)},i=function(_){C.port2.postMessage(_)}}function O(){var C=s.documentElement;i=function(_){var D=s.createElement("script");D.onreadystatechange=function(){g(_),D.onreadystatechange=null,C.removeChild(D),D=null},C.appendChild(D)}}function M(){i=function(C){setTimeout(g,0,C)}}var P=Object.getPrototypeOf&&Object.getPrototypeOf(d);P=P&&P.setTimeout?P:d,{}.toString.call(d.process)==="[object process]"?v():m()?E():d.MessageChannel?T():s&&"onreadystatechange"in s.createElement("script")?O():M(),P.setImmediate=u,P.clearImmediate=c})(typeof self>"u"?typeof a>"u"?this:a:self)}).call(n,e(0),e(4))},function(W,n,e){(function(a){W.exports=f;function f(l,o){if(d("noDeprecation"))return l;var t=!1;function r(){if(!t){if(d("throwDeprecation"))throw new Error(o);d("traceDeprecation"),t=!0}return l.apply(this,arguments)}return r}function d(l){try{if(!a.localStorage)return!1}catch{return!1}var o=a.localStorage[l];return o==null?!1:String(o).toLowerCase()==="true"}}).call(n,e(0))},function(W,n,e){W.exports=d;var a=e(40),f=e(7);f.inherits=e(3),f.inherits(d,a);function d(l){if(!(this instanceof d))return new d(l);a.call(this,l)}d.prototype._transform=function(l,o,t){t(null,l)}},function(W,n,e){var a=e(6).Buffer;W.exports=function(f){if(f instanceof Uint8Array){if(f.byteOffset===0&&f.byteLength===f.buffer.byteLength)return f.buffer;if(typeof f.buffer.slice=="function")return f.buffer.slice(f.byteOffset,f.byteOffset+f.byteLength)}if(a.isBuffer(f)){for(var d=new Uint8Array(f.length),l=f.length,o=0;o<l;o++)d[o]=f[o];return d.buffer}else throw new Error("Argument must be a Buffer")}},function(W,n){W.exports=a;var e=Object.prototype.hasOwnProperty;function a(){for(var f={},d=0;d<arguments.length;d++){var l=arguments[d];for(var o in l)e.call(l,o)&&(f[o]=l[o])}return f}},function(W,n){W.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(W,n,e){var a=e(83),f=e(85);n.parse=M,n.resolve=C,n.resolveObject=_,n.format=P,n.Url=d;function d(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var l=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,t=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,r=["<",">",'"',"`"," ","\r",`
`,"	"],s=["{","}","|","\\","^","`"].concat(r),i=["'"].concat(s),u=["%","/","?",";","#"].concat(i),c=["/","?","#"],h=255,g=/^[+a-z0-9A-Z_-]{0,63}$/,v=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},T={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},O=e(86);function M(D,I,y){if(D&&f.isObject(D)&&D instanceof d)return D;var R=new d;return R.parse(D,I,y),R}d.prototype.parse=function(D,I,y){if(!f.isString(D))throw new TypeError("Parameter 'url' must be a string, not "+typeof D);var R=D.indexOf("?"),b=R!==-1&&R<D.indexOf("#")?"?":"#",z=D.split(b),H=/\\/g;z[0]=z[0].replace(H,"/"),D=z.join(b);var B=D;if(B=B.trim(),!y&&D.split("#").length===1){var p=t.exec(B);if(p)return this.path=B,this.href=B,this.pathname=p[1],p[2]?(this.search=p[2],I?this.query=O.parse(this.search.substr(1)):this.query=this.search.substr(1)):I&&(this.search="",this.query={}),this}var A=l.exec(B);if(A){A=A[0];var j=A.toLowerCase();this.protocol=j,B=B.substr(A.length)}if(y||A||B.match(/^\/\/[^@\/]+@[^@\/]+/)){var x=B.substr(0,2)==="//";x&&!(A&&E[A])&&(B=B.substr(2),this.slashes=!0)}if(!E[A]&&(x||A&&!T[A])){for(var L=-1,U=0;U<c.length;U++){var S=B.indexOf(c[U]);S!==-1&&(L===-1||S<L)&&(L=S)}var w,G;L===-1?G=B.lastIndexOf("@"):G=B.lastIndexOf("@",L),G!==-1&&(w=B.slice(0,G),B=B.slice(G+1),this.auth=decodeURIComponent(w)),L=-1;for(var U=0;U<u.length;U++){var S=B.indexOf(u[U]);S!==-1&&(L===-1||S<L)&&(L=S)}L===-1&&(L=B.length),this.host=B.slice(0,L),B=B.slice(L),this.parseHost(),this.hostname=this.hostname||"";var $=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!$)for(var Q=this.hostname.split(/\./),U=0,re=Q.length;U<re;U++){var le=Q[U];if(le&&!le.match(g)){for(var de="",me=0,Y=le.length;me<Y;me++)le.charCodeAt(me)>127?de+="x":de+=le[me];if(!de.match(g)){var V=Q.slice(0,U),te=Q.slice(U+1),ne=le.match(v);ne&&(V.push(ne[1]),te.unshift(ne[2])),te.length&&(B="/"+te.join(".")+B),this.hostname=V.join(".");break}}}this.hostname.length>h?this.hostname="":this.hostname=this.hostname.toLowerCase(),$||(this.hostname=a.toASCII(this.hostname));var ue=this.port?":"+this.port:"",ge=this.hostname||"";this.host=ge+ue,this.href+=this.host,$&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),B[0]!=="/"&&(B="/"+B))}if(!m[j])for(var U=0,re=i.length;U<re;U++){var ve=i[U];if(B.indexOf(ve)!==-1){var Ee=encodeURIComponent(ve);Ee===ve&&(Ee=escape(ve)),B=B.split(ve).join(Ee)}}var De=B.indexOf("#");De!==-1&&(this.hash=B.substr(De),B=B.slice(0,De));var X=B.indexOf("?");if(X!==-1?(this.search=B.substr(X),this.query=B.substr(X+1),I&&(this.query=O.parse(this.query)),B=B.slice(0,X)):I&&(this.search="",this.query={}),B&&(this.pathname=B),T[j]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var ue=this.pathname||"",N=this.search||"";this.path=ue+N}return this.href=this.format(),this};function P(D){return f.isString(D)&&(D=M(D)),D instanceof d?D.format():d.prototype.format.call(D)}d.prototype.format=function(){var D=this.auth||"";D&&(D=encodeURIComponent(D),D=D.replace(/%3A/i,":"),D+="@");var I=this.protocol||"",y=this.pathname||"",R=this.hash||"",b=!1,z="";this.host?b=D+this.host:this.hostname&&(b=D+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(b+=":"+this.port)),this.query&&f.isObject(this.query)&&Object.keys(this.query).length&&(z=O.stringify(this.query));var H=this.search||z&&"?"+z||"";return I&&I.substr(-1)!==":"&&(I+=":"),this.slashes||(!I||T[I])&&b!==!1?(b="//"+(b||""),y&&y.charAt(0)!=="/"&&(y="/"+y)):b||(b=""),R&&R.charAt(0)!=="#"&&(R="#"+R),H&&H.charAt(0)!=="?"&&(H="?"+H),y=y.replace(/[?#]/g,function(B){return encodeURIComponent(B)}),H=H.replace("#","%23"),I+b+y+H+R};function C(D,I){return M(D,!1,!0).resolve(I)}d.prototype.resolve=function(D){return this.resolveObject(M(D,!1,!0)).format()};function _(D,I){return D?M(D,!1,!0).resolveObject(I):I}d.prototype.resolveObject=function(D){if(f.isString(D)){var I=new d;I.parse(D,!1,!0),D=I}for(var y=new d,R=Object.keys(this),b=0;b<R.length;b++){var z=R[b];y[z]=this[z]}if(y.hash=D.hash,D.href==="")return y.href=y.format(),y;if(D.slashes&&!D.protocol){for(var H=Object.keys(D),B=0;B<H.length;B++){var p=H[B];p!=="protocol"&&(y[p]=D[p])}return T[y.protocol]&&y.hostname&&!y.pathname&&(y.path=y.pathname="/"),y.href=y.format(),y}if(D.protocol&&D.protocol!==y.protocol){if(!T[D.protocol]){for(var A=Object.keys(D),j=0;j<A.length;j++){var x=A[j];y[x]=D[x]}return y.href=y.format(),y}if(y.protocol=D.protocol,!D.host&&!E[D.protocol]){for(var re=(D.pathname||"").split("/");re.length&&!(D.host=re.shift()););D.host||(D.host=""),D.hostname||(D.hostname=""),re[0]!==""&&re.unshift(""),re.length<2&&re.unshift(""),y.pathname=re.join("/")}else y.pathname=D.pathname;if(y.search=D.search,y.query=D.query,y.host=D.host||"",y.auth=D.auth,y.hostname=D.hostname||D.host,y.port=D.port,y.pathname||y.search){var L=y.pathname||"",U=y.search||"";y.path=L+U}return y.slashes=y.slashes||D.slashes,y.href=y.format(),y}var S=y.pathname&&y.pathname.charAt(0)==="/",w=D.host||D.pathname&&D.pathname.charAt(0)==="/",G=w||S||y.host&&D.pathname,$=G,Q=y.pathname&&y.pathname.split("/")||[],re=D.pathname&&D.pathname.split("/")||[],le=y.protocol&&!T[y.protocol];if(le&&(y.hostname="",y.port=null,y.host&&(Q[0]===""?Q[0]=y.host:Q.unshift(y.host)),y.host="",D.protocol&&(D.hostname=null,D.port=null,D.host&&(re[0]===""?re[0]=D.host:re.unshift(D.host)),D.host=null),G=G&&(re[0]===""||Q[0]==="")),w)y.host=D.host||D.host===""?D.host:y.host,y.hostname=D.hostname||D.hostname===""?D.hostname:y.hostname,y.search=D.search,y.query=D.query,Q=re;else if(re.length)Q||(Q=[]),Q.pop(),Q=Q.concat(re),y.search=D.search,y.query=D.query;else if(!f.isNullOrUndefined(D.search)){if(le){y.hostname=y.host=Q.shift();var de=y.host&&y.host.indexOf("@")>0?y.host.split("@"):!1;de&&(y.auth=de.shift(),y.host=y.hostname=de.shift())}return y.search=D.search,y.query=D.query,(!f.isNull(y.pathname)||!f.isNull(y.search))&&(y.path=(y.pathname?y.pathname:"")+(y.search?y.search:"")),y.href=y.format(),y}if(!Q.length)return y.pathname=null,y.search?y.path="/"+y.search:y.path=null,y.href=y.format(),y;for(var me=Q.slice(-1)[0],Y=(y.host||D.host||Q.length>1)&&(me==="."||me==="..")||me==="",V=0,te=Q.length;te>=0;te--)me=Q[te],me==="."?Q.splice(te,1):me===".."?(Q.splice(te,1),V++):V&&(Q.splice(te,1),V--);if(!G&&!$)for(;V--;V)Q.unshift("..");G&&Q[0]!==""&&(!Q[0]||Q[0].charAt(0)!=="/")&&Q.unshift(""),Y&&Q.join("/").substr(-1)!=="/"&&Q.push("");var ne=Q[0]===""||Q[0]&&Q[0].charAt(0)==="/";if(le){y.hostname=y.host=ne?"":Q.length?Q.shift():"";var de=y.host&&y.host.indexOf("@")>0?y.host.split("@"):!1;de&&(y.auth=de.shift(),y.host=y.hostname=de.shift())}return G=G||y.host&&Q.length,G&&!ne&&Q.unshift(""),Q.length?y.pathname=Q.join("/"):(y.pathname=null,y.path=null),(!f.isNull(y.pathname)||!f.isNull(y.search))&&(y.path=(y.pathname?y.pathname:"")+(y.search?y.search:"")),y.auth=D.auth||y.auth,y.slashes=y.slashes||D.slashes,y.href=y.format(),y},d.prototype.parseHost=function(){var D=this.host,I=o.exec(D);I&&(I=I[0],I!==":"&&(this.port=I.substr(1)),D=D.substr(0,D.length-I.length)),D&&(this.hostname=D)}},function(W,n,e){(function(a,f){var d;(function(l){typeof n=="object"&&n&&n.nodeType,typeof a=="object"&&a&&a.nodeType;var o=typeof f=="object"&&f;o.global===o||o.window===o||o.self;var t,r=2147483647,s=36,i=1,u=26,c=38,h=700,g=72,v=128,m="-",E=/^xn--/,T=/[^\x20-\x7E]/,O=/[\x2E\u3002\uFF0E\uFF61]/g,M={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},P=s-i,C=Math.floor,_=String.fromCharCode;function D(L){throw new RangeError(M[L])}function I(L,U){for(var S=L.length,w=[];S--;)w[S]=U(L[S]);return w}function y(L,U){var S=L.split("@"),w="";S.length>1&&(w=S[0]+"@",L=S[1]),L=L.replace(O,".");var G=L.split("."),$=I(G,U).join(".");return w+$}function R(L){for(var U=[],S=0,w=L.length,G,$;S<w;)G=L.charCodeAt(S++),G>=55296&&G<=56319&&S<w?($=L.charCodeAt(S++),($&64512)==56320?U.push(((G&1023)<<10)+($&1023)+65536):(U.push(G),S--)):U.push(G);return U}function b(L){return I(L,function(U){var S="";return U>65535&&(U-=65536,S+=_(U>>>10&1023|55296),U=56320|U&1023),S+=_(U),S}).join("")}function z(L){return L-48<10?L-22:L-65<26?L-65:L-97<26?L-97:s}function H(L,U){return L+22+75*(L<26)-((U!=0)<<5)}function B(L,U,S){var w=0;for(L=S?C(L/h):L>>1,L+=C(L/U);L>P*u>>1;w+=s)L=C(L/P);return C(w+(P+1)*L/(L+c))}function p(L){var U=[],S=L.length,w,G=0,$=v,Q=g,re,le,de,me,Y,V,te,ne,ue;for(re=L.lastIndexOf(m),re<0&&(re=0),le=0;le<re;++le)L.charCodeAt(le)>=128&&D("not-basic"),U.push(L.charCodeAt(le));for(de=re>0?re+1:0;de<S;){for(me=G,Y=1,V=s;de>=S&&D("invalid-input"),te=z(L.charCodeAt(de++)),(te>=s||te>C((r-G)/Y))&&D("overflow"),G+=te*Y,ne=V<=Q?i:V>=Q+u?u:V-Q,!(te<ne);V+=s)ue=s-ne,Y>C(r/ue)&&D("overflow"),Y*=ue;w=U.length+1,Q=B(G-me,w,me==0),C(G/w)>r-$&&D("overflow"),$+=C(G/w),G%=w,U.splice(G++,0,$)}return b(U)}function A(L){var U,S,w,G,$,Q,re,le,de,me,Y,V=[],te,ne,ue,ge;for(L=R(L),te=L.length,U=v,S=0,$=g,Q=0;Q<te;++Q)Y=L[Q],Y<128&&V.push(_(Y));for(w=G=V.length,G&&V.push(m);w<te;){for(re=r,Q=0;Q<te;++Q)Y=L[Q],Y>=U&&Y<re&&(re=Y);for(ne=w+1,re-U>C((r-S)/ne)&&D("overflow"),S+=(re-U)*ne,U=re,Q=0;Q<te;++Q)if(Y=L[Q],Y<U&&++S>r&&D("overflow"),Y==U){for(le=S,de=s;me=de<=$?i:de>=$+u?u:de-$,!(le<me);de+=s)ge=le-me,ue=s-me,V.push(_(H(me+ge%ue,0))),le=C(ge/ue);V.push(_(H(le,0))),$=B(S,ne,w==G),S=0,++w}++S,++U}return V.join("")}function j(L){return y(L,function(U){return E.test(U)?p(U.slice(4).toLowerCase()):U})}function x(L){return y(L,function(U){return T.test(U)?"xn--"+A(U):U})}t={version:"1.4.1",ucs2:{decode:R,encode:b},decode:p,encode:A,toASCII:x,toUnicode:j},d=(function(){return t}).call(n,e,n,a),d!==void 0&&(a.exports=d)})()}).call(n,e(84)(W),e(0))},function(W,n){W.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(W,n,e){W.exports={isString:function(a){return typeof a=="string"},isObject:function(a){return typeof a=="object"&&a!==null},isNull:function(a){return a===null},isNullOrUndefined:function(a){return a==null}}},function(W,n,e){n.decode=n.parse=e(87),n.encode=n.stringify=e(88)},function(W,n,e){function a(d,l){return Object.prototype.hasOwnProperty.call(d,l)}W.exports=function(d,l,o,t){l=l||"&",o=o||"=";var r={};if(typeof d!="string"||d.length===0)return r;var s=/\+/g;d=d.split(l);var i=1e3;t&&typeof t.maxKeys=="number"&&(i=t.maxKeys);var u=d.length;i>0&&u>i&&(u=i);for(var c=0;c<u;++c){var h=d[c].replace(s,"%20"),g=h.indexOf(o),v,m,E,T;g>=0?(v=h.substr(0,g),m=h.substr(g+1)):(v=h,m=""),E=decodeURIComponent(v),T=decodeURIComponent(m),a(r,E)?f(r[E])?r[E].push(T):r[E]=[r[E],T]:r[E]=T}return r};var f=Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"}},function(W,n,e){var a=function(o){switch(typeof o){case"string":return o;case"boolean":return o?"true":"false";case"number":return isFinite(o)?o:"";default:return""}};W.exports=function(o,t,r,s){return t=t||"&",r=r||"=",o===null&&(o=void 0),typeof o=="object"?d(l(o),function(i){var u=encodeURIComponent(a(i))+r;return f(o[i])?d(o[i],function(c){return u+encodeURIComponent(a(c))}).join(t):u+encodeURIComponent(a(o[i]))}).join(t):s?encodeURIComponent(a(s))+r+encodeURIComponent(a(o)):""};var f=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"};function d(o,t){if(o.map)return o.map(t);for(var r=[],s=0;s<o.length;s++)r.push(t(o[s],s));return r}var l=Object.keys||function(o){var t=[];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&t.push(r);return t}},function(W,n,e){Object.defineProperty(n,"__esModule",{value:!0});function a(f){if(typeof f.state!="function"){var d="pending";f.then(function(l){return d="resolved",l},function(l){return d="rejected",l}),f.state=function(){return d}}return f}n.default=a}])})}(_t)),_t.exports}var Ht=In();const yn={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 p-6 bg-gray-50"},pn={class:"absolute top-3 left-3 z-10 bg-black bg-opacity-75 text-white text-sm px-3 py-1.5 rounded-full font-medium backdrop-blur-sm"},jn=["id"],An={__name:"NiftiViewer",props:{Select_url:{type:[String,Number],default:"http://localhost:3000/avg152T1_LR_nifti.nii"}},emits:["current-loaded"],setup(et,{emit:ze}){const W=et,n=ze,e=Rt("");Rt(!1);const a=Rt([]),f=sn([{id:"nifti-image-z",axis:"z",currImgIdIndex:0,total:0,complete:!1,scale:0,overlayUrl:"",overlayPixels:[]},{id:"nifti-image-x",axis:"x",currImgIdIndex:0,total:0,complete:!1,scale:0,overlayUrl:"",overlayPixels:[]},{id:"nifti-image-y",axis:"y",currImgIdIndex:0,total:0,complete:!1,scale:0,overlayUrl:"",overlayPixels:[]}]),d=["OrientationMarkers","Pan","Zoom"],l=new Ye.Synchronizer("cornerstonenewimage",Ye.updateImageSynchronizer);un(()=>W.Select_url,i=>{s()});const o=i=>{const u=i.detail.element;let g=Ye.getToolState(u,"stack").data[0].currentImageIdIndex,v=f.find(m=>m.id===u.id);v.currImgIdIndex=g},t=i=>{const u=i.detail.viewport,c=i.detail.element,g=Ye.getToolState(c,"stack").data[0];let v=f.find(m=>m.id===c.id);v.scale=u.scale.toFixed(4),v.currImgIdIndex=g.currentImageIdIndex},r=(i,u,c)=>{lt.enable(i);const h=e.value.fromURL(u);return i.dataset.imageId=h.url,new Promise(g=>{try{lt.loadAndCacheImage(h.url).then(function(v){let m=lt.metaData.get("imagePlaneModule",v.imageId);g(v);const E=lt.metaData.get("multiFrameModule",h.url).numberOfFrames,T=Array.from(Array(E),(C,_)=>`nifti:${h.filePath}#${h.slice.dimension}-${_},t-0`),O={currentImageIdIndex:h.slice.index,imageIds:T},M=lt.getDefaultViewportForImage(i,v),P=lt.getEnabledElement(i);f[c].total=T.length,lt.displayImage(i,v,M),lt.resize(i,!0),P.viewport.pixelReplication=!0,Ye.addStackStateManager(i,["stack","Crosshairs"]),Ye.addToolState(i,"stack",O),d.forEach(C=>{let _=C==="Pan"?2:1;Ye.addToolForElement(i,Cn[`${C}Tool`]),Ye.setToolActive(C,{mouseButtonMask:_})}),Ye.addToolForElement(i,Ye.StackScrollMouseWheelTool),Ye.setToolActive("StackScrollMouseWheel",{mouseButtonMask:0}),l.add(i),Ye.stackPrefetch.enable(i),Ye.addToolForElement(i,Ye.ReferenceLinesTool),Ye.setToolEnabled("ReferenceLines",{synchronizationContext:l}),Ye.addToolForElement(i,Ye.CrosshairsTool),Ye.setToolActive("Crosshairs",{mouseButtonMask:1,synchronizationContext:l})})}catch(v){throw v}})},s=async()=>{let i=0,u=W.Select_url;for(let c=0;c<f.length;c++){const h=document.getElementById(f[c].id),g=e.value.fromURL(`nifti:${u}#${f[c].axis},t-${i}`);await r(h,`nifti:${g.filePath}#${f[c].axis},t-${i}`,c)}n("current-loaded")};return dn(()=>{Ht.external.cornerstone=Zt,Ye.external.cornerstoneMath=En,Ye.external.cornerstone=Zt,Ye.external.Hammer=On,Ht.nifti.streamingMode=!0,e.value=Ht.nifti.ImageId,Ye.init(),St(()=>{a.value.forEach(i=>{i.addEventListener("cornerstonetoolsmousewheel",u=>{u.preventDefault(),St(()=>{o(u)})}),i.addEventListener(lt.EVENTS.IMAGE_RENDERED,u=>{u.preventDefault(),St(()=>{t(u)})})}),s()})}),(i,u)=>(Bt(),bt("div",yn,[(Bt(!0),bt(fn,null,cn(f,c=>(Bt(),bt("div",{key:c.id,class:"relative bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow duration-200",onContextmenu:u[0]||(u[0]=Ut(()=>{},["prevent"])),onSelectstart:u[1]||(u[1]=Ut(()=>{},["prevent"])),onMousedown:u[2]||(u[2]=Ut(()=>{},["prevent"]))},[Ct("div",pn,[Ct("span",null,Yt(c.currImgIdIndex+1)+" / "+Yt(c.total),1)]),Ct("div",{ref_for:!0,ref_key:"viewports",ref:a,class:"aspect-square w-full bg-gray-100 flex items-center justify-center",id:c.id},u[3]||(u[3]=[Ct("div",{class:"text-gray-400 text-sm"},"...",-1)]),8,jn)],32))),128))]))}},Ln=ln(An,[["__scopeId","data-v-d0d02d5f"]]);export{Ln as N};
