import{d as ue,r as d,u as de,o as re,c as D,e as i,f as u,w as o,g as p,Q as ie,p as c,aa as S,F as C,n as L,k as E,h as N,aq as $,ai as ce,ah as me,t as pe,aA as ve,M as m,a as fe,W as _e,O as r,P as be}from"./index-iZTeaJac.js";import{n as ge,f as ke,g as j}from"./index-C-7UpYWQ.js";import{t as he}from"./index-2Fl6aFRQ.js";import{b as we,c as Ie,d as ye}from"./index-BlD-43QO.js";import{b as xe}from"./index-Bqa-GVRE.js";const Me={class:"p-4"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Fe={class:"flex items-center space-x-4"},De={class:"flex items-center space-x-4"},Se={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Te={class:"flex flex-col space-y-3"},Ce={class:"tipDiv"},Le={class:"flex justify-center pt-4"},Ne=ue({__name:"add",setup(Pe){const M=fe(),P=d(),q=d([]),V=d({}),f=d([]),U=d({}),A=d({}),_=d(1),b=d(!0),F=de(),g=d(!1),v=d(!1),k=d(!1),h=d(!0),w=d(""),Q=d([{value:"1",label:"病例模型"},{value:"2",label:"诊疗方案模型"},{value:"3",label:"影像分割模型"},{value:"4",label:"影像诊断模型"},{value:"5",label:"病理组学模型"}]),z=d([]),l=d({modelMain:"",modelSub:"",patientInfo:"",disease:"",hospital:"",inferenceName:"",notes:"",file:"",segmentationModel:"",optimizationModel:"",fileList:[]}),R=e=>{P.value.clearFiles();const a=e[0];a.uid=ve(),P.value.handleStart(a)},W=e=>{switch(l.value.fileList=[],f.value=[],V.value=[],l.value.modelMain){case"1":v.value=!1,g.value=!0,k.value=!0,_.value=1,b.value=!1,h.value=!0,T(e),w.value="请上传修改后的模板文件";break;case"2":v.value=!1,g.value=!0,k.value=!1,_.value=1,b.value=!1,h.value=!0,T(e),w.value="请上传修改后的模板文件";break;case"3":v.value=!0,g.value=!0,k.value=!1,_.value=1,b.value=!1,h.value=!0,w.value="请上传修改后的模板文件";break;case"4":v.value=!1,g.value=!1,T(e),k.value=!1,_.value=9999,b.value=!0,h.value=!0,w.value="请上传推理图片";break;case"5":v.value=!1,g.value=!1,T(e),k.value=!1,_.value=9999,b.value=!0,h.value=!1,w.value="请上传推理图片";break}l.value.modelSub=""},G=()=>{let e="模板",a="";switch(l.value.modelMain){case"1":e="病例模型模板",a="/uploads/template/病例模型模板.xlsx";break;case"2":e="诊疗方案模型模板",a="/uploads/template/诊疗优化模板.xlsx";break;case"3":e="影像分割模型模板",a="/uploads/template/影像分割推理模板.zip";break;case"4":e="影像诊断模型模板",a="";break;case"5":e="病理组学模型模板",a="";break;default:e="模板",a=""}const s="/"+a,n=document.createElement("a");n.href=s,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)},H=(e,a)=>{f.value=a,V.value=e.raw},J=e=>{A.value=[],A.value=U.value[e]},T=async e=>{const a=await he({model_id:e});z.value=a.data},K=async()=>{const e=await ie();q.value=e.data},X=async()=>{const e=await ge(),a=d({});for(let s=0;s<e.data.length;s++)if(a.value[s]={name:e.data[s].task_name,remark:e.data[s].remark,model:[]},e.data[s].models.length>0)for(let n=0;n<e.data[s].models.length;n++)a.value[s].model[n]={name:"调优"+(n+1)+"；得分："+e.data[s].models[n].dice,result_id:e.data[s].models[n].result_id};U.value=a.value},Y=async()=>{const e=new FormData;e.append("inference_name",l.value.inferenceName),e.append("task_id",l.value.modelSub),e.append("external_doctor_id",F.getDoctorId),e.append("hospital_name",l.value.hospital),e.append("remark",l.value.notes),e.append("file",V.value);const a=await ye(e);a.code==200?(m.success(a.message),M.push({name:"telemedicine"})):m.error(a.message)},Z=async()=>{const e=new FormData;e.append("inference_name",l.value.inferenceName),e.append("doctor_id",F.getDoctorId),e.append("task_id",l.value.modelSub),e.append("file",V.value),await xe(e),M.push({name:"telemedicine"})},ee=async()=>{const e=new FormData;e.append("task_name",l.value.inferenceName),e.append("doctor_id",F.getDoctorId),e.append("result_id",l.value.optimizationModel),e.append("remark",l.value.notes),e.append("file",V.value);const a=await ke(e);if(a.code==200){m.success(a.message);const s=_e.service({lock:!0,text:"正在推理中...",background:"rgba(255, 255, 255, 0.7)"}),n=await j({inference_id:a.data.inference_id});B(n.data.progress);const I=setInterval(async()=>{const y=await j({inference_id:a.data.inference_id}),x=B(y.data.progress);s.setText(x.value),x.status&&(s.close(),clearInterval(I),m.success("推理完成"),M.push({name:"telemedicine"}))},1e3)}else m.error(a.message)},B=e=>e.includes("推理完成")?{status:!0,value:`${e}`}:{status:!1,value:`${e}`},ae=async()=>{const e=new FormData;for(let s=0;s<f.value.length;s++)e.append("files[]",f.value[s].raw);e.append("inference_name",l.value.inferenceName),e.append("doctor_id",F.getDoctorId),e.append("task_id",l.value.modelSub),e.append("remarks",l.value.notes);const a=await Ie(e);a.code==200?(m.success(a.message),M.push({name:"telemedicine"})):m.error(a.message)},le=async()=>{const e=new FormData;for(let s=0;s<f.value.length;s++)e.append("files[]",f.value[s].raw);e.append("inference_name",l.value.inferenceName),e.append("doctor_id",F.getDoctorId),e.append("task_id",l.value.modelSub);const a=await we(e);a.code==200?(m.success(a.message),M.push({name:"telemedicine"})):m.error(a.message)},te=()=>{switch(l.value.modelMain){case"1":Y();break;case"2":Z();break;case"3":ee();break;case"4":ae();break;case"5":le();break}};return re(()=>{K(),X()}),(e,a)=>{const s=p("el-input"),n=p("el-form-item"),I=p("el-option"),y=p("el-select"),x=p("el-button"),se=p("el-upload"),ne=p("el-form"),oe=p("el-card");return r(),D("div",Me,[a[11]||(a[11]=i("div",{class:"flex items-center mb-6"},[i("h2",{class:"text-xl font-semibold"},"远程医疗申请")],-1)),u(oe,{class:"bg-white rounded-lg shadow-md p-6 max-w-3xl mx-auto"},{default:o(()=>[u(ne,{ref:"form",model:l.value,"label-width":"120px",class:"space-y-6"},{default:o(()=>[i("div",Ve,[u(n,{label:"推理名称",prop:"inferenceName"},{default:o(()=>[u(s,{modelValue:l.value.inferenceName,"onUpdate:modelValue":a[0]||(a[0]=t=>l.value.inferenceName=t),placeholder:"请输入推理名称"},null,8,["modelValue"])]),_:1}),k.value?(r(),c(n,{key:0,label:"医院名称",prop:"hospital"},{default:o(()=>[u(s,{modelValue:l.value.hospital,"onUpdate:modelValue":a[1]||(a[1]=t=>l.value.hospital=t),placeholder:"请输入医院名称"},null,8,["modelValue"])]),_:1})):S("",!0)]),u(n,{label:"选择模型",prop:"model"},{default:o(()=>[i("div",Fe,[u(y,{modelValue:l.value.modelMain,"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.modelMain=t),placeholder:"请选择模型类型",class:"self-stretch",onChange:W},{default:o(()=>[(r(!0),D(C,null,L(Q.value,t=>(r(),c(I,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),v.value?S("",!0):(r(),c(y,{key:0,modelValue:l.value.modelSub,"onUpdate:modelValue":a[3]||(a[3]=t=>l.value.modelSub=t),placeholder:"请选择模型",class:"self-stretch",disabled:!l.value.modelMain},{default:o(()=>[(r(!0),D(C,null,L(z.value,t=>(r(),c(I,{key:t.task_id,label:t.task_name,value:t.task_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])),g.value?(r(),c(x,{key:1,type:"primary",onClick:G,class:"bg-blue-600 hover:bg-blue-700 ml-2"},{default:o(()=>[u(N($),{class:"mr-1"},{default:o(()=>[u(N(ce))]),_:1}),a[8]||(a[8]=E(" 下载模板 "))]),_:1,__:[8]})):S("",!0)])]),_:1}),v.value?(r(),c(n,{key:0,label:"选择分割模型",prop:"dataSet"},{default:o(()=>[i("div",De,[u(y,{modelValue:l.value.segmentationModel,"onUpdate:modelValue":a[4]||(a[4]=t=>l.value.segmentationModel=t),placeholder:"请选择分割模型",class:"self-stretch",onChange:J},{default:o(()=>[(r(!0),D(C,null,L(U.value,(t,O)=>(r(),c(I,{key:O,label:t.name,value:O},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(y,{modelValue:l.value.optimizationModel,"onUpdate:modelValue":a[5]||(a[5]=t=>l.value.optimizationModel=t),placeholder:"请选择调优模型",class:"self-stretch",disabled:!l.value.segmentationModel},{default:o(()=>[(r(!0),D(C,null,L(A.value?.model||[],t=>(r(),c(I,{key:t.result_id,label:t.name,value:t.result_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])]),_:1})):S("",!0),i("div",Se,[u(n,{label:"患者基本信息",prop:"patientInfo"},{default:o(()=>[i("div",Te,[u(se,{ref_key:"upload",ref:P,"auto-upload":!1,"on-change":H,"on-exceed":R,multiple:b.value,limit:_.value,"file-list":l.value.fileList,"onUpdate:fileList":a[6]||(a[6]=t=>l.value.fileList=t),class:"w-full upload-demo"},{tip:o(()=>[i("div",Ce,pe(w.value),1)]),default:o(()=>[u(x,{type:"success",class:"bg-green-600 hover:bg-green-700"},{default:o(()=>[u(N($),{class:"mr-1"},{default:o(()=>[u(N(me))]),_:1}),a[9]||(a[9]=E(" 上传文件 "))]),_:1,__:[9]})]),_:1},8,["multiple","limit","file-list"])])]),_:1})]),h.value?(r(),c(n,{key:1,label:"备注信息",prop:"notes"},{default:o(()=>[u(s,{modelValue:l.value.notes,"onUpdate:modelValue":a[7]||(a[7]=t=>l.value.notes=t),type:"textarea",rows:3,placeholder:"请输入备注信息",class:"w-3/4"},null,8,["modelValue"])]),_:1})):S("",!0),i("div",Le,[u(x,{type:"primary",size:"large",class:"px-8 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg shadow-md transition-colors duration-200",onClick:te},{default:o(()=>a[10]||(a[10]=[E(" 提交申请 ")])),_:1,__:[10]})])]),_:1},8,["model"])]),_:1})])}}}),Oe=be(Ne,[["__scopeId","data-v-3b47000e"]]);export{Oe as default};
