import{d as z,r as m,o as E,X as O,c as C,e as s,a1 as G,f as e,w as t,g as n,R as H,Q as J,h as f,G as j,m as Q,F as T,n as X,p as Z,k as h,af as $,Z as K,aj as W,t as ee,a as le,O as U,M as A,P as ae}from"./index-iZTeaJac.js";import{U as te}from"./userListComponents-F1YBBUwJ.js";import{a as oe,b as se,d as de}from"./index-Bmr-LazT.js";const re={class:"min-h-screen bg-gray-50 px-4 py-6"},ie={class:"max-w-7xl mx-auto"},ue={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},ne={class:"bg-blue-50 px-6 py-4 border-b border-blue-100"},pe={class:"flex items-center"},ce={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mt-6"},me={class:"bg-green-50 px-6 py-4 border-b border-green-100"},_e={class:"flex items-center"},ve={class:"p-6"},fe={class:"bg-gray-50 rounded-lg p-4 mb-6"},be={class:"w-full"},ge={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden mt-6"},xe={class:"bg-purple-50 px-6 py-4 border-b border-purple-100"},Ve={class:"flex items-center"},ye={class:"flex justify-center mt-8 pb-8"},we={class:"flex space-x-4"},he=z({__name:"add",setup(Ue){const g=le(),b=O(),x=m(),p=m(!1),c=m({name:"",disease:"",sex:""}),D=m([]),F=m(),a=m({title:"",code:"",objective:"",description:"",design:"",inclusion_criteria:"",exclusion_criteria:"",sponsor:"",start_date:"",end_date:"",status:"",principal_doctor:"",group_id:"",enroll_date:"",patient_ids:" "}),Y=m([]),S=m([]),R=async()=>{if(b.query.row){const r=await se({study_id:x.value.value,title:a.value.title,status:a.value.status,patient_ids:a.value.patient_ids,group_id:""});r.code==200&&(A.success(r.message),g.push({name:"clinicalResearchSupport"}))}else(await de({title:a.value.title,code:a.value.code,objective:a.value.objective,description:a.value.description,design:a.value.design,inclusion_criteria:a.value.inclusion_criteria,exclusion_criteria:a.value.exclusion_criteria,sponsor:a.value.sponsor,start_date:a.value.start_date,end_date:a.value.end_date,status:a.value.status,principal_doctor:a.value.principal_doctor,group_id:a.value.group_id,enroll_date:a.value.enroll_date,patient_ids:a.value.patient_ids})).code==200&&(A.success("添加成功"),g.push({name:"clinicalResearchSupport"}))},I=r=>{a.value.patient_ids=r.map(l=>l.patient_id).join(",")},L=r=>{g.push({name:"dataCollection_details",query:{patient_id:r.patient_id}})},k=async(r,l,i)=>{const u=await H({patient_name:r,tag_id:l,gender:i});Y.value=u.data},P=()=>{k(c.value.name,c.value.disease,c.value.sex)},q=async()=>{const r=await J();S.value=[{tag_id:"",name:"全部类型"},...r.data]},N=async r=>{const l=await oe({study_id:r});a.value=l.data.study_info;for(let i=0;i<l.data.patient_list.length;i++)D.value[i]=l.data.patient_list[i].patient_id};return E(()=>{b.query.row&&(x.value=m(JSON.parse(b.query.row)),p.value=!0,N(x.value.value)),k("","",""),q()}),(r,l)=>{const i=n("el-icon"),u=n("el-input"),d=n("el-form-item"),_=n("el-col"),M=n("el-date-picker"),v=n("el-option"),V=n("el-select"),B=n("el-row"),y=n("el-form"),w=n("el-button");return U(),C("div",re,[s("div",ie,[l[22]||(l[22]=G('<div class="mb-8 flex items-center" data-v-a98fe8c7><div class="flex items-center space-x-3 mb-3" data-v-a98fe8c7><div class="w-1 h-8 bg-gradient-to-b from-blue-500 to-indigo-600 rounded-full" data-v-a98fe8c7></div><h1 class="text-3xl font-bold text-gray-800" data-v-a98fe8c7>临床研究方案</h1></div><p class="text-gray-600 ml-7" data-v-a98fe8c7>创建和管理临床研究方案，追踪研究进展</p></div>',1)),s("div",ue,[s("div",ne,[s("div",pe,[e(i,{class:"text-blue-600 mr-3 text-lg !mr-2"},{default:t(()=>[e(f(j))]),_:1}),l[16]||(l[16]=s("h3",{class:"text-lg font-semibold text-blue-700"},"基本信息",-1))])]),e(y,{model:a.value,ref_key:"formRef",ref:F,"label-width":"150px",class:"p-6"},{default:t(()=>[e(B,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(d,{label:"研究标题",prop:"title"},{default:t(()=>[e(u,{modelValue:a.value.title,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.title=o),placeholder:"请输入方案标题"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(d,{label:"研究编号",prop:"code"},{default:t(()=>[e(u,{modelValue:a.value.code,"onUpdate:modelValue":l[1]||(l[1]=o=>a.value.code=o),placeholder:"请输入研究编号",disabled:p.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(d,{label:"合作单位",prop:"sponsor"},{default:t(()=>[e(u,{modelValue:a.value.sponsor,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.sponsor=o),placeholder:"请输入合作单位",disabled:p.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(d,{label:"负责人医生",prop:"principal_doctor"},{default:t(()=>[e(u,{modelValue:a.value.principal_doctor,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.principal_doctor=o),placeholder:"请输入负责人医生",disabled:p.value},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(d,{label:"开始日期",prop:"start_date"},{default:t(()=>[e(M,{modelValue:a.value.start_date,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.start_date=o),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(d,{label:"结束日期",prop:"end_date"},{default:t(()=>[e(M,{modelValue:a.value.end_date,"onUpdate:modelValue":l[5]||(l[5]=o=>a.value.end_date=o),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(d,{label:"状态",prop:""},{default:t(()=>[e(V,{modelValue:a.value.status,"onUpdate:modelValue":l[6]||(l[6]=o=>a.value.status=o),placeholder:"请选择状态",style:{width:"100%"}},{default:t(()=>[e(v,{label:"未开始",value:0}),e(v,{label:"进行中",value:1}),e(v,{label:"完成",value:2}),e(v,{label:"中止",value:3})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",ce,[s("div",me,[s("div",_e,[e(i,{class:"text-green-600 mr-3 text-lg !mr-2"},{default:t(()=>[e(f(Q))]),_:1}),l[17]||(l[17]=s("h3",{class:"text-lg font-semibold text-green-700"},"参与人员选择",-1))])]),s("div",ve,[s("div",fe,[l[19]||(l[19]=s("div",{class:"flex items-center space-x-4 mb-4"},[s("span",{class:"text-sm font-medium text-gray-600"},"筛选条件：")],-1)),e(y,{inline:!0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end"},{default:t(()=>[e(d,{label:"姓名",class:"mb-0"},{default:t(()=>[e(u,{modelValue:c.value.name,"onUpdate:modelValue":l[7]||(l[7]=o=>c.value.name=o),placeholder:"请输入姓名",clearable:"",class:"w-full"},null,8,["modelValue"])]),_:1}),e(d,{label:"病种",class:"mb-0"},{default:t(()=>[e(V,{modelValue:c.value.disease,"onUpdate:modelValue":l[8]||(l[8]=o=>c.value.disease=o),placeholder:"选择病种",clearable:"",class:"w-full"},{default:t(()=>[(U(!0),C(T,null,X(S.value,o=>(U(),Z(v,{label:o.name,value:o.tag_id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"性别",class:"mb-0"},{default:t(()=>[e(V,{modelValue:c.value.sex,"onUpdate:modelValue":l[9]||(l[9]=o=>c.value.sex=o),placeholder:"选择性别",clearable:"",class:"w-full"},{default:t(()=>[e(v,{label:"男",value:"0"}),e(v,{label:"女",value:"1"})]),_:1},8,["modelValue"])]),_:1}),e(d,{class:"mb-0"},{default:t(()=>[e(w,{type:"primary",onClick:P,class:"!bg-gradient-to-r !from-green-500 !to-green-600 hover:!from-green-600 hover:!to-green-700 !border-0 shadow-lg hover:shadow-xl transition-all duration-300"},{default:t(()=>[e(i,{class:"mr-2"},{default:t(()=>[e(f($))]),_:1}),l[18]||(l[18]=h(" 筛选查询 "))]),_:1,__:[18]})]),_:1})]),_:1})]),s("div",be,[e(te,{"table-data":Y.value,type:"selection",onHandleDetails:L,selectArr:D.value,onSelectionChange:I},null,8,["table-data","selectArr"])])])]),s("div",ge,[s("div",xe,[s("div",Ve,[e(i,{class:"text-purple-600 mr-3 text-lg !mr-2"},{default:t(()=>[e(f(j))]),_:1}),l[20]||(l[20]=s("h3",{class:"text-lg font-semibold text-purple-700"},"研究内容",-1))])]),e(y,{model:a.value,ref:"formRef2","label-width":"150px",class:"p-6"},{default:t(()=>[e(d,{label:"研究目标",prop:"objective"},{default:t(()=>[e(u,{modelValue:a.value.objective,"onUpdate:modelValue":l[10]||(l[10]=o=>a.value.objective=o),type:"textarea",rows:4,placeholder:"请输入研究目标",disabled:p.value},null,8,["modelValue","disabled"])]),_:1}),e(d,{label:"研究描述",prop:"description"},{default:t(()=>[e(u,{modelValue:a.value.description,"onUpdate:modelValue":l[11]||(l[11]=o=>a.value.description=o),type:"textarea",rows:4,placeholder:"请输入研究描述",disabled:p.value},null,8,["modelValue","disabled"])]),_:1}),e(d,{label:"研究设计",prop:"design"},{default:t(()=>[e(u,{modelValue:a.value.design,"onUpdate:modelValue":l[12]||(l[12]=o=>a.value.design=o),type:"textarea",rows:4,placeholder:"请输入研究设计",disabled:p.value},null,8,["modelValue","disabled"])]),_:1}),e(d,{label:"纳入标准",prop:"inclusion_criteria"},{default:t(()=>[e(u,{modelValue:a.value.inclusion_criteria,"onUpdate:modelValue":l[13]||(l[13]=o=>a.value.inclusion_criteria=o),type:"textarea",rows:4,placeholder:"请输入纳入标准",disabled:p.value},null,8,["modelValue","disabled"])]),_:1}),e(d,{label:"排除标准",prop:"exclusion_criteria"},{default:t(()=>[e(u,{modelValue:a.value.exclusion_criteria,"onUpdate:modelValue":l[14]||(l[14]=o=>a.value.exclusion_criteria=o),type:"textarea",rows:4,placeholder:"请输入排除标准",disabled:p.value},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),s("div",ye,[s("div",we,[e(w,{onClick:l[15]||(l[15]=()=>r.$router.go(-1)),size:"large",class:"px-8 py-3"},{default:t(()=>[e(i,{class:"!mr-2"},{default:t(()=>[e(f(K))]),_:1}),l[21]||(l[21]=h(" 返回 "))]),_:1,__:[21]}),e(w,{onClick:R,type:"primary",size:"large",class:"!bg-gradient-to-r !from-blue-500 !to-blue-600 hover:!from-blue-600 hover:!to-blue-700 !border-0 shadow-lg hover:shadow-xl transition-all duration-300 px-8 py-3"},{default:t(()=>[e(i,{class:"!mr-2"},{default:t(()=>[e(f(W))]),_:1}),h(" "+ee(f(b).query.row?"更新方案":"创建方案"),1)]),_:1})])])])])}}}),ke=ae(he,[["__scopeId","data-v-a98fe8c7"]]);export{ke as default};
