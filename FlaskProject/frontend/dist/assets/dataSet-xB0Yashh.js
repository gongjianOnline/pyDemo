import{d as se,o as oe,r as n,Q as ne,c as y,e as t,f as a,w as o,h as c,a2 as de,g as _,F as T,n as H,k as u,t as N,Y as R,a3 as ie,a4 as ue,as as q,p as re,T as ce,U as _e,a6 as pe,M as w,a as me,a7 as ve,O as g,P as fe}from"./index-iZTeaJac.js";import{U as L}from"./userListComponents-F1YBBUwJ.js";import{d as be,a as ge,b as O,c as xe,e as ye}from"./index-2Fl6aFRQ.js";import{i as we}from"./index-C-7UpYWQ.js";const De={class:"flex h-full bg-gray-50"},he={class:"w-64 bg-white border-r border-slate-200 flex flex-col shadow-sm"},Ce={class:"flex-1 overflow-auto"},Se={class:"p-4"},ke={class:"space-y-1"},Ve=["onClick"],Ie={class:"flex items-center justify-between"},Pe={class:"flex items-center gap-3"},Te={class:"font-medium text-sm text-slate-800"},Ne={class:"text-xs text-slate-500"},Le={class:"opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-slate-200"},Ue={class:"flex-1 flex flex-col"},Be={class:"bg-white border-b border-slate-200 p-6 shadow-sm"},Ae={class:"max-w-4xl"},je={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},Me={class:"flex items-end gap-3"},$e={class:"bg-white border-b border-slate-200 p-4"},ze={class:"flex items-center justify-between"},Ee={class:"flex items-center gap-6"},Fe={class:"flex items-center gap-2"},He={class:"text-sm text-slate-600"},Re={class:"font-medium text-slate-800"},qe={class:"flex-1 bg-white overflow-auto"},Oe={class:"flex justify-center mb-2"},Qe={class:"h-[500px] overflow-auto"},Ye={class:"text-right mb-1"},Ge={class:"h-[400px] overflow-y-auto"},Je=se({__name:"dataSet",setup(Ke){const Q=me();oe(()=>{p(),K(),C()});const U=n(0),B=n(""),A=n([]),p=async()=>{const l=await be({dataset_type:"1",is_active:""});A.value=l.data.list,m.value=l.data.list[0].dataset_id,D.value=l.data.list[0].patient_id},D=n(""),m=n(0),Y=l=>{D.value=l.patient_id,m.value=l.dataset_id},v=n(!1),h=n([]),G=async l=>{v.value=!0;const e=await ge({dataset_id:l.dataset_id});h.value=e.data.patient_list,B.value=l.dataset_id},J=async()=>{const l=ae(f.value,h.value);await O({dataset_id:B.value,patient_ids:l.map(e=>e.patient_id).join(",")}),w({type:"success",message:"操作成功"}),v.value=!1,p()},d=n({patientName:"",sex:"",diseaseType:""}),j=n([]),K=async()=>{const l=await ne();j.value=l.data},x=n([]),C=async()=>{try{const l=await we({patient_name:d.value.patientName,tag_id:d.value.diseaseType,gender:d.value.sex});x.value=l.data}catch{x.value=[]}},f=n([]),S=l=>{f.value=l,U.value=f.value.length},k=l=>{Q.push({name:"dataCollection_details",query:{patient_id:l.patient_id}})},b=n(!1),V=n(""),W=async()=>{await xe({name:V.value,dataset_type:"1",description:"",patient_ids:f.value.map(l=>l.patient_id).join(",")}),w({type:"success",message:"创建成功"}),b.value=!1,p()},X=async l=>{ve.confirm("确定删除该条数据集吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await ye({dataset_id:l.dataset_id}),w({type:"success",message:"操作成功"}),p()}).catch(()=>{})},Z=async()=>{await O({dataset_id:m.value.toString(),patient_ids:f.value.map(l=>l.patient_id).join(",")}),w({type:"success",message:"添加成功"}),p()},ee=()=>{d.value.patientName="",d.value.sex="",d.value.diseaseType="",C()},te=l=>l.split(","),ae=(l,e)=>{const r=new Set(l.map(i=>i.patient_id));return e.filter(i=>!r.has(i.patient_id))};return(l,e)=>{const r=_("el-button"),i=_("el-icon"),M=_("el-dropdown-item"),le=_("el-dropdown"),$=_("el-input"),I=_("el-option"),z=_("el-select"),E=_("el-dialog");return g(),y(T,null,[t("div",De,[t("div",he,[e[10]||(e[10]=t("div",{class:"p-4 border-b border-slate-100"},[t("h2",{class:"text-lg font-semibold text-slate-800 flex items-center gap-2"}," 数据集管理 ")],-1)),t("div",Ce,[t("div",Se,[a(r,{type:"primary",class:"w-full mb-4",onClick:e[0]||(e[0]=s=>b.value=!0),icon:c(de)},{default:o(()=>e[7]||(e[7]=[u(" 创建数据集 ")])),_:1,__:[7]},8,["icon"]),t("div",ke,[(g(!0),y(T,null,H(A.value,(s,P)=>(g(),y("div",{key:P,class:R(["group relative p-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-50",{"bg-blue-50 border-l-4 border-blue-500":m.value===s.dataset_id}]),onClick:F=>Y(s)},[t("div",Ie,[t("div",Pe,[t("div",{class:R(["w-2 h-2 rounded-full bg-cyan-500",{"bg-blue-500":m.value===s.dataset_id}])},null,2),t("div",null,[t("div",Te,N(s.name),1),t("div",Ne,N(te(s.patient_id).length)+" 条记录",1)])]),a(le,{trigger:"click"},{dropdown:o(()=>[a(M,{command:"delete",divided:"",onClick:F=>G(s)},{default:o(()=>[a(i,{class:"mr-2"},{default:o(()=>[a(c(ue))]),_:1}),e[8]||(e[8]=u("详情"))]),_:2,__:[8]},1032,["onClick"]),a(M,{command:"delete",divided:"",onClick:F=>X(s)},{default:o(()=>[a(i,{class:"mr-2"},{default:o(()=>[a(c(q))]),_:1}),e[9]||(e[9]=u("删除"))]),_:2,__:[9]},1032,["onClick"])]),default:o(()=>[t("div",Le,[a(i,null,{default:o(()=>[a(c(ie))]),_:1})])]),_:2},1024)])],10,Ve))),128))])])])]),t("div",Ue,[t("div",Be,[t("div",Ae,[e[16]||(e[16]=t("h3",{class:"text-xl font-semibold text-slate-800 mb-6"},"数据筛选",-1)),t("div",je,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"患者姓名",-1)),a($,{modelValue:d.value.patientName,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.patientName=s),class:"w-full",placeholder:"输入患者姓名"},null,8,["modelValue"])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"性别",-1)),a(z,{modelValue:d.value.sex,"onUpdate:modelValue":e[2]||(e[2]=s=>d.value.sex=s),placeholder:"请选择性别",class:"w-full",size:"default"},{default:o(()=>[a(I,{label:"男",value:0}),a(I,{label:"女",value:1})]),_:1},8,["modelValue"])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"病种",-1)),a(z,{modelValue:d.value.diseaseType,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value.diseaseType=s),placeholder:"请选择病种",class:"w-full",size:"default"},{default:o(()=>[(g(!0),y(T,null,H(j.value,(s,P)=>(g(),re(I,{key:P,label:s.name,value:s.tag_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",Me,[a(r,{type:"primary",class:"flex-1",onClick:C},{default:o(()=>[a(i,{class:"!mr-2"},{default:o(()=>[a(c(ce))]),_:1}),e[14]||(e[14]=u("筛选"))]),_:1,__:[14]}),a(r,{onClick:ee},{default:o(()=>[a(i,{class:"mr-2"},{default:o(()=>[a(c(_e))]),_:1}),e[15]||(e[15]=u("重置"))]),_:1,__:[15]})])])])]),t("div",$e,[t("div",ze,[t("div",Ee,[t("div",Fe,[e[19]||(e[19]=t("div",{class:"w-2 h-2 rounded-full bg-blue-500"},null,-1)),t("span",He,[e[17]||(e[17]=u("已选中: ")),t("span",Re,N(U.value),1),e[18]||(e[18]=u(" 条记录"))])])]),t("div",null,[a(r,{type:"primary",onClick:Z},{default:o(()=>[a(i,{class:"mr-2"},{default:o(()=>[a(c(pe))]),_:1}),e[20]||(e[20]=u("更新当前数据集"))]),_:1,__:[20]})])])]),t("div",qe,[a(L,{colNum:3,type:"selection","table-data":x.value,defaultSelectIds:D.value,onHandleDetails:k,onSelectionChange:S},null,8,["table-data","defaultSelectIds"])])])]),a(E,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s),title:"创建数据集",width:"80%","before-close":()=>b.value=!1},{default:o(()=>[t("div",null,[t("div",Oe,[a($,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=s=>V.value=s),style:{width:"240px"},placeholder:"请输入数据集名称"},null,8,["modelValue"]),a(r,{type:"primary",class:"ml-3",onClick:W},{default:o(()=>e[21]||(e[21]=[u("创建")])),_:1,__:[21]})]),t("div",Qe,[a(L,{colNum:3,type:"selection","table-data":x.value,onHandleDetails:k,onSelectionChange:S},null,8,["table-data"])])])]),_:1},8,["modelValue","before-close"]),a(E,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=s=>v.value=s),title:"数据集详情",width:"80%","before-close":()=>v.value=!1},{default:o(()=>[t("div",Ye,[a(r,{type:"danger",onClick:J},{default:o(()=>[a(i,{class:"mr-2"},{default:o(()=>[a(c(q))]),_:1}),e[22]||(e[22]=u("删除"))]),_:1,__:[22]})]),t("div",Ge,[a(L,{colNum:3,type:"selection","table-data":h.value,onHandleDetails:k,onSelectionChange:S},null,8,["table-data"])])]),_:1},8,["modelValue","before-close"])],64)}}}),tt=fe(Je,[["__scopeId","data-v-1b8f7cab"]]);export{tt as default};
