import{d as K,u as Q,o as W,r as d,Q as J,R as X,c as w,e,f as s,t as u,w as a,g as f,F as C,n as z,k as i,h,T as Y,U as Z,V as L,M as ee,a as te,O as v,p as se,W as U,P as le}from"./index-iZTeaJac.js";import{U as ae}from"./userListComponents-F1YBBUwJ.js";import{d as oe,a as ne}from"./index-BXSuu6V1.js";const de={class:"w-full h-full bg-gradient-to-br from-slate-50 to-blue-50"},re={class:"bg-white shadow-lg border-b border-gray-200 p-6"},ie={class:"max-w-7xl mx-auto"},ue={class:"mb-4"},ce={class:"text-gray-600"},me={class:"bg-gray-50 rounded-xl p-4"},fe={class:"flex flex-wrap items-center gap-4"},pe={class:"flex items-center space-x-2"},xe={class:"flex items-center space-x-2"},ge={class:"flex items-center space-x-3 ml-auto"},ve={class:"p-2"},_e={class:"flex-1"},be={class:"mx-auto"},ye={class:"bg-white rounded-2xl shadow-xl"},we={class:"px-6 py-4"},he={class:"space-y-3"},ke={class:"flex items-center"},Ve={class:"text-sm font-medium text-gray-700"},Be={class:"text-sm text-gray-900 font-semibold"},je={class:"mt-6 flex justify-center"},Ce={class:"px-6 py-4"},De={class:"space-y-3"},Me={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100"},ze={class:"text-sm text-gray-900 font-semibold flex-1 text-right"},Le={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100"},Ue={class:"text-sm text-gray-900 font-semibold"},Ie={class:"mt-6 flex justify-center"},Ne={class:"px-6 py-4"},Se={class:"space-y-3"},$e={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100"},Pe={class:"text-sm text-gray-900 font-semibold flex-1 text-right"},Ae={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100"},Ee={class:"text-sm text-gray-900 font-semibold"},Fe={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100"},Te={class:"text-sm text-gray-900 font-semibold"},Oe={class:"mt-6 flex justify-center"},Re=K({__name:"index",setup(qe){const I=te(),N=Q(),S="//api/datacollection/data_import";W(()=>{$(),k()});const c=d({nameValue:"",illnessNameValue:"",sexValue:""}),D=d([]),$=async()=>{const l=await J();D.value=l.data},_=d([]),k=async()=>{try{const l=await X({patient_name:c.value.nameValue,tag_id:c.value.illnessNameValue,gender:c.value.sexValue});_.value=l.data}catch{_.value=[]}},P=l=>{I.push({name:"dataCollection_details",query:{patient_id:l.patient_id}})},A=async()=>{const l=U.service({lock:!0,text:"数据正在同步中...",background:"rgba(255, 255, 255, 0.7)"}),t=await oe();M.value=Object.entries(t.data).map(([n,m])=>({name:n,value:m})),l.close(),p.value=!0},p=d(!1),M=d([]),x=d(!1),V=d({}),E=async()=>{const l=U.service({lock:!0,text:"数据正在备份中...",background:"rgba(255, 255, 255, 0.7)"}),t=await ne();V.value=t.data,l.close(),x.value=!0},F=l=>{if(l===0)return"0 B";const t=1024,n=["B","KB","MB","GB","TB"],m=Math.floor(Math.log(l)/Math.log(t));return parseFloat((l/Math.pow(t,m)).toFixed(2))+" "+n[m]},T=()=>{const l="//uploads/template/数据导入模板.xlsx",t="数据导入模板",n=document.createElement("a");n.href=l,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)},g=d(!1),O=d({Authorization:`Bearer ${N.getToken}`}),b=d({}),R=l=>{b.value=l.data,g.value=!0,k()},q=l=>{ee.error(`导入信息：${l.message}`)};return(l,t)=>{const n=f("el-option"),m=f("el-select"),y=f("el-icon"),r=f("el-button"),G=f("el-upload"),H=f("el-dropdown"),B=f("el-dialog");return v(),w(C,null,[e("div",de,[e("div",re,[e("div",ie,[e("div",ue,[t[8]||(t[8]=e("h1",{class:"text-2xl font-bold text-gray-800 mb-2"},"患者列表",-1)),e("p",ce,"共 "+u(_.value.length)+" 位患者",1)]),e("div",me,[e("div",fe,[e("div",pe,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"病种",-1)),s(m,{modelValue:c.value.illnessNameValue,"onUpdate:modelValue":t[0]||(t[0]=o=>c.value.illnessNameValue=o),placeholder:"选择病种",size:"default",clearable:"",style:{width:"100px"}},{default:a(()=>[(v(!0),w(C,null,z(D.value,(o,j)=>(v(),se(n,{key:j,label:o.name,value:o.tag_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",xe,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"性别",-1)),s(m,{modelValue:c.value.sexValue,"onUpdate:modelValue":t[1]||(t[1]=o=>c.value.sexValue=o),placeholder:"选择性别",size:"default",clearable:"",style:{width:"100px"}},{default:a(()=>[s(n,{label:"男",value:"0"}),s(n,{label:"女",value:"1"})]),_:1},8,["modelValue"])]),e("div",ge,[s(r,{type:"primary",size:"default",onClick:k},{default:a(()=>[s(y,{class:"mr-2"},{default:a(()=>[s(h(Y))]),_:1}),t[11]||(t[11]=i("筛选"))]),_:1,__:[11]}),s(r,{type:"success",size:"default",class:"flex items-center",onClick:A},{default:a(()=>[s(y,{class:"!mr-2"},{default:a(()=>[s(h(Z))]),_:1}),t[12]||(t[12]=i(" 数据同步 "))]),_:1,__:[12]}),s(H,{placement:"bottom-start"},{dropdown:a(()=>[e("div",ve,[s(r,{type:"success",size:"default",onClick:T,class:"flex items-center mb-2"},{default:a(()=>t[14]||(t[14]=[i("数据下载")])),_:1,__:[14]}),s(G,{class:"upload-demo",action:S,multiple:"",headers:O.value,"on-success":R,"on-error":q,"show-file-list":!1},{default:a(()=>[s(r,{type:"success",size:"default",class:"flex items-center"},{default:a(()=>t[15]||(t[15]=[i(" 数据导入 ")])),_:1,__:[15]})]),_:1},8,["headers"])])]),default:a(()=>[s(r,null,{default:a(()=>[s(y,{class:"!mr-2"},{default:a(()=>[s(h(L))]),_:1}),t[13]||(t[13]=i(" 数据导入 "))]),_:1,__:[13]})]),_:1}),s(r,{type:"success",size:"default",class:"flex items-center",onClick:E},{default:a(()=>[s(y,{class:"!mr-2"},{default:a(()=>[s(h(L))]),_:1}),t[16]||(t[16]=i(" 数据备份 "))]),_:1,__:[16]})])])])])]),e("div",_e,[e("div",be,[e("div",ye,[s(ae,{"table-data":_.value,onHandleDetails:P},null,8,["table-data"])])])])]),s(B,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=o=>p.value=o),width:"600","before-close":()=>p.value=!1,class:"rounded-lg"},{default:a(()=>[e("div",we,[t[19]||(t[19]=e("div",{class:"text-center mb-6"},[e("div",{class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])]),e("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"数据同步成功"),e("p",{class:"text-sm text-gray-500"},"所有数据已成功同步完成")],-1)),e("div",he,[(v(!0),w(C,null,z(M.value,(o,j)=>(v(),w("div",{key:j,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100"},[e("div",ke,[t[17]||(t[17]=e("div",{class:"w-2 h-2 bg-cyan-500 rounded-full mr-3"},null,-1)),e("span",Ve,u(o.name),1)]),e("span",Be,u(o.value),1)]))),128))]),e("div",je,[s(r,{type:"primary",onClick:t[2]||(t[2]=o=>p.value=!1),class:"px-8"},{default:a(()=>t[18]||(t[18]=[i(" 确定 ")])),_:1,__:[18]})])])]),_:1},8,["modelValue","before-close"]),s(B,{modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=o=>x.value=o),width:"600","before-close":()=>x.value=!1,class:"rounded-lg"},{default:a(()=>[e("div",Ce,[t[23]||(t[23]=e("div",{class:"text-center mb-6"},[e("div",{class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])]),e("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"数据备份成功"),e("p",{class:"text-sm text-gray-500"},"所有数据备份完成,请妥善保管备份文件")],-1)),e("div",De,[e("div",Me,[t[20]||(t[20]=e("div",{class:"flex items-center w-28"},[e("div",{class:"w-2 h-2 bg-cyan-500 rounded-full mr-3"}),e("span",{class:"text-sm font-medium text-gray-700"},"备份路径：")],-1)),e("div",ze,u(V.value.file_path),1)]),e("div",Le,[t[21]||(t[21]=e("div",{class:"flex items-center"},[e("div",{class:"w-2 h-2 bg-cyan-500 rounded-full mr-3"}),e("span",{class:"text-sm font-medium text-gray-700"},"文件大小：")],-1)),e("span",Ue,u(F(V.value.size_bytes)),1)])]),e("div",Ie,[s(r,{type:"primary",onClick:t[4]||(t[4]=o=>x.value=!1),class:"px-8"},{default:a(()=>t[22]||(t[22]=[i(" 确定 ")])),_:1,__:[22]})])])]),_:1},8,["modelValue","before-close"]),s(B,{modelValue:g.value,"onUpdate:modelValue":t[7]||(t[7]=o=>g.value=o),width:"600","before-close":()=>g.value=!1,class:"rounded-lg"},{default:a(()=>[e("div",Ne,[t[28]||(t[28]=e("div",{class:"text-center mb-6"},[e("div",{class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])]),e("h3",{class:"text-xl font-semibold text-gray-900 mb-2"},"数据导入成功"),e("p",{class:"text-sm text-gray-500"},"患者、逐行就诊、化验与分类均已写入")],-1)),e("div",Se,[e("div",$e,[t[24]||(t[24]=e("div",{class:"flex items-center"},[e("div",{class:"w-2 h-2 bg-cyan-500 rounded-full mr-3"}),e("span",{class:"text-sm font-medium text-gray-700"},"检验/影像/病理结果：")],-1)),e("div",Pe,u(b.value.inserted_lab_results),1)]),e("div",Ae,[t[25]||(t[25]=e("div",{class:"flex items-center"},[e("div",{class:"w-2 h-2 bg-cyan-500 rounded-full mr-3"}),e("span",{class:"text-sm font-medium text-gray-700"},"患者数量：")],-1)),e("span",Ee,u(b.value.inserted_patients),1)]),e("div",Fe,[t[26]||(t[26]=e("div",{class:"flex items-center"},[e("div",{class:"w-2 h-2 bg-cyan-500 rounded-full mr-3"}),e("span",{class:"text-sm font-medium text-gray-700"},"就诊记录：")],-1)),e("span",Te,u(b.value.inserted_visits),1)])]),e("div",Oe,[s(r,{type:"primary",onClick:t[6]||(t[6]=o=>g.value=!1),class:"px-8"},{default:a(()=>t[27]||(t[27]=[i(" 确定 ")])),_:1,__:[27]})])])]),_:1},8,["modelValue","before-close"])],64)}}}),Qe=le(Re,[["__scopeId","data-v-cfaa6cdf"]]);export{Qe as default};
