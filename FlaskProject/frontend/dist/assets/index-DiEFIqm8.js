import{$ as w,d as ie,o as ue,r as p,ay as ce,c as _,e as o,f as t,k as i,w as a,g as u,F as A,n as I,t as b,h as m,af as me,aQ as pe,i as _e,Y as q,p as R,q as fe,a2 as ve,m as ge,aa as ye,j as be,am as M,aR as Q,M as x,a7 as xe,S as we,O as d,P as Ve}from"./index-iZTeaJac.js";const V="/",he=async()=>await w(`${V}/api/doctor/role_list`),ke=async()=>await w(`${V}/api/common/department_list`),Ce=async()=>await w(`${V}/api/common/title_list`),Ue=async v=>await w(`${V}/api/doctor/user_role_list`,{...v}),Le=async v=>await w(`${V}/api/doctor/create_doctor`,{...v}),$e=async v=>await w(`${V}/api/doctor/role_assign`,{...v}),Ne=async v=>await w(`${V}/api/doctor/set_active`,{...v}),Ae={class:"bg-gray-50 p-4"},Ie={class:"max-w-7xl mx-auto"},Re={class:"flex gap-4"},Pe={class:"w-80 bg-white rounded-lg shadow-sm border"},Be={class:"p-4 border-b border-gray-200"},je={class:"font-semibold text-gray-800 flex items-center"},De={class:"p-2"},Se=["onClick"],Me={class:"flex items-center"},Te={class:"font-medium"},ze={class:"flex-1 bg-white rounded-lg shadow-sm border"},Ee={class:"p-4 border-b border-gray-200"},Fe={class:"flex items-center justify-between mb-4"},Oe={class:"font-semibold text-gray-800"},qe={class:"text-sm text-gray-500 font-normal ml-2"},Qe={class:"flex gap-3"},Ye={class:"p-4 h-[calc(100vh-250px)] overflow-auto"},Ge={class:"grid gap-3"},He={class:"flex items-center gap-4"},Je={class:"space-y-1"},Ke={class:"flex items-center gap-2"},We={class:"font-semibold text-gray-800"},Xe={class:"flex items-center gap-4 text-sm text-gray-600"},Ze={class:"flex gap-2"},et={key:0,class:"flex items-center"},tt={key:1,class:"flex items-center"},lt={class:"dialog-footer"},at=ie({__name:"index",setup(v){ue(()=>{Y(),G(),H(),U()});const T=p([]),Y=async()=>{const s=await he();T.value=s.data},z=p([]),G=async()=>{const s=await ke();z.value=s.data},E=p([]),H=async()=>{const s=await Ce();E.value=s.data},C=p([]),y=p([]),U=async()=>{const s=await Ue({role_id:L.value?L.value.toString():null});y.value=s.data,C.value=s.data;const e=c.value.dockerNameValue.trim(),r=c.value.phone.trim();e||r?O():y.value=C.value},c=p({dockerNameValue:"",phone:""}),F=p([{id:1,name:"管理员"},{id:3,name:"医生"},{id:2,name:"科研人员"},{id:0,name:"未分配成员"}]),L=p(1),$=p(!1),J=p(),n=ce({name:"",phone:"",gender:null,department:"",title:"",role:null}),K=s=>{L.value=s,U()},W=()=>F.value.find(e=>e.id===L.value)?.name||"未分配成员",X=()=>y.value.length||0,Z=()=>{const s=c.value.dockerNameValue.trim(),e=c.value.phone.trim();if(!s&&!e){y.value=C.value,x.info("请输入搜索条件");return}const r=O();r===0?x.warning("未找到匹配的用户"):x.success(`找到 ${r} 个匹配用户`)},ee=()=>{c.value.dockerNameValue="",c.value.phone="",y.value=C.value,x.info("搜索条件已重置")},O=()=>{const s=c.value.dockerNameValue.trim().toLowerCase(),e=c.value.phone.trim(),r=C.value.filter(f=>{const h=s?f.doctor_name?.toLowerCase().includes(s):!0,D=e?f.phone?.includes(e):!0;return h&&D});return y.value=r,r.length},j=async(s,e)=>{await $e({user_id:s.user_id,role_id:e}),x({type:"success",message:"权限更新成功"}),U()},te=async s=>{xe.confirm("确认修改该用户权限吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Ne({doctor_id:s.user_id,is_active:s.is_active==0?1:0}),x({type:"success",message:"状态已更新"}),U()})},le=()=>{$.value=!0,Object.assign(n,{name:"",phone:"",gender:null,department:"",title:"",role:null})},ae=async()=>{const s={key:"hiteamtech@@1233",mode:"ecb",cipherType:"hex"},e=new we.sm4(s);await Le({name:n.name,gender:n.gender==null?0:n.gender,birth_date:"1980-01-01",department_id:parseInt(n.department),title_id:parseInt(n.title),phone:n.phone,email:"",avatar_url:"",employee_no:"",id_card:"",password:btoa(e.encrypt("123456")),remarks:"",role_id:n.role+""}),x({type:"success",message:"添加成功"}),Object.assign(n,{name:"",phone:"",gender:null,department:"",title:"",role:null}),$.value=!1,U()};return(s,e)=>{const r=u("el-icon"),f=u("el-button"),h=u("el-input"),D=u("el-avatar"),oe=u("el-tag"),P=u("el-dropdown-item"),se=u("el-dropdown-menu"),ne=u("el-dropdown"),k=u("el-form-item"),N=u("el-option"),B=u("el-select"),re=u("el-form"),de=u("el-dialog");return d(),_("div",Ae,[o("div",Ie,[o("div",Re,[o("div",Pe,[o("div",Be,[o("h3",je,[t(r,{class:"mr-2 text-green-600"},{default:a(()=>[t(m(_e))]),_:1}),e[10]||(e[10]=i(" 权限分组 "))])]),o("ul",De,[(d(!0),_(A,null,I(F.value,l=>(d(),_("li",{key:l.id,onClick:g=>K(l.id),class:q(["flex items-center justify-between p-3 rounded-lg cursor-pointer transition-all duration-200 mb-1",L.value===l.id?"bg-blue-50 border border-blue-200 text-blue-700":"hover:bg-gray-50 text-gray-700"])},[o("div",Me,[t(r,{class:q([l.iconColor,"mr-3"])},{default:a(()=>[(d(),R(fe(l.icon)))]),_:2},1032,["class"]),o("span",Te,b(l.name),1)])],10,Se))),128))])]),o("div",ze,[o("div",Ee,[o("div",Fe,[o("h3",Oe,[i(b(W())+" ",1),o("span",qe," ("+b(X())+"人) ",1)]),t(f,{type:"primary",onClick:le},{default:a(()=>[t(r,{class:"mr-1"},{default:a(()=>[t(m(ve))]),_:1}),e[11]||(e[11]=i(" 添加成员 "))]),_:1,__:[11]})]),o("div",Qe,[t(h,{modelValue:c.value.dockerNameValue,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value.dockerNameValue=l),placeholder:"输入姓名搜索","prefix-icon":m(me),class:"flex-1",clearable:""},null,8,["modelValue","prefix-icon"]),t(h,{modelValue:c.value.phone,"onUpdate:modelValue":e[1]||(e[1]=l=>c.value.phone=l),placeholder:"输入手机号搜索","prefix-icon":m(pe),class:"flex-1",clearable:""},null,8,["modelValue","prefix-icon"]),t(f,{type:"primary",onClick:Z},{default:a(()=>e[12]||(e[12]=[i("搜索")])),_:1,__:[12]}),t(f,{onClick:ee},{default:a(()=>e[13]||(e[13]=[i("重置")])),_:1,__:[13]})])]),o("div",Ye,[o("div",Ge,[(d(!0),_(A,null,I(y.value,(l,g)=>(d(),_("div",{key:g,class:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:shadow-sm transition-shadow"},[o("div",He,[t(D,{size:50,src:"../../assets/page/userImg.png",class:"border-2 border-gray-100 object-cover"},{default:a(()=>[t(r,{class:"!text-xl"},{default:a(()=>[t(m(ge))]),_:1})]),_:1}),o("div",Je,[o("div",Ke,[o("span",We,b(l.doctor_name),1),l.is_active?ye("",!0):(d(),R(oe,{key:0,type:"danger",size:"small"},{default:a(()=>e[14]||(e[14]=[i("账号已禁用")])),_:1,__:[14]}))]),o("div",Xe,[o("span",null,"科室: "+b(l.department_name),1),o("span",null,"职称: "+b(l.title_name||"暂无"),1),o("span",null,"联系方式: "+b(l.phone||"暂无"),1)])])]),o("div",Ze,[t(ne,{trigger:"click"},{dropdown:a(()=>[t(se,null,{default:a(()=>[t(P,{onClick:S=>j(l,1)},{default:a(()=>[t(r,{class:"mr-2 text-red-500"},{default:a(()=>[t(m(M))]),_:1}),e[16]||(e[16]=i(" 转为管理员 "))]),_:2,__:[16]},1032,["onClick"]),t(P,{onClick:S=>j(l,3)},{default:a(()=>[t(r,{class:"mr-2 text-teal-500"},{default:a(()=>[t(m(M))]),_:1}),e[17]||(e[17]=i(" 转为医生 "))]),_:2,__:[17]},1032,["onClick"]),t(P,{onClick:S=>j(l,2)},{default:a(()=>[t(r,{class:"mr-2 text-green-500"},{default:a(()=>[t(m(M))]),_:1}),e[18]||(e[18]=i(" 转为科研人员 "))]),_:2,__:[18]},1032,["onClick"]),t(P,{divided:"",onClick:S=>te(l)},{default:a(()=>[l.is_active?(d(),_("div",et,[t(r,{class:"mr-2 text-red-500"},{default:a(()=>[t(m(Q))]),_:1}),e[19]||(e[19]=i(" 禁用用户 "))])):(d(),_("div",tt,[t(r,{class:"mr-2 text-red-500"},{default:a(()=>[t(m(Q))]),_:1}),e[20]||(e[20]=i(" 启用用户 "))]))]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[t(f,{type:"primary",size:"small"},{default:a(()=>[e[15]||(e[15]=i(" 权限操作 ")),t(r,{class:"ml-1"},{default:a(()=>[t(m(be))]),_:1})]),_:1,__:[15]})]),_:2},1024)])]))),128))])])])])]),t(de,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=l=>$.value=l),title:"添加新成员",width:"500px","close-on-click-modal":!1},{footer:a(()=>[o("div",lt,[t(f,{onClick:e[8]||(e[8]=l=>$.value=!1)},{default:a(()=>e[21]||(e[21]=[i("取消")])),_:1,__:[21]}),t(f,{type:"primary",onClick:ae},{default:a(()=>e[22]||(e[22]=[i("确认添加")])),_:1,__:[22]})])]),default:a(()=>[t(re,{model:n,"label-width":"80px",ref_key:"formRef",ref:J},{default:a(()=>[t(k,{label:"姓名",prop:"name"},{default:a(()=>[t(h,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=l=>n.name=l),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),t(k,{label:"电话",prop:"name"},{default:a(()=>[t(h,{modelValue:n.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>n.phone=l),placeholder:"请输入联系方式"},null,8,["modelValue"])]),_:1}),t(k,{label:"性别",prop:"department"},{default:a(()=>[t(B,{modelValue:n.gender,"onUpdate:modelValue":e[4]||(e[4]=l=>n.gender=l),placeholder:"请选择性别",class:"w-full"},{default:a(()=>[t(N,{label:"男",value:0}),t(N,{label:"女",value:1})]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"科室",prop:"department"},{default:a(()=>[t(B,{modelValue:n.department,"onUpdate:modelValue":e[5]||(e[5]=l=>n.department=l),placeholder:"请选择科室",class:"w-full"},{default:a(()=>[(d(!0),_(A,null,I(z.value,(l,g)=>(d(),R(N,{key:g,label:l.name,value:l.department_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"职称",prop:"title"},{default:a(()=>[t(B,{modelValue:n.title,"onUpdate:modelValue":e[6]||(e[6]=l=>n.title=l),placeholder:"请选择职称",class:"w-full"},{default:a(()=>[(d(!0),_(A,null,I(E.value,(l,g)=>(d(),R(N,{key:g,label:l.name,value:l.title_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"角色",prop:"role"},{default:a(()=>[t(B,{modelValue:n.role,"onUpdate:modelValue":e[7]||(e[7]=l=>n.role=l),placeholder:"请选择权限",class:"w-full"},{default:a(()=>[(d(!0),_(A,null,I(T.value,(l,g)=>(d(),R(N,{key:g,label:l.name,value:l.role_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),st=Ve(at,[["__scopeId","data-v-99b3691f"]]);export{st as default};
