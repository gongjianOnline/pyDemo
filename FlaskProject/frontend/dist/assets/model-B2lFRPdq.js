import{d as X,o as Z,r as d,Q as ee,R as le,c as N,e as a,f as l,w as s,g as i,h as g,ag as te,k as p,a2 as ae,t as y,x as T,ad as se,F as oe,n as ne,p as ie,af as de,a as ue,M as B,O as k,P as re}from"./index-iZTeaJac.js";import{U as ce}from"./userListComponents-F1YBBUwJ.js";import{t as me,a as pe,b as _e,c as fe,d as ve}from"./index-BSUptXTg.js";const be={class:"min-h-screen bg-gray-50 p-6"},ge={class:"max-w-7xl mx-auto"},ye={class:"mb-8"},xe={class:"flex items-center space-x-4 mb-4"},we={class:"bg-white rounded-xl shadow-sm border border-gray-200"},Ve={class:"p-6 border-b border-gray-200"},he={class:"flex justify-between items-center"},Ue={class:"p-6"},Ce={class:"font-medium text-gray-900"},ke={class:"text-gray-500"},qe={class:"flex"},De={class:"space-y-6"},Ae={class:"bg-gray-50 rounded-lg p-6"},Ie={class:"flex space-x-2"},Pe={class:"bg-gray-50 rounded-lg p-6"},ze={class:"bg-white rounded-lg p-4 mb-4 border border-gray-200"},Le={class:"flex flex-wrap items-center gap-4"},Se={class:"flex items-center space-x-2"},Ne={class:"flex items-center space-x-2"},Te={class:"flex items-center space-x-2"},Be={class:"flex items-center space-x-3 ml-auto"},Ee={class:"bg-white rounded-lg border border-gray-200 min-h-96 h-[400px] overflow-auto"},Me={class:"flex justify-end space-x-3 pt-6 border-t border-gray-200"},Ye=X({__name:"model",setup(je){const q=ue();Z(()=>{M(),I(),w()});const E=()=>{q.go(-1)},D=d([]),w=async()=>{const o=await me();D.value=o.data},u=d({nameValue:"",illnessNameValue:"",sexValue:""}),A=d([]),M=async()=>{const o=await ee();A.value=o.data},I=async()=>{try{const o=await le({patient_name:u.value.nameValue,tag_id:u.value.illnessNameValue,gender:u.value.sexValue});P.value=o.data}catch{}},P=d([]),c=d(!1),_=d(!1),n=d({name:"",frequencyValue:0,frequencyUnit:"",description:""}),Y=()=>{_.value=!1,c.value=!0},z=d([]),L=d({}),j=o=>{_.value=!0,c.value=!0,n.value.name=o.name,n.value.frequencyValue=o.cycle_count,n.value.frequencyUnit=o.cycle_unit.toString(),n.value.description=o.description,z.value=o.patient_id.split(",").map(e=>parseInt(e)),L.value=o},f=d([]),H=o=>{f.value=o},R=o=>{q.push({name:"dataCollection_details"})},$=async()=>{_.value?(await pe({name:n.value.name,cycle_unit:parseInt(n.value.frequencyUnit),cycle_count:n.value.frequencyValue,description:n.value.description,patient_ids:f.value.map(o=>o.patient_id.toString()),visit_ids:f.value.map(o=>o.visit_id.toString()),template_id:L.value.template_id,need_followup:1,is_active:1}),B({type:"success",message:"创建成功"})):(await _e({name:n.value.name,cycle_unit:parseInt(n.value.frequencyUnit),cycle_count:n.value.frequencyValue,description:n.value.description,patient_ids:f.value.map(o=>o.patient_id.toString()),visit_ids:f.value.map(o=>o.visit_id.toString()),start_date:T().format("")}),B({type:"success",message:"创建成功"}),n.value.name="",n.value.frequencyValue=0,n.value.frequencyUnit="",n.value.description=""),w(),c.value=!1},F=async o=>{o.need_followup?await fe({template_id:o.template_id}):await ve({template_id:o.template_id}),w()};return(o,e)=>{const x=i("el-icon"),m=i("el-button"),v=i("el-table-column"),O=i("el-tag"),Q=i("el-switch"),W=i("el-table"),V=i("el-input"),h=i("el-form-item"),U=i("el-col"),G=i("el-input-number"),r=i("el-option"),C=i("el-select"),S=i("el-row"),J=i("el-form"),K=i("el-dialog");return k(),N("div",be,[a("div",ge,[a("div",ye,[a("div",xe,[l(m,{onClick:E,class:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 bg-white hover:bg-gray-50 border border-gray-200 hover:border-gray-300 transition-all duration-200 px-4 py-2 rounded-lg shadow-sm"},{default:s(()=>[l(x,null,{default:s(()=>[l(g(te))]),_:1}),e[9]||(e[9]=a("span",{class:"font-medium"},"返回",-1))]),_:1,__:[9]})]),e[10]||(e[10]=a("h1",{class:"text-3xl font-bold text-gray-900"},"随访模板管理",-1)),e[11]||(e[11]=a("p",{class:"text-gray-600 mt-2"},"创建和管理患者随访模板",-1))]),a("div",we,[a("div",Ve,[a("div",he,[e[13]||(e[13]=a("h2",{class:"text-xl font-semibold text-gray-900"},"模板列表",-1)),l(m,{type:"primary",onClick:Y,class:"bg-blue-600 hover:bg-blue-700 border-blue-600 shadow-sm px-6"},{default:s(()=>[l(x,{class:"mr-2"},{default:s(()=>[l(g(ae))]),_:1}),e[12]||(e[12]=p(" 新增模板 "))]),_:1,__:[12]})])]),a("div",Ue,[l(W,{data:D.value,class:"w-full","header-cell-style":{backgroundColor:"#f8fafc",color:"#374151",fontWeight:"600",borderColor:"#e5e7eb"},"cell-style":{borderColor:"#f1f5f9"},stripe:""},{default:s(()=>[l(v,{prop:"name",label:"模板名称","min-width":"200"},{default:s(({row:t})=>[a("div",Ce,y(t.name),1)]),_:1}),l(v,{prop:"type",label:"随访频率","min-width":"120"},{default:s(({row:t})=>[l(O,{type:"info",size:"small",class:"bg-blue-50 text-blue-700 border-blue-200"},{default:s(()=>[p(y(t.cycle_count)+"次 / "+y(t.cycle_unit)+"天 ",1)]),_:2},1024)]),_:1}),l(v,{prop:"createdAt",label:"创建时间","min-width":"150"},{default:s(({row:t})=>[a("div",ke,y(g(T)(t.updated_at).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),l(v,{prop:"createdAt",label:"状态","min-width":"150"},{default:s(({row:t})=>[l(Q,{modelValue:t.need_followup,"onUpdate:modelValue":b=>t.need_followup=b,size:"large","active-text":"启用","inactive-text":"禁用","active-value":1,"inactive-value":0,onChange:b=>F(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(v,{label:"操作",width:"120",fixed:"right"},{default:s(({row:t})=>[a("div",qe,[l(m,{size:"small",type:"primary",link:"",onClick:b=>j(t),class:"text-blue-600 hover:text-blue-800 font-medium"},{default:s(()=>[l(x,{class:"mr-1"},{default:s(()=>[l(g(se))]),_:1}),e[14]||(e[14]=p(" 编辑 "))]),_:2,__:[14]},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])]),l(K,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=t=>c.value=t),title:_.value?"编辑模板":"新增模板",width:"90%","close-on-click-modal":!1,class:"rounded-lg"},{footer:s(()=>[a("div",Me,[l(m,{size:"default",onClick:e[7]||(e[7]=t=>c.value=!1),class:"px-6"},{default:s(()=>e[21]||(e[21]=[p(" 取消 ")])),_:1,__:[21]}),l(m,{type:"primary",size:"default",onClick:$,class:"bg-blue-600 hover:bg-blue-700 px-6"},{default:s(()=>[p(y(_.value?"保存修改":"创建模板"),1)]),_:1})])]),default:s(()=>[a("div",De,[a("div",Ae,[e[15]||(e[15]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"基本信息",-1)),l(J,{model:n.value,"label-width":"120px",class:"space-y-4"},{default:s(()=>[l(S,{gutter:24},{default:s(()=>[l(U,{span:12},{default:s(()=>[l(h,{label:"模板名称"},{default:s(()=>[l(V,{modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.name=t),placeholder:"请输入模板名称",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1}),l(U,{span:12},{default:s(()=>[l(h,{label:"随访频率"},{default:s(()=>[a("div",Ie,[l(G,{modelValue:n.value.frequencyValue,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.frequencyValue=t),min:1,max:365,style:{width:"150px"},"controls-position":"right"},null,8,["modelValue"]),l(C,{modelValue:n.value.frequencyUnit,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.frequencyUnit=t),class:"w-24"},{default:s(()=>[l(r,{label:"天",value:"1"}),l(r,{label:"周",value:"7"}),l(r,{label:"月",value:"30"}),l(r,{label:"年",value:"365"})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1}),l(S,null,{default:s(()=>[l(U,{span:24},{default:s(()=>[l(h,{label:"方案描述"},{default:s(()=>[l(V,{modelValue:n.value.description,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.description=t),type:"textarea",rows:3,placeholder:"请输入随访方案描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),a("div",Pe,[e[20]||(e[20]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"选择患者",-1)),a("div",ze,[a("div",Le,[a("div",Se,[e[16]||(e[16]=a("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap min-w-12"},"姓名",-1)),l(V,{modelValue:u.value.nameValue,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.nameValue=t),placeholder:"请输入姓名",size:"default",clearable:"",class:"w-40"},null,8,["modelValue"])]),a("div",Ne,[e[17]||(e[17]=a("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap min-w-12"},"病种",-1)),l(C,{modelValue:u.value.illnessNameValue,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.illnessNameValue=t),placeholder:"选择病种",size:"default",clearable:"",style:{width:"150px"}},{default:s(()=>[(k(!0),N(oe,null,ne(A.value,(t,b)=>(k(),ie(r,{key:b,label:t.name,value:t.tag_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),a("div",Te,[e[18]||(e[18]=a("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap min-w-12"},"性别",-1)),l(C,{modelValue:u.value.sexValue,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.sexValue=t),placeholder:"选择性别",size:"default",clearable:"",style:{width:"150px"}},{default:s(()=>[l(r,{label:"男",value:"0"}),l(r,{label:"女",value:"1"})]),_:1},8,["modelValue"])]),a("div",Be,[l(m,{type:"primary",size:"default",onClick:I,class:"bg-blue-600 hover:bg-blue-700"},{default:s(()=>[l(x,{class:"mr-1"},{default:s(()=>[l(g(de))]),_:1}),e[19]||(e[19]=p(" 筛选 "))]),_:1,__:[19]})])])]),a("div",Ee,[l(ce,{"table-data":P.value,type:"selection",onHandleDetails:R,onSelectionChange:H,selectArr:z.value},null,8,["table-data","selectArr"])])])])]),_:1},8,["modelValue","title"])])])}}}),Fe=re(Ye,[["__scopeId","data-v-dc37eeb4"]]);export{Fe as default};
