import{d as D,u as M,r as u,o as N,c as d,e as t,f as s,g as c,w as m,F as v,n as y,p as E,Y as P,t as _,k as B,h as F,I as O,U as $,O as n,M as j,W,P as Y}from"./index-iZTeaJac.js";import{d as q,f as G}from"./index-2Fl6aFRQ.js";import{a as H}from"./index-C-7UpYWQ.js";import{_ as J}from"./NoticeModal.vue_vue_type_script_setup_true_lang-CrlJJ41n.js";const K={class:"bg-gradient-to-br bg-gray-50 p-6"},Q={class:"max-w-7xl mx-auto"},R={class:"flex gap-6 h-full"},X={class:"w-1/3 bg-white rounded-2xl shadow-xl p-6 space-y-6 h-[calc(100vh-180px)] overflow-auto"},Z={class:"space-y-2"},ee={class:"space-y-2"},te={class:"space-y-3"},le={class:"overflow-y-auto space-y-3"},oe=["onClick"],ae={class:"border border-gray-200 rounded-xl p-4 hover:border-blue-300 hover:bg-blue-50"},se={class:"flex items-center justify-between mb-2"},re={class:"font-semibold text-gray-800"},ne={class:"text-sm text-gray-600 leading-relaxed"},de={key:0,class:"flex-1 bg-white rounded-2xl shadow-xl p-6 h-[calc(100vh-180px)] overflow-auto"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},ue={class:"bg-gray-50 rounded-lg p-3"},ce={class:"flex"},me={class:"block text-sm font-semibold text-gray-700"},pe={class:"bg-gray-50 rounded-lg p-3"},ve={class:"text-gray-600 text-sm mt-2"},_e={class:"flex gap-4"},ge={key:1,class:"flex-1 bg-white rounded-2xl shadow-xl p-6"},be=D({__name:"moduleTrain",setup(fe){const z=M(),g=u(!1);N(()=>{L(),T()});const a=u({moduleValue:"",dataSetValue:"",algorithmValue:"",moduleType:"4",selectedAlgorithm:null,selectedAlgorithmName:""}),o=u({proportionA:"",proportionB:"",proportionC:""}),h=u([]),L=async()=>{const r=await q({dataset_type:"1",is_active:""});h.value=r.data.list},b=u(),T=async()=>{b.value=[];const r=await G({model_id:a.value.moduleType,is_active:"1"});b.value=r.data.list},U=r=>{a.value.selectedAlgorithm=r.algorithm_id,a.value.selectedAlgorithmName=r.name,V.value.forEach(e=>{o.value[e.key]=0})},V=u([{name:"训练轮次",key:"epochs",description:""},{name:"批次大小",key:"batch_size",description:"批量大小 默认16"},{name:"学习率",key:"lr",description:"学习率 默认1e-4"}]),I=async()=>{const r=parseFloat(o.value.proportionA)||0,e=parseFloat(o.value.proportionB)||0,i=parseFloat(o.value.proportionC)||0,f=Math.round((r+e+i)*100)/100;if(Math.abs(f-1)>.01){j({message:"比例之和必须为1",type:"error"});return}const p=W.service({lock:!0,text:"正在创建方案，请稍候...",background:"rgba(255, 255, 255, 0.7)"});try{await H({doctor_id:z.getDoctorId,dataset_id:a.value.dataSetValue,model_id:a.value.moduleType,algorithm_id:a.value.selectedAlgorithm.toString(),task_name:a.value.moduleValue,train_ratio:o.value.proportionA,val_ratio:o.value.proportionB,test_ratio:o.value.proportionC,epochs:o.value.epochs,batch_size:o.value.batch_size,lr:o.value.lr,model_name:a.value.selectedAlgorithmName}),p.close(),g.value=!0,k()}catch{p.close()}},k=()=>{for(let r in o.value)o.value[r]=""};return(r,e)=>{const i=c("el-input"),f=c("el-option"),p=c("el-select"),w=c("el-input-number"),A=c("el-icon"),C=c("el-button");return n(),d(v,null,[t("div",K,[t("div",Q,[t("div",R,[t("div",X,[t("div",Z,[e[6]||(e[6]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," 模型名称 ",-1)),s(i,{modelValue:a.value.moduleValue,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.moduleValue=l),placeholder:"请输入模型名称",class:"w-full",size:"large",clearable:""},null,8,["modelValue"])]),t("div",ee,[e[7]||(e[7]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," 选择数据集 ",-1)),s(p,{modelValue:a.value.dataSetValue,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.dataSetValue=l),placeholder:"请选择数据集",class:"w-full",size:"large",clearable:""},{default:m(()=>[(n(!0),d(v,null,y(h.value,l=>(n(),E(f,{key:l.dataset_id,label:l.name,value:l.dataset_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",te,[e[8]||(e[8]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},"选择算法",-1)),t("div",le,[(n(!0),d(v,null,y(b.value,(l,x)=>(n(),d("div",{key:x,class:P(["group cursor-pointer transition-all duration-300 hover:shadow-md",a.value.selectedAlgorithm==l.algorithm_id?"border rounded-xl bg-blue-50 border-blue-300":""]),onClick:S=>U(l)},[t("div",ae,[t("div",se,[t("h4",re,_(l.name),1)]),t("p",ne,_(l.description),1)])],10,oe))),128))])])]),a.value.moduleType==="4"?(n(),d("div",de,[e[13]||(e[13]=t("div",{class:"mb-6"},[t("h2",{class:"text-xl font-bold text-gray-800 mb-2"},"算法参数配置"),t("p",{class:"text-gray-600"},"调整模型训练参数以获得最佳性能")],-1)),t("div",ie,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-gray-700"},"选择比例",-1)),t("div",ue,[t("div",ce,[s(i,{modelValue:o.value.proportionA,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.proportionA=l),placeholder:"0.7",class:"mr-1"},null,8,["modelValue"]),s(i,{modelValue:o.value.proportionB,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.proportionB=l),placeholder:"0.2",class:"mr-1"},null,8,["modelValue"]),s(i,{modelValue:o.value.proportionC,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.proportionC=l),placeholder:"0.1"},null,8,["modelValue"])]),e[9]||(e[9]=t("div",{class:"text-gray-600 text-sm mt-2"},"用于数据集的比例训练0.6:0.2:0.2(训练:推理:验证)比例，总数为一",-1))])]),(n(!0),d(v,null,y(V.value,(l,x)=>(n(),d("div",{key:x,class:"space-y-2"},[t("label",me,_(l.name),1),t("div",pe,[s(w,{modelValue:o.value[l.key],"onUpdate:modelValue":S=>o.value[l.key]=S,"controls-position":"right",class:"w-full",size:"large"},null,8,["modelValue","onUpdate:modelValue"]),t("div",ve,_(l.description),1)])]))),128))]),t("div",_e,[s(C,{type:"primary",size:"large",onClick:I,class:"flex-1 h-12 text-base font-semibold"},{default:m(()=>[s(A,{class:"mr-2"},{default:m(()=>[s(F(O))]),_:1}),e[11]||(e[11]=B(" 开始训练 "))]),_:1,__:[11]}),s(C,{type:"default",size:"large",onClick:k,class:"h-12 text-base font-semibold"},{default:m(()=>[s(A,{class:"mr-2"},{default:m(()=>[s(F($))]),_:1}),e[12]||(e[12]=B(" 重置 "))]),_:1,__:[12]})])])):(n(),d("div",ge,e[14]||(e[14]=[t("div",{class:"mb-6"},[t("h2",{class:"text-xl font-bold text-gray-800 mb-2"},"图像分割算法参数配置"),t("p",{class:"text-gray-600"},"调整模型训练参数以获得最佳性能")],-1)])))])])]),s(J,{noticeDialog:g.value,onOnClose:e[5]||(e[5]=l=>g.value=l)},null,8,["noticeDialog"])],64)}}}),ke=Y(be,[["__scopeId","data-v-2d6415f6"]]);export{ke as default};
