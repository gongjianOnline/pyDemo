import{d as O,u as $,r as u,o as Y,c,e as t,f as n,g as p,w as b,F as f,n as k,a8 as L,a9 as U,p as q,Y as G,t as _,k as D,O as m,M as H,P as J}from"./index-iZTeaJac.js";import{d as K,f as Q,g as R,m as W}from"./index-2Fl6aFRQ.js";import{_ as X}from"./NoticeModal.vue_vue_type_script_setup_true_lang-CrlJJ41n.js";const Z={class:"min-h-screen bg-gradient-to-br bg-gray-50"},ee={class:"max-w-7xl mx-auto"},te={class:"flex gap-6 h-full"},le={class:"w-1/3 bg-white rounded-2xl shadow-xl p-6 space-y-6"},oe={class:"space-y-2"},ae={class:"space-y-2"},se={class:"space-y-3"},re={class:"space-y-3"},ne={class:"overflow-y-auto space-y-3"},de=["onClick"],ie={class:"border border-gray-200 rounded-xl p-4 hover:border-blue-300 hover:bg-blue-50"},ue={class:"flex items-center justify-between mb-2"},me={class:"font-semibold text-gray-800"},ce={class:"text-sm text-gray-600 leading-relaxed"},pe={class:"flex-1 bg-white rounded-2xl shadow-xl p-6"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},_e={class:"bg-gray-50 rounded-lg p-3"},ge={class:"flex"},be={class:"text-sm flex items-center"},fe={class:"font-semibold text-gray-700"},xe={class:"ml-2 text-xs"},ye={class:"bg-gray-50 rounded-lg p-3"},he={class:"text-gray-600 text-sm mt-2"},Ve={class:"flex gap-4"},we=O({__name:"moduleTrain",setup(ke){const P=$(),x=u(!1);Y(()=>{z(),C()});const s=u({moduleValue:"",dataSetValue:"",algorithmValue:"",moduleType:"1",selectedAlgorithm:null}),A=u(),z=async()=>{const o=await K({dataset_type:"2",is_active:"1"});A.value=o.data.list},v=u([]),C=async()=>{const o=await Q({model_id:s.value.moduleType,is_active:"1"});v.value=o.data.list,s.value.selectedAlgorithm=o.data.list[0]?.algorithm_id||"",F()},M=o=>{s.value.selectedAlgorithm=o.algorithm_id,F()},S=u([]),a=u({}),y=u({}),B=u([]),F=async()=>{const o=await R({algorithm_id:s.value.selectedAlgorithm?.toString()});a.value={},y.value={},S.value=o.data.list,a.value.proportionA="",a.value.proportionB="",a.value.proportionC="",o.data.list.forEach(e=>{a.value[e.param_name]=e.default_value,y.value[e.param_name]=e.param_type}),B.value=o.data.list.map(e=>e.param_id.toString())},N=async()=>{const{proportionA:o,proportionB:e,proportionC:r,...d}=a.value,i=parseFloat(a.value.proportionA)||0,h=parseFloat(a.value.proportionB)||0,V=parseFloat(a.value.proportionC)||0,g=Math.round((i+h+V)*100)/100;if(Math.abs(g-1)>.01){H({message:"比例之和必须为1",type:"error"});return}await W({doctor_id:parseInt(P.getDoctorId),dataset_id:parseInt(s.value.dataSetValue),algorithm_id:s.value.selectedAlgorithm,model_id:1,param_ids:B.value.join(","),param_values:{...E(y.value,d)},train_ratio:o,val_ratio:e,test_ratio:r,task_name:s.value.moduleValue,model_name:j(s.value.selectedAlgorithm)}),x.value=!0,I()},I=()=>{for(let o in a.value)a.value[o]=""},E=(o,e)=>{const r={};for(const d in o){const i=e[d];if(i!=null)switch(o[d]){case"int":r[d]=parseInt(i,10);break;case"float":r[d]=parseFloat(i);break;case"enum":r[d]=String(i);break;default:r[d]=i}}return r},j=o=>{const e=v.value.find(r=>r.algorithm_id===o);return e?e.name:null};return(o,e)=>{const r=p("el-input"),d=p("el-option"),i=p("el-select"),h=p("el-radio-button"),V=p("el-radio-group"),g=p("el-button");return m(),c(f,null,[t("div",Z,[t("div",ee,[t("div",te,[t("div",le,[t("div",oe,[e[7]||(e[7]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," 模型名称 ",-1)),n(r,{modelValue:s.value.moduleValue,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.moduleValue=l),placeholder:"请输入模型名称",class:"w-full",size:"large",clearable:""},null,8,["modelValue"])]),t("div",ae,[e[8]||(e[8]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," 选择数据集 ",-1)),n(i,{modelValue:s.value.dataSetValue,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.dataSetValue=l),placeholder:"请选择数据集",class:"w-full",size:"large",clearable:""},{default:b(()=>[(m(!0),c(f,null,k(A.value,l=>(m(),q(d,{key:l.dataset_id,label:l.name,value:l.dataset_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",se,[e[9]||(e[9]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},"算法类型",-1)),t("div",null,[n(V,{modelValue:s.value.moduleType,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.moduleType=l),size:"large",onChange:C},{default:b(()=>[n(h,{label:"病例模型",value:"1"})]),_:1},8,["modelValue"])])]),t("div",re,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},"选择算法",-1)),t("div",ne,[(m(!0),c(f,null,k(v.value,(l,w)=>(m(),c("div",{key:w,class:G(["group cursor-pointer transition-all rounded-xl duration-300 hover:shadow-md",s.value.selectedAlgorithm===l.algorithm_id?" ring-2 ring-blue-500 border-blue-300 bg-blue-50":""]),onClick:T=>M(l)},[t("div",ie,[t("div",ue,[t("h4",me,_(l.name),1)]),t("p",ce,_(l.description),1)])],10,de))),128))])])]),t("div",pe,[e[15]||(e[15]=t("div",{class:"mb-6"},[t("h2",{class:"text-xl font-bold text-gray-800 mb-2"},"算法参数配置"),t("p",{class:"text-gray-600"},"调整模型训练参数以获得最佳性能")],-1)),L(t("div",ve,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-semibold text-gray-700"},"选择比例",-1)),t("div",_e,[t("div",ge,[n(r,{modelValue:a.value.proportionA,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.proportionA=l),placeholder:"0.7",class:"mr-1"},null,8,["modelValue"]),n(r,{modelValue:a.value.proportionB,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.proportionB=l),placeholder:"0.2",class:"mr-1"},null,8,["modelValue"]),n(r,{modelValue:a.value.proportionC,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.proportionC=l),placeholder:"0.1"},null,8,["modelValue"])]),e[11]||(e[11]=t("div",{class:"text-gray-600 text-sm mt-2"},"用于数据集的比例训练0.6:0.2:0.2(训练:验证:测试)集比例，总数为一",-1))])]),(m(!0),c(f,null,k(S.value,(l,w)=>(m(),c("div",{key:w,class:"space-y-2"},[t("label",be,[t("div",fe,_(l.param_name),1),t("div",xe,"范围："+_(l.allowed_values),1)]),t("div",ye,[n(r,{modelValue:a.value[l.param_name],"onUpdate:modelValue":T=>a.value[l.param_name]=T,placeholder:l.allowed_values,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t("div",he,_(l.description),1)])]))),128))],512),[[U,v.value.length]]),L(t("div",Ve,[n(g,{type:"primary",size:"large",onClick:N,class:"flex-1 h-12 text-base font-semibold"},{default:b(()=>e[13]||(e[13]=[D(" 开始训练 ")])),_:1,__:[13]}),n(g,{type:"default",size:"large",onClick:I,class:"h-12 text-base font-semibold"},{default:b(()=>e[14]||(e[14]=[D(" 重置 ")])),_:1,__:[14]})],512),[[U,v.value.length]])])])])]),n(X,{noticeDialog:x.value,onOnClose:e[6]||(e[6]=l=>x.value=l)},null,8,["noticeDialog"])],64)}}}),Be=J(we,[["__scopeId","data-v-1ec82136"]]);export{Be as default};
