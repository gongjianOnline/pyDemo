import{d as $,u as R,o as q,r as _,Q as H,R as O,c as g,e,f as l,t as i,g as u,w as a,F as h,n as D,p as N,k as f,h as w,aB as Q,x as W,ah as G,aC as J,W as K,M as X,a as Z,O as p,P as ee}from"./index-iZTeaJac.js";import{U as te}from"./userListComponents-F1YBBUwJ.js";import{t as se}from"./index-2Fl6aFRQ.js";import{a as le}from"./index-FnU4Z0QY.js";const ae={class:"w-full h-full bg-gradient-to-br from-slate-50 to-blue-50"},oe={class:"bg-white shadow-lg border-b border-gray-200 p-6"},ne={class:"max-w-7xl mx-auto"},de={class:"mb-4"},ie={class:"text-gray-600"},re={class:"bg-gray-50 rounded-xl p-4"},ue={class:"flex flex-wrap items-center gap-4"},ce={class:"flex items-center space-x-2"},me={class:"flex items-center space-x-2"},_e={class:"flex items-center space-x-2"},pe={class:"flex items-center space-x-3 ml-auto"},fe={class:"h-[calc(100vh-20rem)] overflow-auto"},xe={class:"mx-auto"},ve={class:"bg-white rounded-2xl shadow-xl"},ge={class:"my-2 w-full"},be={class:"h-full flex flex-col p-6"},ye={class:"mb-6"},he={class:"mb-8"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ve={class:"space-y-2"},ke={class:"flex justify-between items-center w-full"},De={class:"font-medium text-gray-900"},Le={class:"text-gray-500 text-xs"},ze={class:"space-y-2"},Ce={class:"flex-1 mb-6"},Ie={class:"flex justify-between items-center mb-4"},Ne={class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4"},Ue={class:"flex items-center mb-4"},je={class:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-semibold text-lg mr-3"},Ae={class:"flex-1"},Me={class:"text-base font-semibold text-gray-900 mb-1"},Pe={class:"text-xs text-gray-500"},Se={class:"mb-4"},Be={class:"grid grid-cols-2 gap-3"},Ee={class:"flex flex-col"},Fe={class:"text-sm font-medium text-gray-900"},Te={class:"flex flex-col"},Ye={class:"text-sm font-medium text-gray-900"},$e={class:"flex flex-col col-span-2"},Re={class:"text-sm font-medium text-gray-900 truncate"},qe={class:"pt-4 border-t border-gray-100"},He={class:"flex justify-end gap-3 pt-6 border-t border-gray-200"},Oe=$({__name:"newAdd",setup(Qe){const L=Z(),U=R();q(()=>{A(),I(),j()});const r=_({nameValue:"",illnessNameValue:"",sexValue:""}),z=_([]),j=async()=>{const o=await se({model_id:"5"});z.value=o.data},C=_([]),A=async()=>{const o=await H();C.value=o.data},V=_([]),I=async()=>{const o=await O({patient_name:r.value.nameValue,tag_id:r.value.illnessNameValue,gender:r.value.sexValue});V.value=o.data},M=o=>{L.push({name:"dataCollection_details",query:{patient_id:o.patient_id}})},x=_([]),P=o=>{x.value=o},b=_(!1),S=()=>{x.value.forEach(o=>{c.value[`files${o.patient_id}`]=[]}),b.value=!0},c=_({moduleID:"",taskName:""}),B=async()=>{const o=K.service({lock:!0,text:"正在创建方案，请稍候...",background:"rgba(255, 255, 255, 0.7)"}),{moduleID:t,taskName:y,...m}=c.value,n=new FormData;n.append("inference_name",y),n.append("doctor_id",U.getDoctorId),n.append("task_id",t),n.append("patient_id",x.value.map(d=>d.patient_id).join(","));for(let d in m)m[d].forEach(v=>{n.append(`${d}[]`,v.raw)});await le(n),X({type:"success",message:"创建成功"}),o.close(),setTimeout(()=>{L.back()},3e3)};return(o,t)=>{const y=u("el-input"),m=u("el-option"),n=u("el-select"),d=u("el-button"),v=u("el-icon"),E=u("el-divider"),F=u("el-tag"),T=u("el-upload"),Y=u("el-drawer");return p(),g(h,null,[e("div",ae,[e("div",oe,[e("div",ne,[e("div",de,[t[7]||(t[7]=e("h1",{class:"text-2xl font-bold text-gray-800 mb-2"},"创建病理组学推理任务",-1)),e("p",ie,"共 "+i(V.value.length)+" 位患者",1)]),e("div",re,[e("div",ue,[e("div",ce,[t[8]||(t[8]=e("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"姓名",-1)),l(y,{modelValue:r.value.nameValue,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value.nameValue=s),placeholder:"请输入姓名",size:"default",clearable:""},null,8,["modelValue"])]),e("div",me,[t[9]||(t[9]=e("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"病种",-1)),l(n,{modelValue:r.value.illnessNameValue,"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.illnessNameValue=s),placeholder:"选择病种",size:"default",clearable:"",style:{width:"100px"}},{default:a(()=>[(p(!0),g(h,null,D(C.value,(s,k)=>(p(),N(m,{key:k,label:s.name,value:s.tag_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",_e,[t[10]||(t[10]=e("label",{class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"性别",-1)),l(n,{modelValue:r.value.sexValue,"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.sexValue=s),placeholder:"选择性别",size:"default",clearable:"",style:{width:"100px"}},{default:a(()=>[l(m,{label:"男",value:"0"}),l(m,{label:"女",value:"1"})]),_:1},8,["modelValue"])]),e("div",pe,[l(d,{type:"primary",size:"default",onClick:I},{default:a(()=>t[11]||(t[11]=[f("筛选")])),_:1,__:[11]})])])])])]),e("div",fe,[e("div",xe,[e("div",ve,[l(te,{type:"selection","table-data":V.value,onHandleDetails:M,onSelectionChange:P},null,8,["table-data"])])])]),e("div",ge,[l(d,{type:"success",size:"default",class:"flex items-center w-full",onClick:S},{default:a(()=>[l(v,{class:"mr-2"},{default:a(()=>[l(w(Q))]),_:1}),t[12]||(t[12]=f(" 配置推理任务参数 "))]),_:1,__:[12]})])]),l(Y,{size:"80%",modelValue:b.value,"onUpdate:modelValue":t[6]||(t[6]=s=>b.value=s),"with-header":!1},{default:a(()=>[e("div",be,[e("div",ye,[t[13]||(t[13]=e("h3",{class:"text-xl font-semibold text-gray-900 mb-4"},"配置模型及病理资料",-1)),l(E,{class:"!my-0"})]),e("div",he,[e("div",we,[e("div",Ve,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"模型列表",-1)),l(n,{modelValue:c.value.moduleID,"onUpdate:modelValue":t[3]||(t[3]=s=>c.value.moduleID=s),placeholder:"请选择模型",class:"w-full",size:"large"},{default:a(()=>[(p(!0),g(h,null,D(z.value,s=>(p(),N(m,{key:s.task_id,label:s.task_name,value:s.task_id},{default:a(()=>[e("div",ke,[e("span",De,i(s.task_name),1),e("span",Le,i(s.remarks),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",ze,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700"},"任务名称",-1)),l(y,{modelValue:c.value.taskName,"onUpdate:modelValue":t[4]||(t[4]=s=>c.value.taskName=s),placeholder:"请输入任务名称",class:"w-full",size:"large"},null,8,["modelValue"])])])]),e("div",Ce,[e("div",Ie,[t[16]||(t[16]=e("h4",{class:"text-base font-semibold text-gray-900"},"患者信息",-1)),l(F,{type:"info",size:"small"},{default:a(()=>[f("共 "+i(x.value.length)+" 位患者",1)]),_:1})]),e("div",Ne,[(p(!0),g(h,null,D(x.value,s=>(p(),g("div",{key:s.patient_id,class:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-1"},[e("div",Ue,[e("div",je,i(s.name.charAt(0)),1),e("div",Ae,[e("h5",Me,i(s.name),1),e("span",Pe,"ID: "+i(s.patient_id),1)])]),e("div",Se,[e("div",Be,[e("div",Ee,[t[17]||(t[17]=e("span",{class:"text-xs text-gray-500 mb-1"},"性别",-1)),e("span",Fe,i(s.gender_text),1)]),e("div",Te,[t[18]||(t[18]=e("span",{class:"text-xs text-gray-500 mb-1"},"出生日期",-1)),e("span",Ye,i(w(W)(s.birth_date).format("YYYY-MM-DD")),1)]),e("div",$e,[t[19]||(t[19]=e("span",{class:"text-xs text-gray-500 mb-1"},"证件号",-1)),e("span",Re,i(s.id_card),1)])])]),e("div",qe,[l(T,{"file-list":c.value["files"+s.patient_id],"onUpdate:fileList":k=>c.value["files"+s.patient_id]=k,"auto-upload":!1,class:"w-full","show-file-list":!0,limit:5,multiple:""},{trigger:a(()=>[l(d,{type:"primary",size:"small",class:"w-full flex items-center justify-center"},{default:a(()=>[l(v,{class:"mr-1"},{default:a(()=>[l(w(G))]),_:1}),t[20]||(t[20]=f(" 上传影像资料 "))]),_:1,__:[20]})]),_:2},1032,["file-list","onUpdate:fileList"])])]))),128))])]),e("div",He,[l(d,{size:"large",onClick:t[5]||(t[5]=s=>b.value=!1)},{default:a(()=>t[21]||(t[21]=[f("取消")])),_:1,__:[21]}),l(d,{type:"primary",size:"large",onClick:B,class:"flex items-center px-6"},{default:a(()=>[l(v,{class:"mr-1"},{default:a(()=>[l(w(J))]),_:1}),t[22]||(t[22]=f(" 创建推理任务 "))]),_:1,__:[22]})])])]),_:1},8,["modelValue"])],64)}}}),Xe=ee(Oe,[["__scopeId","data-v-7bdc9505"]]);export{Xe as default};
