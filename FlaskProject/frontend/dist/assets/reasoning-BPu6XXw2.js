import{d as A,u as E,o as R,r as m,Q as K,R as O,c as _,F as $,e,f as l,g as c,w as r,n as P,p as j,k as T,h as N,T as Q,U as W,I as F,W as H,M as q,a as Y,O as i,ai as G,ak as X,aa as U,Y as S,t as V,P as Z}from"./index-iZTeaJac.js";import{U as ee}from"./userListComponents-F1YBBUwJ.js";import{e as te,f as se,g as B,n as le}from"./index-C-7UpYWQ.js";import{t as ae}from"./index-2Fl6aFRQ.js";const oe={class:"p-6 border-b border-gray-100 bg-gray-50"},ne={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},de={class:"space-y-2"},re={class:"space-y-2"},ie={class:"space-y-2"},ue={class:"flex items-center gap-3 mt-6"},ce={class:"flex-1 h-[calc(100vh - 200px)] overflow-auto"},me={class:"p-6 border-t border-gray-100 bg-gray-50"},pe={class:"flex items-center justify-center"},_e={class:"text-center mt-4"},ge=A({__name:"reasoningDiagnosisComponent",props:{taskId:{}},setup(L){const g=Y(),I=E(),b=L;R(()=>{f(),C()});const o=m({patientName:"",sex:"",diseasesType:"",reasoningName:""}),y=m(!1),w=m([]),C=async()=>{const a=await K();w.value=a.data},p=m([{id:"1",name:"张三",gender:"男",age:88,idCard:"131022177987877330",phone:"15321354687",hometown:"河北省衡水市枣强县",insurance:"自费",diagnose:"食管胃结合部癌"},{id:"2",name:"张三",gender:"女",age:88,idCard:"131022177987877330",phone:"15321354687",hometown:"河北省衡水市枣强县",insurance:"医保",diagnose:"食管胃结合部癌"}]),f=async()=>{const a=await O({patient_name:o.value.patientName,tag_id:o.value.diseasesType,gender:o.value.sex});p.value=a.data},d=m([]),s=a=>{d.value=a},n=a=>{g.push({name:"dataCollection_details",query:{patient_id:a.patient_id}})},x=async()=>{const a=H.service({lock:!0,text:"正在创建方案，请稍候...",background:"rgba(255, 255, 255, 0.7)"});await te({task_id:b.taskId,doctor_id:I.getDoctorId,inference_name:o.value.reasoningName,patient_ids:d.value.map(t=>t.patient_id).join(",")}),a.close(),y.value=!1,k(),q({type:"success",message:"推理成功"})},k=()=>{o.value.patientName="",o.value.sex="",o.value.diseasesType="",o.value.reasoningName="",f()};return(a,t)=>{const h=c("el-input"),v=c("el-option"),M=c("el-select"),z=c("el-icon"),D=c("el-button"),J=c("el-dialog");return i(),_($,null,[e("div",oe,[t[11]||(t[11]=e("h2",{class:"text-lg font-bold text-gray-800 mb-4 flex items-center"},"筛选条件",-1)),e("div",ne,[e("div",de,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"患者姓名",-1)),l(h,{modelValue:o.value.patientName,"onUpdate:modelValue":t[0]||(t[0]=u=>o.value.patientName=u),class:"w-full",placeholder:"患者姓名",size:"large"},null,8,["modelValue"])]),e("div",re,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"性别",-1)),l(M,{modelValue:o.value.sex,"onUpdate:modelValue":t[1]||(t[1]=u=>o.value.sex=u),placeholder:"请选择性别",class:"w-full",size:"large",clearable:""},{default:r(()=>[l(v,{label:"男",value:0}),l(v,{label:"女",value:1})]),_:1},8,["modelValue"])]),e("div",ie,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"疾病种类",-1)),l(M,{modelValue:o.value.diseasesType,"onUpdate:modelValue":t[2]||(t[2]=u=>o.value.diseasesType=u),placeholder:"请选择疾病种类",class:"w-full",size:"large",clearable:""},{default:r(()=>[(i(!0),_($,null,P(w.value,u=>(i(),j(v,{key:u.tag_id,label:u.name,value:u.tag_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),e("div",ue,[l(D,{type:"primary",size:"large",class:"px-8",onClick:f},{default:r(()=>[l(z,{class:"mr-2"},{default:r(()=>[l(N(Q))]),_:1}),t[9]||(t[9]=T("筛选"))]),_:1,__:[9]}),l(D,{size:"large",class:"px-6",onClick:k},{default:r(()=>[l(z,{class:"mr-2"},{default:r(()=>[l(N(W))]),_:1}),t[10]||(t[10]=T("重置"))]),_:1,__:[10]})])]),e("div",ce,[l(ee,{colNum:3,type:"selection","table-data":p.value,onHandleDetails:n,onSelectionChange:s},null,8,["table-data"])]),e("div",me,[l(D,{onClick:t[3]||(t[3]=u=>y.value=!0),type:"primary",size:"large",class:"w-full h-12 text-base font-semibold"},{default:r(()=>[l(z,{class:"mr-2"},{default:r(()=>[l(N(F))]),_:1}),t[12]||(t[12]=T("立即推理 "))]),_:1,__:[12]})]),l(J,{modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=u=>y.value=u),title:"",width:"500","before-close":()=>y.value=!1},{default:r(()=>[e("div",pe,[t[13]||(t[13]=e("div",{class:"mr-2"},"推理名称",-1)),e("div",null,[l(h,{modelValue:o.value.reasoningName,"onUpdate:modelValue":t[4]||(t[4]=u=>o.value.reasoningName=u),style:{width:"240px"},placeholder:"请输入本次推理的名称"},null,8,["modelValue"])])]),e("div",_e,[l(D,{type:"primary",onClick:x},{default:r(()=>t[14]||(t[14]=[T("确认并训练")])),_:1,__:[14]})])]),_:1},8,["modelValue","before-close"])],64)}}}),be={class:"p-6 border-b border-gray-100 bg-gray-50"},fe={class:"grid grid-cols-1 md:grid-cols-1 gap-6"},ve={class:"space-y-2"},ye={class:"space-y-2"},xe={class:"space-y-2"},ke={class:"p-6 border-t border-gray-100 bg-gray-50"},we=A({__name:"reasoningImgComponent",props:{resultId:{}},setup(L){const g=E(),I=L,b=m([]),o=m(""),y=()=>{const d="//uploads/template/影像分割推理模板.zip",s="影像分割训练模板",n=document.createElement("a");n.href=d,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n)},w=async()=>{const d=new FormData;if(b.value.length===0){q({type:"error",message:"请上传数据集"});return}d.append("doctor_id",g.getDoctorId),d.append("result_id",I.resultId),d.append("remark",""),d.append("task_name",o.value),d.append("file",b.value[0].raw);const s=await se(d);C(s.data.inference_id.toString())},C=async d=>{const s=H.service({lock:!0,text:"正在推理中...",background:"rgba(255, 255, 255, 0.7)"}),n=await B({inference_id:d});p(n.data.progress);const x=setInterval(async()=>{const k=await B({inference_id:d}),a=p(k.data.progress);s.setText(a.value),a.status&&(s.close(),clearInterval(x),f.value=!0,b.value=[],o.value="")},1e3)},p=d=>d.includes("推理完成")?{status:!0,value:`${d}`}:{status:!1,value:`${d}`},f=m(!1);return(d,s)=>{const n=c("el-icon"),x=c("el-button"),k=c("el-input"),a=c("el-upload"),t=c("el-result"),h=c("el-dialog");return i(),_($,null,[e("div",be,[s[8]||(s[8]=e("h2",{class:"text-lg font-bold text-gray-800 mb-4 flex items-center"},"筛选条件",-1)),e("div",fe,[e("div",ve,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"影像分割推理模板",-1)),l(x,{type:"primary",onClick:y},{default:r(()=>[l(n,{class:"mr-2"},{default:r(()=>[l(N(G))]),_:1}),s[3]||(s[3]=T(" 下载模板"))]),_:1,__:[3]})]),e("div",ye,[s[5]||(s[5]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"推理任务名称",-1)),l(k,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=v=>o.value=v),style:{width:"240px"},placeholder:"请输入模型任务名称"},null,8,["modelValue"])]),e("div",xe,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"上传影像文件",-1)),l(a,{class:"upload-demo",drag:"",action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15",multiple:"","file-list":b.value,"onUpdate:fileList":s[1]||(s[1]=v=>b.value=v),"auto-upload":!1},{default:r(()=>[l(n,{class:"el-icon--upload"},{default:r(()=>[l(N(X))]),_:1}),s[6]||(s[6]=e("div",{class:"el-upload__text"},[T(" 将文件拖放到此处或"),e("em",null,"点击上传")],-1))]),_:1,__:[6]},8,["file-list"])])])]),e("div",ke,[l(x,{type:"primary",size:"large",onClick:w,class:"w-full h-12 text-base font-semibold"},{default:r(()=>[l(n,{class:"mr-2"},{default:r(()=>[l(N(F))]),_:1}),s[9]||(s[9]=T(" 开始推理 "))]),_:1,__:[9]})]),l(h,{modelValue:f.value,"onUpdate:modelValue":s[2]||(s[2]=v=>f.value=v),width:"500","before-close":()=>f.value=!1},{default:r(()=>[l(t,{icon:"success",title:"推理成功"})]),_:1},8,["modelValue","before-close"])],64)}}}),he={class:"flex w-full h-full bg-gradient-to-br from-slate-50 to-blue-50"},Ve={class:"w-1/4 bg-white shadow-lg border-r border-gray-200"},Te={class:"p-6 border-b border-gray-100"},Ie={class:"p-6 h-[calc(100vh-290px)] overflow-auto"},$e={key:0,class:"space-y-3"},Ne=["onClick"],Ce={class:"flex items-start justify-between"},Le={class:"flex-1"},De={class:"font-semibold text-gray-800 mb-2"},Ue={class:"text-sm text-gray-600"},Pe={key:1,class:"space-y-6"},ze={class:"bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 rounded-t-lg border-b border-gray-100"},Se={class:"text-lg font-semibold text-gray-800 flex items-center"},je={class:"p-4"},Ae={class:"grid gap-4 md:grid-cols-1 xl:grid-cols-1"},Me=["onClick"],Be={class:"flex items-center justify-between mb-4"},Ee={class:"space-y-3"},Re={class:"flex items-center justify-between"},Fe={class:"flex items-center"},He={class:"text-lg font-bold text-gray-800"},qe={class:"flex items-start justify-between"},Je=["title"],Ke={class:"flex items-center justify-between"},Oe={class:"flex items-center"},Qe={class:"text-sm font-semibold text-gray-800"},We={class:"flex-1 bg-white flex flex-col"},Ye=A({__name:"reasoning",setup(L){R(()=>{b()});const g=m({moduleType:"4"}),I=m([]),b=async()=>{const s=await ae({model_id:"4"});I.value=s.data},o=m(0),y=(s,n)=>{o.value=s.task_id},w=m([]),C=async()=>{const s=await le();w.value=s.data},p=m(),f=s=>{p.value=s.result_id},d=()=>{g.value.moduleType=="3"?C():b()};return(s,n)=>{const x=c("el-radio-button"),k=c("el-radio-group");return i(),_("div",he,[e("div",Ve,[n[4]||(n[4]=e("div",{class:"p-6 border-b border-gray-100"},[e("h1",{class:"text-xl font-bold text-gray-800 flex items-center"}," 模型推理 ")],-1)),e("div",Te,[l(k,{modelValue:g.value.moduleType,"onUpdate:modelValue":n[0]||(n[0]=a=>g.value.moduleType=a),onChange:d,size:"large"},{default:r(()=>[l(x,{label:"诊断",value:"4"}),l(x,{label:"图像分割",value:"3"})]),_:1},8,["modelValue"])]),e("div",Ie,[g.value.moduleType=="4"?(i(),_("ul",$e,[(i(!0),_($,null,P(I.value,(a,t)=>(i(),_("li",{key:a.task_id,class:S(["border rounded-xl p-4 hover:border-blue-300 hover:shadow-md transition-all duration-300 cursor-pointer hover:bg-blue-50",{"bg-blue-100 border-blue-500":o.value===a.task_id}]),onClick:h=>y(a)},[e("div",Ce,[e("div",Le,[e("h3",De,V(a.task_name),1),e("p",Ue,"描述: "+V(a.remarks),1)])])],10,Ne))),128))])):U("",!0),g.value.moduleType=="3"?(i(),_("ul",Pe,[(i(!0),_($,null,P(w.value,a=>(i(),_("li",{key:a.task_id,class:"bg-white rounded-lg shadow-sm border border-gray-200"},[e("div",ze,[e("h3",Se,V(a.task_name),1)]),e("div",je,[e("div",Ae,[(i(!0),_($,null,P(a.models,(t,h)=>(i(),_("div",{key:t.result_id,onClick:v=>f(t),class:S(["group relative border-2 rounded-xl p-5 transition-all duration-300 cursor-pointer hover:shadow-lg transform hover:-translate-y-1",{"bg-blue-50 border-blue-400 shadow-md":p.value===t.result_id,"bg-white border-gray-200 hover:border-blue-300 hover:bg-blue-50":p.value!==t.result_id}])},[e("div",Be,[e("span",{class:S(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",{"bg-blue-100 text-blue-800":p.value===t.result_id,"bg-gray-100 text-gray-700 group-hover:bg-blue-100 group-hover:text-blue-800":p.value!==t.result_id}])}," 调优 "+V(h+1),3)]),e("div",Ee,[e("div",Re,[n[1]||(n[1]=e("span",{class:"text-sm font-medium text-gray-600"},"Dice得分",-1)),e("div",Fe,[e("span",He,V(t.dice),1)])]),e("div",qe,[n[2]||(n[2]=e("span",{class:"text-sm font-medium text-gray-600"},"网络配置",-1)),e("span",{class:"text-sm text-right text-gray-800 font-mono bg-gray-100 px-2 py-1 rounded w-20 inline-block truncate",title:t.model_type},V(t.model_type),9,Je)]),e("div",Ke,[n[3]||(n[3]=e("span",{class:"text-sm font-medium text-gray-600"},"K折验证",-1)),e("div",Oe,[e("span",Qe,V(t.fold),1)])])])],10,Me))),128))])])]))),128))])):U("",!0)])]),e("div",We,[g.value.moduleType=="4"?(i(),j(ge,{key:0,taskId:o.value},null,8,["taskId"])):U("",!0),g.value.moduleType=="3"?(i(),j(we,{key:1,resultId:p.value},null,8,["resultId"])):U("",!0)])])}}}),tt=Z(Ye,[["__scopeId","data-v-fd6caca5"]]);export{tt as default};
