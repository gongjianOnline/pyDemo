import{d as ue,o as ie,r as n,c as p,e as t,f as s,g as c,k as v,w as o,F as b,n as g,h as r,ai as re,ak as me,Y as q,t as d,a3 as ce,at as G,a4 as pe,p as z,I as ve,U as J,x as H,M as P,W as fe,O as u,P as _e}from"./index-iZTeaJac.js";import{n as be,b as ge,c as Q,d as xe}from"./index-C-7UpYWQ.js";const ye={class:"bg-gradient-to-br bg-gray-50 p-6"},we={class:"max-w-7xl mx-auto"},ke={class:"flex gap-6 h-full"},Ve={class:"w-1/3 bg-white rounded-2xl shadow-xl p-6 space-y-6 h-[calc(100vh-180px)] overflow-auto"},he={class:"space-y-2"},Ce={class:"space-y-2"},Te={class:"flex text-sm font-semibold text-gray-700 mb-2"},De={class:"text-xs ml-2 mr-2"},Ue={class:"space-y-2"},je=["onClick"],Ye={class:"flex items-center justify-between flex-1"},Ie={class:"flex items-center gap-3 flex-1"},Me={class:"flex justify-between flex-1"},Ne={class:"font-medium text-sm text-slate-800"},ze={class:"font-medium text-sm text-slate-800"},Le={class:"opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-slate-200"},He={class:"flex-1 bg-white rounded-2xl shadow-xl p-6 h-[calc(100vh-180px)] overflow-auto"},Pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},Se={class:"bg-gray-50 rounded-lg p-3"},$e={class:"bg-gray-50 rounded-lg p-3"},Fe={class:"bg-gray-50 rounded-lg p-3"},Re={class:"flex gap-4"},Ae={class:"bg-gray-50 rounded-lg p-3"},Be={class:"bg-gray-50 rounded-lg p-3"},Ee={class:"flex gap-4"},Ke={class:"space-y-4"},Oe={class:"flex items-center justify-between py-2 border-b border-gray-100"},We={class:"text-sm text-gray-900"},qe={class:"flex items-center justify-between py-2 border-b border-gray-100"},Ge={class:"text-sm font-semibold text-blue-600"},Je={class:"flex items-center justify-between py-2 border-b border-gray-100"},Qe={class:"text-sm text-gray-900"},Xe={class:"flex items-center justify-between py-2 border-b border-gray-100"},Ze={class:"text-sm text-gray-900"},et={class:"space-y-6"},tt={class:"bg-gray-50 rounded-lg p-4 space-y-3"},lt={class:"flex items-center justify-between"},st={class:"text-sm font-semibold text-gray-900"},at={class:"flex items-center justify-between"},ot={class:"text-sm text-gray-900"},nt={class:"space-y-4"},dt={class:"flex items-center justify-between border-b border-gray-100 pb-2"},ut={class:"text-sm font-medium text-blue-600"},it={class:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full"},rt={class:"grid grid-cols-1 gap-2"},mt={class:"flex items-center justify-between"},ct={class:"text-sm font-medium text-gray-900"},pt={class:"flex items-center justify-between"},vt={class:"text-sm font-semibold text-green-600"},ft={class:"flex items-center justify-between"},_t={class:"text-sm text-gray-900"},bt=ue({__name:"segmentedTrain",setup(gt){ie(()=>{$()});const S=n([]),$=async()=>{const a=await be();S.value=a.data},X=()=>{const a="//uploads/template/影像分割训练模板.zip",e="影像分割训练模板",i=document.createElement("a");i.href=a,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)},h=n({moduleValue:""}),C=n(0),T=n(""),F=n([{value:"2d",label:"2d"},{value:"3d_fullres",label:"3d_fullres"}]),D=n(""),R=n([{value:"0",label:"0"},{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"5",label:"5"}]),x=n([]),Z=async()=>{const a=new FormData;if(x.value.length===0)return P({type:"error",message:"请上传数据集"});a.append("file",x.value[0].raw),a.append("task_name",h.value.moduleValue),a.append("nnunet_id",C.value.toString()),a.append("model_type",T.value),a.append("fold",D.value),a.append("remark","");const e=await xe(a);P({type:"success",message:"任务创建成功"}),E(),A(e.data.result_id)},y=n({}),A=async a=>{const e=fe.service({lock:!0,text:"正在训练中...",background:"rgba(255, 255, 255, 0.7)"}),i=await Q({result_id:a.toString()});B(i.data.remark);const m=setInterval(async()=>{const f=await Q({result_id:a.toString()}),Y=B(f.data.remark);e.setText(Y.value),Y.status&&(e.close(),y.value=f.data,U.value=!0,clearInterval(m),$())},1e3)},B=a=>a.includes("模型训练中")?{status:!1,value:`${a} / 10`}:a.includes("训练完成")?{status:!0,value:`${a}`}:{status:!1,value:`${a}`},E=()=>{h.value.moduleValue="",C.value=0,T.value="",D.value="",x.value=[]},w=n(""),k=n(""),L=n(0),ee=a=>{L.value=a},te=a=>{_.value=a,V.value=!0},V=n(!1),le=async()=>{if(_.value.models.some(i=>i.model_type==w.value&&i.fold==k.value)){P({type:"warning",message:"该组合参数已经存在，请尝试其它参数组合"});return}const e=await ge({task_id:_.value.task_id,model_type:w.value,fold:parseInt(k.value)});await A(e.data.result_id),V.value=!1},se=()=>{w.value="",k.value=""},U=n(!1),_=n({}),j=n(!1),ae=a=>{j.value=!0,_.value=a};return(a,e)=>{const i=c("el-input"),m=c("el-icon"),f=c("el-button"),Y=c("el-upload"),K=c("el-dropdown-item"),oe=c("el-dropdown"),ne=c("el-input-number"),I=c("el-option"),M=c("el-select"),de=c("el-drawer"),O=c("el-dialog");return u(),p(b,null,[t("div",ye,[t("div",we,[t("div",ke,[t("div",Ve,[t("div",he,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," 模型名称 ",-1)),s(i,{modelValue:h.value.moduleValue,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value.moduleValue=l),placeholder:"请输入模型名称",class:"w-full",size:"large",clearable:""},null,8,["modelValue"])]),t("div",Ce,[t("label",Te,[e[13]||(e[13]=v(" 上传训练压缩文件 ")),t("div",De,[s(f,{type:"primary",size:"small",onClick:X},{default:o(()=>[s(m,{class:"mr-1"},{default:o(()=>[s(r(re))]),_:1}),e[11]||(e[11]=v("下载模板数据"))]),_:1,__:[11]}),e[12]||(e[12]=t("div",null,"（训练集参考格式）",-1))])]),s(Y,{class:"upload-demo",drag:"","auto-upload":!1,"file-list":x.value,"onUpdate:fileList":e[1]||(e[1]=l=>x.value=l),multiple:""},{default:o(()=>[s(m,{class:"el-icon--upload"},{default:o(()=>[s(r(me))]),_:1}),e[14]||(e[14]=t("div",{class:"el-upload__text"},[v(" 将文件拖放到此处或 "),t("em",null,"点击上传")],-1))]),_:1,__:[14]},8,["file-list"])]),t("div",Ue,[e[17]||(e[17]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," 历史训练结果 ",-1)),t("div",null,[(u(!0),p(b,null,g(S.value,(l,N)=>(u(),p("div",{key:N,class:q(["group relative p-3 rounded-lg cursor-pointer transition-all duration-200 hover:bg-slate-50",{"bg-blue-50 border-l-4 border-blue-500":L.value===l.nnunet_id}]),onClick:W=>ee(l)},[t("div",Ye,[t("div",Ie,[t("div",{class:q(["w-2 h-2 rounded-full bg-green-500",{"bg-blue-500":L.value===l.nnunet_id}])},null,2),t("div",Me,[t("div",Ne,d(l.task_name),1),t("div",ze,"id:"+d(l.nnunet_id),1)])]),s(oe,{trigger:"click"},{dropdown:o(()=>[s(K,{command:"delete",divided:"",onClick:W=>te(l)},{default:o(()=>[s(m,{class:"mr-2"},{default:o(()=>[s(r(G))]),_:1}),e[15]||(e[15]=v("继续训练"))]),_:2,__:[15]},1032,["onClick"]),s(K,{command:"delete",divided:"",onClick:W=>ae(l)},{default:o(()=>[s(m,{class:"mr-2"},{default:o(()=>[s(r(pe))]),_:1}),e[16]||(e[16]=v("训练详情"))]),_:2,__:[16]},1032,["onClick"])]),default:o(()=>[t("div",Le,[s(m,null,{default:o(()=>[s(r(ce))]),_:1})])]),_:2},1024)])],10,je))),128))])])]),t("div",He,[e[24]||(e[24]=t("div",{class:"mb-6"},[t("h2",{class:"text-xl font-bold text-gray-800 mb-2"},"算法参数配置"),t("p",{class:"text-gray-600"},"调整模型训练参数以获得最佳性能")],-1)),t("div",Pe,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-semibold text-gray-700"},"任务ID",-1)),t("div",Se,[s(ne,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=l=>C.value=l),"controls-position":"right",size:"large"},null,8,["modelValue"])]),e[19]||(e[19]=t("p",{class:"text-sm text-gray-600 leading-relaxed"},"任务ID不能重复",-1))]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-semibold text-gray-700"},"U-Net网络配置",-1)),t("div",$e,[s(M,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=l=>T.value=l),placeholder:"U-Net网络配置",style:{width:"240px"}},{default:o(()=>[(u(!0),p(b,null,g(F.value,l=>(u(),z(I,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-semibold text-gray-700"},"5折交叉验证",-1)),t("div",Fe,[s(M,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=l=>D.value=l),placeholder:"5折交叉验证",style:{width:"240px"}},{default:o(()=>[(u(!0),p(b,null,g(R.value,l=>(u(),z(I,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),t("div",Re,[s(f,{type:"primary",size:"large",onClick:Z,class:"flex-1 h-12 text-base font-semibold"},{default:o(()=>[s(m,{class:"mr-2"},{default:o(()=>[s(r(ve))]),_:1}),e[22]||(e[22]=v(" 开始训练 "))]),_:1,__:[22]}),s(f,{type:"default",size:"large",onClick:E,class:"h-12 text-base font-semibold"},{default:o(()=>[s(m,{class:"mr-2"},{default:o(()=>[s(r(J))]),_:1}),e[23]||(e[23]=v(" 重置 "))]),_:1,__:[23]})])])])])]),s(de,{modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=l=>V.value=l),"before-close":()=>V.value=!1},{default:o(()=>[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-semibold text-gray-700"},"U-Net网络配置",-1)),t("div",Ae,[s(M,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=l=>w.value=l),placeholder:"U-Net网络配置",style:{width:"240px"}},{default:o(()=>[(u(!0),p(b,null,g(F.value,l=>(u(),z(I,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-semibold text-gray-700"},"5折交叉验证",-1)),t("div",Be,[s(M,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=l=>k.value=l),placeholder:"5折交叉验证",style:{width:"240px"}},{default:o(()=>[(u(!0),p(b,null,g(R.value,l=>(u(),z(I,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",Ee,[s(f,{type:"primary",size:"large",onClick:le,class:"flex-1 h-12 text-base font-semibold"},{default:o(()=>[s(m,{class:"mr-2"},{default:o(()=>[s(r(G))]),_:1}),e[27]||(e[27]=v(" 继续训练 "))]),_:1,__:[27]}),s(f,{type:"default",size:"large",onClick:se,class:"h-12 text-base font-semibold"},{default:o(()=>[s(m,{class:"mr-2"},{default:o(()=>[s(r(J))]),_:1}),e[28]||(e[28]=v(" 重置 "))]),_:1,__:[28]})])]),_:1},8,["modelValue","before-close"]),s(O,{modelValue:U.value,"onUpdate:modelValue":e[8]||(e[8]=l=>U.value=l),title:"训练详情",width:"500","before-close":()=>U.value=!1},{default:o(()=>[t("div",Ke,[t("div",Oe,[e[29]||(e[29]=t("span",{class:"text-sm font-medium text-gray-600"},"训练时间：",-1)),t("span",We,d(r(H)(y.value.completed_time||"").format("YYYY-MM-DD HH:mm:ss")),1)]),t("div",qe,[e[30]||(e[30]=t("span",{class:"text-sm font-medium text-gray-600"},"准确率：",-1)),t("span",Ge,d(y.value.dice||""),1)]),t("div",Je,[e[31]||(e[31]=t("span",{class:"text-sm font-medium text-gray-600"},"U-Net网络配置：",-1)),t("span",Qe,d(y.value.model_type||""),1)]),t("div",Xe,[e[32]||(e[32]=t("span",{class:"text-sm font-medium text-gray-600"},"K折交叉验证数量：",-1)),t("span",Ze,d(y.value.fold||""),1)])])]),_:1},8,["modelValue","before-close"]),s(O,{modelValue:j.value,"onUpdate:modelValue":e[9]||(e[9]=l=>j.value=l),title:"训练详情",width:"500","before-close":()=>j.value=!1},{default:o(()=>[t("div",et,[t("div",tt,[e[35]||(e[35]=t("h3",{class:"text-base font-semibold text-gray-800 mb-3"},"基本信息",-1)),t("div",lt,[e[33]||(e[33]=t("span",{class:"text-sm font-medium text-gray-600"},"模型名称：",-1)),t("span",st,d(_.value.task_name),1)]),t("div",at,[e[34]||(e[34]=t("span",{class:"text-sm font-medium text-gray-600"},"提交时间：",-1)),t("span",ot,d(r(H)(_.value.completed_time||"").format("YYYY-MM-DD HH:mm:ss")),1)])]),t("div",nt,[e[39]||(e[39]=t("h3",{class:"text-base font-semibold text-gray-800"},"训练模型",-1)),(u(!0),p(b,null,g(_.value.models,(l,N)=>(u(),p("div",{key:N,class:"border border-gray-200 rounded-lg p-4 space-y-3 hover:shadow-sm transition-shadow"},[t("div",dt,[t("span",ut,"模型 "+d(N+1),1),t("span",it,d(l.model_type),1)]),t("div",rt,[t("div",mt,[e[36]||(e[36]=t("span",{class:"text-sm text-gray-600"},"K折交叉验证数量：",-1)),t("span",ct,d(l.fold),1)]),t("div",pt,[e[37]||(e[37]=t("span",{class:"text-sm text-gray-600"},"Dice得分：",-1)),t("span",vt,d(l.dice),1)]),t("div",ft,[e[38]||(e[38]=t("span",{class:"text-sm text-gray-600"},"完成时间：",-1)),t("span",_t,d(r(H)(l.completed_time).format("YYYY-MM-DD HH:mm:ss")),1)])])]))),128))])])]),_:1},8,["modelValue","before-close"])],64)}}}),wt=_e(bt,[["__scopeId","data-v-dcee6df7"]]);export{wt as default};
