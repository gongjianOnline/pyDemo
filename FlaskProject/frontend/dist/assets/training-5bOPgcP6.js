import{d as z,u as L,r as p,c as x,e as o,f as t,a1 as N,g as m,k as c,w as d,F as k,n as T,h as _,ai as S,ak as M,t as V,aB as E,U as I,O as b,M as h,W as j,P as O}from"./index-iZTeaJac.js";import{c as P}from"./index-FnU4Z0QY.js";import{T as $}from"./TrainLIst-ClyIvyM8.js";import{_ as R}from"./NoticeModal.vue_vue_type_script_setup_true_lang-CrlJJ41n.js";import"./index-2Fl6aFRQ.js";const W={class:"bg-gradient-to-br bg-gray-50 p-6"},q={class:"mb-2 flex justify-between"},G={class:"max-w-7xl mx-auto"},H={class:"flex gap-6 h-full"},J={class:"w-1/3 bg-white rounded-2xl shadow-xl p-6 space-y-6 h-[calc(100vh-180px)] overflow-auto"},K={class:"space-y-2"},Q={class:"space-y-2"},X={class:"flex text-sm font-semibold text-gray-700 mb-2"},Y={class:"ml-2 flex flex-col justify-center"},Z={class:"flex-1 bg-white rounded-2xl shadow-xl p-6 h-[calc(100vh-180px)] overflow-auto"},ee={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},oe={class:"bg-gray-50 rounded-lg p-3"},le={class:"flex"},te={class:"block text-sm font-semibold text-gray-700"},ae={class:"bg-gray-50 rounded-lg p-3"},se={class:"text-gray-600 text-sm mt-2"},ne={class:"flex gap-4"},de=z({__name:"training",setup(re){const w=L(),g=p(!1),v=p([]),f=p({moduleValue:"",dataSetValue:"",algorithmValue:"",moduleType:"5",selectedAlgorithm:null,selectedAlgorithmName:""}),l=p({proportionA:"",proportionB:"",proportionC:""}),C=p([{name:"训练轮次",key:"epochs",description:""},{name:"批次大小",key:"batch_size",description:"批量大小 默认16"},{name:"学习率",key:"lr",description:"学习率 默认1e-4"},{name:"特征数量",key:"num_features",description:"ResNet 输出的特征维度 默认 2048"},{name:"线程数",key:"num_workers",description:"DataLoader 的 num_workers 默认0"}]),F=async()=>{const r=parseFloat(l.value.proportionA)||0,e=parseFloat(l.value.proportionB)||0,n=parseFloat(l.value.proportionC)||0,i=Math.round((r+e+n)*100)/100;if(Math.abs(i-1)>.01){h({message:"比例之和必须为1",type:"error"});return}if(v.value.length==0){h({type:"error",message:"请上传文件模板"});return}const u=j.service({lock:!0,text:"正在创建方案，请稍候...",background:"rgba(255, 255, 255, 0.7)"});try{const a=new FormData;a.append("doctor_id",w.getDoctorId),a.append("file",v.value[0].raw),a.append("model_id",f.value.moduleType),a.append("remarks",""),a.append("task_name",f.value.moduleValue),a.append("train_ratio",l.value.proportionA),a.append("val_ratio",l.value.proportionB),a.append("test_ratio",l.value.proportionC),a.append("epochs",l.value.epochs),a.append("batch_size",l.value.batch_size),a.append("lr",l.value.lr),a.append("num_workers",l.value.num_workers),a.append("num_workers",l.value.num_features),await P(a),u.close(),g.value=!0,y()}catch{u.close()}},y=()=>{for(let r in l.value)l.value[r]=""},B=()=>{const r="//uploads/template/病理组学模板.zip",e="病理组学训练模板",n=document.createElement("a");n.href=r,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)};return(r,e)=>{const n=m("el-input"),i=m("el-icon"),u=m("el-button"),a=m("el-upload"),A=m("el-input-number");return b(),x(k,null,[o("div",W,[o("div",q,[e[6]||(e[6]=N('<div class="flex items-center" data-v-a6eecc1d><div class="flex items-center space-x-3 mb-3" data-v-a6eecc1d><div class="w-1 h-8 bg-gradient-to-b from-blue-500 to-indigo-600 rounded-full" data-v-a6eecc1d></div><h1 class="text-3xl font-bold text-gray-800" data-v-a6eecc1d>病理组学训练平台</h1></div><p class="text-gray-600 ml-7" data-v-a6eecc1d>基于机器学习的智能病理组学模型训练系统</p></div>',1)),o("div",null,[t($,{"model-id":"5"})])]),o("div",G,[o("div",H,[o("div",J,[o("div",K,[e[7]||(e[7]=o("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," 模型名称 ",-1)),t(n,{modelValue:f.value.moduleValue,"onUpdate:modelValue":e[0]||(e[0]=s=>f.value.moduleValue=s),placeholder:"请输入模型名称",class:"w-full",size:"large",clearable:""},null,8,["modelValue"])]),o("div",Q,[o("label",X,[e[10]||(e[10]=c(" 训练数据上传 ")),o("div",Y,[t(u,{type:"primary",link:"",onClick:B},{default:d(()=>[t(i,{class:"mr-1"},{default:d(()=>[t(_(S))]),_:1}),e[8]||(e[8]=c(" 下载训练数据模板 "))]),_:1,__:[8]}),e[9]||(e[9]=o("div",null,"（训练集参考格式）",-1))])]),t(a,{class:"upload-demo",drag:"",action:"",multiple:"","file-list":v.value,"onUpdate:fileList":e[1]||(e[1]=s=>v.value=s),"auto-upload":!1},{default:d(()=>[t(i,{class:"el-icon--upload"},{default:d(()=>[t(_(M))]),_:1}),e[11]||(e[11]=o("div",{class:"el-upload__text"},[c(" 在此处拖放文件或"),o("em",null,"点击上传")],-1))]),_:1,__:[11]},8,["file-list"])])]),o("div",Z,[e[16]||(e[16]=o("div",{class:"mb-6"},[o("h2",{class:"text-xl font-bold text-gray-800 mb-2"},"算法参数配置"),o("p",{class:"text-gray-600"},"调整模型训练参数以获得最佳性能")],-1)),o("div",ee,[o("div",null,[e[13]||(e[13]=o("label",{class:"block text-sm font-semibold text-gray-700"},"选择比例",-1)),o("div",oe,[o("div",le,[t(n,{modelValue:l.value.proportionA,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.proportionA=s),placeholder:"0.7",class:"mr-1"},null,8,["modelValue"]),t(n,{modelValue:l.value.proportionB,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.proportionB=s),placeholder:"0.2",class:"mr-1"},null,8,["modelValue"]),t(n,{modelValue:l.value.proportionC,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.proportionC=s),placeholder:"0.1"},null,8,["modelValue"])]),e[12]||(e[12]=o("div",{class:"text-gray-600 text-sm mt-2"},"用于数据集的比例训练0.6:0.2:0.2(训练:推理:验证)比例，总数为一",-1))])]),(b(!0),x(k,null,T(C.value,(s,D)=>(b(),x("div",{key:D,class:"space-y-2"},[o("label",te,V(s.name),1),o("div",ae,[t(A,{modelValue:l.value[s.key],"onUpdate:modelValue":U=>l.value[s.key]=U,"controls-position":"right",class:"w-full",size:"large"},null,8,["modelValue","onUpdate:modelValue"]),o("div",se,V(s.description),1)])]))),128))]),o("div",ne,[t(u,{type:"primary",size:"large",onClick:F,class:"flex-1 h-12 text-base font-semibold"},{default:d(()=>[t(i,{class:"mr-2"},{default:d(()=>[t(_(E))]),_:1}),e[14]||(e[14]=c(" 开始训练 "))]),_:1,__:[14]}),t(u,{type:"default",size:"large",onClick:y,class:"h-12 text-base font-semibold"},{default:d(()=>[t(i,{class:"mr-2"},{default:d(()=>[t(_(I))]),_:1}),e[15]||(e[15]=c(" 重置 "))]),_:1,__:[15]})])])])])]),t(R,{noticeDialog:g.value,onOnClose:e[5]||(e[5]=s=>g.value=s)},null,8,["noticeDialog"])],64)}}}),ve=O(de,[["__scopeId","data-v-a6eecc1d"]]);export{ve as default};
