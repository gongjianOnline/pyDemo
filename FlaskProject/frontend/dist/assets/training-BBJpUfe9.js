import{d as O,u as $,o as J,r as p,c as f,e as t,a1 as Y,f as d,g as y,k as _,w as m,F as S,n as B,a8 as I,a9 as U,h,ai as q,ak as G,Y as H,t as g,I as K,U as Q,O as b,M as k,P as R}from"./index-iZTeaJac.js";import{d as W,f as X,g as Z}from"./index-2Fl6aFRQ.js";import{c as ee}from"./index-Bqa-GVRE.js";import{T as te}from"./TrainLIst-ClyIvyM8.js";const ae={class:"min-h-screen bg-gradient-to-br bg-gray-50 p-4"},le={class:"mb-2 flex items-center justify-between"},oe={class:"max-w-7xl mx-auto"},se={class:"flex gap-6 h-full items-start justify-start"},de={class:"w-1/3 bg-white rounded-2xl shadow-xl p-6 space-y-6"},re={class:"space-y-2"},ie={class:"space-y-2"},ne={class:"text-sm font-semibold text-gray-700 mb-2 flex"},ue={class:"ml-2"},pe={class:"space-y-3"},me={class:"overflow-y-auto space-y-3"},ce=["onClick"],ve={class:"flex items-center justify-between mb-2"},fe={class:"font-semibold text-gray-800"},_e={class:"text-sm text-gray-600 leading-relaxed"},ge={class:"flex-1 bg-white rounded-2xl shadow-xl p-6"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},xe={class:"bg-gray-50 rounded-lg p-3"},ye={class:"flex"},he={class:"text-sm flex items-center"},we={class:"font-semibold text-gray-700"},Ve={class:"ml-2 text-xs"},ke={class:"bg-gray-50 rounded-lg p-3"},Ae={class:"text-gray-600 text-sm mt-2"},Ce={class:"flex gap-4"},Fe=O({__name:"training",setup(Le){const D=$();J(()=>{P(),N()});const c=p([]),u=p({moduleValue:"",dataSetValue:"",algorithmValue:"",moduleType:"2",selectedAlgorithm:null}),T=p(),P=async()=>{const l=await W({dataset_type:"2",is_active:"1"});T.value=l.data.list},x=p([]),N=async()=>{const l=await X({model_id:u.value.moduleType,is_active:"1"});x.value=l.data.list,u.value.selectedAlgorithm=l.data.list[0]?.algorithm_id||"",F()},M=l=>{u.value.selectedAlgorithm=l.algorithm_id,F()},A=p([]),o=p({}),w=p({}),C=p([]),F=async()=>{const l=await Z({algorithm_id:u.value.selectedAlgorithm?.toString()});o.value={},w.value={},A.value=l.data.list,o.value.proportionA="",o.value.proportionB="",o.value.proportionC="",l.data.list.forEach(e=>{o.value[e.param_name]=e.default_value,w.value[e.param_name]=e.param_type}),C.value=l.data.list.map(e=>e.param_id.toString())},j=async()=>{const{proportionA:l,proportionB:e,proportionC:s,...i}=o.value,n=parseFloat(o.value.proportionA)||0,V=parseFloat(o.value.proportionB)||0,a=parseFloat(o.value.proportionC)||0,v=Math.round((n+V+a)*100)/100;if(Math.abs(v-1)>.01){k({message:"比例之和必须为1",type:"error"});return}const r=new FormData;if(c.value.length===0){k({type:"error",message:"缺少模板文件"});return}r.append("file",c.value[0].raw),r.append("doctor_id",D.getDoctorId),r.append("model_id","2"),r.append("algorithm_id",u.value.selectedAlgorithm+""),r.append("param_ids",C.value.join(",")),r.append("param_values",JSON.stringify({...z(w.value,i)})),r.append("train_ratio",l),r.append("val_ratio",e),r.append("test_ratio",s),r.append("task_name",u.value.moduleValue),r.append("remarks",""),await ee(r),k({type:"success",message:"训练完成"}),L()},L=()=>{c.value=[],u.value.moduleValue="";for(let l in o.value)o.value[l]=""},z=(l,e)=>{const s={};for(const i in l){const n=e[i];if(n!=null)switch(l[i]){case"int":s[i]=parseInt(n,10);break;case"float":s[i]=parseFloat(n);break;case"enum":s[i]=String(n);break;default:s[i]=n}}return s},E=()=>{const l="//uploads/template/诊疗优化模板.xlsx",e="诊疗优化模板",s=document.createElement("a");s.href=l,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s)};return(l,e)=>{const s=y("el-input"),i=y("el-icon"),n=y("el-button"),V=y("el-upload");return b(),f("div",ae,[t("div",le,[e[5]||(e[5]=Y('<div class="flex items-center" data-v-f16bc0f6><div class="flex items-center space-x-3 mb-3" data-v-f16bc0f6><div class="w-1 h-8 bg-gradient-to-b from-blue-500 to-indigo-600 rounded-full" data-v-f16bc0f6></div><h1 class="text-3xl font-bold text-gray-800" data-v-f16bc0f6>临床研究训练平台</h1></div><p class="text-gray-600 ml-7" data-v-f16bc0f6>基于机器学习的临床研究训练系统</p></div>',1)),t("div",null,[d(te,{"model-id":"2"})])]),t("div",oe,[t("div",se,[t("div",de,[t("div",re,[e[6]||(e[6]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," 模型名称 ",-1)),d(s,{modelValue:u.value.moduleValue,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.moduleValue=a),placeholder:"请输入模型名称",class:"w-full",size:"large",clearable:""},null,8,["modelValue"])]),t("div",ie,[t("label",ne,[e[9]||(e[9]=_(" 选择数据集 ")),t("div",ue,[d(n,{type:"primary",link:"",onClick:E},{default:m(()=>[d(i,{class:"mr-1"},{default:m(()=>[d(h(q))]),_:1}),e[7]||(e[7]=_(" 下载文件训练数据模板 "))]),_:1,__:[7]}),e[8]||(e[8]=t("div",null,"（训练集参考格式）",-1))])]),d(V,{class:"upload-demo",drag:"",action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15",multiple:"","auto-upload":!1,"file-list":c.value,"onUpdate:fileList":e[1]||(e[1]=a=>c.value=a)},{default:m(()=>[d(i,{class:"el-icon--upload"},{default:m(()=>[d(h(G))]),_:1}),e[10]||(e[10]=t("div",{class:"el-upload__text"},[_(" 在此处拖放文件或"),t("em",null,"点击上传")],-1))]),_:1,__:[10]},8,["file-list"])]),t("div",pe,[e[11]||(e[11]=t("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},"选择算法",-1)),t("div",me,[(b(!0),f(S,null,B(x.value,(a,v)=>(b(),f("div",{key:v,class:"cursor-pointer transition-all duration-300",onClick:r=>M(a)},[t("div",{class:H(["border rounded-xl p-4 hover:border-blue-300 hover:bg-blue-50 bg-white",u.value.selectedAlgorithm===a.algorithm_id?"border-2 border-blue-500":"border-gray-200"])},[t("div",ve,[t("h4",fe,g(a.name),1)]),t("p",_e,g(a.description),1)],2)],8,ce))),128))])])]),t("div",ge,[e[16]||(e[16]=t("div",{class:"mb-6"},[t("h2",{class:"text-xl font-bold text-gray-800 mb-2"},"算法参数配置"),t("p",{class:"text-gray-600"},"调整模型训练参数以获得最佳性能")],-1)),I(t("div",be,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-semibold text-gray-700"},"选择比例",-1)),t("div",xe,[t("div",ye,[d(s,{modelValue:o.value.proportionA,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.proportionA=a),placeholder:"0.7",class:"mr-1"},null,8,["modelValue"]),d(s,{modelValue:o.value.proportionB,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.proportionB=a),placeholder:"0.2",class:"mr-1"},null,8,["modelValue"]),d(s,{modelValue:o.value.proportionC,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.proportionC=a),placeholder:"0.1"},null,8,["modelValue"])]),e[12]||(e[12]=t("div",{class:"text-gray-600 text-sm mt-2"},"用于数据集的比例训练0.6:0.2:0.2(训练:验证:测试)集比例，总数为一",-1))])]),(b(!0),f(S,null,B(A.value,(a,v)=>(b(),f("div",{key:v,class:"space-y-2"},[t("label",he,[t("div",we,g(a.param_name),1),t("div",Ve,"范围："+g(a.allowed_values),1)]),t("div",ke,[d(s,{modelValue:o.value[a.param_name],"onUpdate:modelValue":r=>o.value[a.param_name]=r,placeholder:a.allowed_values,class:"w-full"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t("div",Ae,g(a.description),1)])]))),128))],512),[[U,x.value.length]]),I(t("div",Ce,[d(n,{type:"primary",size:"large",onClick:j,class:"flex-1 h-12 text-base font-semibold"},{default:m(()=>[d(i,{class:"mr-2"},{default:m(()=>[d(h(K))]),_:1}),e[14]||(e[14]=_("开始训练 "))]),_:1,__:[14]}),d(n,{type:"default",size:"large",onClick:L,class:"h-12 text-base font-semibold"},{default:m(()=>[d(i,{class:"mr-2"},{default:m(()=>[d(h(Q))]),_:1}),e[15]||(e[15]=_(" 重置 "))]),_:1,__:[15]})],512),[[U,x.value.length]])])])])])}}}),De=R(Fe,[["__scopeId","data-v-f16bc0f6"]]);export{De as default};
